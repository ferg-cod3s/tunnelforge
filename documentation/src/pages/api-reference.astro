---
import Layout from '../layouts/Layout.astro';
---

<Layout title="API Reference - TunnelForge Documentation">
  <div class="page-header">
    <h1>TunnelForge API Documentation</h1>
    <p>Complete API reference for TunnelForge's RESTful API and WebSocket endpoints.</p>
  </div>

  <div class="content">
    <section class="overview">
      <h2>Overview</h2>
      <p>TunnelForge provides a RESTful API for managing terminal sessions and a WebSocket API for real-time terminal I/O. All APIs are served from the base URL (default: <code>http://localhost:4020</code>).</p>
    </section>

    <section class="authentication">
      <h2>Authentication</h2>
      
      <h3>Authentication Methods</h3>
      <p>The API supports multiple authentication methods configured at server startup:</p>
      <ol>
        <li><strong>No Authentication</strong> (<code>--no-auth</code>)</li>
        <li><strong>System Authentication</strong> (default) - Uses OS user accounts</li>
        <li><strong>Environment Variables</strong> - <code>TUNNELFORGE_USERNAME</code> and <code>TUNNELFORGE_PASSWORD</code></li>
        <li><strong>SSH Keys</strong> (<code>--enable-ssh-keys</code>)</li>
        <li><strong>Local Bypass</strong> (<code>--allow-local-bypass</code>)</li>
      </ol>

      <h3>Authentication Headers</h3>
      <p>For authenticated endpoints, include credentials:</p>
      <pre><code>Authorization: Basic &lt;base64(username:password)&gt;</code></pre>
      <p>Or for token-based auth:</p>
      <pre><code>X-Auth-Token: &lt;token&gt;</code></pre>
    </section>

    <section class="rest-api">
      <h2>REST API Endpoints</h2>
      
      <h3>Sessions</h3>
      
      <div class="endpoint">
        <h4>Create Session</h4>
        <p>Creates a new terminal session.</p>
        <p><strong>Endpoint</strong>: <code>POST /api/sessions</code></p>
        
        <h5>Request Body</h5>
        <p>Send a JSON payload with session configuration including title, command, working directory, and terminal dimensions.</p>
        
        <h5>Response</h5>
        <p>Returns session details including unique ID, status, and process information.</p>
      </div>

      <div class="endpoint">
        <h4>List Sessions</h4>
        <p>Get all active sessions.</p>
        <p><strong>Endpoint</strong>: <code>GET /api/sessions</code></p>
        
        <h5>Response</h5>
        <p>Returns an array of all active sessions with their current status and metadata.</p>
      </div>

      <div class="endpoint">
        <h4>Get Session</h4>
        <p>Get details of a specific session.</p>
        <p><strong>Endpoint</strong>: <code>GET /api/sessions/:id</code></p>
        
        <h5>Response</h5>
        <p>Returns detailed information about the specified session including status, process ID, and activity timestamps.</p>
      </div>

      <div class="endpoint">
        <h4>Update Session</h4>
        <p>Update session properties like title and terminal dimensions.</p>
        <p><strong>Endpoint</strong>: <code>PATCH /api/sessions/:id</code></p>
      </div>

      <div class="endpoint">
        <h4>Delete Session</h4>
        <p>Terminate a session.</p>
        <p><strong>Endpoint</strong>: <code>DELETE /api/sessions/:id</code></p>
      </div>
    </section>

    <section class="websocket-api">
      <h2>WebSocket API</h2>
      <p>For real-time terminal I/O, connect to the WebSocket endpoint:</p>
      <pre><code>ws://localhost:4020/ws/sessions/:id</code></pre>
      
      <h3>Message Types</h3>
      <ul>
        <li><strong>Input</strong> - Send terminal input to the session</li>
        <li><strong>Output</strong> - Receive terminal output from the session</li>
        <li><strong>Resize</strong> - Resize the terminal window</li>
        <li><strong>Status</strong> - Session status updates</li>
      </ul>
    </section>

    <section class="error-handling">
      <h2>Error Handling</h2>
      <p>All API endpoints return appropriate HTTP status codes and error messages:</p>
      <ul>
        <li><strong>400</strong> - Bad Request (invalid parameters)</li>
        <li><strong>401</strong> - Unauthorized (authentication required)</li>
        <li><strong>403</strong> - Forbidden (insufficient permissions)</li>
        <li><strong>404</strong> - Not Found (resource doesn't exist)</li>
        <li><strong>500</strong> - Internal Server Error</li>
      </ul>
    </section>

    <section class="rate-limiting">
      <h2>Rate Limiting</h2>
      <p>API endpoints are rate-limited to prevent abuse. Limits are configurable via server options.</p>
    </section>

    <div class="next-steps">
      <h2>Next Steps</h2>
      <p>Check out the <a href="/architecture">Architecture Guide</a> to understand how these APIs work together.</p>
    </div>
  </div>
</Layout>

<style>
  .page-header {
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #e5e7eb;
  }

  .page-header h1 {
    margin: 0 0 0.5rem 0;
    color: #1f2937;
  }

  .page-header p {
    margin: 0;
    font-size: 1.125rem;
    color: #6b7280;
  }

  .content section {
    margin-bottom: 3rem;
  }

  .content h2 {
    color: #1f2937;
    margin-bottom: 1rem;
    padding-top: 1rem;
  }

  .content h3 {
    color: #374151;
    margin: 1.5rem 0 0.75rem 0;
  }

  .content h4 {
    color: #4b5563;
    margin: 1rem 0 0.5rem 0;
  }

  .content h5 {
    color: #6b7280;
    margin: 0.75rem 0 0.5rem 0;
    font-size: 1rem;
  }

  .endpoint {
    background-color: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
  }

  .endpoint h4 {
    margin-top: 0;
    color: #1f2937;
  }

  pre {
    background-color: #1f2937;
    color: #f9fafb;
    padding: 1rem;
    border-radius: 6px;
    overflow-x: auto;
    margin: 1rem 0;
  }

  code {
    background-color: #f3f4f6;
    color: #dc2626;
    padding: 0.125rem 0.25rem;
    border-radius: 0.25rem;
    font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
    font-size: 0.875em;
  }

  pre code {
    background-color: transparent;
    color: inherit;
    padding: 0;
  }

  ul, ol {
    margin-bottom: 1rem;
    padding-left: 1.5rem;
  }

  li {
    margin-bottom: 0.5rem;
  }

  a {
    color: #2563eb;
    text-decoration: none;
  }

  a:hover {
    text-decoration: underline;
  }

  .next-steps {
    background-color: #eff6ff;
    border: 1px solid #bfdbfe;
    border-radius: 8px;
    padding: 2rem;
    text-align: center;
    margin-top: 3rem;
  }

  .next-steps h2 {
    margin-top: 0;
    color: #1e40af;
  }

  .next-steps p {
    margin: 0;
    font-size: 1.125rem;
    color: #1e40af;
  }
</style>
