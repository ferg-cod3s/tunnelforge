var fi=Object.create;var Fe=Object.defineProperty;var Bt=Object.getOwnPropertyDescriptor;var pi=Object.getOwnPropertyNames;var gi=Object.getPrototypeOf,_i=Object.prototype.hasOwnProperty;var We=(y,t)=>()=>(y&&(t=y(y=0)),t);var mi=(y,t)=>()=>(t||y((t={exports:{}}).exports,t),t.exports),vi=(y,t)=>{for(var e in t)Fe(y,e,{get:t[e],enumerable:!0})},bi=(y,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let d of pi(t))!_i.call(y,d)&&d!==e&&Fe(y,d,{get:()=>t[d],enumerable:!(s=Bt(t,d))||s.enumerable});return y};var yi=(y,t,e)=>(e=y!=null?fi(gi(y)):{},bi(t||!y||!y.__esModule?Fe(e,"default",{value:y,enumerable:!0}):e,y));var O=(y,t,e,s)=>{for(var d=s>1?void 0:s?Bt(t,e):t,b=y.length-1,S;b>=0;b--)(S=y[b])&&(d=(s?S(t,e,d):S(d))||d);return s&&d&&Fe(t,e,d),d};var Qt=mi(Jt=>{(()=>{"use strict";var y={349:(S,r,h)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CircularList=void 0;let g=h(460),p=h(844);class n extends p.Disposable{constructor(c){super(),this._maxLength=c,this.onDeleteEmitter=this.register(new g.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new g.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new g.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(c){if(this._maxLength===c)return;let u=new Array(c);for(let m=0;m<Math.min(c,this.length);m++)u[m]=this._array[this._getCyclicIndex(m)];this._array=u,this._maxLength=c,this._startIndex=0}get length(){return this._length}set length(c){if(c>this._length)for(let u=this._length;u<c;u++)this._array[u]=void 0;this._length=c}get(c){return this._array[this._getCyclicIndex(c)]}set(c,u){this._array[this._getCyclicIndex(c)]=u}push(c){this._array[this._getCyclicIndex(this._length)]=c,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(c,u,...m){if(u){for(let i=c;i<this._length-u;i++)this._array[this._getCyclicIndex(i)]=this._array[this._getCyclicIndex(i+u)];this._length-=u,this.onDeleteEmitter.fire({index:c,amount:u})}for(let i=this._length-1;i>=c;i--)this._array[this._getCyclicIndex(i+m.length)]=this._array[this._getCyclicIndex(i)];for(let i=0;i<m.length;i++)this._array[this._getCyclicIndex(c+i)]=m[i];if(m.length&&this.onInsertEmitter.fire({index:c,amount:m.length}),this._length+m.length>this._maxLength){let i=this._length+m.length-this._maxLength;this._startIndex+=i,this._length=this._maxLength,this.onTrimEmitter.fire(i)}else this._length+=m.length}trimStart(c){c>this._length&&(c=this._length),this._startIndex+=c,this._length-=c,this.onTrimEmitter.fire(c)}shiftElements(c,u,m){if(!(u<=0)){if(c<0||c>=this._length)throw new Error("start argument out of range");if(c+m<0)throw new Error("Cannot shift elements in list beyond index 0");if(m>0){for(let o=u-1;o>=0;o--)this.set(c+o+m,this.get(c+o));let i=c+u+m-this._length;if(i>0)for(this._length+=i;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let i=0;i<u;i++)this.set(c+i+m,this.get(c+i))}}_getCyclicIndex(c){return(this._startIndex+c)%this._maxLength}}r.CircularList=n},439:(S,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.clone=void 0,r.clone=function h(g,p=5){if(typeof g!="object")return g;let n=Array.isArray(g)?[]:{};for(let f in g)n[f]=p<=1?g[f]:g[f]&&h(g[f],p-1);return n}},969:(S,r,h)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CoreTerminal=void 0;let g=h(844),p=h(585),n=h(348),f=h(866),c=h(744),u=h(302),m=h(83),i=h(460),o=h(753),l=h(480),a=h(994),v=h(282),C=h(435),x=h(981),L=h(660),k=!1;class P extends g.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new i.EventEmitter),this._onScroll.event(R=>{this._onScrollApi?.fire(R.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(R){for(let B in R)this.optionsService.options[B]=R[B]}constructor(R){super(),this._windowsWrappingHeuristics=this.register(new g.MutableDisposable),this._onBinary=this.register(new i.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new i.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new i.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new i.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new i.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new i.EventEmitter),this._instantiationService=new n.InstantiationService,this.optionsService=this.register(new u.OptionsService(R)),this._instantiationService.setService(p.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(c.BufferService)),this._instantiationService.setService(p.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(f.LogService)),this._instantiationService.setService(p.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(m.CoreService)),this._instantiationService.setService(p.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(o.CoreMouseService)),this._instantiationService.setService(p.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(l.UnicodeService)),this._instantiationService.setService(p.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(a.CharsetService),this._instantiationService.setService(p.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(L.OscLinkService),this._instantiationService.setService(p.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new C.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,i.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,i.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,i.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,i.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom())),this.register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this.register(this._bufferService.onScroll(B=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this.register(this._inputHandler.onScroll(B=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this.register(new x.WriteBuffer((B,D)=>this._inputHandler.parse(B,D))),this.register((0,i.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(R,B){this._writeBuffer.write(R,B)}writeSync(R,B){this._logService.logLevel<=p.LogLevelEnum.WARN&&!k&&(this._logService.warn("writeSync is unreliable and will be removed soon."),k=!0),this._writeBuffer.writeSync(R,B)}input(R,B=!0){this.coreService.triggerDataEvent(R,B)}resize(R,B){isNaN(R)||isNaN(B)||(R=Math.max(R,c.MINIMUM_COLS),B=Math.max(B,c.MINIMUM_ROWS),this._bufferService.resize(R,B))}scroll(R,B=!1){this._bufferService.scroll(R,B)}scrollLines(R,B,D){this._bufferService.scrollLines(R,B,D)}scrollPages(R){this.scrollLines(R*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(R){let B=R-this._bufferService.buffer.ydisp;B!==0&&this.scrollLines(B)}registerEscHandler(R,B){return this._inputHandler.registerEscHandler(R,B)}registerDcsHandler(R,B){return this._inputHandler.registerDcsHandler(R,B)}registerCsiHandler(R,B){return this._inputHandler.registerCsiHandler(R,B)}registerOscHandler(R,B){return this._inputHandler.registerOscHandler(R,B)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let R=!1,B=this.optionsService.rawOptions.windowsPty;B&&B.buildNumber!==void 0&&B.buildNumber!==void 0?R=B.backend==="conpty"&&B.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(R=!0),R?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){let R=[];R.push(this.onLineFeed(v.updateWindowsModeWrappedState.bind(null,this._bufferService))),R.push(this.registerCsiHandler({final:"H"},()=>((0,v.updateWindowsModeWrappedState)(this._bufferService),!1))),this._windowsWrappingHeuristics.value=(0,g.toDisposable)(()=>{for(let B of R)B.dispose()})}}}r.CoreTerminal=P},460:(S,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.runAndSubscribe=r.forwardEvent=r.EventEmitter=void 0,r.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=h=>(this._listeners.push(h),{dispose:()=>{if(!this._disposed){for(let p=0;p<this._listeners.length;p++)if(this._listeners[p]===h)return void this._listeners.splice(p,1)}}})),this._event}fire(h,g){let p=[];for(let n=0;n<this._listeners.length;n++)p.push(this._listeners[n]);for(let n=0;n<p.length;n++)p[n].call(void 0,h,g)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},r.forwardEvent=function(h,g){return h(p=>g.fire(p))},r.runAndSubscribe=function(h,g){return g(void 0),h(p=>g(p))}},435:function(S,r,h){var g=this&&this.__decorate||function(U,_,A,w){var T,M=arguments.length,$=M<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,A):w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")$=Reflect.decorate(U,_,A,w);else for(var z=U.length-1;z>=0;z--)(T=U[z])&&($=(M<3?T($):M>3?T(_,A,$):T(_,A))||$);return M>3&&$&&Object.defineProperty(_,A,$),$},p=this&&this.__param||function(U,_){return function(A,w){_(A,w,U)}};Object.defineProperty(r,"__esModule",{value:!0}),r.InputHandler=r.WindowsOptionsReportType=void 0;let n=h(584),f=h(116),c=h(15),u=h(844),m=h(482),i=h(437),o=h(460),l=h(643),a=h(511),v=h(734),C=h(585),x=h(480),L=h(242),k=h(351),P=h(941),K={"(":0,")":1,"*":2,"+":3,"-":1,".":2},R=131072;function B(U,_){if(U>24)return _.setWinLines||!1;switch(U){case 1:return!!_.restoreWin;case 2:return!!_.minimizeWin;case 3:return!!_.setWinPosition;case 4:return!!_.setWinSizePixels;case 5:return!!_.raiseWin;case 6:return!!_.lowerWin;case 7:return!!_.refreshWin;case 8:return!!_.setWinSizeChars;case 9:return!!_.maximizeWin;case 10:return!!_.fullscreenWin;case 11:return!!_.getWinState;case 13:return!!_.getWinPosition;case 14:return!!_.getWinSizePixels;case 15:return!!_.getScreenSizePixels;case 16:return!!_.getCellSizePixels;case 18:return!!_.getWinSizeChars;case 19:return!!_.getScreenSizeChars;case 20:return!!_.getIconTitle;case 21:return!!_.getWinTitle;case 22:return!!_.pushTitle;case 23:return!!_.popTitle;case 24:return!!_.setWinLines}return!1}var D;(function(U){U[U.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",U[U.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(D||(r.WindowsOptionsReportType=D={}));let ne=0;class ie extends u.Disposable{getAttrData(){return this._curAttrData}constructor(_,A,w,T,M,$,z,j,re=new c.EscapeSequenceParser){super(),this._bufferService=_,this._charsetService=A,this._coreService=w,this._logService=T,this._optionsService=M,this._oscLinkService=$,this._coreMouseService=z,this._unicodeService=j,this._parser=re,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new m.StringToUtf32,this._utf8Decoder=new m.Utf8ToUtf32,this._workCell=new a.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=i.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=i.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new o.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new o.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new o.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new o.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new o.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new o.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new o.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new o.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new o.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new o.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new o.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new o.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new o.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new F(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(E=>this._activeBuffer=E.activeBuffer)),this._parser.setCsiHandlerFallback((E,W)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(E),params:W.toArray()})}),this._parser.setEscHandlerFallback(E=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(E)})}),this._parser.setExecuteHandlerFallback(E=>{this._logService.debug("Unknown EXECUTE code: ",{code:E})}),this._parser.setOscHandlerFallback((E,W,I)=>{this._logService.debug("Unknown OSC code: ",{identifier:E,action:W,data:I})}),this._parser.setDcsHandlerFallback((E,W,I)=>{W==="HOOK"&&(I=I.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(E),action:W,payload:I})}),this._parser.setPrintHandler((E,W,I)=>this.print(E,W,I)),this._parser.registerCsiHandler({final:"@"},E=>this.insertChars(E)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},E=>this.scrollLeft(E)),this._parser.registerCsiHandler({final:"A"},E=>this.cursorUp(E)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},E=>this.scrollRight(E)),this._parser.registerCsiHandler({final:"B"},E=>this.cursorDown(E)),this._parser.registerCsiHandler({final:"C"},E=>this.cursorForward(E)),this._parser.registerCsiHandler({final:"D"},E=>this.cursorBackward(E)),this._parser.registerCsiHandler({final:"E"},E=>this.cursorNextLine(E)),this._parser.registerCsiHandler({final:"F"},E=>this.cursorPrecedingLine(E)),this._parser.registerCsiHandler({final:"G"},E=>this.cursorCharAbsolute(E)),this._parser.registerCsiHandler({final:"H"},E=>this.cursorPosition(E)),this._parser.registerCsiHandler({final:"I"},E=>this.cursorForwardTab(E)),this._parser.registerCsiHandler({final:"J"},E=>this.eraseInDisplay(E,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},E=>this.eraseInDisplay(E,!0)),this._parser.registerCsiHandler({final:"K"},E=>this.eraseInLine(E,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},E=>this.eraseInLine(E,!0)),this._parser.registerCsiHandler({final:"L"},E=>this.insertLines(E)),this._parser.registerCsiHandler({final:"M"},E=>this.deleteLines(E)),this._parser.registerCsiHandler({final:"P"},E=>this.deleteChars(E)),this._parser.registerCsiHandler({final:"S"},E=>this.scrollUp(E)),this._parser.registerCsiHandler({final:"T"},E=>this.scrollDown(E)),this._parser.registerCsiHandler({final:"X"},E=>this.eraseChars(E)),this._parser.registerCsiHandler({final:"Z"},E=>this.cursorBackwardTab(E)),this._parser.registerCsiHandler({final:"`"},E=>this.charPosAbsolute(E)),this._parser.registerCsiHandler({final:"a"},E=>this.hPositionRelative(E)),this._parser.registerCsiHandler({final:"b"},E=>this.repeatPrecedingCharacter(E)),this._parser.registerCsiHandler({final:"c"},E=>this.sendDeviceAttributesPrimary(E)),this._parser.registerCsiHandler({prefix:">",final:"c"},E=>this.sendDeviceAttributesSecondary(E)),this._parser.registerCsiHandler({final:"d"},E=>this.linePosAbsolute(E)),this._parser.registerCsiHandler({final:"e"},E=>this.vPositionRelative(E)),this._parser.registerCsiHandler({final:"f"},E=>this.hVPosition(E)),this._parser.registerCsiHandler({final:"g"},E=>this.tabClear(E)),this._parser.registerCsiHandler({final:"h"},E=>this.setMode(E)),this._parser.registerCsiHandler({prefix:"?",final:"h"},E=>this.setModePrivate(E)),this._parser.registerCsiHandler({final:"l"},E=>this.resetMode(E)),this._parser.registerCsiHandler({prefix:"?",final:"l"},E=>this.resetModePrivate(E)),this._parser.registerCsiHandler({final:"m"},E=>this.charAttributes(E)),this._parser.registerCsiHandler({final:"n"},E=>this.deviceStatus(E)),this._parser.registerCsiHandler({prefix:"?",final:"n"},E=>this.deviceStatusPrivate(E)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},E=>this.softReset(E)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},E=>this.setCursorStyle(E)),this._parser.registerCsiHandler({final:"r"},E=>this.setScrollRegion(E)),this._parser.registerCsiHandler({final:"s"},E=>this.saveCursor(E)),this._parser.registerCsiHandler({final:"t"},E=>this.windowOptions(E)),this._parser.registerCsiHandler({final:"u"},E=>this.restoreCursor(E)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},E=>this.insertColumns(E)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},E=>this.deleteColumns(E)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},E=>this.selectProtected(E)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},E=>this.requestMode(E,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},E=>this.requestMode(E,!1)),this._parser.setExecuteHandler(n.C0.BEL,()=>this.bell()),this._parser.setExecuteHandler(n.C0.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(n.C0.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(n.C0.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(n.C0.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(n.C0.BS,()=>this.backspace()),this._parser.setExecuteHandler(n.C0.HT,()=>this.tab()),this._parser.setExecuteHandler(n.C0.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(n.C0.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(n.C1.IND,()=>this.index()),this._parser.setExecuteHandler(n.C1.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(n.C1.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new L.OscHandler(E=>(this.setTitle(E),this.setIconName(E),!0))),this._parser.registerOscHandler(1,new L.OscHandler(E=>this.setIconName(E))),this._parser.registerOscHandler(2,new L.OscHandler(E=>this.setTitle(E))),this._parser.registerOscHandler(4,new L.OscHandler(E=>this.setOrReportIndexedColor(E))),this._parser.registerOscHandler(8,new L.OscHandler(E=>this.setHyperlink(E))),this._parser.registerOscHandler(10,new L.OscHandler(E=>this.setOrReportFgColor(E))),this._parser.registerOscHandler(11,new L.OscHandler(E=>this.setOrReportBgColor(E))),this._parser.registerOscHandler(12,new L.OscHandler(E=>this.setOrReportCursorColor(E))),this._parser.registerOscHandler(104,new L.OscHandler(E=>this.restoreIndexedColor(E))),this._parser.registerOscHandler(110,new L.OscHandler(E=>this.restoreFgColor(E))),this._parser.registerOscHandler(111,new L.OscHandler(E=>this.restoreBgColor(E))),this._parser.registerOscHandler(112,new L.OscHandler(E=>this.restoreCursorColor(E))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(let E in f.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:E},()=>this.selectCharset("("+E)),this._parser.registerEscHandler({intermediates:")",final:E},()=>this.selectCharset(")"+E)),this._parser.registerEscHandler({intermediates:"*",final:E},()=>this.selectCharset("*"+E)),this._parser.registerEscHandler({intermediates:"+",final:E},()=>this.selectCharset("+"+E)),this._parser.registerEscHandler({intermediates:"-",final:E},()=>this.selectCharset("-"+E)),this._parser.registerEscHandler({intermediates:".",final:E},()=>this.selectCharset("."+E)),this._parser.registerEscHandler({intermediates:"/",final:E},()=>this.selectCharset("/"+E));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(E=>(this._logService.error("Parsing error: ",E),E)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new k.DcsHandler((E,W)=>this.requestStatusString(E,W)))}_preserveStack(_,A,w,T){this._parseStack.paused=!0,this._parseStack.cursorStartX=_,this._parseStack.cursorStartY=A,this._parseStack.decodedLength=w,this._parseStack.position=T}_logSlowResolvingAsync(_){this._logService.logLevel<=C.LogLevelEnum.WARN&&Promise.race([_,new Promise((A,w)=>setTimeout(()=>w("#SLOW_TIMEOUT"),5e3))]).catch(A=>{if(A!=="#SLOW_TIMEOUT")throw A;console.warn("async parser handler taking longer than 5000 ms")})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(_,A){let w,T=this._activeBuffer.x,M=this._activeBuffer.y,$=0,z=this._parseStack.paused;if(z){if(w=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,A))return this._logSlowResolvingAsync(w),w;T=this._parseStack.cursorStartX,M=this._parseStack.cursorStartY,this._parseStack.paused=!1,_.length>R&&($=this._parseStack.position+R)}if(this._logService.logLevel<=C.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof _=="string"?` "${_}"`:` "${Array.prototype.map.call(_,E=>String.fromCharCode(E)).join("")}"`),typeof _=="string"?_.split("").map(E=>E.charCodeAt(0)):_),this._parseBuffer.length<_.length&&this._parseBuffer.length<R&&(this._parseBuffer=new Uint32Array(Math.min(_.length,R))),z||this._dirtyRowTracker.clearRange(),_.length>R)for(let E=$;E<_.length;E+=R){let W=E+R<_.length?E+R:_.length,I=typeof _=="string"?this._stringDecoder.decode(_.substring(E,W),this._parseBuffer):this._utf8Decoder.decode(_.subarray(E,W),this._parseBuffer);if(w=this._parser.parse(this._parseBuffer,I))return this._preserveStack(T,M,I,E),this._logSlowResolvingAsync(w),w}else if(!z){let E=typeof _=="string"?this._stringDecoder.decode(_,this._parseBuffer):this._utf8Decoder.decode(_,this._parseBuffer);if(w=this._parser.parse(this._parseBuffer,E))return this._preserveStack(T,M,E,0),this._logSlowResolvingAsync(w),w}this._activeBuffer.x===T&&this._activeBuffer.y===M||this._onCursorMove.fire();let j=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),re=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);re<this._bufferService.rows&&this._onRequestRefreshRows.fire(Math.min(re,this._bufferService.rows-1),Math.min(j,this._bufferService.rows-1))}print(_,A,w){let T,M,$=this._charsetService.charset,z=this._optionsService.rawOptions.screenReaderMode,j=this._bufferService.cols,re=this._coreService.decPrivateModes.wraparound,E=this._coreService.modes.insertMode,W=this._curAttrData,I=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&w-A>0&&I.getWidth(this._activeBuffer.x-1)===2&&I.setCellFromCodepoint(this._activeBuffer.x-1,0,1,W);let N=this._parser.precedingJoinState;for(let Se=A;Se<w;++Se){if(T=_[Se],T<127&&$){let fe=$[String.fromCharCode(T)];fe&&(T=fe.charCodeAt(0))}let Ce=this._unicodeService.charProperties(T,N);M=x.UnicodeService.extractWidth(Ce);let Ne=x.UnicodeService.extractShouldJoin(Ce),ue=Ne?x.UnicodeService.extractWidth(N):0;if(N=Ce,z&&this._onA11yChar.fire((0,m.stringFromCodePoint)(T)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+M-ue>j){if(re){let fe=I,xe=this._activeBuffer.x-ue;for(this._activeBuffer.x=ue,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),I=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),ue>0&&I instanceof i.BufferLine&&I.copyCellsFrom(fe,xe,0,ue,!1);xe<j;)fe.setCellFromCodepoint(xe++,0,1,W)}else if(this._activeBuffer.x=j-1,M===2)continue}if(Ne&&this._activeBuffer.x){let fe=I.getWidth(this._activeBuffer.x-1)?1:2;I.addCodepointToCell(this._activeBuffer.x-fe,T,M);for(let xe=M-ue;--xe>=0;)I.setCellFromCodepoint(this._activeBuffer.x++,0,0,W)}else if(E&&(I.insertCells(this._activeBuffer.x,M-ue,this._activeBuffer.getNullCell(W)),I.getWidth(j-1)===2&&I.setCellFromCodepoint(j-1,l.NULL_CELL_CODE,l.NULL_CELL_WIDTH,W)),I.setCellFromCodepoint(this._activeBuffer.x++,T,M,W),M>0)for(;--M;)I.setCellFromCodepoint(this._activeBuffer.x++,0,0,W)}this._parser.precedingJoinState=N,this._activeBuffer.x<j&&w-A>0&&I.getWidth(this._activeBuffer.x)===0&&!I.hasContent(this._activeBuffer.x)&&I.setCellFromCodepoint(this._activeBuffer.x,0,1,W),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(_,A){return _.final!=="t"||_.prefix||_.intermediates?this._parser.registerCsiHandler(_,A):this._parser.registerCsiHandler(_,w=>!B(w.params[0],this._optionsService.rawOptions.windowOptions)||A(w))}registerDcsHandler(_,A){return this._parser.registerDcsHandler(_,new k.DcsHandler(A))}registerEscHandler(_,A){return this._parser.registerEscHandler(_,A)}registerOscHandler(_,A){return this._parser.registerOscHandler(_,new L.OscHandler(A))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)?.isWrapped){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;let _=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);_.hasWidth(this._activeBuffer.x)&&!_.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let _=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-_),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(_=this._bufferService.cols-1){this._activeBuffer.x=Math.min(_,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(_,A){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=_,this._activeBuffer.y=this._activeBuffer.scrollTop+A):(this._activeBuffer.x=_,this._activeBuffer.y=A),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(_,A){this._restrictCursor(),this._setCursor(this._activeBuffer.x+_,this._activeBuffer.y+A)}cursorUp(_){let A=this._activeBuffer.y-this._activeBuffer.scrollTop;return A>=0?this._moveCursor(0,-Math.min(A,_.params[0]||1)):this._moveCursor(0,-(_.params[0]||1)),!0}cursorDown(_){let A=this._activeBuffer.scrollBottom-this._activeBuffer.y;return A>=0?this._moveCursor(0,Math.min(A,_.params[0]||1)):this._moveCursor(0,_.params[0]||1),!0}cursorForward(_){return this._moveCursor(_.params[0]||1,0),!0}cursorBackward(_){return this._moveCursor(-(_.params[0]||1),0),!0}cursorNextLine(_){return this.cursorDown(_),this._activeBuffer.x=0,!0}cursorPrecedingLine(_){return this.cursorUp(_),this._activeBuffer.x=0,!0}cursorCharAbsolute(_){return this._setCursor((_.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(_){return this._setCursor(_.length>=2?(_.params[1]||1)-1:0,(_.params[0]||1)-1),!0}charPosAbsolute(_){return this._setCursor((_.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(_){return this._moveCursor(_.params[0]||1,0),!0}linePosAbsolute(_){return this._setCursor(this._activeBuffer.x,(_.params[0]||1)-1),!0}vPositionRelative(_){return this._moveCursor(0,_.params[0]||1),!0}hVPosition(_){return this.cursorPosition(_),!0}tabClear(_){let A=_.params[0];return A===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:A===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(_){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let A=_.params[0]||1;for(;A--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(_){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let A=_.params[0]||1;for(;A--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(_){let A=_.params[0];return A===1&&(this._curAttrData.bg|=536870912),A!==2&&A!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(_,A,w,T=!1,M=!1){let $=this._activeBuffer.lines.get(this._activeBuffer.ybase+_);$.replaceCells(A,w,this._activeBuffer.getNullCell(this._eraseAttrData()),M),T&&($.isWrapped=!1)}_resetBufferLine(_,A=!1){let w=this._activeBuffer.lines.get(this._activeBuffer.ybase+_);w&&(w.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),A),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+_),w.isWrapped=!1)}eraseInDisplay(_,A=!1){let w;switch(this._restrictCursor(this._bufferService.cols),_.params[0]){case 0:for(w=this._activeBuffer.y,this._dirtyRowTracker.markDirty(w),this._eraseInBufferLine(w++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,A);w<this._bufferService.rows;w++)this._resetBufferLine(w,A);this._dirtyRowTracker.markDirty(w);break;case 1:for(w=this._activeBuffer.y,this._dirtyRowTracker.markDirty(w),this._eraseInBufferLine(w,0,this._activeBuffer.x+1,!0,A),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(w+1).isWrapped=!1);w--;)this._resetBufferLine(w,A);this._dirtyRowTracker.markDirty(0);break;case 2:for(w=this._bufferService.rows,this._dirtyRowTracker.markDirty(w-1);w--;)this._resetBufferLine(w,A);this._dirtyRowTracker.markDirty(0);break;case 3:let T=this._activeBuffer.lines.length-this._bufferService.rows;T>0&&(this._activeBuffer.lines.trimStart(T),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-T,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-T,0),this._onScroll.fire(0))}return!0}eraseInLine(_,A=!1){switch(this._restrictCursor(this._bufferService.cols),_.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,A);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,A);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,A)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(_){this._restrictCursor();let A=_.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let w=this._activeBuffer.ybase+this._activeBuffer.y,T=this._bufferService.rows-1-this._activeBuffer.scrollBottom,M=this._bufferService.rows-1+this._activeBuffer.ybase-T+1;for(;A--;)this._activeBuffer.lines.splice(M-1,1),this._activeBuffer.lines.splice(w,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(_){this._restrictCursor();let A=_.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let w=this._activeBuffer.ybase+this._activeBuffer.y,T;for(T=this._bufferService.rows-1-this._activeBuffer.scrollBottom,T=this._bufferService.rows-1+this._activeBuffer.ybase-T;A--;)this._activeBuffer.lines.splice(w,1),this._activeBuffer.lines.splice(T,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(_){this._restrictCursor();let A=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return A&&(A.insertCells(this._activeBuffer.x,_.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(_){this._restrictCursor();let A=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return A&&(A.deleteCells(this._activeBuffer.x,_.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(_){let A=_.params[0]||1;for(;A--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(_){let A=_.params[0]||1;for(;A--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(i.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(_){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let A=_.params[0]||1;for(let w=this._activeBuffer.scrollTop;w<=this._activeBuffer.scrollBottom;++w){let T=this._activeBuffer.lines.get(this._activeBuffer.ybase+w);T.deleteCells(0,A,this._activeBuffer.getNullCell(this._eraseAttrData())),T.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(_){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let A=_.params[0]||1;for(let w=this._activeBuffer.scrollTop;w<=this._activeBuffer.scrollBottom;++w){let T=this._activeBuffer.lines.get(this._activeBuffer.ybase+w);T.insertCells(0,A,this._activeBuffer.getNullCell(this._eraseAttrData())),T.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(_){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let A=_.params[0]||1;for(let w=this._activeBuffer.scrollTop;w<=this._activeBuffer.scrollBottom;++w){let T=this._activeBuffer.lines.get(this._activeBuffer.ybase+w);T.insertCells(this._activeBuffer.x,A,this._activeBuffer.getNullCell(this._eraseAttrData())),T.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(_){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let A=_.params[0]||1;for(let w=this._activeBuffer.scrollTop;w<=this._activeBuffer.scrollBottom;++w){let T=this._activeBuffer.lines.get(this._activeBuffer.ybase+w);T.deleteCells(this._activeBuffer.x,A,this._activeBuffer.getNullCell(this._eraseAttrData())),T.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(_){this._restrictCursor();let A=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return A&&(A.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(_.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(_){let A=this._parser.precedingJoinState;if(!A)return!0;let w=_.params[0]||1,T=x.UnicodeService.extractWidth(A),M=this._activeBuffer.x-T,$=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(M),z=new Uint32Array($.length*w),j=0;for(let E=0;E<$.length;){let W=$.codePointAt(E)||0;z[j++]=W,E+=W>65535?2:1}let re=j;for(let E=1;E<w;++E)z.copyWithin(re,0,j),re+=j;return this.print(z,0,re),!0}sendDeviceAttributesPrimary(_){return _.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(n.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(n.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(_){return _.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(n.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(n.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(_.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(n.C0.ESC+"[>83;40003;0c")),!0}_is(_){return(this._optionsService.rawOptions.termName+"").indexOf(_)===0}setMode(_){for(let A=0;A<_.length;A++)switch(_.params[A]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(_){for(let A=0;A<_.length;A++)switch(_.params[A]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,f.DEFAULT_CHARSET),this._charsetService.setgCharset(1,f.DEFAULT_CHARSET),this._charsetService.setgCharset(2,f.DEFAULT_CHARSET),this._charsetService.setgCharset(3,f.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(_){for(let A=0;A<_.length;A++)switch(_.params[A]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(_){for(let A=0;A<_.length;A++)switch(_.params[A]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),_.params[A]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(_,A){let w=this._coreService.decPrivateModes,{activeProtocol:T,activeEncoding:M}=this._coreMouseService,$=this._coreService,{buffers:z,cols:j}=this._bufferService,{active:re,alt:E}=z,W=this._optionsService.rawOptions,I=Ne=>Ne?1:2,N=_.params[0];return Se=N,Ce=A?N===2?4:N===4?I($.modes.insertMode):N===12?3:N===20?I(W.convertEol):0:N===1?I(w.applicationCursorKeys):N===3?W.windowOptions.setWinLines?j===80?2:j===132?1:0:0:N===6?I(w.origin):N===7?I(w.wraparound):N===8?3:N===9?I(T==="X10"):N===12?I(W.cursorBlink):N===25?I(!$.isCursorHidden):N===45?I(w.reverseWraparound):N===66?I(w.applicationKeypad):N===67?4:N===1e3?I(T==="VT200"):N===1002?I(T==="DRAG"):N===1003?I(T==="ANY"):N===1004?I(w.sendFocus):N===1005?4:N===1006?I(M==="SGR"):N===1015?4:N===1016?I(M==="SGR_PIXELS"):N===1048?1:N===47||N===1047||N===1049?I(re===E):N===2004?I(w.bracketedPasteMode):0,$.triggerDataEvent(`${n.C0.ESC}[${A?"":"?"}${Se};${Ce}$y`),!0;var Se,Ce}_updateAttrColor(_,A,w,T,M){return A===2?(_|=50331648,_&=-16777216,_|=v.AttributeData.fromColorRGB([w,T,M])):A===5&&(_&=-50331904,_|=33554432|255&w),_}_extractColor(_,A,w){let T=[0,0,-1,0,0,0],M=0,$=0;do{if(T[$+M]=_.params[A+$],_.hasSubParams(A+$)){let z=_.getSubParams(A+$),j=0;do T[1]===5&&(M=1),T[$+j+1+M]=z[j];while(++j<z.length&&j+$+1+M<T.length);break}if(T[1]===5&&$+M>=2||T[1]===2&&$+M>=5)break;T[1]&&(M=1)}while(++$+A<_.length&&$+M<T.length);for(let z=2;z<T.length;++z)T[z]===-1&&(T[z]=0);switch(T[0]){case 38:w.fg=this._updateAttrColor(w.fg,T[1],T[3],T[4],T[5]);break;case 48:w.bg=this._updateAttrColor(w.bg,T[1],T[3],T[4],T[5]);break;case 58:w.extended=w.extended.clone(),w.extended.underlineColor=this._updateAttrColor(w.extended.underlineColor,T[1],T[3],T[4],T[5])}return $}_processUnderline(_,A){A.extended=A.extended.clone(),(!~_||_>5)&&(_=1),A.extended.underlineStyle=_,A.fg|=268435456,_===0&&(A.fg&=-268435457),A.updateExtended()}_processSGR0(_){_.fg=i.DEFAULT_ATTR_DATA.fg,_.bg=i.DEFAULT_ATTR_DATA.bg,_.extended=_.extended.clone(),_.extended.underlineStyle=0,_.extended.underlineColor&=-67108864,_.updateExtended()}charAttributes(_){if(_.length===1&&_.params[0]===0)return this._processSGR0(this._curAttrData),!0;let A=_.length,w,T=this._curAttrData;for(let M=0;M<A;M++)w=_.params[M],w>=30&&w<=37?(T.fg&=-50331904,T.fg|=16777216|w-30):w>=40&&w<=47?(T.bg&=-50331904,T.bg|=16777216|w-40):w>=90&&w<=97?(T.fg&=-50331904,T.fg|=16777224|w-90):w>=100&&w<=107?(T.bg&=-50331904,T.bg|=16777224|w-100):w===0?this._processSGR0(T):w===1?T.fg|=134217728:w===3?T.bg|=67108864:w===4?(T.fg|=268435456,this._processUnderline(_.hasSubParams(M)?_.getSubParams(M)[0]:1,T)):w===5?T.fg|=536870912:w===7?T.fg|=67108864:w===8?T.fg|=1073741824:w===9?T.fg|=2147483648:w===2?T.bg|=134217728:w===21?this._processUnderline(2,T):w===22?(T.fg&=-134217729,T.bg&=-134217729):w===23?T.bg&=-67108865:w===24?(T.fg&=-268435457,this._processUnderline(0,T)):w===25?T.fg&=-536870913:w===27?T.fg&=-67108865:w===28?T.fg&=-1073741825:w===29?T.fg&=2147483647:w===39?(T.fg&=-67108864,T.fg|=16777215&i.DEFAULT_ATTR_DATA.fg):w===49?(T.bg&=-67108864,T.bg|=16777215&i.DEFAULT_ATTR_DATA.bg):w===38||w===48||w===58?M+=this._extractColor(_,M,T):w===53?T.bg|=1073741824:w===55?T.bg&=-1073741825:w===59?(T.extended=T.extended.clone(),T.extended.underlineColor=-1,T.updateExtended()):w===100?(T.fg&=-67108864,T.fg|=16777215&i.DEFAULT_ATTR_DATA.fg,T.bg&=-67108864,T.bg|=16777215&i.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",w);return!0}deviceStatus(_){switch(_.params[0]){case 5:this._coreService.triggerDataEvent(`${n.C0.ESC}[0n`);break;case 6:let A=this._activeBuffer.y+1,w=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${n.C0.ESC}[${A};${w}R`)}return!0}deviceStatusPrivate(_){if(_.params[0]===6){let A=this._activeBuffer.y+1,w=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${n.C0.ESC}[?${A};${w}R`)}return!0}softReset(_){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=i.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(_){let A=_.params[0]||1;switch(A){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}let w=A%2==1;return this._optionsService.options.cursorBlink=w,!0}setScrollRegion(_){let A=_.params[0]||1,w;return(_.length<2||(w=_.params[1])>this._bufferService.rows||w===0)&&(w=this._bufferService.rows),w>A&&(this._activeBuffer.scrollTop=A-1,this._activeBuffer.scrollBottom=w-1,this._setCursor(0,0)),!0}windowOptions(_){if(!B(_.params[0],this._optionsService.rawOptions.windowOptions))return!0;let A=_.length>1?_.params[1]:0;switch(_.params[0]){case 14:A!==2&&this._onRequestWindowsOptionsReport.fire(D.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(D.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${n.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:A!==0&&A!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),A!==0&&A!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:A!==0&&A!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),A!==0&&A!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(_){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(_){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(_){return this._windowTitle=_,this._onTitleChange.fire(_),!0}setIconName(_){return this._iconName=_,!0}setOrReportIndexedColor(_){let A=[],w=_.split(";");for(;w.length>1;){let T=w.shift(),M=w.shift();if(/^\d+$/.exec(T)){let $=parseInt(T);if(Q($))if(M==="?")A.push({type:0,index:$});else{let z=(0,P.parseColor)(M);z&&A.push({type:1,index:$,color:z})}}}return A.length&&this._onColor.fire(A),!0}setHyperlink(_){let A=_.split(";");return!(A.length<2)&&(A[1]?this._createHyperlink(A[0],A[1]):!A[0]&&this._finishHyperlink())}_createHyperlink(_,A){this._getCurrentLinkId()&&this._finishHyperlink();let w=_.split(":"),T,M=w.findIndex($=>$.startsWith("id="));return M!==-1&&(T=w[M].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:T,uri:A}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(_,A){let w=_.split(";");for(let T=0;T<w.length&&!(A>=this._specialColors.length);++T,++A)if(w[T]==="?")this._onColor.fire([{type:0,index:this._specialColors[A]}]);else{let M=(0,P.parseColor)(w[T]);M&&this._onColor.fire([{type:1,index:this._specialColors[A],color:M}])}return!0}setOrReportFgColor(_){return this._setOrReportSpecialColor(_,0)}setOrReportBgColor(_){return this._setOrReportSpecialColor(_,1)}setOrReportCursorColor(_){return this._setOrReportSpecialColor(_,2)}restoreIndexedColor(_){if(!_)return this._onColor.fire([{type:2}]),!0;let A=[],w=_.split(";");for(let T=0;T<w.length;++T)if(/^\d+$/.exec(w[T])){let M=parseInt(w[T]);Q(M)&&A.push({type:2,index:M})}return A.length&&this._onColor.fire(A),!0}restoreFgColor(_){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(_){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(_){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,f.DEFAULT_CHARSET),!0}selectCharset(_){return _.length!==2?(this.selectDefaultCharset(),!0):(_[0]==="/"||this._charsetService.setgCharset(K[_[0]],f.CHARSETS[_[1]]||f.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){let _=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,_,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=i.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=i.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(_){return this._charsetService.setgLevel(_),!0}screenAlignmentPattern(){let _=new a.CellData;_.content=4194373,_.fg=this._curAttrData.fg,_.bg=this._curAttrData.bg,this._setCursor(0,0);for(let A=0;A<this._bufferService.rows;++A){let w=this._activeBuffer.ybase+this._activeBuffer.y+A,T=this._activeBuffer.lines.get(w);T&&(T.fill(_),T.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(_,A){let w=this._bufferService.buffer,T=this._optionsService.rawOptions;return(M=>(this._coreService.triggerDataEvent(`${n.C0.ESC}${M}${n.C0.ESC}\\`),!0))(_==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:_==='"p'?'P1$r61;1"p':_==="r"?`P1$r${w.scrollTop+1};${w.scrollBottom+1}r`:_==="m"?"P1$r0m":_===" q"?`P1$r${{block:2,underline:4,bar:6}[T.cursorStyle]-(T.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(_,A){this._dirtyRowTracker.markRangeDirty(_,A)}}r.InputHandler=ie;let F=class{constructor(U){this._bufferService=U,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(U){U<this.start?this.start=U:U>this.end&&(this.end=U)}markRangeDirty(U,_){U>_&&(ne=U,U=_,_=ne),U<this.start&&(this.start=U),_>this.end&&(this.end=_)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function Q(U){return 0<=U&&U<256}F=g([p(0,C.IBufferService)],F)},844:(S,r)=>{function h(g){for(let p of g)p.dispose();g.length=0}Object.defineProperty(r,"__esModule",{value:!0}),r.getDisposeArrayDisposable=r.disposeArray=r.toDisposable=r.MutableDisposable=r.Disposable=void 0,r.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(let g of this._disposables)g.dispose();this._disposables.length=0}register(g){return this._disposables.push(g),g}unregister(g){let p=this._disposables.indexOf(g);p!==-1&&this._disposables.splice(p,1)}},r.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(g){this._isDisposed||g===this._value||(this._value?.dispose(),this._value=g)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}},r.toDisposable=function(g){return{dispose:g}},r.disposeArray=h,r.getDisposeArrayDisposable=function(g){return{dispose:()=>h(g)}}},114:(S,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.isChromeOS=r.isLinux=r.isWindows=r.isIphone=r.isIpad=r.isMac=r.getSafariVersion=r.isSafari=r.isLegacyEdge=r.isFirefox=r.isNode=void 0,r.isNode=typeof process<"u"&&"title"in process;let h=r.isNode?"node":navigator.userAgent,g=r.isNode?"node":navigator.platform;r.isFirefox=h.includes("Firefox"),r.isLegacyEdge=h.includes("Edge"),r.isSafari=/^((?!chrome|android).)*safari/i.test(h),r.getSafariVersion=function(){if(!r.isSafari)return 0;let p=h.match(/Version\/(\d+)/);return p===null||p.length<2?0:parseInt(p[1])},r.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(g),r.isIpad=g==="iPad",r.isIphone=g==="iPhone",r.isWindows=["Windows","Win16","Win32","WinCE"].includes(g),r.isLinux=g.indexOf("Linux")>=0,r.isChromeOS=/\bCrOS\b/.test(h)},226:(S,r,h)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DebouncedIdleTask=r.IdleTaskQueue=r.PriorityTaskQueue=void 0;let g=h(114);class p{constructor(){this._tasks=[],this._i=0}enqueue(c){this._tasks.push(c),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(c){this._idleCallback=void 0;let u=0,m=0,i=c.timeRemaining(),o=0;for(;this._i<this._tasks.length;){if(u=Date.now(),this._tasks[this._i]()||this._i++,u=Math.max(1,Date.now()-u),m=Math.max(u,m),o=c.timeRemaining(),1.5*m>o)return i-u<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(i-u))}ms`),void this._start();i=o}this.clear()}}class n extends p{_requestCallback(c){return setTimeout(()=>c(this._createDeadline(16)))}_cancelCallback(c){clearTimeout(c)}_createDeadline(c){let u=Date.now()+c;return{timeRemaining:()=>Math.max(0,u-Date.now())}}}r.PriorityTaskQueue=n,r.IdleTaskQueue=!g.isNode&&"requestIdleCallback"in window?class extends p{_requestCallback(f){return requestIdleCallback(f)}_cancelCallback(f){cancelIdleCallback(f)}}:n,r.DebouncedIdleTask=class{constructor(){this._queue=new r.IdleTaskQueue}set(f){this._queue.clear(),this._queue.enqueue(f)}flush(){this._queue.flush()}}},282:(S,r,h)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.updateWindowsModeWrappedState=void 0;let g=h(643);r.updateWindowsModeWrappedState=function(p){let n=p.buffer.lines.get(p.buffer.ybase+p.buffer.y-1),f=n?.get(p.cols-1),c=p.buffer.lines.get(p.buffer.ybase+p.buffer.y);c&&f&&(c.isWrapped=f[g.CHAR_DATA_CODE_INDEX]!==g.NULL_CELL_CODE&&f[g.CHAR_DATA_CODE_INDEX]!==g.WHITESPACE_CELL_CODE)}},734:(S,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ExtendedAttrs=r.AttributeData=void 0;class h{constructor(){this.fg=0,this.bg=0,this.extended=new g}static toColorRGB(n){return[n>>>16&255,n>>>8&255,255&n]}static fromColorRGB(n){return(255&n[0])<<16|(255&n[1])<<8|255&n[2]}clone(){let n=new h;return n.fg=this.fg,n.bg=this.bg,n.extended=this.extended.clone(),n}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}r.AttributeData=h;class g{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(n){this._ext=n}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(n){this._ext&=-469762049,this._ext|=n<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(n){this._ext&=-67108864,this._ext|=67108863&n}get urlId(){return this._urlId}set urlId(n){this._urlId=n}get underlineVariantOffset(){let n=(3758096384&this._ext)>>29;return n<0?4294967288^n:n}set underlineVariantOffset(n){this._ext&=536870911,this._ext|=n<<29&3758096384}constructor(n=0,f=0){this._ext=0,this._urlId=0,this._ext=n,this._urlId=f}clone(){return new g(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}r.ExtendedAttrs=g},92:(S,r,h)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Buffer=r.MAX_BUFFER_SIZE=void 0;let g=h(349),p=h(226),n=h(734),f=h(437),c=h(634),u=h(511),m=h(643),i=h(863),o=h(116);r.MAX_BUFFER_SIZE=4294967295,r.Buffer=class{constructor(l,a,v){this._hasScrollback=l,this._optionsService=a,this._bufferService=v,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=f.DEFAULT_ATTR_DATA.clone(),this.savedCharset=o.DEFAULT_CHARSET,this.markers=[],this._nullCell=u.CellData.fromCharData([0,m.NULL_CELL_CHAR,m.NULL_CELL_WIDTH,m.NULL_CELL_CODE]),this._whitespaceCell=u.CellData.fromCharData([0,m.WHITESPACE_CELL_CHAR,m.WHITESPACE_CELL_WIDTH,m.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new p.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new g.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(l){return l?(this._nullCell.fg=l.fg,this._nullCell.bg=l.bg,this._nullCell.extended=l.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new n.ExtendedAttrs),this._nullCell}getWhitespaceCell(l){return l?(this._whitespaceCell.fg=l.fg,this._whitespaceCell.bg=l.bg,this._whitespaceCell.extended=l.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new n.ExtendedAttrs),this._whitespaceCell}getBlankLine(l,a){return new f.BufferLine(this._bufferService.cols,this.getNullCell(l),a)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){let l=this.ybase+this.y-this.ydisp;return l>=0&&l<this._rows}_getCorrectBufferLength(l){if(!this._hasScrollback)return l;let a=l+this._optionsService.rawOptions.scrollback;return a>r.MAX_BUFFER_SIZE?r.MAX_BUFFER_SIZE:a}fillViewportRows(l){if(this.lines.length===0){l===void 0&&(l=f.DEFAULT_ATTR_DATA);let a=this._rows;for(;a--;)this.lines.push(this.getBlankLine(l))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new g.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(l,a){let v=this.getNullCell(f.DEFAULT_ATTR_DATA),C=0,x=this._getCorrectBufferLength(a);if(x>this.lines.maxLength&&(this.lines.maxLength=x),this.lines.length>0){if(this._cols<l)for(let k=0;k<this.lines.length;k++)C+=+this.lines.get(k).resize(l,v);let L=0;if(this._rows<a)for(let k=this._rows;k<a;k++)this.lines.length<a+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new f.BufferLine(l,v)):this.ybase>0&&this.lines.length<=this.ybase+this.y+L+1?(this.ybase--,L++,this.ydisp>0&&this.ydisp--):this.lines.push(new f.BufferLine(l,v)));else for(let k=this._rows;k>a;k--)this.lines.length>a+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(x<this.lines.maxLength){let k=this.lines.length-x;k>0&&(this.lines.trimStart(k),this.ybase=Math.max(this.ybase-k,0),this.ydisp=Math.max(this.ydisp-k,0),this.savedY=Math.max(this.savedY-k,0)),this.lines.maxLength=x}this.x=Math.min(this.x,l-1),this.y=Math.min(this.y,a-1),L&&(this.y+=L),this.savedX=Math.min(this.savedX,l-1),this.scrollTop=0}if(this.scrollBottom=a-1,this._isReflowEnabled&&(this._reflow(l,a),this._cols>l))for(let L=0;L<this.lines.length;L++)C+=+this.lines.get(L).resize(l,v);this._cols=l,this._rows=a,this._memoryCleanupQueue.clear(),C>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let l=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,l=!1);let a=0;for(;this._memoryCleanupPosition<this.lines.length;)if(a+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),a>100)return!0;return l}get _isReflowEnabled(){let l=this._optionsService.rawOptions.windowsPty;return l&&l.buildNumber?this._hasScrollback&&l.backend==="conpty"&&l.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(l,a){this._cols!==l&&(l>this._cols?this._reflowLarger(l,a):this._reflowSmaller(l,a))}_reflowLarger(l,a){let v=(0,c.reflowLargerGetLinesToRemove)(this.lines,this._cols,l,this.ybase+this.y,this.getNullCell(f.DEFAULT_ATTR_DATA));if(v.length>0){let C=(0,c.reflowLargerCreateNewLayout)(this.lines,v);(0,c.reflowLargerApplyNewLayout)(this.lines,C.layout),this._reflowLargerAdjustViewport(l,a,C.countRemoved)}}_reflowLargerAdjustViewport(l,a,v){let C=this.getNullCell(f.DEFAULT_ATTR_DATA),x=v;for(;x-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<a&&this.lines.push(new f.BufferLine(l,C))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-v,0)}_reflowSmaller(l,a){let v=this.getNullCell(f.DEFAULT_ATTR_DATA),C=[],x=0;for(let L=this.lines.length-1;L>=0;L--){let k=this.lines.get(L);if(!k||!k.isWrapped&&k.getTrimmedLength()<=l)continue;let P=[k];for(;k.isWrapped&&L>0;)k=this.lines.get(--L),P.unshift(k);let K=this.ybase+this.y;if(K>=L&&K<L+P.length)continue;let R=P[P.length-1].getTrimmedLength(),B=(0,c.reflowSmallerGetNewLineLengths)(P,this._cols,l),D=B.length-P.length,ne;ne=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+D):Math.max(0,this.lines.length-this.lines.maxLength+D);let ie=[];for(let w=0;w<D;w++){let T=this.getBlankLine(f.DEFAULT_ATTR_DATA,!0);ie.push(T)}ie.length>0&&(C.push({start:L+P.length+x,newLines:ie}),x+=ie.length),P.push(...ie);let F=B.length-1,Q=B[F];Q===0&&(F--,Q=B[F]);let U=P.length-D-1,_=R;for(;U>=0;){let w=Math.min(_,Q);if(P[F]===void 0)break;if(P[F].copyCellsFrom(P[U],_-w,Q-w,w,!0),Q-=w,Q===0&&(F--,Q=B[F]),_-=w,_===0){U--;let T=Math.max(U,0);_=(0,c.getWrappedLineTrimmedLength)(P,T,this._cols)}}for(let w=0;w<P.length;w++)B[w]<l&&P[w].setCell(B[w],v);let A=D-ne;for(;A-- >0;)this.ybase===0?this.y<a-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+x)-a&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+D,this.ybase+a-1)}if(C.length>0){let L=[],k=[];for(let F=0;F<this.lines.length;F++)k.push(this.lines.get(F));let P=this.lines.length,K=P-1,R=0,B=C[R];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+x);let D=0;for(let F=Math.min(this.lines.maxLength-1,P+x-1);F>=0;F--)if(B&&B.start>K+D){for(let Q=B.newLines.length-1;Q>=0;Q--)this.lines.set(F--,B.newLines[Q]);F++,L.push({index:K+1,amount:B.newLines.length}),D+=B.newLines.length,B=C[++R]}else this.lines.set(F,k[K--]);let ne=0;for(let F=L.length-1;F>=0;F--)L[F].index+=ne,this.lines.onInsertEmitter.fire(L[F]),ne+=L[F].amount;let ie=Math.max(0,P+x-this.lines.maxLength);ie>0&&this.lines.onTrimEmitter.fire(ie)}}translateBufferLineToString(l,a,v=0,C){let x=this.lines.get(l);return x?x.translateToString(a,v,C):""}getWrappedRangeForLine(l){let a=l,v=l;for(;a>0&&this.lines.get(a).isWrapped;)a--;for(;v+1<this.lines.length&&this.lines.get(v+1).isWrapped;)v++;return{first:a,last:v}}setupTabStops(l){for(l!=null?this.tabs[l]||(l=this.prevStop(l)):(this.tabs={},l=0);l<this._cols;l+=this._optionsService.rawOptions.tabStopWidth)this.tabs[l]=!0}prevStop(l){for(l==null&&(l=this.x);!this.tabs[--l]&&l>0;);return l>=this._cols?this._cols-1:l<0?0:l}nextStop(l){for(l==null&&(l=this.x);!this.tabs[++l]&&l<this._cols;);return l>=this._cols?this._cols-1:l<0?0:l}clearMarkers(l){this._isClearing=!0;for(let a=0;a<this.markers.length;a++)this.markers[a].line===l&&(this.markers[a].dispose(),this.markers.splice(a--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let l=0;l<this.markers.length;l++)this.markers[l].dispose(),this.markers.splice(l--,1);this._isClearing=!1}addMarker(l){let a=new i.Marker(l);return this.markers.push(a),a.register(this.lines.onTrim(v=>{a.line-=v,a.line<0&&a.dispose()})),a.register(this.lines.onInsert(v=>{a.line>=v.index&&(a.line+=v.amount)})),a.register(this.lines.onDelete(v=>{a.line>=v.index&&a.line<v.index+v.amount&&a.dispose(),a.line>v.index&&(a.line-=v.amount)})),a.register(a.onDispose(()=>this._removeMarker(a))),a}_removeMarker(l){this._isClearing||this.markers.splice(this.markers.indexOf(l),1)}}},437:(S,r,h)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferLine=r.DEFAULT_ATTR_DATA=void 0;let g=h(734),p=h(511),n=h(643),f=h(482);r.DEFAULT_ATTR_DATA=Object.freeze(new g.AttributeData);let c=0;class u{constructor(i,o,l=!1){this.isWrapped=l,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*i);let a=o||p.CellData.fromCharData([0,n.NULL_CELL_CHAR,n.NULL_CELL_WIDTH,n.NULL_CELL_CODE]);for(let v=0;v<i;++v)this.setCell(v,a);this.length=i}get(i){let o=this._data[3*i+0],l=2097151&o;return[this._data[3*i+1],2097152&o?this._combined[i]:l?(0,f.stringFromCodePoint)(l):"",o>>22,2097152&o?this._combined[i].charCodeAt(this._combined[i].length-1):l]}set(i,o){this._data[3*i+1]=o[n.CHAR_DATA_ATTR_INDEX],o[n.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[i]=o[1],this._data[3*i+0]=2097152|i|o[n.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*i+0]=o[n.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|o[n.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(i){return this._data[3*i+0]>>22}hasWidth(i){return 12582912&this._data[3*i+0]}getFg(i){return this._data[3*i+1]}getBg(i){return this._data[3*i+2]}hasContent(i){return 4194303&this._data[3*i+0]}getCodePoint(i){let o=this._data[3*i+0];return 2097152&o?this._combined[i].charCodeAt(this._combined[i].length-1):2097151&o}isCombined(i){return 2097152&this._data[3*i+0]}getString(i){let o=this._data[3*i+0];return 2097152&o?this._combined[i]:2097151&o?(0,f.stringFromCodePoint)(2097151&o):""}isProtected(i){return 536870912&this._data[3*i+2]}loadCell(i,o){return c=3*i,o.content=this._data[c+0],o.fg=this._data[c+1],o.bg=this._data[c+2],2097152&o.content&&(o.combinedData=this._combined[i]),268435456&o.bg&&(o.extended=this._extendedAttrs[i]),o}setCell(i,o){2097152&o.content&&(this._combined[i]=o.combinedData),268435456&o.bg&&(this._extendedAttrs[i]=o.extended),this._data[3*i+0]=o.content,this._data[3*i+1]=o.fg,this._data[3*i+2]=o.bg}setCellFromCodepoint(i,o,l,a){268435456&a.bg&&(this._extendedAttrs[i]=a.extended),this._data[3*i+0]=o|l<<22,this._data[3*i+1]=a.fg,this._data[3*i+2]=a.bg}addCodepointToCell(i,o,l){let a=this._data[3*i+0];2097152&a?this._combined[i]+=(0,f.stringFromCodePoint)(o):2097151&a?(this._combined[i]=(0,f.stringFromCodePoint)(2097151&a)+(0,f.stringFromCodePoint)(o),a&=-2097152,a|=2097152):a=o|4194304,l&&(a&=-12582913,a|=l<<22),this._data[3*i+0]=a}insertCells(i,o,l){if((i%=this.length)&&this.getWidth(i-1)===2&&this.setCellFromCodepoint(i-1,0,1,l),o<this.length-i){let a=new p.CellData;for(let v=this.length-i-o-1;v>=0;--v)this.setCell(i+o+v,this.loadCell(i+v,a));for(let v=0;v<o;++v)this.setCell(i+v,l)}else for(let a=i;a<this.length;++a)this.setCell(a,l);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,l)}deleteCells(i,o,l){if(i%=this.length,o<this.length-i){let a=new p.CellData;for(let v=0;v<this.length-i-o;++v)this.setCell(i+v,this.loadCell(i+o+v,a));for(let v=this.length-o;v<this.length;++v)this.setCell(v,l)}else for(let a=i;a<this.length;++a)this.setCell(a,l);i&&this.getWidth(i-1)===2&&this.setCellFromCodepoint(i-1,0,1,l),this.getWidth(i)!==0||this.hasContent(i)||this.setCellFromCodepoint(i,0,1,l)}replaceCells(i,o,l,a=!1){if(a)for(i&&this.getWidth(i-1)===2&&!this.isProtected(i-1)&&this.setCellFromCodepoint(i-1,0,1,l),o<this.length&&this.getWidth(o-1)===2&&!this.isProtected(o)&&this.setCellFromCodepoint(o,0,1,l);i<o&&i<this.length;)this.isProtected(i)||this.setCell(i,l),i++;else for(i&&this.getWidth(i-1)===2&&this.setCellFromCodepoint(i-1,0,1,l),o<this.length&&this.getWidth(o-1)===2&&this.setCellFromCodepoint(o,0,1,l);i<o&&i<this.length;)this.setCell(i++,l)}resize(i,o){if(i===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;let l=3*i;if(i>this.length){if(this._data.buffer.byteLength>=4*l)this._data=new Uint32Array(this._data.buffer,0,l);else{let a=new Uint32Array(l);a.set(this._data),this._data=a}for(let a=this.length;a<i;++a)this.setCell(a,o)}else{this._data=this._data.subarray(0,l);let a=Object.keys(this._combined);for(let C=0;C<a.length;C++){let x=parseInt(a[C],10);x>=i&&delete this._combined[x]}let v=Object.keys(this._extendedAttrs);for(let C=0;C<v.length;C++){let x=parseInt(v[C],10);x>=i&&delete this._extendedAttrs[x]}}return this.length=i,4*l*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){let i=new Uint32Array(this._data.length);return i.set(this._data),this._data=i,1}return 0}fill(i,o=!1){if(o)for(let l=0;l<this.length;++l)this.isProtected(l)||this.setCell(l,i);else{this._combined={},this._extendedAttrs={};for(let l=0;l<this.length;++l)this.setCell(l,i)}}copyFrom(i){this.length!==i.length?this._data=new Uint32Array(i._data):this._data.set(i._data),this.length=i.length,this._combined={};for(let o in i._combined)this._combined[o]=i._combined[o];this._extendedAttrs={};for(let o in i._extendedAttrs)this._extendedAttrs[o]=i._extendedAttrs[o];this.isWrapped=i.isWrapped}clone(){let i=new u(0);i._data=new Uint32Array(this._data),i.length=this.length;for(let o in this._combined)i._combined[o]=this._combined[o];for(let o in this._extendedAttrs)i._extendedAttrs[o]=this._extendedAttrs[o];return i.isWrapped=this.isWrapped,i}getTrimmedLength(){for(let i=this.length-1;i>=0;--i)if(4194303&this._data[3*i+0])return i+(this._data[3*i+0]>>22);return 0}getNoBgTrimmedLength(){for(let i=this.length-1;i>=0;--i)if(4194303&this._data[3*i+0]||50331648&this._data[3*i+2])return i+(this._data[3*i+0]>>22);return 0}copyCellsFrom(i,o,l,a,v){let C=i._data;if(v)for(let L=a-1;L>=0;L--){for(let k=0;k<3;k++)this._data[3*(l+L)+k]=C[3*(o+L)+k];268435456&C[3*(o+L)+2]&&(this._extendedAttrs[l+L]=i._extendedAttrs[o+L])}else for(let L=0;L<a;L++){for(let k=0;k<3;k++)this._data[3*(l+L)+k]=C[3*(o+L)+k];268435456&C[3*(o+L)+2]&&(this._extendedAttrs[l+L]=i._extendedAttrs[o+L])}let x=Object.keys(i._combined);for(let L=0;L<x.length;L++){let k=parseInt(x[L],10);k>=o&&(this._combined[k-o+l]=i._combined[k])}}translateToString(i,o,l,a){o=o??0,l=l??this.length,i&&(l=Math.min(l,this.getTrimmedLength())),a&&(a.length=0);let v="";for(;o<l;){let C=this._data[3*o+0],x=2097151&C,L=2097152&C?this._combined[o]:x?(0,f.stringFromCodePoint)(x):n.WHITESPACE_CELL_CHAR;if(v+=L,a)for(let k=0;k<L.length;++k)a.push(o);o+=C>>22||1}return a&&a.push(o),v}}r.BufferLine=u},634:(S,r)=>{function h(g,p,n){if(p===g.length-1)return g[p].getTrimmedLength();let f=!g[p].hasContent(n-1)&&g[p].getWidth(n-1)===1,c=g[p+1].getWidth(0)===2;return f&&c?n-1:n}Object.defineProperty(r,"__esModule",{value:!0}),r.getWrappedLineTrimmedLength=r.reflowSmallerGetNewLineLengths=r.reflowLargerApplyNewLayout=r.reflowLargerCreateNewLayout=r.reflowLargerGetLinesToRemove=void 0,r.reflowLargerGetLinesToRemove=function(g,p,n,f,c){let u=[];for(let m=0;m<g.length-1;m++){let i=m,o=g.get(++i);if(!o.isWrapped)continue;let l=[g.get(m)];for(;i<g.length&&o.isWrapped;)l.push(o),o=g.get(++i);if(f>=m&&f<i){m+=l.length-1;continue}let a=0,v=h(l,a,p),C=1,x=0;for(;C<l.length;){let k=h(l,C,p),P=k-x,K=n-v,R=Math.min(P,K);l[a].copyCellsFrom(l[C],x,v,R,!1),v+=R,v===n&&(a++,v=0),x+=R,x===k&&(C++,x=0),v===0&&a!==0&&l[a-1].getWidth(n-1)===2&&(l[a].copyCellsFrom(l[a-1],n-1,v++,1,!1),l[a-1].setCell(n-1,c))}l[a].replaceCells(v,n,c);let L=0;for(let k=l.length-1;k>0&&(k>a||l[k].getTrimmedLength()===0);k--)L++;L>0&&(u.push(m+l.length-L),u.push(L)),m+=l.length-1}return u},r.reflowLargerCreateNewLayout=function(g,p){let n=[],f=0,c=p[f],u=0;for(let m=0;m<g.length;m++)if(c===m){let i=p[++f];g.onDeleteEmitter.fire({index:m-u,amount:i}),m+=i-1,u+=i,c=p[++f]}else n.push(m);return{layout:n,countRemoved:u}},r.reflowLargerApplyNewLayout=function(g,p){let n=[];for(let f=0;f<p.length;f++)n.push(g.get(p[f]));for(let f=0;f<n.length;f++)g.set(f,n[f]);g.length=p.length},r.reflowSmallerGetNewLineLengths=function(g,p,n){let f=[],c=g.map((o,l)=>h(g,l,p)).reduce((o,l)=>o+l),u=0,m=0,i=0;for(;i<c;){if(c-i<n){f.push(c-i);break}u+=n;let o=h(g,m,p);u>o&&(u-=o,m++);let l=g[m].getWidth(u-1)===2;l&&u--;let a=l?n-1:n;f.push(a),i+=a}return f},r.getWrappedLineTrimmedLength=h},295:(S,r,h)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferSet=void 0;let g=h(460),p=h(844),n=h(92);class f extends p.Disposable{constructor(u,m){super(),this._optionsService=u,this._bufferService=m,this._onBufferActivate=this.register(new g.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new n.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new n.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(u){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(u),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(u,m){this._normal.resize(u,m),this._alt.resize(u,m),this.setupTabStops(u)}setupTabStops(u){this._normal.setupTabStops(u),this._alt.setupTabStops(u)}}r.BufferSet=f},511:(S,r,h)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CellData=void 0;let g=h(482),p=h(643),n=h(734);class f extends n.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new n.ExtendedAttrs,this.combinedData=""}static fromCharData(u){let m=new f;return m.setFromCharData(u),m}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,g.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(u){this.fg=u[p.CHAR_DATA_ATTR_INDEX],this.bg=0;let m=!1;if(u[p.CHAR_DATA_CHAR_INDEX].length>2)m=!0;else if(u[p.CHAR_DATA_CHAR_INDEX].length===2){let i=u[p.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=i&&i<=56319){let o=u[p.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=o&&o<=57343?this.content=1024*(i-55296)+o-56320+65536|u[p.CHAR_DATA_WIDTH_INDEX]<<22:m=!0}else m=!0}else this.content=u[p.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|u[p.CHAR_DATA_WIDTH_INDEX]<<22;m&&(this.combinedData=u[p.CHAR_DATA_CHAR_INDEX],this.content=2097152|u[p.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}r.CellData=f},643:(S,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.WHITESPACE_CELL_CODE=r.WHITESPACE_CELL_WIDTH=r.WHITESPACE_CELL_CHAR=r.NULL_CELL_CODE=r.NULL_CELL_WIDTH=r.NULL_CELL_CHAR=r.CHAR_DATA_CODE_INDEX=r.CHAR_DATA_WIDTH_INDEX=r.CHAR_DATA_CHAR_INDEX=r.CHAR_DATA_ATTR_INDEX=r.DEFAULT_EXT=r.DEFAULT_ATTR=r.DEFAULT_COLOR=void 0,r.DEFAULT_COLOR=0,r.DEFAULT_ATTR=256|r.DEFAULT_COLOR<<9,r.DEFAULT_EXT=0,r.CHAR_DATA_ATTR_INDEX=0,r.CHAR_DATA_CHAR_INDEX=1,r.CHAR_DATA_WIDTH_INDEX=2,r.CHAR_DATA_CODE_INDEX=3,r.NULL_CELL_CHAR="",r.NULL_CELL_WIDTH=1,r.NULL_CELL_CODE=0,r.WHITESPACE_CELL_CHAR=" ",r.WHITESPACE_CELL_WIDTH=1,r.WHITESPACE_CELL_CODE=32},863:(S,r,h)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Marker=void 0;let g=h(460),p=h(844);class n{get id(){return this._id}constructor(c){this.line=c,this.isDisposed=!1,this._disposables=[],this._id=n._nextId++,this._onDispose=this.register(new g.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,p.disposeArray)(this._disposables),this._disposables.length=0)}register(c){return this._disposables.push(c),c}}r.Marker=n,n._nextId=1},116:(S,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DEFAULT_CHARSET=r.CHARSETS=void 0,r.CHARSETS={},r.DEFAULT_CHARSET=r.CHARSETS.B,r.CHARSETS[0]={"`":"\u25C6",a:"\u2592",b:"\u2409",c:"\u240C",d:"\u240D",e:"\u240A",f:"\xB0",g:"\xB1",h:"\u2424",i:"\u240B",j:"\u2518",k:"\u2510",l:"\u250C",m:"\u2514",n:"\u253C",o:"\u23BA",p:"\u23BB",q:"\u2500",r:"\u23BC",s:"\u23BD",t:"\u251C",u:"\u2524",v:"\u2534",w:"\u252C",x:"\u2502",y:"\u2264",z:"\u2265","{":"\u03C0","|":"\u2260","}":"\xA3","~":"\xB7"},r.CHARSETS.A={"#":"\xA3"},r.CHARSETS.B=void 0,r.CHARSETS[4]={"#":"\xA3","@":"\xBE","[":"ij","\\":"\xBD","]":"|","{":"\xA8","|":"f","}":"\xBC","~":"\xB4"},r.CHARSETS.C=r.CHARSETS[5]={"[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},r.CHARSETS.R={"#":"\xA3","@":"\xE0","[":"\xB0","\\":"\xE7","]":"\xA7","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xA8"},r.CHARSETS.Q={"@":"\xE0","[":"\xE2","\\":"\xE7","]":"\xEA","^":"\xEE","`":"\xF4","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xFB"},r.CHARSETS.K={"@":"\xA7","[":"\xC4","\\":"\xD6","]":"\xDC","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xDF"},r.CHARSETS.Y={"#":"\xA3","@":"\xA7","[":"\xB0","\\":"\xE7","]":"\xE9","`":"\xF9","{":"\xE0","|":"\xF2","}":"\xE8","~":"\xEC"},r.CHARSETS.E=r.CHARSETS[6]={"@":"\xC4","[":"\xC6","\\":"\xD8","]":"\xC5","^":"\xDC","`":"\xE4","{":"\xE6","|":"\xF8","}":"\xE5","~":"\xFC"},r.CHARSETS.Z={"#":"\xA3","@":"\xA7","[":"\xA1","\\":"\xD1","]":"\xBF","{":"\xB0","|":"\xF1","}":"\xE7"},r.CHARSETS.H=r.CHARSETS[7]={"@":"\xC9","[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},r.CHARSETS["="]={"#":"\xF9","@":"\xE0","[":"\xE9","\\":"\xE7","]":"\xEA","^":"\xEE",_:"\xE8","`":"\xF4","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xFB"}},584:(S,r)=>{var h,g,p;Object.defineProperty(r,"__esModule",{value:!0}),r.C1_ESCAPED=r.C1=r.C0=void 0,function(n){n.NUL="\0",n.SOH="",n.STX="",n.ETX="",n.EOT="",n.ENQ="",n.ACK="",n.BEL="\x07",n.BS="\b",n.HT="	",n.LF=`
`,n.VT="\v",n.FF="\f",n.CR="\r",n.SO="",n.SI="",n.DLE="",n.DC1="",n.DC2="",n.DC3="",n.DC4="",n.NAK="",n.SYN="",n.ETB="",n.CAN="",n.EM="",n.SUB="",n.ESC="\x1B",n.FS="",n.GS="",n.RS="",n.US="",n.SP=" ",n.DEL="\x7F"}(h||(r.C0=h={})),function(n){n.PAD="\x80",n.HOP="\x81",n.BPH="\x82",n.NBH="\x83",n.IND="\x84",n.NEL="\x85",n.SSA="\x86",n.ESA="\x87",n.HTS="\x88",n.HTJ="\x89",n.VTS="\x8A",n.PLD="\x8B",n.PLU="\x8C",n.RI="\x8D",n.SS2="\x8E",n.SS3="\x8F",n.DCS="\x90",n.PU1="\x91",n.PU2="\x92",n.STS="\x93",n.CCH="\x94",n.MW="\x95",n.SPA="\x96",n.EPA="\x97",n.SOS="\x98",n.SGCI="\x99",n.SCI="\x9A",n.CSI="\x9B",n.ST="\x9C",n.OSC="\x9D",n.PM="\x9E",n.APC="\x9F"}(g||(r.C1=g={})),function(n){n.ST=`${h.ESC}\\`}(p||(r.C1_ESCAPED=p={}))},482:(S,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Utf8ToUtf32=r.StringToUtf32=r.utf32ToString=r.stringFromCodePoint=void 0,r.stringFromCodePoint=function(h){return h>65535?(h-=65536,String.fromCharCode(55296+(h>>10))+String.fromCharCode(h%1024+56320)):String.fromCharCode(h)},r.utf32ToString=function(h,g=0,p=h.length){let n="";for(let f=g;f<p;++f){let c=h[f];c>65535?(c-=65536,n+=String.fromCharCode(55296+(c>>10))+String.fromCharCode(c%1024+56320)):n+=String.fromCharCode(c)}return n},r.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(h,g){let p=h.length;if(!p)return 0;let n=0,f=0;if(this._interim){let c=h.charCodeAt(f++);56320<=c&&c<=57343?g[n++]=1024*(this._interim-55296)+c-56320+65536:(g[n++]=this._interim,g[n++]=c),this._interim=0}for(let c=f;c<p;++c){let u=h.charCodeAt(c);if(55296<=u&&u<=56319){if(++c>=p)return this._interim=u,n;let m=h.charCodeAt(c);56320<=m&&m<=57343?g[n++]=1024*(u-55296)+m-56320+65536:(g[n++]=u,g[n++]=m)}else u!==65279&&(g[n++]=u)}return n}},r.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(h,g){let p=h.length;if(!p)return 0;let n,f,c,u,m=0,i=0,o=0;if(this.interim[0]){let v=!1,C=this.interim[0];C&=(224&C)==192?31:(240&C)==224?15:7;let x,L=0;for(;(x=63&this.interim[++L])&&L<4;)C<<=6,C|=x;let k=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,P=k-L;for(;o<P;){if(o>=p)return 0;if(x=h[o++],(192&x)!=128){o--,v=!0;break}this.interim[L++]=x,C<<=6,C|=63&x}v||(k===2?C<128?o--:g[m++]=C:k===3?C<2048||C>=55296&&C<=57343||C===65279||(g[m++]=C):C<65536||C>1114111||(g[m++]=C)),this.interim.fill(0)}let l=p-4,a=o;for(;a<p;){for(;!(!(a<l)||128&(n=h[a])||128&(f=h[a+1])||128&(c=h[a+2])||128&(u=h[a+3]));)g[m++]=n,g[m++]=f,g[m++]=c,g[m++]=u,a+=4;if(n=h[a++],n<128)g[m++]=n;else if((224&n)==192){if(a>=p)return this.interim[0]=n,m;if(f=h[a++],(192&f)!=128){a--;continue}if(i=(31&n)<<6|63&f,i<128){a--;continue}g[m++]=i}else if((240&n)==224){if(a>=p)return this.interim[0]=n,m;if(f=h[a++],(192&f)!=128){a--;continue}if(a>=p)return this.interim[0]=n,this.interim[1]=f,m;if(c=h[a++],(192&c)!=128){a--;continue}if(i=(15&n)<<12|(63&f)<<6|63&c,i<2048||i>=55296&&i<=57343||i===65279)continue;g[m++]=i}else if((248&n)==240){if(a>=p)return this.interim[0]=n,m;if(f=h[a++],(192&f)!=128){a--;continue}if(a>=p)return this.interim[0]=n,this.interim[1]=f,m;if(c=h[a++],(192&c)!=128){a--;continue}if(a>=p)return this.interim[0]=n,this.interim[1]=f,this.interim[2]=c,m;if(u=h[a++],(192&u)!=128){a--;continue}if(i=(7&n)<<18|(63&f)<<12|(63&c)<<6|63&u,i<65536||i>1114111)continue;g[m++]=i}}return m}}},225:(S,r,h)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.UnicodeV6=void 0;let g=h(480),p=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],n=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],f;r.UnicodeV6=class{constructor(){if(this.version="6",!f){f=new Uint8Array(65536),f.fill(1),f[0]=0,f.fill(0,1,32),f.fill(0,127,160),f.fill(2,4352,4448),f[9001]=2,f[9002]=2,f.fill(2,11904,42192),f[12351]=1,f.fill(2,44032,55204),f.fill(2,63744,64256),f.fill(2,65040,65050),f.fill(2,65072,65136),f.fill(2,65280,65377),f.fill(2,65504,65511);for(let c=0;c<p.length;++c)f.fill(0,p[c][0],p[c][1]+1)}}wcwidth(c){return c<32?0:c<127?1:c<65536?f[c]:function(u,m){let i,o=0,l=m.length-1;if(u<m[0][0]||u>m[l][1])return!1;for(;l>=o;)if(i=o+l>>1,u>m[i][1])o=i+1;else{if(!(u<m[i][0]))return!0;l=i-1}return!1}(c,n)?0:c>=131072&&c<=196605||c>=196608&&c<=262141?2:1}charProperties(c,u){let m=this.wcwidth(c),i=m===0&&u!==0;if(i){let o=g.UnicodeService.extractWidth(u);o===0?i=!1:o>m&&(m=o)}return g.UnicodeService.createPropertyValue(0,m,i)}}},981:(S,r,h)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.WriteBuffer=void 0;let g=h(460),p=h(844);class n extends p.Disposable{constructor(c){super(),this._action=c,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new g.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(c,u){if(u!==void 0&&this._syncCalls>u)return void(this._syncCalls=0);if(this._pendingData+=c.length,this._writeBuffer.push(c),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let m;for(this._isSyncWriting=!0;m=this._writeBuffer.shift();){this._action(m);let i=this._callbacks.shift();i&&i()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(c,u){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=c.length,this._writeBuffer.push(c),this._callbacks.push(u),void this._innerWrite();setTimeout(()=>this._innerWrite())}this._pendingData+=c.length,this._writeBuffer.push(c),this._callbacks.push(u)}_innerWrite(c=0,u=!0){let m=c||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){let i=this._writeBuffer[this._bufferOffset],o=this._action(i,u);if(o){let a=v=>Date.now()-m>=12?setTimeout(()=>this._innerWrite(0,v)):this._innerWrite(m,v);return void o.catch(v=>(queueMicrotask(()=>{throw v}),Promise.resolve(!1))).then(a)}let l=this._callbacks[this._bufferOffset];if(l&&l(),this._bufferOffset++,this._pendingData-=i.length,Date.now()-m>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}r.WriteBuffer=n},941:(S,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.toRgbString=r.parseColor=void 0;let h=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,g=/^[\da-f]+$/;function p(n,f){let c=n.toString(16),u=c.length<2?"0"+c:c;switch(f){case 4:return c[0];case 8:return u;case 12:return(u+u).slice(0,3);default:return u+u}}r.parseColor=function(n){if(!n)return;let f=n.toLowerCase();if(f.indexOf("rgb:")===0){f=f.slice(4);let c=h.exec(f);if(c){let u=c[1]?15:c[4]?255:c[7]?4095:65535;return[Math.round(parseInt(c[1]||c[4]||c[7]||c[10],16)/u*255),Math.round(parseInt(c[2]||c[5]||c[8]||c[11],16)/u*255),Math.round(parseInt(c[3]||c[6]||c[9]||c[12],16)/u*255)]}}else if(f.indexOf("#")===0&&(f=f.slice(1),g.exec(f)&&[3,6,9,12].includes(f.length))){let c=f.length/3,u=[0,0,0];for(let m=0;m<3;++m){let i=parseInt(f.slice(c*m,c*m+c),16);u[m]=c===1?i<<4:c===2?i:c===3?i>>4:i>>8}return u}},r.toRgbString=function(n,f=16){let[c,u,m]=n;return`rgb:${p(c,f)}/${p(u,f)}/${p(m,f)}`}},770:(S,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PAYLOAD_LIMIT=void 0,r.PAYLOAD_LIMIT=1e7},351:(S,r,h)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DcsHandler=r.DcsParser=void 0;let g=h(482),p=h(742),n=h(770),f=[];r.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=f,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=f}registerHandler(u,m){this._handlers[u]===void 0&&(this._handlers[u]=[]);let i=this._handlers[u];return i.push(m),{dispose:()=>{let o=i.indexOf(m);o!==-1&&i.splice(o,1)}}}clearHandler(u){this._handlers[u]&&delete this._handlers[u]}setHandlerFallback(u){this._handlerFb=u}reset(){if(this._active.length)for(let u=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;u>=0;--u)this._active[u].unhook(!1);this._stack.paused=!1,this._active=f,this._ident=0}hook(u,m){if(this.reset(),this._ident=u,this._active=this._handlers[u]||f,this._active.length)for(let i=this._active.length-1;i>=0;i--)this._active[i].hook(m);else this._handlerFb(this._ident,"HOOK",m)}put(u,m,i){if(this._active.length)for(let o=this._active.length-1;o>=0;o--)this._active[o].put(u,m,i);else this._handlerFb(this._ident,"PUT",(0,g.utf32ToString)(u,m,i))}unhook(u,m=!0){if(this._active.length){let i=!1,o=this._active.length-1,l=!1;if(this._stack.paused&&(o=this._stack.loopPosition-1,i=m,l=this._stack.fallThrough,this._stack.paused=!1),!l&&i===!1){for(;o>=0&&(i=this._active[o].unhook(u),i!==!0);o--)if(i instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=o,this._stack.fallThrough=!1,i;o--}for(;o>=0;o--)if(i=this._active[o].unhook(!1),i instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=o,this._stack.fallThrough=!0,i}else this._handlerFb(this._ident,"UNHOOK",u);this._active=f,this._ident=0}};let c=new p.Params;c.addParam(0),r.DcsHandler=class{constructor(u){this._handler=u,this._data="",this._params=c,this._hitLimit=!1}hook(u){this._params=u.length>1||u.params[0]?u.clone():c,this._data="",this._hitLimit=!1}put(u,m,i){this._hitLimit||(this._data+=(0,g.utf32ToString)(u,m,i),this._data.length>n.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(u){let m=!1;if(this._hitLimit)m=!1;else if(u&&(m=this._handler(this._data,this._params),m instanceof Promise))return m.then(i=>(this._params=c,this._data="",this._hitLimit=!1,i));return this._params=c,this._data="",this._hitLimit=!1,m}}},15:(S,r,h)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.EscapeSequenceParser=r.VT500_TRANSITION_TABLE=r.TransitionTable=void 0;let g=h(844),p=h(742),n=h(242),f=h(351);class c{constructor(o){this.table=new Uint8Array(o)}setDefault(o,l){this.table.fill(o<<4|l)}add(o,l,a,v){this.table[l<<8|o]=a<<4|v}addMany(o,l,a,v){for(let C=0;C<o.length;C++)this.table[l<<8|o[C]]=a<<4|v}}r.TransitionTable=c;let u=160;r.VT500_TRANSITION_TABLE=function(){let i=new c(4095),o=Array.apply(null,Array(256)).map((L,k)=>k),l=(L,k)=>o.slice(L,k),a=l(32,127),v=l(0,24);v.push(25),v.push.apply(v,l(28,32));let C=l(0,14),x;for(x in i.setDefault(1,0),i.addMany(a,0,2,0),C)i.addMany([24,26,153,154],x,3,0),i.addMany(l(128,144),x,3,0),i.addMany(l(144,152),x,3,0),i.add(156,x,0,0),i.add(27,x,11,1),i.add(157,x,4,8),i.addMany([152,158,159],x,0,7),i.add(155,x,11,3),i.add(144,x,11,9);return i.addMany(v,0,3,0),i.addMany(v,1,3,1),i.add(127,1,0,1),i.addMany(v,8,0,8),i.addMany(v,3,3,3),i.add(127,3,0,3),i.addMany(v,4,3,4),i.add(127,4,0,4),i.addMany(v,6,3,6),i.addMany(v,5,3,5),i.add(127,5,0,5),i.addMany(v,2,3,2),i.add(127,2,0,2),i.add(93,1,4,8),i.addMany(a,8,5,8),i.add(127,8,5,8),i.addMany([156,27,24,26,7],8,6,0),i.addMany(l(28,32),8,0,8),i.addMany([88,94,95],1,0,7),i.addMany(a,7,0,7),i.addMany(v,7,0,7),i.add(156,7,0,0),i.add(127,7,0,7),i.add(91,1,11,3),i.addMany(l(64,127),3,7,0),i.addMany(l(48,60),3,8,4),i.addMany([60,61,62,63],3,9,4),i.addMany(l(48,60),4,8,4),i.addMany(l(64,127),4,7,0),i.addMany([60,61,62,63],4,0,6),i.addMany(l(32,64),6,0,6),i.add(127,6,0,6),i.addMany(l(64,127),6,0,0),i.addMany(l(32,48),3,9,5),i.addMany(l(32,48),5,9,5),i.addMany(l(48,64),5,0,6),i.addMany(l(64,127),5,7,0),i.addMany(l(32,48),4,9,5),i.addMany(l(32,48),1,9,2),i.addMany(l(32,48),2,9,2),i.addMany(l(48,127),2,10,0),i.addMany(l(48,80),1,10,0),i.addMany(l(81,88),1,10,0),i.addMany([89,90,92],1,10,0),i.addMany(l(96,127),1,10,0),i.add(80,1,11,9),i.addMany(v,9,0,9),i.add(127,9,0,9),i.addMany(l(28,32),9,0,9),i.addMany(l(32,48),9,9,12),i.addMany(l(48,60),9,8,10),i.addMany([60,61,62,63],9,9,10),i.addMany(v,11,0,11),i.addMany(l(32,128),11,0,11),i.addMany(l(28,32),11,0,11),i.addMany(v,10,0,10),i.add(127,10,0,10),i.addMany(l(28,32),10,0,10),i.addMany(l(48,60),10,8,10),i.addMany([60,61,62,63],10,0,11),i.addMany(l(32,48),10,9,12),i.addMany(v,12,0,12),i.add(127,12,0,12),i.addMany(l(28,32),12,0,12),i.addMany(l(32,48),12,9,12),i.addMany(l(48,64),12,0,11),i.addMany(l(64,127),12,12,13),i.addMany(l(64,127),10,12,13),i.addMany(l(64,127),9,12,13),i.addMany(v,13,13,13),i.addMany(a,13,13,13),i.add(127,13,0,13),i.addMany([27,156,24,26],13,14,0),i.add(u,0,2,0),i.add(u,8,5,8),i.add(u,6,0,6),i.add(u,11,0,11),i.add(u,13,13,13),i}();class m extends g.Disposable{constructor(o=r.VT500_TRANSITION_TABLE){super(),this._transitions=o,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new p.Params,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(l,a,v)=>{},this._executeHandlerFb=l=>{},this._csiHandlerFb=(l,a)=>{},this._escHandlerFb=l=>{},this._errorHandlerFb=l=>l,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,g.toDisposable)(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this.register(new n.OscParser),this._dcsParser=this.register(new f.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(o,l=[64,126]){let a=0;if(o.prefix){if(o.prefix.length>1)throw new Error("only one byte as prefix supported");if(a=o.prefix.charCodeAt(0),a&&60>a||a>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(o.intermediates){if(o.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let C=0;C<o.intermediates.length;++C){let x=o.intermediates.charCodeAt(C);if(32>x||x>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");a<<=8,a|=x}}if(o.final.length!==1)throw new Error("final must be a single byte");let v=o.final.charCodeAt(0);if(l[0]>v||v>l[1])throw new Error(`final must be in range ${l[0]} .. ${l[1]}`);return a<<=8,a|=v,a}identToString(o){let l=[];for(;o;)l.push(String.fromCharCode(255&o)),o>>=8;return l.reverse().join("")}setPrintHandler(o){this._printHandler=o}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(o,l){let a=this._identifier(o,[48,126]);this._escHandlers[a]===void 0&&(this._escHandlers[a]=[]);let v=this._escHandlers[a];return v.push(l),{dispose:()=>{let C=v.indexOf(l);C!==-1&&v.splice(C,1)}}}clearEscHandler(o){this._escHandlers[this._identifier(o,[48,126])]&&delete this._escHandlers[this._identifier(o,[48,126])]}setEscHandlerFallback(o){this._escHandlerFb=o}setExecuteHandler(o,l){this._executeHandlers[o.charCodeAt(0)]=l}clearExecuteHandler(o){this._executeHandlers[o.charCodeAt(0)]&&delete this._executeHandlers[o.charCodeAt(0)]}setExecuteHandlerFallback(o){this._executeHandlerFb=o}registerCsiHandler(o,l){let a=this._identifier(o);this._csiHandlers[a]===void 0&&(this._csiHandlers[a]=[]);let v=this._csiHandlers[a];return v.push(l),{dispose:()=>{let C=v.indexOf(l);C!==-1&&v.splice(C,1)}}}clearCsiHandler(o){this._csiHandlers[this._identifier(o)]&&delete this._csiHandlers[this._identifier(o)]}setCsiHandlerFallback(o){this._csiHandlerFb=o}registerDcsHandler(o,l){return this._dcsParser.registerHandler(this._identifier(o),l)}clearDcsHandler(o){this._dcsParser.clearHandler(this._identifier(o))}setDcsHandlerFallback(o){this._dcsParser.setHandlerFallback(o)}registerOscHandler(o,l){return this._oscParser.registerHandler(o,l)}clearOscHandler(o){this._oscParser.clearHandler(o)}setOscHandlerFallback(o){this._oscParser.setHandlerFallback(o)}setErrorHandler(o){this._errorHandler=o}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(o,l,a,v,C){this._parseStack.state=o,this._parseStack.handlers=l,this._parseStack.handlerPos=a,this._parseStack.transition=v,this._parseStack.chunkPos=C}parse(o,l,a){let v,C=0,x=0,L=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,L=this._parseStack.chunkPos+1;else{if(a===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");let k=this._parseStack.handlers,P=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(a===!1&&P>-1){for(;P>=0&&(v=k[P](this._params),v!==!0);P--)if(v instanceof Promise)return this._parseStack.handlerPos=P,v}this._parseStack.handlers=[];break;case 4:if(a===!1&&P>-1){for(;P>=0&&(v=k[P](),v!==!0);P--)if(v instanceof Promise)return this._parseStack.handlerPos=P,v}this._parseStack.handlers=[];break;case 6:if(C=o[this._parseStack.chunkPos],v=this._dcsParser.unhook(C!==24&&C!==26,a),v)return v;C===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(C=o[this._parseStack.chunkPos],v=this._oscParser.end(C!==24&&C!==26,a),v)return v;C===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,L=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=15&this._parseStack.transition}for(let k=L;k<l;++k){switch(C=o[k],x=this._transitions.table[this.currentState<<8|(C<160?C:u)],x>>4){case 2:for(let D=k+1;;++D){if(D>=l||(C=o[D])<32||C>126&&C<u){this._printHandler(o,k,D),k=D-1;break}if(++D>=l||(C=o[D])<32||C>126&&C<u){this._printHandler(o,k,D),k=D-1;break}if(++D>=l||(C=o[D])<32||C>126&&C<u){this._printHandler(o,k,D),k=D-1;break}if(++D>=l||(C=o[D])<32||C>126&&C<u){this._printHandler(o,k,D),k=D-1;break}}break;case 3:this._executeHandlers[C]?this._executeHandlers[C]():this._executeHandlerFb(C),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:k,code:C,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:let P=this._csiHandlers[this._collect<<8|C],K=P?P.length-1:-1;for(;K>=0&&(v=P[K](this._params),v!==!0);K--)if(v instanceof Promise)return this._preserveStack(3,P,K,x,k),v;K<0&&this._csiHandlerFb(this._collect<<8|C,this._params),this.precedingJoinState=0;break;case 8:do switch(C){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(C-48)}while(++k<l&&(C=o[k])>47&&C<60);k--;break;case 9:this._collect<<=8,this._collect|=C;break;case 10:let R=this._escHandlers[this._collect<<8|C],B=R?R.length-1:-1;for(;B>=0&&(v=R[B](),v!==!0);B--)if(v instanceof Promise)return this._preserveStack(4,R,B,x,k),v;B<0&&this._escHandlerFb(this._collect<<8|C),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|C,this._params);break;case 13:for(let D=k+1;;++D)if(D>=l||(C=o[D])===24||C===26||C===27||C>127&&C<u){this._dcsParser.put(o,k,D),k=D-1;break}break;case 14:if(v=this._dcsParser.unhook(C!==24&&C!==26),v)return this._preserveStack(6,[],0,x,k),v;C===27&&(x|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let D=k+1;;D++)if(D>=l||(C=o[D])<32||C>127&&C<u){this._oscParser.put(o,k,D),k=D-1;break}break;case 6:if(v=this._oscParser.end(C!==24&&C!==26),v)return this._preserveStack(5,[],0,x,k),v;C===27&&(x|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0}this.currentState=15&x}}}r.EscapeSequenceParser=m},242:(S,r,h)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.OscHandler=r.OscParser=void 0;let g=h(770),p=h(482),n=[];r.OscParser=class{constructor(){this._state=0,this._active=n,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(f,c){this._handlers[f]===void 0&&(this._handlers[f]=[]);let u=this._handlers[f];return u.push(c),{dispose:()=>{let m=u.indexOf(c);m!==-1&&u.splice(m,1)}}}clearHandler(f){this._handlers[f]&&delete this._handlers[f]}setHandlerFallback(f){this._handlerFb=f}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=n}reset(){if(this._state===2)for(let f=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;f>=0;--f)this._active[f].end(!1);this._stack.paused=!1,this._active=n,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||n,this._active.length)for(let f=this._active.length-1;f>=0;f--)this._active[f].start();else this._handlerFb(this._id,"START")}_put(f,c,u){if(this._active.length)for(let m=this._active.length-1;m>=0;m--)this._active[m].put(f,c,u);else this._handlerFb(this._id,"PUT",(0,p.utf32ToString)(f,c,u))}start(){this.reset(),this._state=1}put(f,c,u){if(this._state!==3){if(this._state===1)for(;c<u;){let m=f[c++];if(m===59){this._state=2,this._start();break}if(m<48||57<m)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+m-48}this._state===2&&u-c>0&&this._put(f,c,u)}}end(f,c=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let u=!1,m=this._active.length-1,i=!1;if(this._stack.paused&&(m=this._stack.loopPosition-1,u=c,i=this._stack.fallThrough,this._stack.paused=!1),!i&&u===!1){for(;m>=0&&(u=this._active[m].end(f),u!==!0);m--)if(u instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=m,this._stack.fallThrough=!1,u;m--}for(;m>=0;m--)if(u=this._active[m].end(!1),u instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=m,this._stack.fallThrough=!0,u}else this._handlerFb(this._id,"END",f);this._active=n,this._id=-1,this._state=0}}},r.OscHandler=class{constructor(f){this._handler=f,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(f,c,u){this._hitLimit||(this._data+=(0,p.utf32ToString)(f,c,u),this._data.length>g.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(f){let c=!1;if(this._hitLimit)c=!1;else if(f&&(c=this._handler(this._data),c instanceof Promise))return c.then(u=>(this._data="",this._hitLimit=!1,u));return this._data="",this._hitLimit=!1,c}}},742:(S,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Params=void 0;let h=2147483647;class g{static fromArray(n){let f=new g;if(!n.length)return f;for(let c=Array.isArray(n[0])?1:0;c<n.length;++c){let u=n[c];if(Array.isArray(u))for(let m=0;m<u.length;++m)f.addSubParam(u[m]);else f.addParam(u)}return f}constructor(n=32,f=32){if(this.maxLength=n,this.maxSubParamsLength=f,f>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(n),this.length=0,this._subParams=new Int32Array(f),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(n),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){let n=new g(this.maxLength,this.maxSubParamsLength);return n.params.set(this.params),n.length=this.length,n._subParams.set(this._subParams),n._subParamsLength=this._subParamsLength,n._subParamsIdx.set(this._subParamsIdx),n._rejectDigits=this._rejectDigits,n._rejectSubDigits=this._rejectSubDigits,n._digitIsSub=this._digitIsSub,n}toArray(){let n=[];for(let f=0;f<this.length;++f){n.push(this.params[f]);let c=this._subParamsIdx[f]>>8,u=255&this._subParamsIdx[f];u-c>0&&n.push(Array.prototype.slice.call(this._subParams,c,u))}return n}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(n){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(n<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=n>h?h:n}}addSubParam(n){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(n<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=n>h?h:n,this._subParamsIdx[this.length-1]++}}hasSubParams(n){return(255&this._subParamsIdx[n])-(this._subParamsIdx[n]>>8)>0}getSubParams(n){let f=this._subParamsIdx[n]>>8,c=255&this._subParamsIdx[n];return c-f>0?this._subParams.subarray(f,c):null}getSubParamsAll(){let n={};for(let f=0;f<this.length;++f){let c=this._subParamsIdx[f]>>8,u=255&this._subParamsIdx[f];u-c>0&&(n[f]=this._subParams.slice(c,u))}return n}addDigit(n){let f;if(this._rejectDigits||!(f=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;let c=this._digitIsSub?this._subParams:this.params,u=c[f-1];c[f-1]=~u?Math.min(10*u+n,h):n}}r.Params=g},741:(S,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.AddonManager=void 0,r.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let h=this._addons.length-1;h>=0;h--)this._addons[h].instance.dispose()}loadAddon(h,g){let p={instance:g,dispose:g.dispose,isDisposed:!1};this._addons.push(p),g.dispose=()=>this._wrappedAddonDispose(p),g.activate(h)}_wrappedAddonDispose(h){if(h.isDisposed)return;let g=-1;for(let p=0;p<this._addons.length;p++)if(this._addons[p]===h){g=p;break}if(g===-1)throw new Error("Could not dispose an addon that has not been loaded");h.isDisposed=!0,h.dispose.apply(h.instance),this._addons.splice(g,1)}}},771:(S,r,h)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferApiView=void 0;let g=h(785),p=h(511);r.BufferApiView=class{constructor(n,f){this._buffer=n,this.type=f}init(n){return this._buffer=n,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(n){let f=this._buffer.lines.get(n);if(f)return new g.BufferLineApiView(f)}getNullCell(){return new p.CellData}}},785:(S,r,h)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferLineApiView=void 0;let g=h(511);r.BufferLineApiView=class{constructor(p){this._line=p}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(p,n){if(!(p<0||p>=this._line.length))return n?(this._line.loadCell(p,n),n):this._line.loadCell(p,new g.CellData)}translateToString(p,n,f){return this._line.translateToString(p,n,f)}}},285:(S,r,h)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferNamespaceApi=void 0;let g=h(771),p=h(460),n=h(844);class f extends n.Disposable{constructor(u){super(),this._core=u,this._onBufferChange=this.register(new p.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new g.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new g.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}r.BufferNamespaceApi=f},975:(S,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ParserApi=void 0,r.ParserApi=class{constructor(h){this._core=h}registerCsiHandler(h,g){return this._core.registerCsiHandler(h,p=>g(p.toArray()))}addCsiHandler(h,g){return this.registerCsiHandler(h,g)}registerDcsHandler(h,g){return this._core.registerDcsHandler(h,(p,n)=>g(p,n.toArray()))}addDcsHandler(h,g){return this.registerDcsHandler(h,g)}registerEscHandler(h,g){return this._core.registerEscHandler(h,g)}addEscHandler(h,g){return this.registerEscHandler(h,g)}registerOscHandler(h,g){return this._core.registerOscHandler(h,g)}addOscHandler(h,g){return this.registerOscHandler(h,g)}}},90:(S,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.UnicodeApi=void 0,r.UnicodeApi=class{constructor(h){this._core=h}register(h){this._core.unicodeService.register(h)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(h){this._core.unicodeService.activeVersion=h}}},744:function(S,r,h){var g=this&&this.__decorate||function(i,o,l,a){var v,C=arguments.length,x=C<3?o:a===null?a=Object.getOwnPropertyDescriptor(o,l):a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(i,o,l,a);else for(var L=i.length-1;L>=0;L--)(v=i[L])&&(x=(C<3?v(x):C>3?v(o,l,x):v(o,l))||x);return C>3&&x&&Object.defineProperty(o,l,x),x},p=this&&this.__param||function(i,o){return function(l,a){o(l,a,i)}};Object.defineProperty(r,"__esModule",{value:!0}),r.BufferService=r.MINIMUM_ROWS=r.MINIMUM_COLS=void 0;let n=h(460),f=h(844),c=h(295),u=h(585);r.MINIMUM_COLS=2,r.MINIMUM_ROWS=1;let m=r.BufferService=class extends f.Disposable{get buffer(){return this.buffers.active}constructor(i){super(),this.isUserScrolling=!1,this._onResize=this.register(new n.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new n.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(i.rawOptions.cols||0,r.MINIMUM_COLS),this.rows=Math.max(i.rawOptions.rows||0,r.MINIMUM_ROWS),this.buffers=this.register(new c.BufferSet(i,this))}resize(i,o){this.cols=i,this.rows=o,this.buffers.resize(i,o),this._onResize.fire({cols:i,rows:o})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(i,o=!1){let l=this.buffer,a;a=this._cachedBlankLine,a&&a.length===this.cols&&a.getFg(0)===i.fg&&a.getBg(0)===i.bg||(a=l.getBlankLine(i,o),this._cachedBlankLine=a),a.isWrapped=o;let v=l.ybase+l.scrollTop,C=l.ybase+l.scrollBottom;if(l.scrollTop===0){let x=l.lines.isFull;C===l.lines.length-1?x?l.lines.recycle().copyFrom(a):l.lines.push(a.clone()):l.lines.splice(C+1,0,a.clone()),x?this.isUserScrolling&&(l.ydisp=Math.max(l.ydisp-1,0)):(l.ybase++,this.isUserScrolling||l.ydisp++)}else{let x=C-v+1;l.lines.shiftElements(v+1,x-1,-1),l.lines.set(C,a.clone())}this.isUserScrolling||(l.ydisp=l.ybase),this._onScroll.fire(l.ydisp)}scrollLines(i,o,l){let a=this.buffer;if(i<0){if(a.ydisp===0)return;this.isUserScrolling=!0}else i+a.ydisp>=a.ybase&&(this.isUserScrolling=!1);let v=a.ydisp;a.ydisp=Math.max(Math.min(a.ydisp+i,a.ybase),0),v!==a.ydisp&&(o||this._onScroll.fire(a.ydisp))}};r.BufferService=m=g([p(0,u.IOptionsService)],m)},994:(S,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CharsetService=void 0,r.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(h){this.glevel=h,this.charset=this._charsets[h]}setgCharset(h,g){this._charsets[h]=g,this.glevel===h&&(this.charset=g)}}},753:function(S,r,h){var g=this&&this.__decorate||function(a,v,C,x){var L,k=arguments.length,P=k<3?v:x===null?x=Object.getOwnPropertyDescriptor(v,C):x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")P=Reflect.decorate(a,v,C,x);else for(var K=a.length-1;K>=0;K--)(L=a[K])&&(P=(k<3?L(P):k>3?L(v,C,P):L(v,C))||P);return k>3&&P&&Object.defineProperty(v,C,P),P},p=this&&this.__param||function(a,v){return function(C,x){v(C,x,a)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CoreMouseService=void 0;let n=h(585),f=h(460),c=h(844),u={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:a=>a.button!==4&&a.action===1&&(a.ctrl=!1,a.alt=!1,a.shift=!1,!0)},VT200:{events:19,restrict:a=>a.action!==32},DRAG:{events:23,restrict:a=>a.action!==32||a.button!==3},ANY:{events:31,restrict:a=>!0}};function m(a,v){let C=(a.ctrl?16:0)|(a.shift?4:0)|(a.alt?8:0);return a.button===4?(C|=64,C|=a.action):(C|=3&a.button,4&a.button&&(C|=64),8&a.button&&(C|=128),a.action===32?C|=32:a.action!==0||v||(C|=3)),C}let i=String.fromCharCode,o={DEFAULT:a=>{let v=[m(a,!1)+32,a.col+32,a.row+32];return v[0]>255||v[1]>255||v[2]>255?"":`\x1B[M${i(v[0])}${i(v[1])}${i(v[2])}`},SGR:a=>{let v=a.action===0&&a.button!==4?"m":"M";return`\x1B[<${m(a,!0)};${a.col};${a.row}${v}`},SGR_PIXELS:a=>{let v=a.action===0&&a.button!==4?"m":"M";return`\x1B[<${m(a,!0)};${a.x};${a.y}${v}`}},l=r.CoreMouseService=class extends c.Disposable{constructor(a,v){super(),this._bufferService=a,this._coreService=v,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new f.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(let C of Object.keys(u))this.addProtocol(C,u[C]);for(let C of Object.keys(o))this.addEncoding(C,o[C]);this.reset()}addProtocol(a,v){this._protocols[a]=v}addEncoding(a,v){this._encodings[a]=v}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(a){if(!this._protocols[a])throw new Error(`unknown protocol "${a}"`);this._activeProtocol=a,this._onProtocolChange.fire(this._protocols[a].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(a){if(!this._encodings[a])throw new Error(`unknown encoding "${a}"`);this._activeEncoding=a}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(a){if(a.col<0||a.col>=this._bufferService.cols||a.row<0||a.row>=this._bufferService.rows||a.button===4&&a.action===32||a.button===3&&a.action!==32||a.button!==4&&(a.action===2||a.action===3)||(a.col++,a.row++,a.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,a,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(a))return!1;let v=this._encodings[this._activeEncoding](a);return v&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(v):this._coreService.triggerDataEvent(v,!0)),this._lastEvent=a,!0}explainEvents(a){return{down:!!(1&a),up:!!(2&a),drag:!!(4&a),move:!!(8&a),wheel:!!(16&a)}}_equalEvents(a,v,C){if(C){if(a.x!==v.x||a.y!==v.y)return!1}else if(a.col!==v.col||a.row!==v.row)return!1;return a.button===v.button&&a.action===v.action&&a.ctrl===v.ctrl&&a.alt===v.alt&&a.shift===v.shift}};r.CoreMouseService=l=g([p(0,n.IBufferService),p(1,n.ICoreService)],l)},83:function(S,r,h){var g=this&&this.__decorate||function(l,a,v,C){var x,L=arguments.length,k=L<3?a:C===null?C=Object.getOwnPropertyDescriptor(a,v):C;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")k=Reflect.decorate(l,a,v,C);else for(var P=l.length-1;P>=0;P--)(x=l[P])&&(k=(L<3?x(k):L>3?x(a,v,k):x(a,v))||k);return L>3&&k&&Object.defineProperty(a,v,k),k},p=this&&this.__param||function(l,a){return function(v,C){a(v,C,l)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CoreService=void 0;let n=h(439),f=h(460),c=h(844),u=h(585),m=Object.freeze({insertMode:!1}),i=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0}),o=r.CoreService=class extends c.Disposable{constructor(l,a,v){super(),this._bufferService=l,this._logService=a,this._optionsService=v,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new f.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new f.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new f.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new f.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,n.clone)(m),this.decPrivateModes=(0,n.clone)(i)}reset(){this.modes=(0,n.clone)(m),this.decPrivateModes=(0,n.clone)(i)}triggerDataEvent(l,a=!1){if(this._optionsService.rawOptions.disableStdin)return;let v=this._bufferService.buffer;a&&this._optionsService.rawOptions.scrollOnUserInput&&v.ybase!==v.ydisp&&this._onRequestScrollToBottom.fire(),a&&this._onUserInput.fire(),this._logService.debug(`sending data "${l}"`,()=>l.split("").map(C=>C.charCodeAt(0))),this._onData.fire(l)}triggerBinaryEvent(l){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${l}"`,()=>l.split("").map(a=>a.charCodeAt(0))),this._onBinary.fire(l))}};r.CoreService=o=g([p(0,u.IBufferService),p(1,u.ILogService),p(2,u.IOptionsService)],o)},348:(S,r,h)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.InstantiationService=r.ServiceCollection=void 0;let g=h(585),p=h(343);class n{constructor(...c){this._entries=new Map;for(let[u,m]of c)this.set(u,m)}set(c,u){let m=this._entries.get(c);return this._entries.set(c,u),m}forEach(c){for(let[u,m]of this._entries.entries())c(u,m)}has(c){return this._entries.has(c)}get(c){return this._entries.get(c)}}r.ServiceCollection=n,r.InstantiationService=class{constructor(){this._services=new n,this._services.set(g.IInstantiationService,this)}setService(f,c){this._services.set(f,c)}getService(f){return this._services.get(f)}createInstance(f,...c){let u=(0,p.getServiceDependencies)(f).sort((o,l)=>o.index-l.index),m=[];for(let o of u){let l=this._services.get(o.id);if(!l)throw new Error(`[createInstance] ${f.name} depends on UNKNOWN service ${o.id}.`);m.push(l)}let i=u.length>0?u[0].index:c.length;if(c.length!==i)throw new Error(`[createInstance] First service dependency of ${f.name} at position ${i+1} conflicts with ${c.length} static arguments`);return new f(...c,...m)}}},866:function(S,r,h){var g=this&&this.__decorate||function(i,o,l,a){var v,C=arguments.length,x=C<3?o:a===null?a=Object.getOwnPropertyDescriptor(o,l):a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(i,o,l,a);else for(var L=i.length-1;L>=0;L--)(v=i[L])&&(x=(C<3?v(x):C>3?v(o,l,x):v(o,l))||x);return C>3&&x&&Object.defineProperty(o,l,x),x},p=this&&this.__param||function(i,o){return function(l,a){o(l,a,i)}};Object.defineProperty(r,"__esModule",{value:!0}),r.traceCall=r.setTraceLogger=r.LogService=void 0;let n=h(844),f=h(585),c={trace:f.LogLevelEnum.TRACE,debug:f.LogLevelEnum.DEBUG,info:f.LogLevelEnum.INFO,warn:f.LogLevelEnum.WARN,error:f.LogLevelEnum.ERROR,off:f.LogLevelEnum.OFF},u,m=r.LogService=class extends n.Disposable{get logLevel(){return this._logLevel}constructor(i){super(),this._optionsService=i,this._logLevel=f.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),u=this}_updateLogLevel(){this._logLevel=c[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(i){for(let o=0;o<i.length;o++)typeof i[o]=="function"&&(i[o]=i[o]())}_log(i,o,l){this._evalLazyOptionalParams(l),i.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+o,...l)}trace(i,...o){this._logLevel<=f.LogLevelEnum.TRACE&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,i,o)}debug(i,...o){this._logLevel<=f.LogLevelEnum.DEBUG&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,i,o)}info(i,...o){this._logLevel<=f.LogLevelEnum.INFO&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,i,o)}warn(i,...o){this._logLevel<=f.LogLevelEnum.WARN&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,i,o)}error(i,...o){this._logLevel<=f.LogLevelEnum.ERROR&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,i,o)}};r.LogService=m=g([p(0,f.IOptionsService)],m),r.setTraceLogger=function(i){u=i},r.traceCall=function(i,o,l){if(typeof l.value!="function")throw new Error("not supported");let a=l.value;l.value=function(...v){if(u.logLevel!==f.LogLevelEnum.TRACE)return a.apply(this,v);u.trace(`GlyphRenderer#${a.name}(${v.map(x=>JSON.stringify(x)).join(", ")})`);let C=a.apply(this,v);return u.trace(`GlyphRenderer#${a.name} return`,C),C}}},302:(S,r,h)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.OptionsService=r.DEFAULT_OPTIONS=void 0;let g=h(460),p=h(844),n=h(114);r.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rescaleOverlappingGlyphs:!1,rightClickSelectsWord:n.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};let f=["normal","bold","100","200","300","400","500","600","700","800","900"];class c extends p.Disposable{constructor(m){super(),this._onOptionChange=this.register(new g.EventEmitter),this.onOptionChange=this._onOptionChange.event;let i={...r.DEFAULT_OPTIONS};for(let o in m)if(o in i)try{let l=m[o];i[o]=this._sanitizeAndValidateOption(o,l)}catch(l){console.error(l)}this.rawOptions=i,this.options={...i},this._setupOptions(),this.register((0,p.toDisposable)(()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null}))}onSpecificOptionChange(m,i){return this.onOptionChange(o=>{o===m&&i(this.rawOptions[m])})}onMultipleOptionChange(m,i){return this.onOptionChange(o=>{m.indexOf(o)!==-1&&i()})}_setupOptions(){let m=o=>{if(!(o in r.DEFAULT_OPTIONS))throw new Error(`No option with key "${o}"`);return this.rawOptions[o]},i=(o,l)=>{if(!(o in r.DEFAULT_OPTIONS))throw new Error(`No option with key "${o}"`);l=this._sanitizeAndValidateOption(o,l),this.rawOptions[o]!==l&&(this.rawOptions[o]=l,this._onOptionChange.fire(o))};for(let o in this.rawOptions){let l={get:m.bind(this,o),set:i.bind(this,o)};Object.defineProperty(this.options,o,l)}}_sanitizeAndValidateOption(m,i){switch(m){case"cursorStyle":if(i||(i=r.DEFAULT_OPTIONS[m]),!function(o){return o==="block"||o==="underline"||o==="bar"}(i))throw new Error(`"${i}" is not a valid value for ${m}`);break;case"wordSeparator":i||(i=r.DEFAULT_OPTIONS[m]);break;case"fontWeight":case"fontWeightBold":if(typeof i=="number"&&1<=i&&i<=1e3)break;i=f.includes(i)?i:r.DEFAULT_OPTIONS[m];break;case"cursorWidth":i=Math.floor(i);case"lineHeight":case"tabStopWidth":if(i<1)throw new Error(`${m} cannot be less than 1, value: ${i}`);break;case"minimumContrastRatio":i=Math.max(1,Math.min(21,Math.round(10*i)/10));break;case"scrollback":if((i=Math.min(i,4294967295))<0)throw new Error(`${m} cannot be less than 0, value: ${i}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(i<=0)throw new Error(`${m} cannot be less than or equal to 0, value: ${i}`);break;case"rows":case"cols":if(!i&&i!==0)throw new Error(`${m} must be numeric, value: ${i}`);break;case"windowsPty":i=i??{}}return i}}r.OptionsService=c},660:function(S,r,h){var g=this&&this.__decorate||function(c,u,m,i){var o,l=arguments.length,a=l<3?u:i===null?i=Object.getOwnPropertyDescriptor(u,m):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(c,u,m,i);else for(var v=c.length-1;v>=0;v--)(o=c[v])&&(a=(l<3?o(a):l>3?o(u,m,a):o(u,m))||a);return l>3&&a&&Object.defineProperty(u,m,a),a},p=this&&this.__param||function(c,u){return function(m,i){u(m,i,c)}};Object.defineProperty(r,"__esModule",{value:!0}),r.OscLinkService=void 0;let n=h(585),f=r.OscLinkService=class{constructor(c){this._bufferService=c,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(c){let u=this._bufferService.buffer;if(c.id===void 0){let v=u.addMarker(u.ybase+u.y),C={data:c,id:this._nextId++,lines:[v]};return v.onDispose(()=>this._removeMarkerFromLink(C,v)),this._dataByLinkId.set(C.id,C),C.id}let m=c,i=this._getEntryIdKey(m),o=this._entriesWithId.get(i);if(o)return this.addLineToLink(o.id,u.ybase+u.y),o.id;let l=u.addMarker(u.ybase+u.y),a={id:this._nextId++,key:this._getEntryIdKey(m),data:m,lines:[l]};return l.onDispose(()=>this._removeMarkerFromLink(a,l)),this._entriesWithId.set(a.key,a),this._dataByLinkId.set(a.id,a),a.id}addLineToLink(c,u){let m=this._dataByLinkId.get(c);if(m&&m.lines.every(i=>i.line!==u)){let i=this._bufferService.buffer.addMarker(u);m.lines.push(i),i.onDispose(()=>this._removeMarkerFromLink(m,i))}}getLinkData(c){return this._dataByLinkId.get(c)?.data}_getEntryIdKey(c){return`${c.id};;${c.uri}`}_removeMarkerFromLink(c,u){let m=c.lines.indexOf(u);m!==-1&&(c.lines.splice(m,1),c.lines.length===0&&(c.data.id!==void 0&&this._entriesWithId.delete(c.key),this._dataByLinkId.delete(c.id)))}};r.OscLinkService=f=g([p(0,n.IBufferService)],f)},343:(S,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.createDecorator=r.getServiceDependencies=r.serviceRegistry=void 0;let h="di$target",g="di$dependencies";r.serviceRegistry=new Map,r.getServiceDependencies=function(p){return p[g]||[]},r.createDecorator=function(p){if(r.serviceRegistry.has(p))return r.serviceRegistry.get(p);let n=function(f,c,u){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(m,i,o){i[h]===i?i[g].push({id:m,index:o}):(i[g]=[{id:m,index:o}],i[h]=i)})(n,f,u)};return n.toString=()=>p,r.serviceRegistry.set(p,n),n}},585:(S,r,h)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.IDecorationService=r.IUnicodeService=r.IOscLinkService=r.IOptionsService=r.ILogService=r.LogLevelEnum=r.IInstantiationService=r.ICharsetService=r.ICoreService=r.ICoreMouseService=r.IBufferService=void 0;let g=h(343);var p;r.IBufferService=(0,g.createDecorator)("BufferService"),r.ICoreMouseService=(0,g.createDecorator)("CoreMouseService"),r.ICoreService=(0,g.createDecorator)("CoreService"),r.ICharsetService=(0,g.createDecorator)("CharsetService"),r.IInstantiationService=(0,g.createDecorator)("InstantiationService"),function(n){n[n.TRACE=0]="TRACE",n[n.DEBUG=1]="DEBUG",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.OFF=5]="OFF"}(p||(r.LogLevelEnum=p={})),r.ILogService=(0,g.createDecorator)("LogService"),r.IOptionsService=(0,g.createDecorator)("OptionsService"),r.IOscLinkService=(0,g.createDecorator)("OscLinkService"),r.IUnicodeService=(0,g.createDecorator)("UnicodeService"),r.IDecorationService=(0,g.createDecorator)("DecorationService")},480:(S,r,h)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.UnicodeService=void 0;let g=h(460),p=h(225);class n{static extractShouldJoin(c){return(1&c)!=0}static extractWidth(c){return c>>1&3}static extractCharKind(c){return c>>3}static createPropertyValue(c,u,m=!1){return(16777215&c)<<3|(3&u)<<1|(m?1:0)}constructor(){this._providers=Object.create(null),this._active="",this._onChange=new g.EventEmitter,this.onChange=this._onChange.event;let c=new p.UnicodeV6;this.register(c),this._active=c.version,this._activeProvider=c}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(c){if(!this._providers[c])throw new Error(`unknown Unicode version "${c}"`);this._active=c,this._activeProvider=this._providers[c],this._onChange.fire(c)}register(c){this._providers[c.version]=c}wcwidth(c){return this._activeProvider.wcwidth(c)}getStringCellWidth(c){let u=0,m=0,i=c.length;for(let o=0;o<i;++o){let l=c.charCodeAt(o);if(55296<=l&&l<=56319){if(++o>=i)return u+this.wcwidth(l);let C=c.charCodeAt(o);56320<=C&&C<=57343?l=1024*(l-55296)+C-56320+65536:u+=this.wcwidth(C)}let a=this.charProperties(l,m),v=n.extractWidth(a);n.extractShouldJoin(a)&&(v-=n.extractWidth(m)),u+=v,m=a}return u}charProperties(c,u){return this._activeProvider.charProperties(c,u)}}r.UnicodeService=n},781:(S,r,h)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Terminal=void 0;let g=h(437),p=h(969),n=h(460);class f extends p.CoreTerminal{constructor(u={}){super(u),this._onBell=this.register(new n.EventEmitter),this.onBell=this._onBell.event,this._onCursorMove=this.register(new n.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onTitleChange=this.register(new n.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onA11yCharEmitter=this.register(new n.EventEmitter),this.onA11yChar=this._onA11yCharEmitter.event,this._onA11yTabEmitter=this.register(new n.EventEmitter),this.onA11yTab=this._onA11yTabEmitter.event,this._setup(),this.register(this._inputHandler.onRequestBell(()=>this.bell())),this.register(this._inputHandler.onRequestReset(()=>this.reset())),this.register((0,n.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,n.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,n.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,n.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter))}get buffer(){return this.buffers.active}get markers(){return this.buffer.markers}addMarker(u){if(this.buffer===this.buffers.normal)return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+u)}bell(){this._onBell.fire()}input(u,m=!0){this.coreService.triggerDataEvent(u,m)}resize(u,m){u===this.cols&&m===this.rows||super.resize(u,m)}clear(){if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let u=1;u<this.rows;u++)this.buffer.lines.push(this.buffer.getBlankLine(g.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0})}}reset(){this.options.rows=this.rows,this.options.cols=this.cols,this._setup(),super.reset()}}r.Terminal=f}},t={};function e(S){var r=t[S];if(r!==void 0)return r.exports;var h=t[S]={exports:{}};return y[S].call(h.exports,h,h.exports,e),h.exports}var s={};(()=>{var S=s;Object.defineProperty(S,"__esModule",{value:!0}),S.Terminal=void 0;let r=e(285),h=e(975),g=e(90),p=e(781),n=e(741),f=e(844),c=["cols","rows"];class u extends f.Disposable{constructor(i){super(),this._core=this.register(new p.Terminal(i)),this._addonManager=this.register(new n.AddonManager),this._publicOptions={...this._core.options};let o=a=>this._core.options[a],l=(a,v)=>{this._checkReadonlyOptions(a),this._core.options[a]=v};for(let a in this._core.options){Object.defineProperty(this._publicOptions,a,{get:()=>this._core.options[a],set:C=>{this._checkReadonlyOptions(a),this._core.options[a]=C}});let v={get:o.bind(this,a),set:l.bind(this,a)};Object.defineProperty(this._publicOptions,a,v)}}_checkReadonlyOptions(i){if(c.includes(i))throw new Error(`Option "${i}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.options.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onLineFeed(){return this._core.onLineFeed}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onTitleChange(){return this._core.onTitleChange}get parser(){return this._checkProposedApi(),this._parser||(this._parser=new h.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new g.UnicodeApi(this._core)}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._checkProposedApi(),this._buffer||(this._buffer=this.register(new r.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){let i=this._core.coreService.decPrivateModes,o="none";switch(this._core.coreMouseService.activeProtocol){case"X10":o="x10";break;case"VT200":o="vt200";break;case"DRAG":o="drag";break;case"ANY":o="any"}return{applicationCursorKeysMode:i.applicationCursorKeys,applicationKeypadMode:i.applicationKeypad,bracketedPasteMode:i.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:o,originMode:i.origin,reverseWraparoundMode:i.reverseWraparound,sendFocusMode:i.sendFocus,wraparoundMode:i.wraparound}}get options(){return this._publicOptions}set options(i){for(let o in i)this._publicOptions[o]=i[o]}input(i,o=!0){this._core.input(i,o)}resize(i,o){this._verifyIntegers(i,o),this._core.resize(i,o)}registerMarker(i=0){return this._checkProposedApi(),this._verifyIntegers(i),this._core.addMarker(i)}addMarker(i){return this.registerMarker(i)}dispose(){super.dispose()}scrollLines(i){this._verifyIntegers(i),this._core.scrollLines(i)}scrollPages(i){this._verifyIntegers(i),this._core.scrollPages(i)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(i){this._verifyIntegers(i),this._core.scrollToLine(i)}clear(){this._core.clear()}write(i,o){this._core.write(i,o)}writeln(i,o){this._core.write(i),this._core.write(`\r
`,o)}reset(){this._core.reset()}loadAddon(i){this._addonManager.loadAddon(this,i)}_verifyIntegers(...i){for(let o of i)if(o===1/0||isNaN(o)||o%1!=0)throw new Error("This API only accepts integers")}}S.Terminal=u})();var d=Jt;for(var b in s)d[b]=s[b];s.__esModule&&Object.defineProperty(d,"__esModule",{value:!0})})()});var Ct=We(()=>{});var G,ot,nt,ii=We(()=>{globalThis.crypto?.subtle&&(G=globalThis.crypto.subtle);ot=class ot{constructor(t){this.keys=new Map;this.cryptoErrorShown=!1;this.storageKey=t||ot.DEFAULT_STORAGE_KEY,this.loadKeysFromStorage()}ensureCryptoAvailable(){if(!G)throw this.cryptoErrorShown||(this.showCryptoError(),this.cryptoErrorShown=!0),new Error("Web Crypto API is not available")}showCryptoError(){if(!document.body){console.error("Web Crypto API not available and DOM not ready to show error");return}let t=window.location.hostname,e=t.match(/^(192\.168\.|10\.|172\.(1[6-9]|2[0-9]|3[0-1])\.)/),s=t!=="localhost"&&t!=="127.0.0.1",d=`SSH key operations are unavailable because the Web Crypto API is not accessible.

`;if(e||s&&window.location.protocol==="http:"?(e&&window.location.protocol==="https:"?d+=`Even though you're using HTTPS, browsers block the Web Crypto API on local network IPs.

`:d+=`This happens when accessing VibeTunnel over HTTP from non-localhost addresses.

`,d+=`To fix this, use one of these methods:
`,d+=`1. Access via http://localhost:4020 instead
`,d+=`   - Use SSH tunnel: ssh -L 4020:localhost:4020 user@server
`,d+=`2. Enable HTTPS on the server (recommended for production)
`,d+=`3. For Chrome: Enable insecure origins at chrome://flags/#unsafely-treat-insecure-origin-as-secure
`,d+=`   - Add your server URL (e.g., http://192.168.1.100:4020)
`,d+=`   - Restart Chrome after changing the flag
`,d+="   - Note: Firefox also enforces these restrictions since v75"):(d+=`Your browser may not support the Web Crypto API or it may be disabled.
`,d+="Please use a modern browser (Chrome 60+, Firefox 75+, Safari 11+)."),!document.querySelector("#crypto-error-style")){let b=document.createElement("style");b.id="crypto-error-style",b.textContent=`
        .crypto-error-banner {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          background: #dc2626;
          color: white;
          padding: 16px;
          z-index: 9999;
          font-family: monospace;
          white-space: pre-wrap;
          box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
      `,document.head.appendChild(b)}if(!document.querySelector(".crypto-error-banner")){let b=document.createElement("div");b.className="crypto-error-banner",b.textContent=d,document.body.appendChild(b)}}isUnlocked(){return!0}async addKey(t,e){if(this.ensureCryptoAvailable(),!G)throw new Error("Crypto not available");try{let s=await this.parsePrivateKey(e),d=this.generateKeyId(),b={id:d,name:t,publicKey:s.publicKey,privateKey:e,algorithm:"Ed25519",encrypted:s.encrypted,fingerprint:s.fingerprint,createdAt:new Date().toISOString()};return this.keys.set(d,b),this.saveKeysToStorage(),d}catch(s){throw new Error(`Failed to add SSH key: ${s}`)}}removeKey(t){this.keys.delete(t),this.saveKeysToStorage()}listKeys(){return Array.from(this.keys.values()).map(t=>({id:t.id,name:t.name,publicKey:t.publicKey,algorithm:t.algorithm,encrypted:t.encrypted,fingerprint:t.fingerprint,createdAt:t.createdAt}))}async sign(t,e){if(this.ensureCryptoAvailable(),!G)throw new Error("Crypto not available");let s=this.keys.get(t);if(!s)throw new Error("SSH key not found");if(!s.privateKey)throw new Error("Private key not available for signing");try{let d=s.privateKey;if(s.encrypted){let h=await this.promptForPassword(s.name);if(!h)throw new Error("Password required for encrypted key");d=await this.decryptPrivateKey(s.privateKey,h)}let b=await this.importPrivateKey(d,s.algorithm),S=this.base64ToArrayBuffer(e),r=await G.sign({name:"Ed25519"},b,S);return{signature:this.arrayBufferToBase64(r),algorithm:s.algorithm}}catch(d){throw new Error(`Failed to sign data: ${d}`)}}async generateKeyPair(t,e){if(this.ensureCryptoAvailable(),!G)throw new Error("Crypto not available");console.log(`\u{1F511} SSH Agent: Starting Ed25519 key generation for "${t}"`);try{let d=await G.generateKey({name:"Ed25519"},!0,["sign","verify"]),b=await G.exportKey("pkcs8",d.privateKey),S=await G.exportKey("raw",d.publicKey),r=this.arrayBufferToPEM(b,"PRIVATE KEY"),h=this.convertEd25519ToSSHPublicKey(S),g=!!e;e&&(r=await this.encryptPrivateKey(r,e));let p=this.generateKeyId(),n={id:p,name:t,publicKey:h,privateKey:r,algorithm:"Ed25519",encrypted:g,fingerprint:await this.generateFingerprint(h),createdAt:new Date().toISOString()};return this.keys.set(p,n),await this.saveKeysToStorage(),console.log(`\u{1F511} SSH Agent: Key "${t}" generated successfully with ID: ${p}`),{keyId:p,privateKeyPEM:r}}catch(s){throw new Error(`Failed to generate key pair: ${s}`)}}getPublicKey(t){let e=this.keys.get(t);return e?e.publicKey:null}getPrivateKey(t){let e=this.keys.get(t);return e?e.privateKey:null}async parsePrivateKey(t){let e=t.includes("BEGIN ENCRYPTED PRIVATE KEY")||t.includes("Proc-Type: 4,ENCRYPTED");if(t.includes("BEGIN PRIVATE KEY")||t.includes("BEGIN ENCRYPTED PRIVATE KEY")){let s="ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIImported...";return{publicKey:s,algorithm:"Ed25519",fingerprint:await this.generateFingerprint(s),encrypted:e}}throw new Error("Only Ed25519 private keys are supported")}async importPrivateKey(t,e){if(!G)throw new Error("Crypto not available");let s=t.replace("-----BEGIN PRIVATE KEY-----","").replace("-----END PRIVATE KEY-----","").replace(/\s/g,""),d=this.base64ToArrayBuffer(s);return G.importKey("pkcs8",d,{name:"Ed25519"},!1,["sign"])}convertEd25519ToSSHPublicKey(t){let e=new Uint8Array(t),d=new TextEncoder().encode("ssh-ed25519"),b=new ArrayBuffer(4+d.length+4+e.length),S=new DataView(b),r=new Uint8Array(b),h=0;return S.setUint32(h,d.length,!1),h+=4,r.set(d,h),h+=d.length,S.setUint32(h,e.length,!1),h+=4,r.set(e,h),`ssh-ed25519 ${this.arrayBufferToBase64(b)}`}async generateFingerprint(t){if(!G)throw new Error("Crypto not available");let e=new TextEncoder,s=await G.digest("SHA-256",e.encode(t));return this.arrayBufferToBase64(s).substring(0,16)}generateKeyId(){return window.crypto.randomUUID()}arrayBufferToBase64(t){let e=new Uint8Array(t),s="";for(let d=0;d<e.length;d++)s+=String.fromCharCode(e[d]);return btoa(s)}base64ToArrayBuffer(t){let e=atob(t),s=new Uint8Array(e.length);for(let d=0;d<e.length;d++)s[d]=e.charCodeAt(d);return s.buffer}arrayBufferToPEM(t,e){let d=this.arrayBufferToBase64(t).match(/.{1,64}/g)||[];return`-----BEGIN ${e}-----
${d.join(`
`)}
-----END ${e}-----`}async loadKeysFromStorage(){try{let t=localStorage.getItem(this.storageKey);if(t){let e=JSON.parse(t);this.keys.clear(),e.forEach(s=>this.keys.set(s.id,s))}}catch(t){console.error("Failed to load SSH keys from storage:",t)}}async saveKeysToStorage(){try{let t=Array.from(this.keys.values());localStorage.setItem(this.storageKey,JSON.stringify(t))}catch(t){console.error("Failed to save SSH keys to storage:",t)}}async encryptPrivateKey(t,e){if(!G)throw new Error("Crypto not available");let s=new TextEncoder,d=s.encode(t),b=await G.importKey("raw",s.encode(e),{name:"PBKDF2"},!1,["deriveKey"]),S=crypto.getRandomValues(new Uint8Array(16)),r=await G.deriveKey({name:"PBKDF2",salt:S,iterations:1e5,hash:"SHA-256"},b,{name:"AES-GCM",length:256},!1,["encrypt"]),h=crypto.getRandomValues(new Uint8Array(12)),g=await G.encrypt({name:"AES-GCM",iv:h},r,d),p=new Uint8Array(S.length+h.length+g.byteLength);return p.set(S,0),p.set(h,S.length),p.set(new Uint8Array(g),S.length+h.length),`-----BEGIN ENCRYPTED PRIVATE KEY-----
${this.arrayBufferToBase64(p.buffer)}
-----END ENCRYPTED PRIVATE KEY-----`}async decryptPrivateKey(t,e){if(!G)throw new Error("Crypto not available");let s=t.replace("-----BEGIN ENCRYPTED PRIVATE KEY-----","").replace("-----END ENCRYPTED PRIVATE KEY-----","").replace(/\s/g,""),d=this.base64ToArrayBuffer(s),b=new Uint8Array(d),S=b.slice(0,16),r=b.slice(16,28),h=b.slice(28),g=new TextEncoder,p=await G.importKey("raw",g.encode(e),{name:"PBKDF2"},!1,["deriveKey"]),n=await G.deriveKey({name:"PBKDF2",salt:S,iterations:1e5,hash:"SHA-256"},p,{name:"AES-GCM",length:256},!1,["decrypt"]),f=await G.decrypt({name:"AES-GCM",iv:r},n,h);return new TextDecoder().decode(f)}async promptForPassword(t){return window.prompt(`Enter password for SSH key "${t}":`)}};ot.DEFAULT_STORAGE_KEY="vibetunnel_ssh_keys";nt=ot});var ri={};vi(ri,{AuthClient:()=>at,authClient:()=>Ui});var Z,oe,at,Ui,si=We(()=>{Ct();Ee();ii();Z=ae("auth-client"),oe=class oe{constructor(){this.currentUser=null;this.sshAgent=new nt,this.loadCurrentUser()}getSSHAgent(){return this.sshAgent}isAuthenticated(){return this.currentUser!==null&&this.isTokenValid()}getCurrentUser(){return this.currentUser}async getCurrentSystemUser(){try{let t=await fetch("/api/auth/current-user");if(t.ok)return(await t.json()).userId;throw new Error("Failed to get current user")}catch(t){throw Z.error("Failed to get current system user:",t),t}}async getUserAvatar(t){try{let r=await fetch(`/api/auth/avatar/${t}`);if(r.ok){let h=await r.json();if(h.avatar&&h.avatar.startsWith("data:"))return h.avatar}}catch(r){Z.error("Failed to get user avatar:",r)}let e=getComputedStyle(document.documentElement),s=e.getPropertyValue("--color-text-dim").trim().split(" ").map(r=>Number.parseInt(r)),d=e.getPropertyValue("--color-text-muted").trim().split(" ").map(r=>Number.parseInt(r)),b=`rgb(${s.join(", ")})`,S=`rgb(${d.join(", ")})`;return"data:image/svg+xml;base64,"+btoa(`
      <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="24" cy="24" r="24" fill="${b}"/>
        <circle cx="24" cy="18" r="8" fill="${S}"/>
        <path d="M8 38c0-8.837 7.163-16 16-16s16 7.163 16 16" fill="${S}"/>
      </svg>
    `)}async authenticateWithSSHKey(t,e){try{if(!this.sshAgent.isUnlocked())return{success:!1,error:"SSH agent is locked"};let s=await this.createChallenge(t),d=await this.sshAgent.sign(e,s.challenge),b=this.sshAgent.getPublicKey(e);if(!b)return{success:!1,error:"SSH key not found"};let r=await(await fetch("/api/auth/ssh-key",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challengeId:s.challengeId,publicKey:b,signature:d.signature})})).json();return Z.log("\u{1F510} SSH key auth server response:",r),r.success?(Z.log("\u2705 SSH key auth successful, setting current user"),this.setCurrentUser({userId:r.userId,token:r.token,authMethod:"ssh-key",loginTime:Date.now()}),Z.log("\u{1F464} Current user set:",this.getCurrentUser())):Z.log("\u274C SSH key auth failed:",r.error),r}catch(s){return Z.error("SSH key authentication failed:",s),{success:!1,error:"SSH key authentication failed"}}}async authenticateWithPassword(t,e){try{let d=await(await fetch("/api/auth/password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t,password:e})})).json();return d.success&&this.setCurrentUser({userId:d.userId,token:d.token,authMethod:"password",loginTime:Date.now()}),d}catch(s){return Z.error("Password authentication failed:",s),{success:!1,error:"Password authentication failed"}}}async authenticate(t){if(Z.log("\u{1F680} Starting SSH authentication for user:",t),this.sshAgent.isUnlocked()){let e=this.sshAgent.listKeys();Z.log("\u{1F5DD}\uFE0F Found SSH keys:",e.length,e.map(s=>({id:s.id,name:s.name})));for(let s of e)try{Z.log(`\u{1F511} Trying SSH key: ${s.name} (${s.id})`);let d=await this.authenticateWithSSHKey(t,s.id);if(Z.log(`\u{1F3AF} SSH key ${s.name} result:`,d),d.success)return Z.log(`\u2705 Authenticated with SSH key: ${s.name}`),d}catch(d){Z.warn(`\u274C SSH key authentication failed for key ${s.name}:`,d)}}else Z.log("\u{1F512} SSH agent is locked");return{success:!1,error:"SSH key authentication failed. Password authentication required."}}async logout(){try{this.currentUser?.token&&await fetch("/api/auth/logout",{method:"POST",headers:{Authorization:`Bearer ${this.currentUser.token}`,"Content-Type":"application/json"}})}catch(t){Z.warn("Server logout failed:",t)}finally{this.clearCurrentUser()}}getAuthHeader(){return this.currentUser?.token?{Authorization:`Bearer ${this.currentUser.token}`}:{}}async fetch(t,e){let s={...this.getAuthHeader(),...e?.headers||{}};return fetch(t,{...e,headers:s})}async verifyToken(){if(!this.currentUser?.token)return!1;try{return(await(await fetch("/api/auth/verify",{headers:{Authorization:`Bearer ${this.currentUser.token}`}})).json()).valid}catch(t){return Z.error("Token verification failed:",t),!1}}async unlockSSHAgent(t){return!0}lockSSHAgent(){}isSSHAgentUnlocked(){return!0}async createChallenge(t){let e=await fetch("/api/auth/challenge",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t})});if(!e.ok)throw new Error("Failed to create authentication challenge");return e.json()}setCurrentUser(t){this.currentUser=t,this.saveCurrentUser()}clearCurrentUser(){this.currentUser=null,localStorage.removeItem(oe.TOKEN_KEY),localStorage.removeItem(oe.USER_KEY)}saveCurrentUser(){this.currentUser&&(localStorage.setItem(oe.TOKEN_KEY,this.currentUser.token),localStorage.setItem(oe.USER_KEY,JSON.stringify({userId:this.currentUser.userId,authMethod:this.currentUser.authMethod,loginTime:this.currentUser.loginTime})))}loadCurrentUser(){try{let t=localStorage.getItem(oe.TOKEN_KEY),e=localStorage.getItem(oe.USER_KEY);if(t&&e){let s=JSON.parse(e);this.currentUser={token:t,userId:s.userId,authMethod:s.authMethod,loginTime:s.loginTime},this.verifyToken().then(d=>{d||this.clearCurrentUser()})}}catch(t){Z.error("Failed to load current user:",t),this.clearCurrentUser()}}isTokenValid(){if(!this.currentUser)return!1;let t=Date.now()-this.currentUser.loginTime,e=1440*60*1e3;return t<e}};oe.TOKEN_KEY="vibetunnel_auth_token",oe.USER_KEY="vibetunnel_user_data";at=oe,Ui=new at});async function Wi(){let y=Date.now();if(He&&y-He.timestamp<Fi)return He.noAuth;try{let t=await fetch("/api/auth/config");if(t.ok)return He={noAuth:(await t.json()).noAuth===!0,timestamp:y},He.noAuth}catch{}return!1}function zi(y){return y.map(t=>{if(typeof t=="object"&&t!==null)try{return JSON.stringify(t,null,2)}catch{return String(t)}return t})}async function qi(y,t,e){try{let{authClient:s}=await Promise.resolve().then(()=>(si(),ri)),d=s.getAuthHeader(),b=await Wi();if(!d.Authorization&&!b)return;let S={"Content-Type":"application/json"};d.Authorization&&(S.Authorization=d.Authorization),await fetch("/api/logs/client",{method:"POST",headers:S,body:JSON.stringify({level:y,module:t,args:zi(e)})})}catch{}}function ae(y){let t=e=>(...s)=>{e==="debug"&&!Ni||(console[e](`[${y}]`,...s),qi(e,y,s))};return{log:t("log"),warn:t("warn"),error:t("error"),debug:t("debug")}}var Ni,He,Fi,Ee=We(()=>{Ct();Ni=!1,He=null,Fi=6e4});var ze=globalThis,Ke=ze.ShadowRoot&&(ze.ShadyCSS===void 0||ze.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Mt=Symbol(),Rt=new WeakMap,qe=class{constructor(t,e,s){if(this._$cssResult$=!0,s!==Mt)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o,e=this.t;if(Ke&&t===void 0){let s=e!==void 0&&e.length===1;s&&(t=Rt.get(e)),t===void 0&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),s&&Rt.set(e,t))}return t}toString(){return this.cssText}},Pt=y=>new qe(typeof y=="string"?y:y+"",void 0,Mt);var Dt=(y,t)=>{if(Ke)y.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(let e of t){let s=document.createElement("style"),d=ze.litNonce;d!==void 0&&s.setAttribute("nonce",d),s.textContent=e.cssText,y.appendChild(s)}},dt=Ke?y=>y:y=>y instanceof CSSStyleSheet?(t=>{let e="";for(let s of t.cssRules)e+=s.cssText;return Pt(e)})(y):y;var{is:Si,defineProperty:Ci,getOwnPropertyDescriptor:wi,getOwnPropertyNames:Ei,getOwnPropertySymbols:Ai,getPrototypeOf:Ti}=Object,ce=globalThis,It=ce.trustedTypes,xi=It?It.emptyScript:"",ki=ce.reactiveElementPolyfillSupport,ke=(y,t)=>y,Le={toAttribute(y,t){switch(t){case Boolean:y=y?xi:null;break;case Object:case Array:y=y==null?y:JSON.stringify(y)}return y},fromAttribute(y,t){let e=y;switch(t){case Boolean:e=y!==null;break;case Number:e=y===null?null:Number(y);break;case Object:case Array:try{e=JSON.parse(y)}catch{e=null}}return e}},je=(y,t)=>!Si(y,t),Ot={attribute:!0,type:String,converter:Le,reflect:!1,useDefault:!1,hasChanged:je};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),ce.litPropertyMetadata??(ce.litPropertyMetadata=new WeakMap);var le=class extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??(this.l=[])).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,e=Ot){if(e.state&&(e.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(t)&&((e=Object.create(e)).wrapped=!0),this.elementProperties.set(t,e),!e.noAccessor){let s=Symbol(),d=this.getPropertyDescriptor(t,s,e);d!==void 0&&Ci(this.prototype,t,d)}}static getPropertyDescriptor(t,e,s){let{get:d,set:b}=wi(this.prototype,t)??{get(){return this[e]},set(S){this[e]=S}};return{get:d,set(S){let r=d?.call(this);b?.call(this,S),this.requestUpdate(t,r,s)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??Ot}static _$Ei(){if(this.hasOwnProperty(ke("elementProperties")))return;let t=Ti(this);t.finalize(),t.l!==void 0&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(ke("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(ke("properties"))){let e=this.properties,s=[...Ei(e),...Ai(e)];for(let d of s)this.createProperty(d,e[d])}let t=this[Symbol.metadata];if(t!==null){let e=litPropertyMetadata.get(t);if(e!==void 0)for(let[s,d]of e)this.elementProperties.set(s,d)}this._$Eh=new Map;for(let[e,s]of this.elementProperties){let d=this._$Eu(e,s);d!==void 0&&this._$Eh.set(d,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){let e=[];if(Array.isArray(t)){let s=new Set(t.flat(1/0).reverse());for(let d of s)e.unshift(dt(d))}else t!==void 0&&e.push(dt(t));return e}static _$Eu(t,e){let s=e.attribute;return s===!1?void 0:typeof s=="string"?s:typeof t=="string"?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(t=>t(this))}addController(t){(this._$EO??(this._$EO=new Set)).add(t),this.renderRoot!==void 0&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$EO?.delete(t)}_$E_(){let t=new Map,e=this.constructor.elementProperties;for(let s of e.keys())this.hasOwnProperty(s)&&(t.set(s,this[s]),delete this[s]);t.size>0&&(this._$Ep=t)}createRenderRoot(){let t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return Dt(t,this.constructor.elementStyles),t}connectedCallback(){this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),this._$EO?.forEach(t=>t.hostConnected?.())}enableUpdating(t){}disconnectedCallback(){this._$EO?.forEach(t=>t.hostDisconnected?.())}attributeChangedCallback(t,e,s){this._$AK(t,s)}_$ET(t,e){let s=this.constructor.elementProperties.get(t),d=this.constructor._$Eu(t,s);if(d!==void 0&&s.reflect===!0){let b=(s.converter?.toAttribute!==void 0?s.converter:Le).toAttribute(e,s.type);this._$Em=t,b==null?this.removeAttribute(d):this.setAttribute(d,b),this._$Em=null}}_$AK(t,e){let s=this.constructor,d=s._$Eh.get(t);if(d!==void 0&&this._$Em!==d){let b=s.getPropertyOptions(d),S=typeof b.converter=="function"?{fromAttribute:b.converter}:b.converter?.fromAttribute!==void 0?b.converter:Le;this._$Em=d;let r=S.fromAttribute(e,b.type);this[d]=r??this._$Ej?.get(d)??r,this._$Em=null}}requestUpdate(t,e,s){if(t!==void 0){let d=this.constructor,b=this[t];if(s??(s=d.getPropertyOptions(t)),!((s.hasChanged??je)(b,e)||s.useDefault&&s.reflect&&b===this._$Ej?.get(t)&&!this.hasAttribute(d._$Eu(t,s))))return;this.C(t,e,s)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(t,e,{useDefault:s,reflect:d,wrapped:b},S){s&&!(this._$Ej??(this._$Ej=new Map)).has(t)&&(this._$Ej.set(t,S??e??this[t]),b!==!0||S!==void 0)||(this._$AL.has(t)||(this.hasUpdated||s||(e=void 0),this._$AL.set(t,e)),d===!0&&this._$Em!==t&&(this._$Eq??(this._$Eq=new Set)).add(t))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}let t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(let[d,b]of this._$Ep)this[d]=b;this._$Ep=void 0}let s=this.constructor.elementProperties;if(s.size>0)for(let[d,b]of s){let{wrapped:S}=b,r=this[d];S!==!0||this._$AL.has(d)||r===void 0||this.C(d,void 0,b,r)}}let t=!1,e=this._$AL;try{t=this.shouldUpdate(e),t?(this.willUpdate(e),this._$EO?.forEach(s=>s.hostUpdate?.()),this.update(e)):this._$EM()}catch(s){throw t=!1,this._$EM(),s}t&&this._$AE(e)}willUpdate(t){}_$AE(t){this._$EO?.forEach(e=>e.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Eq&&(this._$Eq=this._$Eq.forEach(e=>this._$ET(e,this[e]))),this._$EM()}updated(t){}firstUpdated(t){}};le.elementStyles=[],le.shadowRootOptions={mode:"open"},le[ke("elementProperties")]=new Map,le[ke("finalized")]=new Map,ki?.({ReactiveElement:le}),(ce.reactiveElementVersions??(ce.reactiveElementVersions=[])).push("2.1.1");var Re=globalThis,Ve=Re.trustedTypes,Ht=Ve?Ve.createPolicy("lit-html",{createHTML:y=>y}):void 0,ft="$lit$",he=`lit$${Math.random().toFixed(9).slice(2)}$`,pt="?"+he,Li=`<${pt}>`,_e=document,Me=()=>_e.createComment(""),Pe=y=>y===null||typeof y!="object"&&typeof y!="function",gt=Array.isArray,zt=y=>gt(y)||typeof y?.[Symbol.iterator]=="function",ut=`[ 	
\f\r]`,Be=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,$t=/-->/g,Ut=/>/g,pe=RegExp(`>|${ut}(?:([^\\s"'>=/]+)(${ut}*=${ut}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Nt=/'/g,Ft=/"/g,qt=/^(?:script|style|textarea|title)$/i,_t=y=>(t,...e)=>({_$litType$:y,strings:t,values:e}),te=_t(1),sr=_t(2),nr=_t(3),me=Symbol.for("lit-noChange"),Y=Symbol.for("lit-nothing"),Wt=new WeakMap,ge=_e.createTreeWalker(_e,129);function Kt(y,t){if(!gt(y)||!y.hasOwnProperty("raw"))throw Error("invalid template strings array");return Ht!==void 0?Ht.createHTML(t):t}var jt=(y,t)=>{let e=y.length-1,s=[],d,b=t===2?"<svg>":t===3?"<math>":"",S=Be;for(let r=0;r<e;r++){let h=y[r],g,p,n=-1,f=0;for(;f<h.length&&(S.lastIndex=f,p=S.exec(h),p!==null);)f=S.lastIndex,S===Be?p[1]==="!--"?S=$t:p[1]!==void 0?S=Ut:p[2]!==void 0?(qt.test(p[2])&&(d=RegExp("</"+p[2],"g")),S=pe):p[3]!==void 0&&(S=pe):S===pe?p[0]===">"?(S=d??Be,n=-1):p[1]===void 0?n=-2:(n=S.lastIndex-p[2].length,g=p[1],S=p[3]===void 0?pe:p[3]==='"'?Ft:Nt):S===Ft||S===Nt?S=pe:S===$t||S===Ut?S=Be:(S=pe,d=void 0);let c=S===pe&&y[r+1].startsWith("/>")?" ":"";b+=S===Be?h+Li:n>=0?(s.push(g),h.slice(0,n)+ft+h.slice(n)+he+c):h+he+(n===-2?r:c)}return[Kt(y,b+(y[e]||"<?>")+(t===2?"</svg>":t===3?"</math>":"")),s]},De=class y{constructor({strings:t,_$litType$:e},s){let d;this.parts=[];let b=0,S=0,r=t.length-1,h=this.parts,[g,p]=jt(t,e);if(this.el=y.createElement(g,s),ge.currentNode=this.el.content,e===2||e===3){let n=this.el.content.firstChild;n.replaceWith(...n.childNodes)}for(;(d=ge.nextNode())!==null&&h.length<r;){if(d.nodeType===1){if(d.hasAttributes())for(let n of d.getAttributeNames())if(n.endsWith(ft)){let f=p[S++],c=d.getAttribute(n).split(he),u=/([.?@])?(.*)/.exec(f);h.push({type:1,index:b,name:u[2],strings:c,ctor:u[1]==="."?Ge:u[1]==="?"?Xe:u[1]==="@"?Ze:be}),d.removeAttribute(n)}else n.startsWith(he)&&(h.push({type:6,index:b}),d.removeAttribute(n));if(qt.test(d.tagName)){let n=d.textContent.split(he),f=n.length-1;if(f>0){d.textContent=Ve?Ve.emptyScript:"";for(let c=0;c<f;c++)d.append(n[c],Me()),ge.nextNode(),h.push({type:2,index:++b});d.append(n[f],Me())}}}else if(d.nodeType===8)if(d.data===pt)h.push({type:2,index:b});else{let n=-1;for(;(n=d.data.indexOf(he,n+1))!==-1;)h.push({type:7,index:b}),n+=he.length-1}b++}}static createElement(t,e){let s=_e.createElement("template");return s.innerHTML=t,s}};function ve(y,t,e=y,s){if(t===me)return t;let d=s!==void 0?e._$Co?.[s]:e._$Cl,b=Pe(t)?void 0:t._$litDirective$;return d?.constructor!==b&&(d?._$AO?.(!1),b===void 0?d=void 0:(d=new b(y),d._$AT(y,e,s)),s!==void 0?(e._$Co??(e._$Co=[]))[s]=d:e._$Cl=d),d!==void 0&&(t=ve(y,d._$AS(y,t.values),d,s)),t}var Ye=class{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){let{el:{content:e},parts:s}=this._$AD,d=(t?.creationScope??_e).importNode(e,!0);ge.currentNode=d;let b=ge.nextNode(),S=0,r=0,h=s[0];for(;h!==void 0;){if(S===h.index){let g;h.type===2?g=new we(b,b.nextSibling,this,t):h.type===1?g=new h.ctor(b,h.name,h.strings,this,t):h.type===6&&(g=new Je(b,this,t)),this._$AV.push(g),h=s[++r]}S!==h?.index&&(b=ge.nextNode(),S++)}return ge.currentNode=_e,d}p(t){let e=0;for(let s of this._$AV)s!==void 0&&(s.strings!==void 0?(s._$AI(t,s,e),e+=s.strings.length-2):s._$AI(t[e])),e++}},we=class y{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,e,s,d){this.type=2,this._$AH=Y,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=s,this.options=d,this._$Cv=d?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode,e=this._$AM;return e!==void 0&&t?.nodeType===11&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=ve(this,t,e),Pe(t)?t===Y||t==null||t===""?(this._$AH!==Y&&this._$AR(),this._$AH=Y):t!==this._$AH&&t!==me&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):zt(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==Y&&Pe(this._$AH)?this._$AA.nextSibling.data=t:this.T(_e.createTextNode(t)),this._$AH=t}$(t){let{values:e,_$litType$:s}=t,d=typeof s=="number"?this._$AC(t):(s.el===void 0&&(s.el=De.createElement(Kt(s.h,s.h[0]),this.options)),s);if(this._$AH?._$AD===d)this._$AH.p(e);else{let b=new Ye(d,this),S=b.u(this.options);b.p(e),this.T(S),this._$AH=b}}_$AC(t){let e=Wt.get(t.strings);return e===void 0&&Wt.set(t.strings,e=new De(t)),e}k(t){gt(this._$AH)||(this._$AH=[],this._$AR());let e=this._$AH,s,d=0;for(let b of t)d===e.length?e.push(s=new y(this.O(Me()),this.O(Me()),this,this.options)):s=e[d],s._$AI(b),d++;d<e.length&&(this._$AR(s&&s._$AB.nextSibling,d),e.length=d)}_$AR(t=this._$AA.nextSibling,e){for(this._$AP?.(!1,!0,e);t!==this._$AB;){let s=t.nextSibling;t.remove(),t=s}}setConnected(t){this._$AM===void 0&&(this._$Cv=t,this._$AP?.(t))}},be=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,s,d,b){this.type=1,this._$AH=Y,this._$AN=void 0,this.element=t,this.name=e,this._$AM=d,this.options=b,s.length>2||s[0]!==""||s[1]!==""?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=Y}_$AI(t,e=this,s,d){let b=this.strings,S=!1;if(b===void 0)t=ve(this,t,e,0),S=!Pe(t)||t!==this._$AH&&t!==me,S&&(this._$AH=t);else{let r=t,h,g;for(t=b[0],h=0;h<b.length-1;h++)g=ve(this,r[s+h],e,h),g===me&&(g=this._$AH[h]),S||(S=!Pe(g)||g!==this._$AH[h]),g===Y?t=Y:t!==Y&&(t+=(g??"")+b[h+1]),this._$AH[h]=g}S&&!d&&this.j(t)}j(t){t===Y?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}},Ge=class extends be{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===Y?void 0:t}},Xe=class extends be{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==Y)}},Ze=class extends be{constructor(t,e,s,d,b){super(t,e,s,d,b),this.type=5}_$AI(t,e=this){if((t=ve(this,t,e,0)??Y)===me)return;let s=this._$AH,d=t===Y&&s!==Y||t.capture!==s.capture||t.once!==s.once||t.passive!==s.passive,b=t!==Y&&(s===Y||d);d&&this.element.removeEventListener(this.name,this,s),b&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t)}},Je=class{constructor(t,e,s){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(t){ve(this,t)}},Vt={M:ft,P:he,A:pt,C:1,L:jt,R:Ye,D:zt,V:ve,I:we,H:be,N:Xe,U:Ze,B:Ge,F:Je},Bi=Re.litHtmlPolyfillSupport;Bi?.(De,we),(Re.litHtmlVersions??(Re.litHtmlVersions=[])).push("3.3.1");var Yt=(y,t,e)=>{let s=e?.renderBefore??t,d=s._$litPart$;if(d===void 0){let b=e?.renderBefore??null;s._$litPart$=d=new we(t.insertBefore(Me(),b),b,void 0,e??{})}return d._$AI(y),d};var Ie=globalThis,ee=class extends le{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var e;let t=super.createRenderRoot();return(e=this.renderOptions).renderBefore??(e.renderBefore=t.firstChild),t}update(t){let e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=Yt(e,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return me}};ee._$litElement$=!0,ee.finalized=!0,Ie.litElementHydrateSupport?.({LitElement:ee});var Ri=Ie.litElementPolyfillSupport;Ri?.({LitElement:ee});(Ie.litElementVersions??(Ie.litElementVersions=[])).push("4.2.1");var de=y=>(t,e)=>{e!==void 0?e.addInitializer(()=>{customElements.define(y,t)}):customElements.define(y,t)};var Mi={attribute:!0,type:String,converter:Le,reflect:!1,hasChanged:je},Pi=(y=Mi,t,e)=>{let{kind:s,metadata:d}=e,b=globalThis.litPropertyMetadata.get(d);if(b===void 0&&globalThis.litPropertyMetadata.set(d,b=new Map),s==="setter"&&((y=Object.create(y)).wrapped=!0),b.set(e.name,y),s==="accessor"){let{name:S}=e;return{set(r){let h=t.get.call(this);t.set.call(this,r),this.requestUpdate(S,h,y)},init(r){return r!==void 0&&this.C(S,void 0,y,r),r}}}if(s==="setter"){let{name:S}=e;return function(r){let h=this[S];t.call(this,r),this.requestUpdate(S,h,y)}}throw Error("Unsupported decorator location: "+s)};function q(y){return(t,e)=>typeof e=="object"?Pi(y,t,e):((s,d,b)=>{let S=d.hasOwnProperty(b);return d.constructor.createProperty(b,s),S?Object.getOwnPropertyDescriptor(d,b):void 0})(y,t,e)}function V(y){return q({...y,state:!0,attribute:!1})}var{I:jr}=Vt;var Gt=y=>y.strings===void 0;var Xt={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},mt=y=>(...t)=>({_$litDirective$:y,values:t}),et=class{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,e,s){this._$Ct=t,this._$AM=e,this._$Ci=s}_$AS(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}};var Oe=(y,t)=>{let e=y._$AN;if(e===void 0)return!1;for(let s of e)s._$AO?.(t,!1),Oe(s,t);return!0},tt=y=>{let t,e;do{if((t=y._$AM)===void 0)break;e=t._$AN,e.delete(y),y=t}while(e?.size===0)},Zt=y=>{for(let t;t=y._$AM;y=t){let e=t._$AN;if(e===void 0)t._$AN=e=new Set;else if(e.has(y))break;e.add(y),Oi(t)}};function Di(y){this._$AN!==void 0?(tt(this),this._$AM=y,Zt(this)):this._$AM=y}function Ii(y,t=!1,e=0){let s=this._$AH,d=this._$AN;if(d!==void 0&&d.size!==0)if(t)if(Array.isArray(s))for(let b=e;b<s.length;b++)Oe(s[b],!1),tt(s[b]);else s!=null&&(Oe(s,!1),tt(s));else Oe(this,y)}var Oi=y=>{y.type==Xt.CHILD&&(y._$AP??(y._$AP=Ii),y._$AQ??(y._$AQ=Di))},it=class extends et{constructor(){super(...arguments),this._$AN=void 0}_$AT(t,e,s){super._$AT(t,e,s),Zt(this),this.isConnected=t._$AU}_$AO(t,e=!0){t!==this.isConnected&&(this.isConnected=t,t?this.reconnected?.():this.disconnected?.()),e&&(Oe(this,t),tt(this))}setValue(t){if(Gt(this._$Ct))this._$Ct._$AI(t,this);else{let e=[...this._$Ct._$AH];e[this._$Ci]=t,this._$Ct._$AI(e,this,0)}}disconnected(){}reconnected(){}};var rt=()=>new bt,bt=class{},vt=new WeakMap,st=mt(class extends it{render(y){return Y}update(y,[t]){let e=t!==this.G;return e&&this.G!==void 0&&this.rt(void 0),(e||this.lt!==this.ct)&&(this.G=t,this.ht=y.options?.host,this.rt(this.ct=y.element)),Y}rt(y){if(this.isConnected||(y=void 0),typeof this.G=="function"){let t=this.ht??globalThis,e=vt.get(t);e===void 0&&(e=new WeakMap,vt.set(t,e)),e.get(this.G)!==void 0&&this.G.call(this.ht,void 0),e.set(this.G,y),y!==void 0&&this.G.call(this.ht,y)}else this.G.value=y}get lt(){return typeof this.G=="function"?vt.get(this.ht??globalThis)?.get(this.G):this.G?.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}});var ci=yi(Qt());var ei="terminal-shortcut",Hi=[{pattern:/\bctrl\+([a-z])\b/gi,keySequence:y=>`ctrl_${y[1].toLowerCase()}`},{pattern:/\bctrl\+([0-9])\b/gi,keySequence:y=>`ctrl_${y[1]}`},{pattern:/\bctrl\+f([1-9]|1[0-2])\b/gi,keySequence:y=>`ctrl_f${y[1]}`},{pattern:/\bctrl\+shift\+([a-z])\b/gi,keySequence:y=>`ctrl_shift_${y[1].toLowerCase()}`},{pattern:/\balt\+([a-z])\b/gi,keySequence:y=>`alt_${y[1].toLowerCase()}`},{pattern:/\bcmd\+([a-z])\b/gi,keySequence:y=>`cmd_${y[1].toLowerCase()}`},{pattern:/\bf([1-9]|1[0-2])\b/gi,keySequence:y=>`f${y[1]}`},{pattern:/\besc\b/gi,keySequence:()=>"escape"},{pattern:/\bescape\b/gi,keySequence:()=>"escape"},{pattern:/\btab\b/gi,keySequence:()=>"tab"},{pattern:/\bshift\+tab\b/gi,keySequence:()=>"shift_tab"},{pattern:/\benter\b/gi,keySequence:()=>"enter"},{pattern:/\breturn\b/gi,keySequence:()=>"enter"},{pattern:/\bbackspace\b/gi,keySequence:()=>"backspace"},{pattern:/\bdelete\b/gi,keySequence:()=>"delete"},{pattern:/\bspace\b/gi,keySequence:()=>" "},{pattern:/\barrow\s+(up|down|left|right)\b/gi,keySequence:y=>`arrow_${y[1].toLowerCase()}`},{pattern:/\b(up|down|left|right)\s+arrow\b/gi,keySequence:y=>`arrow_${y[1].toLowerCase()}`},{pattern:/\bpage\s+(up|down)\b/gi,keySequence:y=>`page_${y[1].toLowerCase()}`},{pattern:/\b(home|end)\b/gi,keySequence:y=>y[1].toLowerCase()},{pattern:/\besc\s+to\s+(interrupt|quit|exit|cancel)\b/gi,keySequence:()=>"escape"},{pattern:/\bpress\s+esc\b/gi,keySequence:()=>"escape"},{pattern:/\bpress\s+enter\b/gi,keySequence:()=>"enter"},{pattern:/\bpress\s+tab\b/gi,keySequence:()=>"tab"},{pattern:/\bpress\s+ctrl\+([a-z])\b/gi,keySequence:y=>`ctrl_${y[1].toLowerCase()}`},{pattern:/\bctrl\+([a-z])\s+to\s+\w+/gi,keySequence:y=>`ctrl_${y[1].toLowerCase()}`},{pattern:/\bq\s+to\s+(quit|exit)\b/gi,keySequence:()=>"q"},{pattern:/\bpress\s+q\b/gi,keySequence:()=>"q"},{pattern:/❯\s*(\d+)\.\s+.*/g,keySequence:y=>y[1]},{pattern:/(\d+)\.\s+.*/g,keySequence:y=>y[1]}];function ti(y,t){new yt(y,t).process()}var yt=class{constructor(t,e){this.processedRanges=new Map;this.container=t,this.lines=t.querySelectorAll(".terminal-line"),this.onShortcutClick=e}process(){if(this.lines.length!==0)for(let t=0;t<this.lines.length;t++)this.processLine(t)}processLine(t){let e=this.getLineText(t);if(!e)return;let s=this.findShortcutsInLine(e);for(let d of s)this.isRangeProcessed(t,d.start,d.end)||(this.createShortcutLink(d,t),this.markRangeAsProcessed(t,d.start,d.end))}findShortcutsInLine(t){let e=[];for(let d of Hi){d.pattern.lastIndex=0;let b=d.pattern.exec(t);for(;b!==null;){let S=b[0],r=d.keySequence(b),h=b.index,g=b.index+S.length;e.push({text:S,keySequence:r,start:h,end:g}),b=d.pattern.exec(t)}}e.sort((d,b)=>d.start-b.start);let s=[];for(let d of e)s.some(S=>d.start<S.end&&d.end>S.start)||s.push(d);return s}createShortcutLink(t,e){let s=this.lines[e];new St(s,t,this.onShortcutClick).createLink()}getLineText(t){return t<0||t>=this.lines.length?"":this.lines[t].textContent||""}isRangeProcessed(t,e,s){let d=this.processedRanges.get(t);return d?d.some(b=>e<b.end&&s>b.start):!1}markRangeAsProcessed(t,e,s){this.processedRanges.has(t)||this.processedRanges.set(t,[]);let d=this.processedRanges.get(t);d&&d.push({start:e,end:s})}},St=class{constructor(t,e,s){this.lineElement=t,this.shortcut=e,this.onShortcutClick=s}createLink(){this.wrapTextInLink(this.lineElement,this.shortcut.start,this.shortcut.end)}wrapTextInLink(t,e,s){let d=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null),b=[],S=0,r=d.nextNode();for(;r;){let h=r,g=h.textContent||"",p=S,n=S+g.length;n>e&&p<s&&b.push({node:h,start:p,end:n}),S=n,r=d.nextNode()}for(let h=b.length-1;h>=0;h--){let{node:g,start:p}=b[h],n=g.textContent||"",f=Math.max(0,e-p),c=Math.min(n.length,s-p);f<c&&this.wrapTextNode(g,f,c)}}wrapTextNode(t,e,s){let d=t.parentNode;if(!d||this.isInsideClickable(d))return;let b=t.textContent||"",S=b.substring(0,e),r=b.substring(e,s),h=b.substring(s),g=this.createShortcutElement(r),p=document.createDocumentFragment();S&&p.appendChild(document.createTextNode(S)),p.appendChild(g),h&&p.appendChild(document.createTextNode(h)),d.replaceChild(p,t)}createShortcutElement(t){let e=document.createElement("span");return e.className=ei,e.style.color="#9ca3af",e.style.textDecoration="underline",e.style.textDecorationStyle="dotted",e.style.cursor="pointer",e.style.fontWeight="500",e.textContent=t,e.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),this.onShortcutClick(this.shortcut.keySequence)}),e.addEventListener("mouseenter",()=>{e.style.backgroundColor="rgba(156, 163, 175, 0.2)",e.style.color="#d1d5db"}),e.addEventListener("mouseleave",()=>{e.style.backgroundColor="",e.style.color="#9ca3af"}),e.title=`Click to send: ${this.shortcut.keySequence}`,e}isInsideClickable(t){let e=t;for(;e&&e!==document.body;){if(e.tagName==="A"&&e.classList.contains("terminal-link")||e.tagName==="SPAN"&&e.classList.contains(ei))return!0;e=e.parentElement}return!1}};Ee();Ee();function ni(){return/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)||!!navigator.maxTouchPoints&&navigator.maxTouchPoints>1}var Ae=ae("terminal-preferences");var wt={maxCols:0,fontSize:ni()?12:14,fitHorizontally:!1,theme:"dracula"},oi="vibetunnel_terminal_preferences",lt=class y{constructor(){this.preferences=this.loadPreferences()}static getInstance(){return y.instance||(y.instance=new y),y.instance}loadPreferences(){try{let t=localStorage.getItem(oi);if(t){let e=JSON.parse(t),s={...wt,...e};return Ae.debug("Loaded terminal preferences:",s),s}}catch(t){Ae.warn("Failed to load terminal preferences",{error:t})}return Ae.debug("Using default terminal preferences"),{...wt}}savePreferences(){try{let t=JSON.stringify(this.preferences);localStorage.setItem(oi,t),Ae.debug("Saved terminal preferences to localStorage")}catch(t){Ae.warn("Failed to save terminal preferences",{error:t})}}getMaxCols(){return this.preferences.maxCols}setMaxCols(t){this.preferences.maxCols=Math.max(0,t),this.savePreferences()}getFontSize(){return this.preferences.fontSize}setFontSize(t){this.preferences.fontSize=Math.max(8,Math.min(32,t)),this.savePreferences()}getFitHorizontally(){return this.preferences.fitHorizontally}setFitHorizontally(t){this.preferences.fitHorizontally=t,this.savePreferences()}getTheme(){return this.preferences.theme}setTheme(t){Ae.debug("Setting terminal theme:",t),this.preferences.theme=t,this.savePreferences()}getPreferences(){return{...this.preferences}}resetToDefaults(){this.preferences={...wt},this.savePreferences()}};var Et=[{id:"auto",name:"Auto",description:"Follow system theme",colors:{}},{id:"dark",name:"Dark",description:"VibeTunnel default dark",colors:{background:"#1e1e1e",foreground:"#d4d4d4",cursor:"rgb(var(--color-primary))",cursorAccent:"#1e1e1e",black:"#000000",red:"#cd0000",green:"#00cd00",yellow:"#cdcd00",blue:"#0000ee",magenta:"#cd00cd",cyan:"#00cdcd",white:"#e5e5e5",brightBlack:"#7f7f7f",brightRed:"#ff0000",brightGreen:"#00ff00",brightYellow:"#ffff00",brightBlue:"#5c5cff",brightMagenta:"#ff00ff",brightCyan:"#00ffff",brightWhite:"#ffffff"}},{id:"light",name:"Light",description:"Soft light theme",colors:{background:"#f8f9fa",foreground:"#1f2328",cursor:"rgb(var(--color-primary))",cursorAccent:"#f8f9fa",black:"#24292f",red:"#cf222e",green:"#1a7f37",yellow:"#9a6700",blue:"#0969da",magenta:"#8250df",cyan:"#1b7c83",white:"#6e7781",brightBlack:"#57606a",brightRed:"#da3633",brightGreen:"#2da44e",brightYellow:"#bf8700",brightBlue:"#218bff",brightMagenta:"#a475f9",brightCyan:"#3192aa",brightWhite:"#8c959f",selectionBackground:"#0969da",selectionForeground:"#ffffff",selectionInactiveBackground:"#e1e4e8"}},{id:"vscode-dark",name:"VS Code Dark",description:"Popular theme from Visual Studio Code",colors:{background:"#1E1E1E",foreground:"#D4D4D4",cursor:"#AEAFAD",cursorAccent:"#1E1E1E",black:"#000000",red:"#CD3131",green:"#0DBC79",yellow:"#E5E510",blue:"#2472C8",magenta:"#BC3FBC",cyan:"#11A8CD",white:"#E5E5E5",brightBlack:"#666666",brightRed:"#F14C4C",brightGreen:"#23D18B",brightYellow:"#F5F543",brightBlue:"#3B8EEA",brightMagenta:"#D670D6",brightCyan:"#29B8DB",brightWhite:"#FFFFFF"}},{id:"dracula",name:"Dracula",description:"Classic dark theme",colors:{background:"#282A36",foreground:"#F8F8F2",cursor:"#F8F8F2",cursorAccent:"#282A36",black:"#21222C",red:"#FF5555",green:"#50FA7B",yellow:"#F1FA8C",blue:"#BD93F9",magenta:"#FF79C6",cyan:"#8BE9FD",white:"#F8F8F2",brightBlack:"#6272A4",brightRed:"#FF6E6E",brightGreen:"#69FF94",brightYellow:"#FFFFA5",brightBlue:"#D6ACFF",brightMagenta:"#FF92DF",brightCyan:"#A4FFFF",brightWhite:"#FFFFFF"}},{id:"nord",name:"Nord",description:"Arctic north-bluish palette",colors:{background:"#2E3440",foreground:"#D8DEE9",cursor:"#D8DEE9",cursorAccent:"#2E3440",black:"#3B4252",red:"#BF616A",green:"#A3BE8C",yellow:"#EBCB8B",blue:"#81A1C1",magenta:"#B48EAD",cyan:"#88C0D0",white:"#E5E9F0",brightBlack:"#4C566A",brightRed:"#BF616A",brightGreen:"#A3BE8C",brightYellow:"#EBCB8B",brightBlue:"#81A1C1",brightMagenta:"#B48EAD",brightCyan:"#8FBCBB",brightWhite:"#ECEFF4"}}];function At(){let y=document.documentElement.getAttribute("data-theme");return y==="dark"?"dark":y==="light"?"light":window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function Tt(){return At()==="dark"}var Ki=["https://","http://","file://"],ai="terminal-link",ht=/https?:\/\/|file:\/\//g,ji=/(^|\s)(h|ht|htt|http|https|https:|https:\/|https:\/\/|f|fi|fil|file|file:|file:\/|file:\/\/)$/,xt=/^[a-zA-Z0-9[\].-]/,Vi=/^[/a-zA-Z0-9[\].-]/,li=/[^\w\-._~:/?#[\]@!$&'()*+,;=%{}|\\^`]/,Yi=/^(https?:\/\/(localhost|[\d.]+|\[[\da-fA-F:]+\]|(([a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?\.)*[a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?\.[a-zA-Z]+))(:\d+)?.*|file:\/\/.+)/,Gi=/^[a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?$/;function Xi(y){new kt(y).process()}var kt=class{constructor(t){this.processedRanges=new Map;this.container=t,this.lines=t.querySelectorAll(".terminal-line")}process(){if(this.lines.length!==0)for(let t=0;t<this.lines.length;t++)this.processLine(t)}processLine(t){t>0&&this.checkPreviousLineContinuation(t),this.findUrlsInLine(t)}checkPreviousLineContinuation(t){let e=this.getLineText(t),s=this.getLineText(t-1),d=this.findIncompleteUrlAtLineEnd(s,e);if(d){let{startPos:b}=d,S=this.buildMultiLineUrl(t-1,b);S&&this.isValidUrl(S.url)&&(this.isRangeProcessed(t-1,b,S.endLine)||(this.createUrlLinks(S.url,t-1,S.endLine,b),this.markRangeAsProcessed(t-1,S.endLine,b,S.url)))}}findIncompleteUrlAtLineEnd(t,e){for(let d of Ki){let b=t.lastIndexOf(d);if(b>=0&&t.endsWith(d)&&xt.test(e.trimStart()))return{startPos:b,protocol:d}}let s=t.match(ji);if(s){let d=s[2],b=(s.index??0)+(s[1]?1:0);if(this.isValidContinuation(d,e))return{startPos:b,protocol:d}}return null}isValidContinuation(t,e){let s=e.trimStart();if(t==="https://"||t==="file://")return xt.test(s);if(t.endsWith("/"))return Vi.test(s);let d=t+s;return/^(https?:\/\/|file:\/\/)/.test(d)}isValidUrlContinuation(t,e){let s=e.trimStart();if(!s)return!1;if(!t.includes("://")){let b=t+s;return/^(https?:|file:|https?:\/|file:\/|https?:\/\/|file:\/\/)/.test(b)}if(t.match(/(https?:|file:)\/\/$/))return xt.test(s);if(/^(and|or|but|the|is|are|was|were|been|have|has|had|will|would|could|should|may|might|check|visit|go|see|click|open|navigate)\b/i.test(s)||/^[!?;]/.test(s)||/^\.(\s|$)/.test(s))return!1;let d=s.split(/\s/)[0];return/[/:._-]/.test(d)?!0:/^[a-zA-Z]+$/.test(d)&&d.length>2?!/^(next|line|with|text|this|that|then|when|where|which|while|after|before|during|since|until|above|below|between|into|through|under|over|about|against|among|around|behind|beside|beyond|inside|outside|toward|within|without|according|although|because|however|therefore|moreover|nevertheless|furthermore|otherwise|meanwhile|indeed|instead|likewise|similarly|specifically|subsequently|ultimately|additionally|consequently|eventually|finally|initially|particularly|previously|recently|suddenly|usually)/i.test(d):/^[a-zA-Z0-9._~:/?#[\]@!$&'()*+,;=%-]/.test(s)}findUrlsInLine(t){let e=this.getLineText(t);ht.lastIndex=0;let s=ht.exec(e);for(;s!==null;){let d=s.index;if(this.isPositionProcessed(t,d)){s=ht.exec(e);continue}let b=this.buildMultiLineUrl(t,d);b&&this.isValidUrl(b.url)&&(this.createUrlLinks(b.url,t,b.endLine,d),this.markRangeAsProcessed(t,b.endLine,d,b.url)),s=ht.exec(e)}}buildMultiLineUrl(t,e){let s="",d=t;for(let b=t;b<this.lines.length;b++){let S=this.getLineText(b),r;if(b===t)r=S.substring(e);else{let g=s;if(!this.isValidUrlContinuation(g,S)){d=b-1;break}if(r=S.trimStart(),!r){d=b-1;break}}let h=this.findUrlEndInText(r);if(h>=0){s+=r.substring(0,h),d=b;break}else if(s+=r,d=b,b===this.lines.length-1)break}return{url:this.cleanUrl(s),endLine:d}}findUrlEndInText(t){let e=t.search(/\s/);if(e>=0)return e;let s=t.match(li);return s&&s.index!==void 0?s.index:-1}createUrlLinks(t,e,s,d){new Lt(this.lines,t).createLinks(e,s,d)}getLineText(t){return t<0||t>=this.lines.length?"":this.lines[t].textContent||""}isValidUrl(t){if(t.length<7||t.length>2048||/[\n\r\t]/.test(t)||!Yi.test(t))return!1;try{let e=new URL(t);if(!["http:","https:","file:"].includes(e.protocol))return!1;if(e.protocol==="http:"||e.protocol==="https:"){let s=e.hostname;if(s==="localhost"||/^[\d.]+$/.test(s)||s.startsWith("["))return!0;let d=s.split(".");if(d.length<2)return!1;for(let S=0;S<d.length;S++)if(!Gi.test(d[S]))return!1;let b=d[d.length-1];if(!/[a-zA-Z]/.test(b))return!1}return!0}catch{return!1}}cleanUrl(t){let e=t,s=(e.match(/\(/g)||[]).length,d=(e.match(/\)/g)||[]).length;if(d>s){let b=d-s;e=e.replace(/\)+$/,S=>S.substring(0,S.length-b))}return e=e.replace(/[.,;:!?]+$/,""),e}isRangeProcessed(t,e,s){for(let d=t;d<=s;d++)if(this.isPositionProcessed(d,d===t?e:0))return!0;return!1}isPositionProcessed(t,e){let s=this.processedRanges.get(t);return s?s.some(d=>e>=d.start&&e<d.end):!1}markRangeAsProcessed(t,e,s,d){let b=d,S=t;for(;S<=e&&b.length>0;){let r=this.getLineText(S);this.processedRanges.has(S)||this.processedRanges.set(S,[]);let h=this.processedRanges.get(S);if(!h)continue;let g,p;if(S===t){g=s;let n=r.substring(s),f=Math.min(n.length,b.length);p=s+f}else{let n=r.match(/^\s*/);g=n?n[0].length:0;let f=r.substring(g),c=Math.min(f.length,b.length);if(S===e){let u=f.substring(0,c).search(li);u>=0&&(c=u)}p=g+c}h.push({start:g,end:p}),b=b.substring(p-g),S++}}},Lt=class{constructor(t,e){this.lines=t,this.url=e}createLinks(t,e,s){let d=this.url;for(let b=t;b<=e;b++){let S=this.lines[b],r=S.textContent||"",h,g;if(b===t){h=s;let p=r.substring(s);g=s+Math.min(p.length,d.length)}else{let p=r.match(/^\s*/);h=p?p[0].length:0;let n=r.substring(h),f=Math.min(n.length,d.length),c=n.match(/[\s<>"'`]/),u=c?Math.min(c.index??f,f):f;g=h+u}if(h<g&&(this.wrapTextInLink(S,h,g),d=d.substring(g-h)),d.length===0)break}}wrapTextInLink(t,e,s){let d=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null),b=[],S=0,r=d.nextNode();for(;r;){let h=r,g=h.textContent||"",p=S,n=S+g.length;n>e&&p<s&&b.push({node:h,start:p,end:n}),S=n,r=d.nextNode()}for(let h=b.length-1;h>=0;h--){let{node:g,start:p}=b[h],n=g.textContent||"",f=Math.max(0,e-p),c=Math.min(n.length,s-p);f<c&&this.wrapTextNode(g,f,c)}}wrapTextNode(t,e,s){let d=t.parentNode;if(!d||this.isInsideLink(d))return;let b=t.textContent||"",S=b.substring(0,e),r=b.substring(e,s),h=b.substring(s),g=this.createLinkElement(r),p=document.createDocumentFragment();S&&p.appendChild(document.createTextNode(S)),p.appendChild(g),h&&p.appendChild(document.createTextNode(h)),d.replaceChild(p,t)}createLinkElement(t){let e=document.createElement("a");return e.className=ai,e.href=this.url,e.target="_blank",e.rel="noopener noreferrer",e.style.color="#4fc3f7",e.style.textDecoration="underline",e.style.cursor="pointer",e.textContent=t,e.addEventListener("mouseenter",()=>{e.style.backgroundColor="rgba(79, 195, 247, 0.2)"}),e.addEventListener("mouseleave",()=>{e.style.backgroundColor=""}),e}isInsideLink(t){let e=t;for(;e&&e!==document.body;){if(e.tagName==="A"&&e.classList.contains(ai))return!0;e=e.parentElement}return!1}},hi={processLinks:Xi};var H=ae("terminal"),X=class extends ee{constructor(){super(...arguments);this.sessionId="";this.sessionStatus="running";this.cols=80;this.rows=24;this.fontSize=14;this.fitHorizontally=!1;this.maxCols=0;this.theme="auto";this.disableClick=!1;this.hideScrollButton=!1;this.initialCols=0;this.initialRows=0;this.originalFontSize=14;this.userOverrideWidth=!1;this.terminal=null;this._viewportY=0;this.followCursorEnabled=!0;this.programmaticScroll=!1;this.debugMode=!1;this.renderCount=0;this.totalRenderTime=0;this.lastRenderTime=0;this.actualRows=24;this.cursorVisible=!0;this.container=null;this.explicitSizeSet=!1;this.renderPending=!1;this.momentumVelocityY=0;this.momentumVelocityX=0;this.momentumAnimation=null;this.resizeObserver=null;this.mobileWidthResizeComplete=!1;this.pendingResize=null;this.lastCols=0;this.lastRows=0;this.isMobile=!1;this.mobileInitialResizeTimeout=null;this.operationQueue=[];this.handleScrollToBottom=()=>{this.followCursorEnabled=!0,this.scrollToBottom(),this.requestUpdate()};this.handleFitToggle=()=>{if(!this.terminal||!this.container){this.fitHorizontally=!this.fitHorizontally,this.requestUpdate();return}let e=this.terminal.buffer.active,s=this.fontSize*1.2,d=s>0?this.viewportY/s:0,b=this.isScrolledToBottom();if(this.fitHorizontally||(this.originalFontSize=this.fontSize),this.fitHorizontally=!this.fitHorizontally,this.fitHorizontally||(this.fontSize=this.originalFontSize),this.requestResize("fit-mode-change"),b)this.scrollToBottom();else{let S=this.fontSize*1.2,r=Math.max(0,(e.length-this.actualRows)*S),h=d*S;this.viewportY=Math.max(0,Math.min(r,h))}this.requestUpdate()};this.handlePaste=async e=>{e.preventDefault(),e.stopPropagation();let s=e.clipboardData?.getData("text/plain");if(!s&&navigator.clipboard)try{s=await navigator.clipboard.readText()}catch(d){H.error("Failed to read clipboard via navigator API",d)}s&&this.dispatchEvent(new CustomEvent("terminal-paste",{detail:{text:s},bubbles:!0}))};this.handleClick=()=>{this.disableClick||this.container&&this.container.focus()};this.handleShortcutClick=e=>{this.dispatchEvent(new CustomEvent("terminal-input",{detail:{text:e},bubbles:!0}))}}createRenderRoot(){return this}get viewportY(){return this._viewportY}set viewportY(e){this._viewportY=e}queueRenderOperation(e){this.operationQueue.push(e),this.renderPending||(this.renderPending=!0,requestAnimationFrame(()=>{this.processOperationQueue().then(()=>{this.operationQueue.length===0&&(this.renderPending=!1)})}))}requestRenderBuffer(){H.debug("Requesting render buffer update"),this.queueRenderOperation(()=>{H.debug("Executing render operation"),this.renderBuffer()})}async processOperationQueue(){let e=performance.now(),s=8;for(;this.operationQueue.length>0;){let d=this.operationQueue.shift();if(d&&await d(),performance.now()-e>s&&this.operationQueue.length>0){await new Promise(b=>{requestAnimationFrame(()=>{this.processOperationQueue().then(b)})});return}}this.renderBuffer(),this.operationQueue.length===0&&(this.renderPending=!1)}connectedCallback(){let e=lt.getInstance();if(this.theme=e.getTheme(),super.connectedCallback(),this.debugMode=new URLSearchParams(window.location.search).has("debug"),this.themeObserver=new MutationObserver(()=>{this.terminal&&this.theme==="auto"?(H.debug("Auto theme detected system change, updating terminal"),this.terminal.options.theme=this.getTerminalTheme(),this.updateTerminalColorProperties(this.getTerminalTheme()),this.requestRenderBuffer()):this.theme!=="auto"&&H.debug("Ignoring system theme change - explicit theme selected:",this.theme)}),this.themeObserver.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),this.sessionId)try{let s=localStorage.getItem(`terminal-width-override-${this.sessionId}`);s!==null&&(this.userOverrideWidth=s==="true")}catch(s){H.warn("Failed to load terminal width preference from localStorage:",s)}}updated(e){if(e.has("sessionId")&&this.sessionId)try{let s=localStorage.getItem(`terminal-width-override-${this.sessionId}`);s!==null&&(this.userOverrideWidth=s==="true",this.container&&this.requestResize("property-change"))}catch(s){H.warn("Failed to load terminal width preference from localStorage:",s)}if((e.has("cols")||e.has("rows"))&&(this.terminal&&!this.explicitSizeSet&&this.reinitializeTerminal(),this.explicitSizeSet=!1),e.has("fontSize")&&(this.fitHorizontally||(this.originalFontSize=this.fontSize),this.terminal&&this.container&&this.requestResize("property-change")),e.has("fitHorizontally")&&(this.fitHorizontally||(this.fontSize=this.originalFontSize),this.requestResize("property-change")),e.has("maxCols")&&this.terminal&&this.container&&this.requestResize("property-change"),e.has("theme"))if(H.debug("Terminal theme changed to:",this.theme),this.terminal?.options){let s=this.getTerminalTheme();H.debug("Applying terminal theme:",this.theme),this.terminal.options.theme=s,this.updateTerminalColorProperties(s),this.container&&(this.container.innerHTML=""),this.requestRenderBuffer()}else H.warn("No terminal instance found for theme update")}disconnectedCallback(){this.cleanup(),this.themeObserver&&this.themeObserver.disconnect(),super.disconnectedCallback()}setUserOverrideWidth(e){if(this.userOverrideWidth=e,this.isMobile&&e&&(this.mobileWidthResizeComplete=!1,H.debug("[Terminal] Mobile: Resetting width resize block for user-initiated change")),this.sessionId)try{localStorage.setItem(`terminal-width-override-${this.sessionId}`,String(e))}catch(s){H.warn("Failed to save terminal width preference to localStorage:",s)}this.container&&this.requestResize("property-change")}cleanup(){this.momentumAnimation&&(cancelAnimationFrame(this.momentumAnimation),this.momentumAnimation=null),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.pendingResize&&(cancelAnimationFrame(this.pendingResize),this.pendingResize=null),this.mobileInitialResizeTimeout&&(clearTimeout(this.mobileInitialResizeTimeout),this.mobileInitialResizeTimeout=null),this.terminal&&(this.terminal.dispose(),this.terminal=null)}firstUpdated(){this.originalFontSize=this.fontSize,this.initializeTerminal()}requestResize(e){this.isMobile=window.innerWidth<768,H.debug(`[Terminal] Resize requested from ${e} (mobile: ${this.isMobile}, width: ${window.innerWidth})`),this.pendingResize&&cancelAnimationFrame(this.pendingResize),this.pendingResize=requestAnimationFrame(()=>{this.fitTerminal(e),this.pendingResize=null})}shouldResize(e,s){if(this.isMobile&&this.mobileWidthResizeComplete&&!this.userOverrideWidth){let b=this.lastCols!==e,S=this.lastRows!==s;return b?(H.debug("[Terminal] Preventing WIDTH resize on mobile (width already set)"),!1):S?(H.debug(`[Terminal] Allowing HEIGHT resize on mobile: ${this.lastRows} \u2192 ${s} rows`),this.lastRows=s,!0):!1}let d=this.lastCols!==e||this.lastRows!==s;return d&&(H.debug(`[Terminal] Dimensions changed: ${this.lastCols}x${this.lastRows} \u2192 ${e}x${s}`),this.lastCols=e,this.lastRows=s,this.isMobile&&!this.mobileWidthResizeComplete&&(this.mobileWidthResizeComplete=!0,H.debug("[Terminal] Mobile WIDTH resize complete - blocking future width changes"))),d}getTerminalTheme(){let e=this.theme;return e==="auto"&&(e=At()),{...(Et.find(d=>d.id===e)||Et[0]).colors}}updateTerminalColorProperties(e){H.debug("Updating terminal CSS color properties"),Object.entries({black:0,red:1,green:2,yellow:3,blue:4,magenta:5,cyan:6,white:7,brightBlack:8,brightRed:9,brightGreen:10,brightYellow:11,brightBlue:12,brightMagenta:13,brightCyan:14,brightWhite:15}).forEach(([d,b])=>{if(e[d]){let S=`--terminal-color-${b}`;document.documentElement.style.setProperty(S,e[d]),H.debug(`Set CSS property ${S}:`,e[d])}}),e.foreground&&(document.documentElement.style.setProperty("--terminal-foreground",e.foreground),H.debug("Set terminal foreground color:",e.foreground)),e.background&&(document.documentElement.style.setProperty("--terminal-background",e.background),H.debug("Set terminal background color:",e.background)),H.debug("CSS terminal color properties updated")}async initializeTerminal(){try{if(H.debug("initializeTerminal starting"),this.requestUpdate(),this.container=this.querySelector("#terminal-container"),!this.container){let e=new Error("Terminal container not found");throw H.error("terminal container not found",e),e}H.debug("Terminal container found, proceeding with setup"),await this.setupTerminal(),this.setupResize(),this.setupScrolling(),this.viewportY=0,this.terminal&&this.terminal.scrollToTop(),this.requestUpdate()}catch(e){H.error("failed to initialize terminal:",e),this.requestUpdate()}}async reinitializeTerminal(){if(this.terminal){this.container&&this.container.offsetHeight;let e=Number.isFinite(this.cols)?Math.floor(this.cols):80,s=Number.isFinite(this.rows)?Math.floor(this.rows):24;this.terminal.resize(e,s),this.requestResize("property-change")}}async setupTerminal(){try{this.terminal=new ci.Terminal({cursorBlink:!0,cursorStyle:"block",cursorWidth:1,lineHeight:1.2,letterSpacing:0,scrollback:1e4,allowProposedApi:!0,allowTransparency:!1,convertEol:!0,drawBoldTextInBrightColors:!0,minimumContrastRatio:1,macOptionIsMeta:!0,altClickMovesCursor:!0,rightClickSelectsWord:!1,wordSeparator:" ()[]{}'\"`",theme:this.getTerminalTheme()}),this.terminal.resize(this.cols,this.rows),this.requestRenderBuffer()}catch(e){throw H.error("failed to create terminal:",e),e}}measureCharacterWidth(){if(!this.container)return 8;let e=document.createElement("div");e.className="terminal-line",e.style.position="absolute",e.style.visibility="hidden",e.style.top="0",e.style.left="0",e.style.fontSize=`${this.fontSize}px`,e.style.fontFamily="Hack Nerd Font Mono, Fira Code, monospace";let s="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+-=[]{}|;:,.<>?",d=Math.ceil(this.cols/s.length),b=s.repeat(d).substring(0,this.cols);e.textContent=b,this.container.appendChild(e);let r=e.getBoundingClientRect().width/this.cols;return this.container.removeChild(e),Number.isFinite(r)&&r>0?r:8}fitTerminal(e){if(!this.terminal||!this.container){H.warn("[Terminal] Cannot fit terminal: terminal or container not initialized");return}let s=Date.now(),d=this._lastFitTime?s-this._lastFitTime:0;this._lastFitTime=s,H.debug("[Terminal] \u{1F4F1} fitTerminal called",{source:e||"unknown",isMobile:this.isMobile,windowWidth:window.innerWidth,timeSinceLastFit:d,cols:this.cols,rows:this.rows,actualRows:this.actualRows,bufferLength:this.terminal.buffer.active.length}),this.isMobile&&H.debug(`[Terminal] Mobile detected in fitTerminal - source: ${e}, userAgent: ${navigator.userAgent}`);let b=this.actualRows,S=this.fontSize*1.2,r=this.isScrolledToBottom(),h=S>0?this.viewportY/S:0;if(this.fitHorizontally){let g=this.container.clientWidth,p=this.container.clientHeight,n=g/this.cols,f=this.measureCharacterWidth(),c=n/f,u=this.fontSize*c,m=Math.max(4,Math.min(32,u));this.fontSize=m;let i=this.fontSize*1.2,o=Math.max(1,Math.floor(p/i));if(this.actualRows=o,this.rows=o,this.terminal){let l=Number.isFinite(this.cols)?Math.floor(this.cols):80,a=Number.isFinite(this.rows)?Math.floor(this.rows):24,v=this.lastCols,C=this.lastRows;if(this.shouldResize(l,a)){H.debug(`Resizing terminal (${e||"unknown"}): ${l}x${a}`),this.terminal.resize(l,a);let L=!(l!==v)&&a!==C;this.dispatchEvent(new CustomEvent("terminal-resize",{detail:{cols:l,rows:a,isMobile:this.isMobile,isHeightOnlyChange:L,source:e||"unknown"},bubbles:!0}))}else H.debug(`Skipping resize (${e||"unknown"}): dimensions unchanged`)}}else{let g=this.container.clientWidth||800,p=this.container.clientHeight||600,n=this.fontSize*1.2,f=this.measureCharacterWidth(),c=Number.isFinite(f)&&f>0?f:8,u=Math.max(20,Math.floor(g/c))-1,m=this.sessionId.startsWith("fwd_");if(this.maxCols>0?this.cols=Math.min(u,this.maxCols):this.userOverrideWidth?this.cols=u:this.initialCols>0&&m?this.cols=Math.min(u,this.initialCols):this.cols=u,this.rows=Math.max(6,Math.floor(p/n)),this.actualRows=this.rows,this.terminal){let i=Number.isFinite(this.cols)?Math.floor(this.cols):80,o=Number.isFinite(this.rows)?Math.floor(this.rows):24,l=this.lastCols,a=this.lastRows;if(this.shouldResize(i,o)){H.debug(`Resizing terminal (${e||"unknown"}): ${i}x${o}`),this.terminal.resize(i,o);let C=!(i!==l)&&o!==a;this.dispatchEvent(new CustomEvent("terminal-resize",{detail:{cols:i,rows:o,isMobile:this.isMobile,isHeightOnlyChange:C,source:e||"unknown"},bubbles:!0}))}else H.debug(`Skipping resize (${e||"unknown"}): dimensions unchanged`)}}if(this.terminal){let g=this.terminal.buffer.active,p=this.fontSize*1.2,n=Math.max(0,(g.length-this.actualRows)*p);if(r)this.viewportY=n;else{let f=h*p,c=Math.max(0,Math.min(n,f));this.viewportY=c}}this.requestRenderBuffer(),this.requestUpdate()}setupResize(){if(!this.container)return;let e=768;this.isMobile=window.innerWidth<e,H.debug(`[Terminal] Setting up resize - isMobile: ${this.isMobile}, width: ${window.innerWidth}, userAgent: ${navigator.userAgent}`),this.isMobile?(H.debug("[Terminal] Mobile detected - scheduling initial resize in 200ms"),this.mobileInitialResizeTimeout=setTimeout(()=>{H.debug("[Terminal] Mobile: Executing initial resize"),this.fitTerminal("initial-mobile-only"),H.debug("[Terminal] Mobile: Initial width set, future WIDTH resizes blocked (height allowed for keyboard)"),this.mobileInitialResizeTimeout=null},200)):(H.debug("[Terminal] Desktop detected - setting up resize observers"),this.resizeObserver=new ResizeObserver(()=>{H.debug("[Terminal] ResizeObserver triggered"),this.requestResize("ResizeObserver")}),this.resizeObserver.observe(this.container),window.addEventListener("resize",()=>{H.debug("[Terminal] Window resize event triggered"),this.requestResize("window-resize")}),H.debug("[Terminal] Desktop: Requesting initial resize"),this.requestResize("initial-desktop"))}setupScrolling(){if(!this.container)return;this.container.addEventListener("wheel",p=>{p.preventDefault();let n=this.fontSize*1.2,f=0,c=0;switch(p.deltaMode){case WheelEvent.DOM_DELTA_PIXEL:f=p.deltaY,c=p.deltaX;break;case WheelEvent.DOM_DELTA_LINE:f=p.deltaY*n,c=p.deltaX*n;break;case WheelEvent.DOM_DELTA_PAGE:f=p.deltaY*(this.actualRows*n),c=p.deltaX*(this.actualRows*n);break}let u=.5;f*=u,c*=u,Math.abs(f)>0&&this.scrollViewportPixels(f),Math.abs(c)>0&&!this.fitHorizontally&&this.container&&(this.container.scrollLeft+=c)},{passive:!1});let e=!1,s=0,d=0,b=[],S=p=>{p.pointerType!=="touch"||!p.isPrimary||(this.momentumAnimation&&(cancelAnimationFrame(this.momentumAnimation),this.momentumAnimation=null),e=!1,s=p.clientY,d=p.clientX,b=[{y:p.clientY,x:p.clientX,time:performance.now()}],this.container?.setPointerCapture(p.pointerId))},r=p=>{if(p.pointerType!=="touch"||!this.container?.hasPointerCapture(p.pointerId))return;let n=p.clientY,f=p.clientX,c=s-n,u=d-f,m=performance.now();b.push({y:n,x:f,time:m}),b.length>5&&b.shift(),!e&&(Math.abs(c)>5||Math.abs(u)>5)&&(e=!0),e&&(Math.abs(c)>0&&(this.scrollViewportPixels(c),s=n),Math.abs(u)>0&&!this.fitHorizontally&&(this.container.scrollLeft+=u,d=f))},h=p=>{if(p.pointerType==="touch"){if(e&&b.length>=2){let n=performance.now(),f=b[b.length-1],c=b[b.length-2],u=n-c.time,m=f.y-c.y,i=f.x-c.x,o=u>0?-m/u:0,l=u>0?-i/u:0,a=.3;(Math.abs(o)>a||Math.abs(l)>a)&&this.startMomentum(o,l)}this.container?.releasePointerCapture(p.pointerId)}},g=p=>{p.pointerType==="touch"&&this.container?.releasePointerCapture(p.pointerId)};this.container.addEventListener("pointerdown",S),this.container.addEventListener("pointermove",r),this.container.addEventListener("pointerup",h),this.container.addEventListener("pointercancel",g)}scrollViewportPixels(e){if(!this.terminal)return;let s=this.terminal.buffer.active,d=this.fontSize*1.2,b=Math.max(0,(s.length-this.actualRows)*d),S=Math.max(0,Math.min(b,this.viewportY+e));S!==this.viewportY&&(this.viewportY=S,this.updateFollowCursorState(),this.requestRenderBuffer())}startMomentum(e,s){this.momentumVelocityY=e*16,this.momentumVelocityX=s*16,this.momentumAnimation&&cancelAnimationFrame(this.momentumAnimation),this.animateMomentum()}animateMomentum(){let d=this.momentumVelocityY,b=this.momentumVelocityX,S=!1;if(Math.abs(d)>.1){let r=this.terminal?.buffer.active;if(r){let h=this.fontSize*1.2,g=Math.max(0,(r.length-this.actualRows)*h),p=Math.max(0,Math.min(g,this.viewportY+d));p!==this.viewportY?(this.viewportY=p,S=!0,this.updateFollowCursorState()):this.momentumVelocityY=0}}if(Math.abs(b)>.1&&!this.fitHorizontally&&this.container){let r=this.container.scrollLeft+b;this.container.scrollLeft=r,S=!0}this.momentumVelocityY*=.92,this.momentumVelocityX*=.92,Math.abs(this.momentumVelocityY)>.1||Math.abs(this.momentumVelocityX)>.1?(this.momentumAnimation=requestAnimationFrame(()=>{this.animateMomentum()}),S&&this.renderBuffer()):(this.momentumAnimation=null,this.momentumVelocityY=0,this.momentumVelocityX=0)}renderBuffer(){if(!this.terminal||!this.container){H.warn("renderBuffer called but missing terminal or container",{hasTerminal:!!this.terminal,hasContainer:!!this.container});return}H.debug("renderBuffer executing");let e=this.debugMode?performance.now():0;this.debugMode&&this.renderCount++;let s=this.terminal.buffer.active,d=s.length,b=this.fontSize*1.2,S=this.viewportY/b,r=Math.floor(S),h=(S-r)*b,g="",p=s.getNullCell(),n=this.terminal.buffer.active.cursorX,f=this.terminal.buffer.active.cursorY+this.terminal.buffer.active.viewportY;for(let c=0;c<this.actualRows;c++){let u=r+c,m=h>0?` style="transform: translateY(-${h}px);"`:"";if(u>=d){g+=`<div class="terminal-line"${m}></div>`;continue}let i=s.getLine(u);if(!i){g+=`<div class="terminal-line"${m}></div>`;continue}let o=u===f,l=this.renderLine(i,p,o&&this.cursorVisible?n:-1);g+=`<div class="terminal-line"${m}>${l||""}</div>`}if(this.container.innerHTML=g,hi.processLinks(this.container),ti(this.container,this.handleShortcutClick),this.debugMode){let c=performance.now();this.lastRenderTime=c-e,this.totalRenderTime+=this.lastRenderTime,this.requestUpdate()}}renderLine(e,s,d=-1){let b="",S="",r="",h="",g=n=>n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),p=()=>{if(S){let n=g(S);b+=`<span class="${r}"${h?` style="${h}"`:""}>${n}</span>`,S=""}};for(let n=0;n<e.length;n++){if(e.getCell(n,s),!s)continue;let f=s.getChars()||" ";if(s.getWidth()===0)continue;let u="terminal-char",m="",i=n===d;i&&(u+=" cursor");let o=s.getFgColor();if(o!==void 0){if(typeof o=="number"&&o>=0&&o<=255)m+=`color: var(--terminal-color-${o});`;else if(typeof o=="number"&&o>255){let R=o>>16&255,B=o>>8&255,D=o&255;m+=`color: rgb(${R}, ${B}, ${D});`}}let l=s.getBgColor();if(l!==void 0){if(typeof l=="number"&&l>=0&&l<=255)m+=`background-color: var(--terminal-color-${l});`;else if(typeof l=="number"&&l>255){let R=l>>16&255,B=l>>8&255,D=l&255;m+=`background-color: rgb(${R}, ${B}, ${D});`}}let a=s.isBold(),v=s.isItalic(),C=s.isUnderline(),x=s.isDim(),L=s.isInverse(),k=s.isInvisible(),P=s.isStrikethrough(),K=s.isOverline();if(a&&(u+=" bold"),v&&(u+=" italic"),C&&(u+=" underline"),x&&(u+=" dim"),P&&(u+=" strikethrough"),K&&(u+=" overline"),L){let R=m.match(/color: ([^;]+);/)?.[1],B=m.match(/background-color: ([^;]+);/)?.[1],D="var(--terminal-foreground, #e4e4e4)",ne="var(--terminal-background, #0a0a0a)",ie=R||D,F=B||ne;m="",m+=`color: ${F};`,m+=`background-color: ${ie};`}i&&(m+="background-color: rgb(var(--color-primary));"),k&&(m+="opacity: 0;"),(u!==r||m!==h)&&(p(),r=u,h=m),S+=f}return p(),b}write(e,s=!0){if(!this.terminal){H.warn("Terminal.write called but no terminal instance exists");return}this.isMobile&&e.length>100&&H.debug("[Terminal] \u{1F4F1} Large write to terminal",{sessionId:this.sessionId,dataLength:e.length,followCursor:s,bufferLength:this.terminal.buffer.active.length,scrollPosition:this._viewportY}),e.includes("\x1B[?25l")&&(this.cursorVisible=!1),e.includes("\x1B[?25h")&&(this.cursorVisible=!0),this.queueRenderOperation(async()=>{this.terminal&&(await new Promise(d=>{this.terminal?this.terminal.write(e,d):d()}),s&&this.followCursorEnabled&&this.followCursor())})}clear(){this.terminal&&this.queueRenderOperation(()=>{this.terminal&&(this.terminal.clear(),this.viewportY=0)})}setTerminalSize(e,s){this.cols=e,this.rows=s,this.terminal&&(this.explicitSizeSet=!0,this.queueRenderOperation(()=>{this.terminal&&(this.terminal.resize(e,s),this.requestUpdate())}))}scrollToBottom(){this.terminal&&this.queueRenderOperation(()=>{if(!this.terminal)return;this.requestResize("property-change");let e=this.terminal.buffer.active,s=this.fontSize*1.2,d=Math.max(0,(e.length-this.actualRows)*s);this.programmaticScroll=!0,this.viewportY=d,this.programmaticScroll=!1})}scrollToPosition(e){this.terminal&&this.queueRenderOperation(()=>{if(!this.terminal)return;let s=this.terminal.buffer.active,d=this.fontSize*1.2,b=Math.max(0,s.length-this.actualRows);this.programmaticScroll=!0,this.viewportY=Math.max(0,Math.min(b,e))*d,this.programmaticScroll=!1})}queueCallback(e){this.queueRenderOperation(e)}getTerminalSize(){return{cols:this.cols,rows:this.rows}}getVisibleRows(){return this.actualRows}getBufferSize(){return this.terminal?this.terminal.buffer.active.length:0}getScrollPosition(){let e=this.fontSize*1.2;return Math.round(this.viewportY/e)}getMaxScrollPosition(){if(!this.terminal)return 0;let e=this.terminal.buffer.active;return Math.max(0,e.length-this.actualRows)}isScrolledToBottom(){if(!this.terminal)return!0;let e=this.terminal.buffer.active,s=this.fontSize*1.2,d=Math.max(0,(e.length-this.actualRows)*s);return this.viewportY>=d-s}updateFollowCursorState(){if(this.programmaticScroll)return;let e=this.isScrolledToBottom();e&&!this.followCursorEnabled?this.followCursorEnabled=!0:!e&&this.followCursorEnabled&&(this.followCursorEnabled=!1)}followCursor(){if(!this.terminal)return;let e=this.terminal.buffer.active,s=e.cursorY+e.viewportY,d=this.fontSize*1.2,b=s,S=Math.floor(this.viewportY/d),r=S+this.actualRows-1;this.programmaticScroll=!0,b<S?this.viewportY=b*d:b>r&&(this.viewportY=Math.max(0,(b-this.actualRows+1)*d));let h=Math.max(0,(e.length-this.actualRows)*d);this.viewportY=Math.min(this.viewportY,h),this.programmaticScroll=!1}render(){let e=this.getTerminalTheme(),s=`
      view-transition-name: session-${this.sessionId};
      background-color: ${e.background||"var(--terminal-background, #0a0a0a)"};
      color: ${e.foreground||"var(--terminal-foreground, #e4e4e4)"};
    `;return te`
      <style>
        /* Dynamic terminal sizing */
        .terminal-container {
          font-size: ${this.fontSize}px;
          line-height: ${this.fontSize*1.2}px;
          touch-action: none !important;
        }

        .terminal-line {
          height: ${this.fontSize*1.2}px;
          line-height: ${this.fontSize*1.2}px;
        }
      </style>
      <div class="relative w-full h-full p-0 m-0">
        <div
          id="terminal-container"
          class="terminal-container w-full h-full overflow-hidden p-0 m-0"
          tabindex="0"
          contenteditable="false"
          style="${s}"
          @paste=${this.handlePaste}
          @click=${this.handleClick}
          data-testid="terminal-container"
        ></div>
        ${!this.followCursorEnabled&&!this.hideScrollButton?te`
              <div
                class="scroll-to-bottom"
                @click=${this.handleScrollToBottom}
                title="Scroll to bottom"
              >
                ↓
              </div>
            `:""}
        ${this.debugMode?te`
              <div class="debug-overlay">
                <div class="metric">
                  <span class="metric-label">Renders:</span>
                  <span class="metric-value">${this.renderCount}</span>
                </div>
                <div class="metric">
                  <span class="metric-label">Avg:</span>
                  <span class="metric-value"
                    >${this.renderCount>0?(this.totalRenderTime/this.renderCount).toFixed(2):"0.00"}ms</span
                  >
                </div>
                <div class="metric">
                  <span class="metric-label">Last:</span>
                  <span class="metric-value">${this.lastRenderTime.toFixed(2)}ms</span>
                </div>
              </div>
            `:""}
      </div>
    `}};O([q({type:String})],X.prototype,"sessionId",2),O([q({type:String})],X.prototype,"sessionStatus",2),O([q({type:Number})],X.prototype,"cols",2),O([q({type:Number})],X.prototype,"rows",2),O([q({type:Number})],X.prototype,"fontSize",2),O([q({type:Boolean})],X.prototype,"fitHorizontally",2),O([q({type:Number})],X.prototype,"maxCols",2),O([q({type:String})],X.prototype,"theme",2),O([q({type:Boolean})],X.prototype,"disableClick",2),O([q({type:Boolean})],X.prototype,"hideScrollButton",2),O([q({type:Number})],X.prototype,"initialCols",2),O([q({type:Number})],X.prototype,"initialRows",2),O([V()],X.prototype,"terminal",2),O([V()],X.prototype,"followCursorEnabled",2),O([V()],X.prototype,"actualRows",2),O([V()],X.prototype,"cursorVisible",2),X=O([de("vibe-terminal")],X);var $e={SESSION_LIST_BOTTOM_BAR:10,TERMINAL_OVERLAY:15,LOG_BUTTON:20,MOBILE_OVERLAY:25,SIDEBAR_MOBILE:30,MOBILE_INPUT_OVERLAY:40,CTRL_ALPHA_OVERLAY:45,TERMINAL_QUICK_KEYS:48,WIDTH_SELECTOR_DROPDOWN:60,BRANCH_SELECTOR_DROPDOWN:65,IME_INPUT:70,MODAL_BACKDROP:100,MODAL:105,FILE_PICKER:110,SESSION_EXITED_OVERLAY:120,NOTIFICATION:150,FILE_BROWSER:1100};var ye=class extends ee{constructor(){super(...arguments);this.cols=80;this.rows=24;this.inputText="";this.terminalRef=rt();this.testData={ansi:"\x1B[31mRed\x1B[0m \x1B[32mGreen\x1B[0m \x1B[34mBlue\x1B[0m \x1B[1;33mBold Yellow\x1B[0m",unicode:"\u{1F680} Unicode: \u4F60\u597D\u4E16\u754C \u2022 \xF1 \u2022 \xFC \u2022 \xF6 \u2022 \u{1F3A8}",longLine:"This is a very long line that should wrap around when it reaches the edge of the terminal. ".repeat(5),progress:"[##########          ] 50% Complete"}}createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),this.setupTerminal()}async setupTerminal(){await this.updateComplete;let e=this.terminalRef.value;e&&e.addEventListener("terminal-ready",()=>{this.writeWelcomeMessage()})}writeWelcomeMessage(){let e=this.terminalRef.value;e&&(e.write(`\x1B[1;36mVibeTunnel Terminal Test\x1B[0m\r
`),e.write(`=====================================\r
\r
`),e.write(`This is a test environment for the terminal component.\r
`),e.write(`Use the buttons above to test various features.\r
\r
`),e.write("\x1B[32m$ \x1B[0m"))}handleTerminalInput(e){let s=this.terminalRef.value;if(!s)return;let d=e.detail;s.write(d),d==="\r"&&s.write(`
\x1B[32m$ \x1B[0m`)}handleTerminalResize(e){console.log("Terminal resized:",e.detail)}clearTerminal(){let e=this.terminalRef.value;e&&(e.clear(),e.write("\x1B[32m$ \x1B[0m"))}writeTestData(e){let s=this.terminalRef.value;s&&s.write(`${this.testData[e]}\r
\x1B[32m$ \x1B[0m`)}resizeTerminal(e,s){this.cols=e,this.rows=s;let d=this.terminalRef.value;d&&d.setTerminalSize(e,s)}sendCustomInput(){if(!this.inputText)return;let e=this.terminalRef.value;e&&(e.write(`${this.inputText}\r
\x1B[32m$ \x1B[0m`),this.inputText="")}render(){return te`
      <div class="h-screen flex flex-col bg-background text-foreground font-mono">
        <div class="bg-surface border-b border-gray-800 p-4 font-sans">
          <h1 class="text-2xl font-bold text-emerald-400 mb-4">Terminal Test</h1>
          <div class="flex gap-2 flex-wrap">
            <button
              @click=${this.clearTerminal}
              class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-emerald-400 rounded text-sm transition-colors"
            >
              Clear
            </button>
            <button
              @click=${()=>this.writeTestData("ansi")}
              class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-emerald-400 rounded text-sm transition-colors"
            >
              ANSI Colors
            </button>
            <button
              @click=${()=>this.writeTestData("unicode")}
              class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-emerald-400 rounded text-sm transition-colors"
            >
              Unicode
            </button>
            <button
              @click=${()=>this.writeTestData("longLine")}
              class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-emerald-400 rounded text-sm transition-colors"
            >
              Long Line
            </button>
            <button
              @click=${()=>this.writeTestData("progress")}
              class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-emerald-400 rounded text-sm transition-colors"
            >
              Progress Bar
            </button>
            <button
              @click=${()=>this.resizeTerminal(80,24)}
              class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-emerald-400 rounded text-sm transition-colors"
            >
              80x24
            </button>
            <button
              @click=${()=>this.resizeTerminal(120,30)}
              class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-emerald-400 rounded text-sm transition-colors"
            >
              120x30
            </button>
            <button
              @click=${()=>this.resizeTerminal(40,15)}
              class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-emerald-400 rounded text-sm transition-colors"
            >
              40x15
            </button>
          </div>
        </div>

        <div class="flex-1 relative overflow-hidden bg-black m-4 rounded-lg border border-gray-800">
          <div
            class="absolute top-4 right-4 bg-black/80 border border-gray-800 rounded px-3 py-1.5 text-xs"
            style="z-index: ${$e.TERMINAL_OVERLAY};"
          >
            <div>Size: <code class="text-emerald-400">${this.cols}x${this.rows}</code></div>
          </div>

          <vibe-terminal
            ${st(this.terminalRef)}
            .cols=${this.cols}
            .rows=${this.rows}
            @terminal-input=${this.handleTerminalInput}
            @terminal-resize=${this.handleTerminalResize}
            style="width: 100%; height: 100%;"
          ></vibe-terminal>

          <div class="absolute bottom-4 left-4 right-4 flex gap-2" style="z-index: ${$e.TERMINAL_OVERLAY};">
            <input
              type="text"
              placeholder="Type custom text to send..."
              class="flex-1 px-3 py-2 bg-black/80 text-foreground border border-gray-800 rounded font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-emerald-400"
              .value=${this.inputText}
              @input=${e=>{this.inputText=e.target.value}}
              @keydown=${e=>{e.key==="Enter"&&this.sendCustomInput()}}
            />
            <button
              @click=${this.sendCustomInput}
              class="px-4 py-2 bg-emerald-500 hover:bg-emerald-600 text-background rounded font-medium text-sm transition-colors"
            >
              Send
            </button>
          </div>
        </div>
      </div>
    `}};O([V()],ye.prototype,"cols",2),O([V()],ye.prototype,"rows",2),O([V()],ye.prototype,"inputText",2),ye=O([de("terminal-test")],ye);Ee();Ee();var Ue=ae("monaco-loader"),di=!1,ct=null;async function Zi(){return ct||(ct=new Promise((y,t)=>{let e=()=>{let s=document.createElement("script");s.src="/monaco-editor/vs/loader.js",s.async=!0,s.defer=!0,s.onload=()=>{window.require.config({paths:{vs:"/monaco-editor/vs"}}),window.MonacoEnvironment={getWorker:(d,b)=>new Worker("data:,")},window.require(["vs/editor/editor.main"],()=>{Ue.debug("Monaco Editor loaded via AMD with lazy loading"),y()})},s.onerror=()=>{t(new Error("Failed to load Monaco loader script"))},document.head.appendChild(s)};"requestIdleCallback"in window?requestIdleCallback(e,{timeout:2e3}):setTimeout(e,100)}),ct)}async function ui(){if(!di)try{Ue.debug("Loading Monaco Editor..."),window.monaco||await Zi(),Ue.debug("Initializing Monaco Editor...");let y=window.monaco;y.languages.register({id:"shell"}),y.languages.setMonarchTokensProvider("shell",{tokenizer:{root:[[/^#.*$/,"comment"],[/\$\w+/,"variable"],[/\b(echo|cd|ls|grep|find|chmod|mkdir|rm|cp|mv|touch|cat|sed|awk|curl|wget|git|pnpm|npm|yarn|docker|kubectl)\b/,"keyword"],[/"([^"\\]|\\.)*"/,"string"],[/'([^'\\]|\\.)*'/,"string"]]}}),y.editor.setTheme(Tt()?"vs-dark":"vs"),new MutationObserver(()=>{y.editor.setTheme(Tt()?"vs-dark":"vs")}).observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),di=!0,Ue.debug("Monaco Editor initialized successfully")}catch(y){throw Ue.error("Failed to initialize Monaco Editor:",y),y}}var gn=typeof window<"u"?window.monaco:void 0;var Te=ae("monaco-editor"),J=class extends ee{constructor(){super(...arguments);this.content="";this.originalContent="";this.modifiedContent="";this.language="";this.filename="";this.readOnly=!1;this.mode="normal";this.showModeToggle=!1;this.options={};this.isLoading=!0;this.diffMode="sideBySide";this.containerWidth=0;this.containerRef=rt();this.editor=null;this.resizeObserver=null;this.monacoLoaded=!1}createRenderRoot(){return this}async connectedCallback(){super.connectedCallback(),await this.loadMonaco(),this.setupResizeObserver(),await this.updateComplete,this.containerRef.value&&!this.editor&&!this.isLoading&&await this.createEditor()}disconnectedCallback(){super.disconnectedCallback(),this.disposeEditor(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null)}async loadMonaco(){if(this.monacoLoaded||window.monaco){this.monacoLoaded=!0,this.isLoading=!1;return}try{Te.debug("Loading Monaco Editor..."),await ui(),this.monacoLoaded=!0,this.isLoading=!1,Te.debug("Monaco Editor loaded successfully")}catch(e){Te.error("Failed to load Monaco Editor:",e),this.isLoading=!1}}setupResizeObserver(){this.resizeObserver=new ResizeObserver(e=>{for(let s of e){if(this.containerWidth=s.contentRect.width,this.mode==="diff"&&this.editor){let b=this.containerWidth<768?"inline":"sideBySide";b!==this.diffMode&&(this.diffMode=b,this.recreateEditor())}this.editor&&this.editor.layout()}}),this.containerRef.value&&this.resizeObserver.observe(this.containerRef.value)}async updated(e){super.updated(e),(e.has("mode")||e.has("content")&&!this.editor||e.has("originalContent")&&this.mode==="diff"||e.has("modifiedContent")&&this.mode==="diff")&&!this.isLoading&&this.containerRef.value?await this.recreateEditor():this.editor&&!this.isLoading&&(e.has("content")&&this.mode==="normal"&&this.updateContent(),(e.has("language")||e.has("filename"))&&this.updateLanguage(),e.has("readOnly")&&this.updateReadOnly())}async recreateEditor(){this.disposeEditor(),await this.createEditor()}async createEditor(){if(!(!this.containerRef.value||!window.monaco))try{this.setupTheme();let e={theme:"vs-dark",automaticLayout:!0,fontSize:14,fontFamily:"'Fira Code', Menlo, Monaco, 'Courier New', monospace",fontLigatures:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,renderWhitespace:"selection",readOnly:this.readOnly,folding:!0,foldingStrategy:"indentation",foldingHighlight:!0,showFoldingControls:"always",renderLineHighlight:"all",renderLineHighlightOnlyWhenFocus:!1,...this.options};if(this.mode==="diff"){let s={readOnly:!0,automaticLayout:!0,scrollBeyondLastLine:!1,minimap:{enabled:!1},renderWhitespace:"selection",renderSideBySide:this.diffMode==="sideBySide",ignoreTrimWhitespace:!1};this.editor=window.monaco.editor.createDiffEditor(this.containerRef.value,s);let d=this.detectLanguage(),b=Date.now(),S=`${this.filename||"untitled"}-${b}`,r=window.monaco.editor.createModel(this.originalContent||"",d,window.monaco.Uri.parse(`file:///${S}#original`)),h=window.monaco.editor.createModel(this.modifiedContent||"",d,window.monaco.Uri.parse(`file:///${S}#modified`));Te.debug("Creating diff editor");let g=this.editor;g.setModel({original:r,modified:h});let p=()=>{this.editor&&this.editor.layout()},n=g.onDidUpdateDiff(()=>{p(),n.dispose()});setTimeout(p,200)}else this.editor=window.monaco.editor.create(this.containerRef.value,{...e,value:this.content,language:this.detectLanguage()}),this.readOnly||(this.editor.addCommand(window.monaco.KeyMod.CtrlCmd|window.monaco.KeyCode.KeyS,()=>{this.handleSave()}),this.editor.onDidChangeModelContent(()=>{let s=this.editor?.getValue()||"";this.dispatchEvent(new CustomEvent("content-changed",{detail:{content:s},bubbles:!0,composed:!0}))}));Te.debug(`Created ${this.mode} editor`)}catch(e){Te.error("Failed to create editor:",e)}}setupTheme(){window.monaco}detectLanguage(){if(this.language)return this.language;if(this.filename){let e=this.filename.split(".").pop()?.toLowerCase();return{js:"javascript",jsx:"javascript",ts:"typescript",tsx:"typescript",json:"json",html:"html",htm:"html",css:"css",scss:"scss",sass:"sass",less:"less",py:"python",rb:"ruby",go:"go",rs:"rust",java:"java",c:"c",cpp:"cpp",cs:"csharp",php:"php",swift:"swift",kt:"kotlin",scala:"scala",r:"r",sql:"sql",sh:"shell",bash:"shell",zsh:"shell",fish:"shell",ps1:"powershell",yml:"yaml",yaml:"yaml",xml:"xml",md:"markdown",markdown:"markdown",dockerfile:"dockerfile",makefile:"makefile",gitignore:"gitignore"}[e||""]||"plaintext"}return"plaintext"}updateContent(){if(!this.editor||this.mode==="diff")return;this.editor.getValue()!==this.content&&this.editor.setValue(this.content)}updateLanguage(){if(!this.editor||!window.monaco)return;let e=this.detectLanguage();if(this.mode==="normal"){let s=this.editor.getModel();s&&window.monaco.editor.setModelLanguage(s,e)}else{let s=this.editor,d=s.getOriginalEditor().getModel(),b=s.getModifiedEditor().getModel();d&&window.monaco.editor.setModelLanguage(d,e),b&&window.monaco.editor.setModelLanguage(b,e)}}updateReadOnly(){this.editor&&(this.mode==="normal"?this.editor.updateOptions({readOnly:this.readOnly}):this.editor.getModifiedEditor().updateOptions({readOnly:this.readOnly}))}handleSave(){if(this.readOnly||!this.editor||this.mode==="diff")return;let e=this.editor.getValue();this.dispatchEvent(new CustomEvent("save",{detail:{content:e},bubbles:!0,composed:!0}))}toggleDiffMode(){if(this.mode!=="diff")return;this.diffMode=this.diffMode==="inline"?"sideBySide":"inline";let e="",s="";if(this.editor){let b=this.editor.getModel();b&&(e=b.original?.getValue()||this.originalContent||"",s=b.modified?.getValue()||this.modifiedContent||"")}this.originalContent=e,this.modifiedContent=s,this.recreateEditor()}disposeEditor(){if(this.editor){if(this.mode==="diff"){let e=this.editor,s=e.getModel();e.setModel(null),s&&setTimeout(()=>{s.original?.dispose(),s.modified?.dispose()},0)}this.editor.dispose(),this.editor=null}}render(){return te`
      <div
        class="monaco-editor-root"
        style="display: block; width: 100%; height: 100%; position: relative;"
      >
        <div
          class="editor-container"
          ${st(this.containerRef)}
          style="width: 100%; height: 100%; position: relative; background: rgb(var(--color-bg-secondary));"
        >
          ${this.isLoading?te`
                <div
                  class="loading"
                  style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: rgb(var(--color-text-muted)); font-family: ui-monospace, monospace;"
                >
                  Loading editor...
                </div>
              `:""}
          ${this.showModeToggle&&this.mode==="diff"&&!this.isLoading?te`
                <button
                  class="mode-toggle"
                  style="position: absolute; top: 10px; right: 10px; z-index: 10; background: rgb(var(--color-surface)); border: 1px solid rgb(var(--color-border)); color: rgb(var(--color-text)); padding: 4px 8px; border-radius: 4px; font-size: 12px; cursor: pointer;"
                  @click=${this.toggleDiffMode}
                  title="Toggle between inline and side-by-side diff"
                  @mouseenter=${e=>{let s=e.target;s.style.background="rgb(var(--color-surface-hover))",s.style.borderColor="rgb(var(--color-border-focus))"}}
                  @mouseleave=${e=>{let s=e.target;s.style.background="rgb(var(--color-surface))",s.style.borderColor="rgb(var(--color-border))"}}
                >
                  ${this.diffMode==="inline"?"Side by Side":"Inline"}
                </button>
              `:""}
        </div>
      </div>
    `}};O([q({type:String})],J.prototype,"content",2),O([q({type:String})],J.prototype,"originalContent",2),O([q({type:String})],J.prototype,"modifiedContent",2),O([q({type:String})],J.prototype,"language",2),O([q({type:String})],J.prototype,"filename",2),O([q({type:Boolean})],J.prototype,"readOnly",2),O([q({type:String})],J.prototype,"mode",2),O([q({type:Boolean})],J.prototype,"showModeToggle",2),O([q({type:Object})],J.prototype,"options",2),O([V()],J.prototype,"isLoading",2),O([V()],J.prototype,"diffMode",2),O([V()],J.prototype,"containerWidth",2),J=O([de("monaco-editor")],J);var se=class extends ee{constructor(){super(...arguments);this.mode="diff";this.readOnly=!1;this.showModeToggle=!0;this.language="typescript";this.content="";this.originalContent="";this.modifiedContent="";this.savedContent="";this.sampleCode={typescript:`// TypeScript Example
interface User {
  id: number;
  name: string;
  email: string;
  isActive: boolean;
}

class UserService {
  private users: User[] = [];

  async getUser(id: number): Promise<User | undefined> {
    return this.users.find(user => user.id === id);
  }

  async createUser(user: Omit<User, 'id'>): Promise<User> {
    const newUser: User = {
      ...user,
      id: this.users.length + 1
    };
    this.users.push(newUser);
    return newUser;
  }
}

export default UserService;`,javascript:`// JavaScript Example
class Calculator {
  constructor() {
    this.result = 0;
  }

  add(a, b) {
    this.result = a + b;
    return this.result;
  }

  subtract(a, b) {
    this.result = a - b;
    return this.result;
  }

  multiply(a, b) {
    this.result = a * b;
    return this.result;
  }

  divide(a, b) {
    if (b === 0) {
      throw new Error('Division by zero');
    }
    this.result = a / b;
    return this.result;
  }
}

module.exports = Calculator;`,python:`# Python Example
import asyncio
from typing import List, Optional

class TaskManager:
    def __init__(self):
        self.tasks: List[asyncio.Task] = []
        self.results: List[any] = []
    
    async def add_task(self, coro):
        """Add a coroutine as a task"""
        task = asyncio.create_task(coro)
        self.tasks.append(task)
        return task
    
    async def wait_all(self) -> List[any]:
        """Wait for all tasks to complete"""
        if not self.tasks:
            return []
        
        self.results = await asyncio.gather(*self.tasks)
        return self.results
    
    def cancel_all(self):
        """Cancel all pending tasks"""
        for task in self.tasks:
            if not task.done():
                task.cancel()

# Example usage
async def main():
    manager = TaskManager()
    await manager.add_task(asyncio.sleep(1))
    await manager.wait_all()`,json:`{
  "name": "monaco-editor-test",
  "version": "1.0.0",
  "description": "Monaco Editor test component",
  "dependencies": {
    "monaco-editor": "^0.52.2",
    "lit": "^3.3.0"
  },
  "scripts": {
    "test": "echo 'Error: no test specified' && exit 1",
    "build": "tsc && vite build",
    "dev": "vite"
  },
  "keywords": ["monaco", "editor", "test"],
  "author": "VibeTunnel Team",
  "license": "MIT"
}`}}createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),this.loadSampleContent()}loadSampleContent(){let e=this.sampleCode[this.language]||this.sampleCode.typescript;this.content=e,this.originalContent=e,this.modifiedContent=`${e}

// Modified by user
console.log("Changes made!");`}handleModeChange(e){this.mode=e,this.loadSampleContent()}handleLanguageChange(e){let s=e.target;this.language=s.value,this.loadSampleContent()}handleSave(e){this.savedContent=e.detail.content,console.log("Content saved:",this.savedContent),alert("Content saved! Check console for details.")}handleContentChanged(e){console.log("Content changed:",e.detail.content)}render(){return te`
      <div class="h-screen flex flex-col bg-background text-foreground">
        <div class="bg-surface border-b border-gray-800 p-4">
          <h1 class="text-2xl font-bold text-emerald-400 mb-4">Monaco Editor Test</h1>
          <div class="flex gap-3 flex-wrap items-center">
            <span class="text-sm text-gray-400">Mode:</span>
            <button
              class="${this.mode==="normal"?"bg-emerald-500 text-background":"bg-gray-800 hover:bg-gray-700 text-foreground"} px-3 py-1.5 border ${this.mode==="normal"?"border-emerald-500":"border-gray-700 hover:border-emerald-400"} rounded text-sm transition-colors"
              @click=${()=>this.handleModeChange("normal")}
            >
              Normal
            </button>
            <button
              class="${this.mode==="diff"?"bg-emerald-500 text-background":"bg-gray-800 hover:bg-gray-700 text-foreground"} px-3 py-1.5 border ${this.mode==="diff"?"border-emerald-500":"border-gray-700 hover:border-emerald-400"} rounded text-sm transition-colors"
              @click=${()=>this.handleModeChange("diff")}
            >
              Diff
            </button>

            <span class="text-sm text-gray-400 ml-4">Language:</span>
            <select
              @change=${this.handleLanguageChange}
              .value=${this.language}
              class="px-3 py-1.5 bg-gray-800 text-foreground border border-gray-700 hover:border-emerald-400 rounded text-sm cursor-pointer focus:outline-none focus:border-emerald-400"
            >
              <option value="typescript">TypeScript</option>
              <option value="javascript">JavaScript</option>
              <option value="python">Python</option>
              <option value="json">JSON</option>
            </select>

            <label class="flex items-center gap-2 ml-4 text-sm cursor-pointer">
              <input
                type="checkbox"
                .checked=${this.readOnly}
                @change=${e=>{this.readOnly=e.target.checked}}
                class="w-4 h-4 rounded border-gray-700 bg-gray-800 text-emerald-500 focus:ring-emerald-400 focus:ring-offset-0"
              />
              <span>Read Only</span>
            </label>

            ${this.mode==="diff"?te`
                  <label class="flex items-center gap-2 ml-4 text-sm cursor-pointer">
                    <input
                      type="checkbox"
                      .checked=${this.showModeToggle}
                      @change=${e=>{this.showModeToggle=e.target.checked}}
                      class="w-4 h-4 rounded border-gray-700 bg-gray-800 text-emerald-500 focus:ring-emerald-400 focus:ring-offset-0"
                    />
                    <span>Show Mode Toggle</span>
                  </label>
                `:""}
          </div>
        </div>

        <div class="flex-1 relative overflow-hidden border border-gray-800 m-4 rounded-lg">
          <div
            class="absolute top-4 right-4 bg-black/80 border border-gray-800 rounded px-3 py-1.5 text-xs"
            style="z-index: ${$e.TERMINAL_OVERLAY};"
          >
            <div>Mode: <code class="text-emerald-400">${this.mode}</code></div>
            <div>Language: <code class="text-emerald-400">${this.language}</code></div>
            <div>Read Only: <code class="text-emerald-400">${this.readOnly}</code></div>
          </div>

          <monaco-editor
            .mode=${this.mode}
            .content=${this.content}
            .originalContent=${this.originalContent}
            .modifiedContent=${this.modifiedContent}
            .language=${this.language}
            .readOnly=${this.readOnly}
            .showModeToggle=${this.showModeToggle}
            @save=${this.handleSave}
            @content-changed=${this.handleContentChanged}
            style="width: 100%; height: 100%;"
          ></monaco-editor>
        </div>
      </div>
    `}};O([V()],se.prototype,"mode",2),O([V()],se.prototype,"readOnly",2),O([V()],se.prototype,"showModeToggle",2),O([V()],se.prototype,"language",2),O([V()],se.prototype,"content",2),O([V()],se.prototype,"originalContent",2),O([V()],se.prototype,"modifiedContent",2),O([V()],se.prototype,"savedContent",2),se=O([de("monaco-editor-test")],se);
/*! Bundled license information:

@lit/reactive-element/css-tag.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

@lit/reactive-element/reactive-element.js:
lit-html/lit-html.js:
lit-element/lit-element.js:
@lit/reactive-element/decorators/custom-element.js:
@lit/reactive-element/decorators/property.js:
@lit/reactive-element/decorators/state.js:
@lit/reactive-element/decorators/event-options.js:
@lit/reactive-element/decorators/base.js:
@lit/reactive-element/decorators/query.js:
@lit/reactive-element/decorators/query-all.js:
@lit/reactive-element/decorators/query-async.js:
@lit/reactive-element/decorators/query-assigned-nodes.js:
lit-html/directive.js:
lit-html/async-directive.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

lit-html/is-server.js:
  (**
   * @license
   * Copyright 2022 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

@lit/reactive-element/decorators/query-assigned-elements.js:
  (**
   * @license
   * Copyright 2021 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

lit-html/directive-helpers.js:
lit-html/directives/ref.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)
*/
