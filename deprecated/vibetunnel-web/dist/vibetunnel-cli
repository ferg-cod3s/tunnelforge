#!/usr/bin/env node
var Py=Object.create;var Sa=Object.defineProperty;var Ty=Object.getOwnPropertyDescriptor;var Iy=Object.getOwnPropertyNames;var Ey=Object.getPrototypeOf,Cy=Object.prototype.hasOwnProperty;var Be=(n,e)=>()=>(n&&(e=n(n=0)),e);var co=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),Et=(n,e)=>{for(var r in e)Sa(n,r,{get:e[r],enumerable:!0})},Ny=(n,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of Iy(e))!Cy.call(n,t)&&t!==r&&Sa(n,t,{get:()=>e[t],enumerable:!(i=Ty(e,t))||i.enumerable});return n};var C=(n,e,r)=>(r=n!=null?Py(Ey(n)):{},Ny(e||!n||!n.__esModule?Sa(r,"default",{value:n,enumerable:!0}):r,n));function zy(){let n=new Map;for(let[e,r]of Object.entries(be)){for(let[i,t]of Object.entries(r))be[i]={open:`\x1B[${t[0]}m`,close:`\x1B[${t[1]}m`},r[i]=be[i],n.set(t[0],t[1]);Object.defineProperty(be,e,{value:r,enumerable:!1})}return Object.defineProperty(be,"codes",{value:n,enumerable:!1}),be.color.close="\x1B[39m",be.bgColor.close="\x1B[49m",be.color.ansi=zf(),be.color.ansi256=Df(),be.color.ansi16m=Rf(),be.bgColor.ansi=zf(10),be.bgColor.ansi256=Df(10),be.bgColor.ansi16m=Rf(10),Object.defineProperties(be,{rgbToAnsi256:{value(e,r,i){return e===r&&r===i?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(r/255*5)+Math.round(i/255*5)},enumerable:!1},hexToRgb:{value(e){let r=/[a-f\d]{6}|[a-f\d]{3}/i.exec(e.toString(16));if(!r)return[0,0,0];let[i]=r;i.length===3&&(i=[...i].map(o=>o+o).join(""));let t=Number.parseInt(i,16);return[t>>16&255,t>>8&255,t&255]},enumerable:!1},hexToAnsi256:{value:e=>be.rgbToAnsi256(...be.hexToRgb(e)),enumerable:!1},ansi256ToAnsi:{value(e){if(e<8)return 30+e;if(e<16)return 90+(e-8);let r,i,t;if(e>=232)r=((e-232)*10+8)/255,i=r,t=r;else{e-=16;let a=e%36;r=Math.floor(e/36)/5,i=Math.floor(a/6)/5,t=a%6/5}let o=Math.max(r,i,t)*2;if(o===0)return 30;let s=30+(Math.round(t)<<2|Math.round(i)<<1|Math.round(r));return o===2&&(s+=60),s},enumerable:!1},rgbToAnsi:{value:(e,r,i)=>be.ansi256ToAnsi(be.rgbToAnsi256(e,r,i)),enumerable:!1},hexToAnsi:{value:e=>be.ansi256ToAnsi(be.hexToAnsi256(e)),enumerable:!1}}),be}var zf,Df,Rf,be,Dk,jy,Ay,Rk,Dy,Ct,Of=Be(()=>{zf=(n=0)=>e=>`\x1B[${e+n}m`,Df=(n=0)=>e=>`\x1B[${38+n};5;${e}m`,Rf=(n=0)=>(e,r,i)=>`\x1B[${38+n};2;${e};${r};${i}m`,be={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],gray:[90,39],grey:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgGray:[100,49],bgGrey:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}},Dk=Object.keys(be.modifier),jy=Object.keys(be.color),Ay=Object.keys(be.bgColor),Rk=[...jy,...Ay];Dy=zy(),Ct=Dy});function wt(n,e=globalThis.Deno?globalThis.Deno.args:uo.default.argv){let r=n.startsWith("-")?"":n.length===1?"-":"--",i=e.indexOf(r+n),t=e.indexOf("--");return i!==-1&&(t===-1||i<t)}function Ry(){if("FORCE_COLOR"in ke)return ke.FORCE_COLOR==="true"?1:ke.FORCE_COLOR==="false"?0:ke.FORCE_COLOR.length===0?1:Math.min(Number.parseInt(ke.FORCE_COLOR,10),3)}function Oy(n){return n===0?!1:{level:n,hasBasic:!0,has256:n>=2,has16m:n>=3}}function My(n,{streamIsTTY:e,sniffFlags:r=!0}={}){let i=Ry();i!==void 0&&(lo=i);let t=r?lo:i;if(t===0)return 0;if(r){if(wt("color=16m")||wt("color=full")||wt("color=truecolor"))return 3;if(wt("color=256"))return 2}if("TF_BUILD"in ke&&"AGENT_NAME"in ke)return 1;if(n&&!e&&t===void 0)return 0;let o=t||0;if(ke.TERM==="dumb")return o;if(uo.default.platform==="win32"){let s=Uf.default.release().split(".");return Number(s[0])>=10&&Number(s[2])>=10586?Number(s[2])>=14931?3:2:1}if("CI"in ke)return["GITHUB_ACTIONS","GITEA_ACTIONS","CIRCLECI"].some(s=>s in ke)?3:["TRAVIS","APPVEYOR","GITLAB_CI","BUILDKITE","DRONE"].some(s=>s in ke)||ke.CI_NAME==="codeship"?1:o;if("TEAMCITY_VERSION"in ke)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(ke.TEAMCITY_VERSION)?1:0;if(ke.COLORTERM==="truecolor"||ke.TERM==="xterm-kitty")return 3;if("TERM_PROGRAM"in ke){let s=Number.parseInt((ke.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(ke.TERM_PROGRAM){case"iTerm.app":return s>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(ke.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(ke.TERM)||"COLORTERM"in ke?1:o}function Mf(n,e={}){let r=My(n,{streamIsTTY:n&&n.isTTY,...e});return Oy(r)}var uo,Uf,$a,ke,lo,Uy,Ff,Lf=Be(()=>{uo=C(require("node:process"),1),Uf=C(require("node:os"),1),$a=C(require("node:tty"),1);({env:ke}=uo.default);wt("no-color")||wt("no-colors")||wt("color=false")||wt("color=never")?lo=0:(wt("color")||wt("colors")||wt("color=true")||wt("color=always"))&&(lo=1);Uy={stdout:Mf({isTTY:$a.default.isatty(1)}),stderr:Mf({isTTY:$a.default.isatty(2)})},Ff=Uy});function Bf(n,e,r){let i=n.indexOf(e);if(i===-1)return n;let t=e.length,o=0,s="";do s+=n.slice(o,i)+e+r,o=i+t,i=n.indexOf(e,o);while(i!==-1);return s+=n.slice(o),s}function Wf(n,e,r,i){let t=0,o="";do{let s=n[i-1]==="\r";o+=n.slice(t,s?i-1:i)+e+(s?`\r
`:`
`)+r,t=i+1,i=n.indexOf(`
`,t)}while(i!==-1);return o+=n.slice(t),o}var Zf=Be(()=>{});function ri(n){return Ly(n)}var Vf,Gf,xa,dn,ti,Hf,fn,Fy,Ly,ka,By,Wy,_a,fo,Zy,Vy,Wk,v,Fe=Be(()=>{Of();Lf();Zf();({stdout:Vf,stderr:Gf}=Ff),xa=Symbol("GENERATOR"),dn=Symbol("STYLER"),ti=Symbol("IS_EMPTY"),Hf=["ansi","ansi","ansi256","ansi16m"],fn=Object.create(null),Fy=(n,e={})=>{if(e.level&&!(Number.isInteger(e.level)&&e.level>=0&&e.level<=3))throw new Error("The `level` option should be an integer from 0 to 3");let r=Vf?Vf.level:0;n.level=e.level===void 0?r:e.level},Ly=n=>{let e=(...r)=>r.join(" ");return Fy(e,n),Object.setPrototypeOf(e,ri.prototype),e};Object.setPrototypeOf(ri.prototype,Function.prototype);for(let[n,e]of Object.entries(Ct))fn[n]={get(){let r=fo(this,_a(e.open,e.close,this[dn]),this[ti]);return Object.defineProperty(this,n,{value:r}),r}};fn.visible={get(){let n=fo(this,this[dn],!0);return Object.defineProperty(this,"visible",{value:n}),n}};ka=(n,e,r,...i)=>n==="rgb"?e==="ansi16m"?Ct[r].ansi16m(...i):e==="ansi256"?Ct[r].ansi256(Ct.rgbToAnsi256(...i)):Ct[r].ansi(Ct.rgbToAnsi(...i)):n==="hex"?ka("rgb",e,r,...Ct.hexToRgb(...i)):Ct[r][n](...i),By=["rgb","hex","ansi256"];for(let n of By){fn[n]={get(){let{level:r}=this;return function(...i){let t=_a(ka(n,Hf[r],"color",...i),Ct.color.close,this[dn]);return fo(this,t,this[ti])}}};let e="bg"+n[0].toUpperCase()+n.slice(1);fn[e]={get(){let{level:r}=this;return function(...i){let t=_a(ka(n,Hf[r],"bgColor",...i),Ct.bgColor.close,this[dn]);return fo(this,t,this[ti])}}}}Wy=Object.defineProperties(()=>{},{...fn,level:{enumerable:!0,get(){return this[xa].level},set(n){this[xa].level=n}}}),_a=(n,e,r)=>{let i,t;return r===void 0?(i=n,t=e):(i=r.openAll+n,t=e+r.closeAll),{open:n,close:e,openAll:i,closeAll:t,parent:r}},fo=(n,e,r)=>{let i=(...t)=>Zy(i,t.length===1?""+t[0]:t.join(" "));return Object.setPrototypeOf(i,Wy),i[xa]=n,i[dn]=e,i[ti]=r,i},Zy=(n,e)=>{if(n.level<=0||!e)return n[ti]?"":e;let r=n[dn];if(r===void 0)return e;let{openAll:i,closeAll:t}=r;if(e.includes("\x1B"))for(;r!==void 0;)e=Bf(e,r.close,r.open),r=r.parent;let o=e.indexOf(`
`);return o!==-1&&(e=Wf(e,t,i,o)),i+e+t};Object.defineProperties(ri.prototype,fn);Vy=ri(),Wk=ri({level:Gf?Gf.level:0}),v=Vy});function Jf(n){ot&&(ot.end(),ot=null),hn=n;let e=ni.dirname(hn);St.existsSync(e)||St.mkdirSync(e,{recursive:!0});try{ot=St.createWriteStream(hn,{flags:"a"})}catch(r){console.error("Failed to open log file at new location:",r)}}function mo(n){let e=n.toLowerCase();return Gy[e]}function po(n=!1,e){if(Ta=n,e!==void 0?er=e:n&&(er=5),!ot)try{St.existsSync(Pa)||St.mkdirSync(Pa,{recursive:!0});try{St.existsSync(hn)&&St.unlinkSync(hn)}catch{}ot=St.createWriteStream(hn,{flags:"a"})}catch(r){console.error("Failed to initialize log file:",r)}}function Kf(){return new Promise(n=>{ot&&!ot.destroyed?ot.write("",()=>{n()}):n()})}function he(){ot&&(ot.end(),ot=null)}function mn(n,e,r){let i=new Date().toISOString(),t=r.map(l=>{if(typeof l=="object")try{return JSON.stringify(l,null,2)}catch{return String(l)}return String(l)}).join(" "),o,s=v.cyan(`[${e}]`),a=v.gray(i);switch(n){case"ERROR":o=`${a} ${v.red(n)} ${s} ${v.red(t)}`;break;case"WARN":o=`${a} ${v.yellow(n)}  ${s} ${v.yellow(t)}`;break;case"DEBUG":o=`${a} ${v.magenta(n)} ${s} ${v.gray(t)}`;break;default:o=`${a} ${v.green(n)}   ${s} ${t}`}let c=`${i} ${n.padEnd(5)} [${e}] ${t}`;return{console:o,file:c}}function pn(n){if(ot)try{let e=n.replace(Hy,"");ot.write(`${e}
`)}catch{}}function Ia(n){Ta=n,n&&(er=5)}function Ea(n){er=n,Ta=n>=5}function Ca(){return er>=5}function gn(n){switch(n){case"ERROR":return er>=1;case"WARN":return er>=2;case"LOG":return er>=3;case"DEBUG":return er>=5;default:return!0}}function Qf(n,e,r){let{console:i,file:t}=mn(n,e,r);if(pn(t),!!gn(n))switch(n){case"ERROR":console.error(i);break;case"WARN":console.warn(i);break;default:console.log(i)}}function T(n){let e=n.startsWith("[")?n:`[SRV] ${n}`;return{log:(...r)=>{let{console:i,file:t}=mn("LOG",e,r);pn(t),gn("LOG")&&console.log(i)},info:(...r)=>{let{console:i,file:t}=mn("LOG",e,r);pn(t),gn("LOG")&&console.log(i)},warn:(...r)=>{let{console:i,file:t}=mn("WARN",e,r);pn(t),gn("WARN")&&console.warn(i)},error:(...r)=>{let{console:i,file:t}=mn("ERROR",e,r);pn(t),gn("ERROR")&&console.error(i)},debug:(...r)=>{let{console:i,file:t}=mn("DEBUG",e,r);pn(t),gn("DEBUG")&&console.log(i)},setDebugMode:r=>Ia(r),setVerbosity:r=>Ea(r)}}var St,qf,ni,Pa,hn,ii,Gy,er,Ta,ot,Hy,W=Be(()=>{Fe();St=C(require("fs")),qf=C(require("os")),ni=C(require("path")),Pa=ni.join(qf.homedir(),".vibetunnel"),hn=ni.join(Pa,"log.txt");ii=(s=>(s[s.SILENT=0]="SILENT",s[s.ERROR=1]="ERROR",s[s.WARN=2]="WARN",s[s.INFO=3]="INFO",s[s.VERBOSE=4]="VERBOSE",s[s.DEBUG=5]="DEBUG",s))(ii||{}),Gy={silent:0,error:1,warn:2,info:3,verbose:4,debug:5},er=1,Ta=!1;ot=null,Hy=/\x1b\[[0-9;]*m/g});function am(n,e=0){return(Ze[n[e+0]]+Ze[n[e+1]]+Ze[n[e+2]]+Ze[n[e+3]]+"-"+Ze[n[e+4]]+Ze[n[e+5]]+"-"+Ze[n[e+6]]+Ze[n[e+7]]+"-"+Ze[n[e+8]]+Ze[n[e+9]]+"-"+Ze[n[e+10]]+Ze[n[e+11]]+Ze[n[e+12]]+Ze[n[e+13]]+Ze[n[e+14]]+Ze[n[e+15]]).toLowerCase()}var Ze,cm=Be(()=>{Ze=[];for(let n=0;n<256;++n)Ze.push((n+256).toString(16).slice(1))});function za(){return bo>wo.length-16&&((0,lm.randomFillSync)(wo),bo=0),wo.slice(bo,bo+=16)}var lm,wo,bo,um=Be(()=>{lm=require("crypto"),wo=new Uint8Array(256),bo=wo.length});var dm,Da,fm=Be(()=>{dm=require("crypto"),Da={randomUUID:dm.randomUUID}});function nb(n,e,r){if(Da.randomUUID&&!e&&!n)return Da.randomUUID();n=n||{};let i=n.random??n.rng?.()??za();if(i.length<16)throw new Error("Random bytes length must be >= 16");if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e){if(r=r||0,r<0||r+16>e.length)throw new RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let t=0;t<16;++t)e[r+t]=i[t];return e}return am(i)}var Nt,mm=Be(()=>{fm();um();cm();Nt=nb});var vn=Be(()=>{mm()});function Nm(n,e,r,i){return{id:crypto.randomUUID(),type:"request",category:n,action:e,payload:r,sessionId:i}}function Tr(n,e,r){return{id:n.id,type:"response",category:n.category,action:n.action,payload:e,sessionId:n.sessionId,error:r}}function Je(n,e,r,i){return{id:crypto.randomUUID(),type:"event",category:n,action:e,payload:r,sessionId:i}}var $n=Be(()=>{});var zm={};Et(zm,{ControlUnixHandler:()=>$o,controlUnixHandler:()=>ee});var jm,nr,Am,Ma,O,Ua,Fa,$o,ee,Ir=Be(()=>{jm=C(require("node:child_process")),nr=C(require("node:fs")),Am=C(require("node:net")),Ma=C(require("node:path"));vn();W();$n();O=T("control-unix"),Ua=class{async handleMessage(e){if(O.log(`Terminal handler: ${e.action}`),e.action==="spawn"){let r=e.payload;try{let i=["launch"];return r.workingDirectory&&i.push("--working-directory",r.workingDirectory),r.command&&i.push("--command",r.command),i.push("--session-id",r.sessionId),r.terminalPreference&&i.push("--terminal",r.terminalPreference),O.log(`Spawning terminal with args: ${i.join(" ")}`),jm.spawn("vibetunnel",i,{detached:!0,stdio:"ignore"}).unref(),Tr(e,{success:!0})}catch(i){return O.error("Failed to spawn terminal:",i),Tr(e,null,i instanceof Error?i.message:"Failed to spawn terminal")}}return Tr(e,null,`Unknown terminal action: ${e.action}`)}},Fa=class{async handleMessage(e){switch(O.log(`System handler: ${e.action}, type: ${e.type}, id: ${e.id}`),e.action){case"ping":return null;case"ready":return null;default:return O.warn(`Unknown system action: ${e.action}`),Tr(e,null,`Unknown action: ${e.action}`)}}},$o=class{pendingRequests=new Map;macSocket=null;unixServer=null;socketPath;handlers=new Map;messageBuffer=Buffer.alloc(0);constructor(){let e=process.env.HOME||"/tmp",i=process.env.VIBETUNNEL_CONTROL_DIR||Ma.join(e,".vibetunnel");try{nr.mkdirSync(i,{recursive:!0})}catch{}this.socketPath=Ma.join(i,"control.sock"),this.handlers.set("terminal",new Ua),this.handlers.set("system",new Fa)}async start(){O.log("\u{1F680} Starting control Unix socket handler"),O.log(`\u{1F4C2} Socket path: ${this.socketPath}`);try{nr.existsSync(this.socketPath)?(nr.unlinkSync(this.socketPath),O.log("\u{1F9F9} Removed existing stale socket file.")):O.log("\u2705 No existing socket file found")}catch(e){O.warn("\u26A0\uFE0F Failed to remove stale socket file:",e)}this.unixServer=Am.createServer(e=>{this.handleMacConnection(e)}),await new Promise((e,r)=>{this.unixServer?.listen(this.socketPath,()=>{O.log(`Control UNIX socket server listening at ${this.socketPath}`),nr.chmod(this.socketPath,384,i=>{i?O.error("Failed to set socket permissions:",i):O.log("Socket permissions set to 0600 (owner read/write only)")}),e()}),this.unixServer?.on("error",i=>{O.error("UNIX socket server error:",i),r(i)})})}stop(){this.macSocket&&(this.macSocket.destroy(),this.macSocket=null),this.unixServer&&(this.unixServer.close(),this.unixServer=null);try{nr.unlinkSync(this.socketPath)}catch{}}isMacAppConnected(){return this.macSocket!==null&&!this.macSocket.destroyed}handleMacConnection(e){O.log("\u{1F50C} New Mac connection via UNIX socket"),O.log(`\u{1F50D} Socket info: local=${e.localAddress}, remote=${e.remoteAddress}`),this.macSocket&&(O.log("\u26A0\uFE0F Closing existing Mac connection"),this.macSocket.destroy()),this.macSocket=e,O.log("\u2705 Mac socket stored"),e.setNoDelay(!0),O.log("\u2705 Socket options set: NoDelay=true");let r=1024*1024;try{let i=e;i._readableState&&(i._readableState.highWaterMark=r,O.log(`Set socket receive buffer to ${r} bytes`))}catch(i){O.warn("Failed to set socket buffer size:",i)}e.on("data",i=>{if(this.messageBuffer=Buffer.concat([this.messageBuffer,i]),O.log(`\u{1F4E5} Received from Mac: ${i.length} bytes, buffer size: ${this.messageBuffer.length}`),i.length>0){let t=i.subarray(0,Math.min(i.length,50));O.debug(`\u{1F4CB} Data preview (first ${t.length} bytes):`,t.toString("hex"))}for(;!(this.messageBuffer.length<4);){let t=this.messageBuffer.readUInt32BE(0);if(t<=0){O.error(`Invalid message length: ${t}`),this.messageBuffer=Buffer.alloc(0);break}let o=10*1024*1024;if(t>o){O.error(`Message too large: ${t} bytes (max: ${o})`),this.messageBuffer=Buffer.alloc(0);break}if(this.messageBuffer.length<4+t){O.debug(`Waiting for more data: have ${this.messageBuffer.length}, need ${4+t}`);break}let s=this.messageBuffer.subarray(4,4+t);this.messageBuffer=this.messageBuffer.subarray(4+t);try{let a=s.toString("utf-8");O.debug(`\u{1F4E8} Parsing message (${t} bytes): ${a.substring(0,100)}...`);let c=JSON.parse(a);O.log(`\u2705 Parsed Mac message: category=${c.category}, action=${c.action}, id=${c.id}`),this.handleMacMessage(c)}catch(a){O.error("\u274C Failed to parse Mac message:",a),O.error("Message length:",t),O.error("Raw message buffer:",s.toString("utf-8"))}}}),e.on("error",i=>{O.error("\u274C Mac socket error:",i);let t=i;O.error("Error details:",{code:t.code,syscall:t.syscall,errno:t.errno,message:t.message}),(t.code==="EPIPE"||t.code==="ECONNRESET")&&O.error("\u{1F534} Connection broken - Mac app likely closed the connection")}),e.on("close",i=>{O.log(`\u{1F50C} Mac disconnected (hadError: ${i})`),O.log(`\u{1F4CA} Socket state: destroyed=${e.destroyed}, readable=${e.readable}, writable=${e.writable}`),e===this.macSocket&&(this.macSocket=null,O.log("\u{1F9F9} Cleared Mac socket reference"))}),e.on("drain",()=>{O.log("Mac socket drained - ready for more data")}),e.on("end",()=>{O.log("\u{1F4F4} Mac socket received FIN packet (clean close)")}),O.log("\u{1F4E4} Sending initial system:ready event to Mac"),this.sendToMac(Je("system","ready")),O.log("\u2705 system:ready event sent")}handleBrowserConnection(e,r){O.log("\u{1F310} New browser WebSocket connection for control messages"),O.log(`\u{1F464} User ID: ${r||"unknown"}`),O.log(`\u{1F50C} Mac socket status on browser connect: ${this.macSocket?"CONNECTED":"NOT CONNECTED"}`),e.on("message",async i=>{try{let t=i.toString();O.log(`\u{1F4E8} Browser message received (${t.length} chars): ${t.substring(0,200)}...`);let o=JSON.parse(t);O.log(`\u{1F4E5} Parsed browser message - type: ${o.type}, category: ${o.category}, action: ${o.action}`),O.warn(`\u26A0\uFE0F Browser sent message for category: ${o.category}`)}catch(t){O.error("\u274C Failed to parse browser message:",t),e.send(JSON.stringify(Je("system","error",{error:t instanceof Error?t.message:String(t)})))}}),e.on("close",()=>{O.log("Browser disconnected")}),e.on("error",i=>{O.error("Browser WebSocket error:",i)})}async handleMacMessage(e){if(O.log(`Mac message - category: ${e.category}, action: ${e.action}, type: ${e.type}, id: ${e.id}`),e.category==="system"&&e.action==="ping"){let i=Tr(e,{status:"ok"});this.sendToMac(i);return}if(e.type==="response"&&this.pendingRequests.has(e.id)){let i=this.pendingRequests.get(e.id);i&&(O.debug(`Resolving pending request for id: ${e.id}`),this.pendingRequests.delete(e.id),i(e));return}if(e.type==="response"){O.debug(`Ignoring response message that has no pending request: ${e.id}, action: ${e.action}`);return}let r=this.handlers.get(e.category);if(!r){if(O.warn(`No handler for category: ${e.category}`),e.type==="request"){let i=Tr(e,null,`Unknown category: ${e.category}`);this.sendToMac(i)}return}try{let i=await r.handleMessage(e);i&&this.sendToMac(i)}catch(i){if(O.error(`Handler error for ${e.category}:${e.action}:`,i),e.type==="request"){let t=Tr(e,null,i instanceof Error?i.message:"Handler error");this.sendToMac(t)}}}async sendControlMessage(e){return this.isMacAppConnected()?new Promise(r=>{this.pendingRequests.set(e.id,r),this.sendToMac(e),setTimeout(()=>{this.pendingRequests.has(e.id)&&(this.pendingRequests.delete(e.id),r(null))},1e4)}):null}sendNotification(e,r,i){if(!this.macSocket){O.warn("[ControlUnixHandler] Cannot send notification - Mac app not connected");return}let t={id:Nt(),type:"event",category:"notification",action:"show",payload:{title:e,body:r,...i}};this.sendToMac(t),O.info("[ControlUnixHandler] Sent notification:",{title:e,body:r,options:i})}sendToMac(e){if(!this.macSocket){O.warn("\u26A0\uFE0F Cannot send to Mac - no socket connection");return}if(this.macSocket.destroyed){O.warn("\u26A0\uFE0F Cannot send to Mac - socket is destroyed"),this.macSocket=null;return}try{let r=JSON.stringify(e),i=Buffer.from(r,"utf-8"),t=Buffer.allocUnsafe(4);t.writeUInt32BE(i.length,0);let o=Buffer.concat([t,i]);O.log(`\u{1F4E4} Sending to Mac: ${e.category}:${e.action}, header: 4 bytes, payload: ${i.length} bytes, total: ${o.length} bytes`),O.log(`\u{1F4CB} Message ID being sent: ${e.id}`),O.debug(`\u{1F4DD} Message content: ${r.substring(0,200)}...`),(e.category==="system"||e.action==="get-initial-data")&&(O.debug(`\u{1F50D} Length header bytes: ${t.toString("hex")}`),O.debug(`\u{1F50D} First 50 bytes of full data: ${o.subarray(0,Math.min(50,o.length)).toString("hex")}`)),i.length>65536&&O.warn(`\u26A0\uFE0F Large message to Mac: ${i.length} bytes`),this.macSocket.write(o,a=>{a?(O.error("\u274C Error writing to Mac socket:",a),O.error("Error details:",{code:a.code,syscall:a.syscall,message:a.message}),this.macSocket?.destroy(),this.macSocket=null):O.debug("\u2705 Write to Mac socket completed successfully")})?O.debug("\u2705 Write immediate - no backpressure"):O.warn("\u26A0\uFE0F Socket write buffered - backpressure detected")}catch(r){O.error("\u274C Exception while sending to Mac:",r),this.macSocket?.destroy(),this.macSocket=null}}},ee=new $o});var Rm={};Et(Rm,{FishHandler:()=>xn,fishHandler:()=>gb});var La,Dm,xn,gb,Ba=Be(()=>{La=require("child_process"),Dm=C(require("path")),xn=class{async getCompletions(e,r=process.cwd()){return new Promise(i=>{try{let t=(0,La.spawn)("fish",["-c",`complete -C ${JSON.stringify(e)}`],{cwd:r,stdio:["ignore","pipe","ignore"]}),o="",s=setTimeout(()=>{t.kill("SIGTERM"),i([])},2e3);t.stdout?.on("data",a=>{o+=a.toString()}),t.on("close",a=>{if(clearTimeout(s),a!==0||!o.trim()){i([]);return}let c=o.split(`
`).filter(l=>l.trim()).map(l=>l.split("	")[0]).filter(l=>l&&l!==e);i(c)}),t.on("error",()=>{clearTimeout(s),i([])})}catch{i([])}})}static isFishShell(e){let r=Dm.default.basename(e);return r==="fish"||/^fish\d*$/.test(r)}static async getFishVersion(){return new Promise(e=>{try{let r=(0,La.spawn)("fish",["--version"],{stdio:["ignore","pipe","ignore"]}),i="",t=setTimeout(()=>{r.kill("SIGTERM"),e(null)},1e3);r.stdout?.on("data",o=>{i+=o.toString()}),r.on("close",o=>{clearTimeout(t),e(o===0&&i.trim()?i.trim():null)}),r.on("error",()=>{clearTimeout(t),e(null)})}catch{e(null)}})}},gb=new xn});function Ee(n,e){let r=Er.Buffer.isBuffer(e)?e:Er.Buffer.from(typeof e=="string"?e:JSON.stringify(e),"utf8"),i=Er.Buffer.allocUnsafe(5+r.length);return i[0]=n,i.writeUInt32BE(r.length,1),r.copy(i,5),i}function kn(n,e){switch(n){case 1:return e.toString("utf8");case 2:case 3:case 5:case 32:case 33:case 48:case 49:case 50:case 51:try{return JSON.parse(e.toString("utf8"))}catch(r){throw new Error(`Failed to parse JSON payload for message type ${n}: ${r instanceof Error?r.message:String(r)}`)}case 4:return null;default:return e}}var Er,At,Cr,de,li=Be(()=>{Er=require("buffer"),At=(p=>(p[p.STDIN_DATA=1]="STDIN_DATA",p[p.CONTROL_CMD=2]="CONTROL_CMD",p[p.STATUS_UPDATE=3]="STATUS_UPDATE",p[p.HEARTBEAT=4]="HEARTBEAT",p[p.ERROR=5]="ERROR",p[p.STDOUT_SUBSCRIBE=16]="STDOUT_SUBSCRIBE",p[p.METRICS=17]="METRICS",p[p.STATUS_REQUEST=32]="STATUS_REQUEST",p[p.STATUS_RESPONSE=33]="STATUS_RESPONSE",p[p.GIT_FOLLOW_REQUEST=48]="GIT_FOLLOW_REQUEST",p[p.GIT_FOLLOW_RESPONSE=49]="GIT_FOLLOW_RESPONSE",p[p.GIT_EVENT_NOTIFY=50]="GIT_EVENT_NOTIFY",p[p.GIT_EVENT_ACK=51]="GIT_EVENT_ACK",p))(At||{});Cr=class{buffer=Er.Buffer.alloc(0);addData(e){this.buffer=Er.Buffer.concat([this.buffer,e])}*parseMessages(){for(;this.buffer.length>=5;){let e=this.buffer[0],r=this.buffer.readUInt32BE(1);if(this.buffer.length<5+r)break;let i=this.buffer.subarray(5,5+r);this.buffer=this.buffer.subarray(5+r),yield{type:e,payload:i}}}get pendingBytes(){return this.buffer.length}clear(){this.buffer=Er.Buffer.alloc(0)}},de={stdin(n){return Ee(1,n)},resize(n,e){return Ee(2,{cmd:"resize",cols:n,rows:e})},kill(n){return Ee(2,{cmd:"kill",signal:n})},resetSize(){return Ee(2,{cmd:"reset-size"})},updateTitle(n){return Ee(2,{cmd:"update-title",title:n})},status(n,e,r){return Ee(3,{app:n,status:e,...r})},heartbeat(){return Ee(4,Er.Buffer.alloc(0))},error(n,e,r){return Ee(5,{code:n,message:e,details:r})},gitFollowRequest(n){return Ee(48,n)},gitFollowResponse(n){return Ee(49,n)},gitEventNotify(n){return Ee(50,n)},gitEventAck(n){return Ee(51,n)},statusRequest(){return Ee(32,{})},statusResponse(n){return Ee(33,n)}}});var Lm=co((q_,Fm)=>{var Wa=require("path"),hb=require("fs"),vb=[Wa.join(__dirname,"../node-pty"),Wa.join(__dirname,"../../node-pty"),Wa.join(__dirname,"../node_modules/node-pty"),"node-pty"],ui,Um;for(let n of vb)try{if((n==="node-pty"||hb.existsSync(n))&&(ui=require(n)),ui)break}catch(e){Um=e}if(!ui)throw new Error(`Failed to load node-pty from any location. Last error: ${Um?.message}`);Fm.exports=ui});var Gm,Hm,_n,Wr,Va=Be(()=>{Gm=require("events"),Hm=C(require("net"));W();li();_n=T("socket-client"),Wr=class extends Gm.EventEmitter{constructor(r,i={}){super();this.socketPath=r;this.options=i;r.length>103&&_n.warn(`Socket path may be too long (${r.length} chars): ${r}`)}socket;parser=new Cr;connected=!1;reconnectTimer;reconnectDelay=1e3;heartbeatInterval;lastHeartbeat=Date.now();connect(){return new Promise((r,i)=>{if(this.connected){r();return}this.socket=Hm.createConnection(this.socketPath),this.socket.setNoDelay(!0),this.socket.setKeepAlive(!0,0);let t=()=>{this.connected=!0,this.setupSocketHandlers(),this.emit("connect"),this.startHeartbeat(),s(),r()},o=a=>{s(),this.socket?.destroy(),this.socket=void 0,i(a)},s=()=>{this.socket?.off("connect",t),this.socket?.off("error",o)};this.socket.once("connect",t),this.socket.once("error",o)})}setupSocketHandlers(){this.socket&&(this.socket.on("data",r=>{this.parser.addData(r);for(let{type:i,payload:t}of this.parser.parseMessages())this.handleMessage(i,t)}),this.socket.on("close",()=>{this.handleDisconnect()}),this.socket.on("error",r=>{_n.error(`Socket error on ${this.socketPath}:`,r),this.emit("error",r)}))}handleMessage(r,i){try{let t=kn(r,i);this.emit(At[r],t),r===4&&(this.lastHeartbeat=Date.now(),this.sendHeartbeat())}catch(t){_n.error("Failed to parse message:",t)}}handleDisconnect(r){this.connected=!1,this.stopHeartbeat(),this.emit("disconnect",r),this.options.autoReconnect&&!this.reconnectTimer&&(this.reconnectTimer=setTimeout(()=>{this.reconnectTimer=void 0,this.connect().catch(i=>{_n.debug(`Reconnection failed: ${i.message}`),this.handleDisconnect(i)})},this.reconnectDelay))}startHeartbeat(){this.options.heartbeatInterval&&(this.heartbeatInterval=setInterval(()=>{this.sendHeartbeat()},this.options.heartbeatInterval))}stopHeartbeat(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=void 0)}sendStdin(r){return this.send(de.stdin(r))}resize(r,i){return this.send(de.resize(r,i))}kill(r){return this.send(de.kill(r))}resetSize(){return this.send(de.resetSize())}updateTitle(r){return this.send(de.updateTitle(r))}sendStatus(r,i,t){return this.send(de.status(r,i,t))}sendMessage(r,i){let t=this.buildMessage(r,i);return this.send(t)}async sendMessageWithResponse(r,i,t,o=5e3){return new Promise((s,a)=>{let c=setTimeout(()=>{this.off(At[t],l),this.off("error",u),a(new Error(`Request timeout waiting for ${At[t]}`))},o),l=f=>{clearTimeout(c),this.off("error",u),s(f)},u=f=>{clearTimeout(c),this.off(At[t],l),"message"in f?a(new Error(f.message)):a(f)};this.once(At[t],l),this.once("error",u),this.sendMessage(r,i)||(clearTimeout(c),this.off(At[t],l),this.off("error",u),a(new Error("Failed to send message")))})}buildMessage(r,i){switch(r){case 1:return de.stdin(i);case 2:{let t=i;switch(t.cmd){case"resize":return de.resize(t.cols,t.rows);case"kill":return de.kill(t.signal);case"reset-size":return de.resetSize();case"update-title":return de.updateTitle(t.title);default:return Ee(2,t)}}case 3:{let t=i;return de.status(t.app,t.status,t.extra)}case 4:return de.heartbeat();case 32:return de.statusRequest();case 48:return de.gitFollowRequest(i);case 50:return de.gitEventNotify(i);default:throw new Error(`Unsupported message type: ${r}`)}}sendHeartbeat(){return this.send(de.heartbeat())}send(r){if(!this.connected||!this.socket)return _n.debug("Cannot send message: not connected"),!1;try{return this.socket.write(r)}catch(i){return _n.error("Failed to send message:",i),!1}}disconnect(){this.options.autoReconnect=!1,this.connected=!1,this.stopHeartbeat(),this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=void 0),this.socket&&(this.socket.destroy(),this.socket=void 0)}isConnected(){return this.connected}getTimeSinceLastHeartbeat(){return Date.now()-this.lastHeartbeat}}});var sp=co(Ja=>{"use strict";Ja.parse=zb;Ja.serialize=Db;var Ib=Object.prototype.toString,Eb=Object.prototype.hasOwnProperty,Cb=/^[!#$%&'*+\-.^_`|~0-9A-Za-z]+$/,Nb=/^("?)[\u0021\u0023-\u002B\u002D-\u003A\u003C-\u005B\u005D-\u007E]*\1$/,jb=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,Ab=/^[\u0020-\u003A\u003D-\u007E]*$/;function zb(n,e){if(typeof n!="string")throw new TypeError("argument str must be a string");var r={},i=n.length;if(i<2)return r;var t=e&&e.decode||Rb,o=0,s=0,a=0;do{if(s=n.indexOf("=",o),s===-1)break;if(a=n.indexOf(";",o),a===-1)a=i;else if(s>a){o=n.lastIndexOf(";",s-1)+1;continue}var c=ip(n,o,s),l=op(n,s,c),u=n.slice(c,l);if(!Eb.call(r,u)){var d=ip(n,s+1,a),f=op(n,a,d);n.charCodeAt(d)===34&&n.charCodeAt(f-1)===34&&(d++,f--);var p=n.slice(d,f);r[u]=Mb(p,t)}o=a+1}while(o<i);return r}function ip(n,e,r){do{var i=n.charCodeAt(e);if(i!==32&&i!==9)return e}while(++e<r);return r}function op(n,e,r){for(;e>r;){var i=n.charCodeAt(--e);if(i!==32&&i!==9)return e+1}return r}function Db(n,e,r){var i=r&&r.encode||encodeURIComponent;if(typeof i!="function")throw new TypeError("option encode is invalid");if(!Cb.test(n))throw new TypeError("argument name is invalid");var t=i(e);if(!Nb.test(t))throw new TypeError("argument val is invalid");var o=n+"="+t;if(!r)return o;if(r.maxAge!=null){var s=Math.floor(r.maxAge);if(!isFinite(s))throw new TypeError("option maxAge is invalid");o+="; Max-Age="+s}if(r.domain){if(!jb.test(r.domain))throw new TypeError("option domain is invalid");o+="; Domain="+r.domain}if(r.path){if(!Ab.test(r.path))throw new TypeError("option path is invalid");o+="; Path="+r.path}if(r.expires){var a=r.expires;if(!Ob(a)||isNaN(a.valueOf()))throw new TypeError("option expires is invalid");o+="; Expires="+a.toUTCString()}if(r.httpOnly&&(o+="; HttpOnly"),r.secure&&(o+="; Secure"),r.partitioned&&(o+="; Partitioned"),r.priority){var c=typeof r.priority=="string"?r.priority.toLowerCase():r.priority;switch(c){case"low":o+="; Priority=Low";break;case"medium":o+="; Priority=Medium";break;case"high":o+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(r.sameSite){var l=typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite;switch(l){case!0:o+="; SameSite=Strict";break;case"lax":o+="; SameSite=Lax";break;case"strict":o+="; SameSite=Strict";break;case"none":o+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return o}function Rb(n){return n.indexOf("%")!==-1?decodeURIComponent(n):n}function Ob(n){return Ib.call(n)==="[object Date]"}function Mb(n,e){try{return e(n)}catch{return n}}});var lp=co(Io=>{var cp=require("crypto");Io.sign=function(n,e){if(typeof n!="string")throw new TypeError("Cookie value must be provided as a string.");if(typeof e!="string")throw new TypeError("Secret string must be provided.");return n+"."+cp.createHmac("sha256",e).update(n).digest("base64").replace(/\=+$/,"")};Io.unsign=function(n,e){if(typeof n!="string")throw new TypeError("Signed cookie string must be provided.");if(typeof e!="string")throw new TypeError("Secret string must be provided.");var r=n.slice(0,n.lastIndexOf(".")),i=Io.sign(r,e);return ap(i)==ap(n)?r:!1};function ap(n){return cp.createHash("sha1").update(n).digest("hex")}});var mp=co((G0,Tn)=>{"use strict";var Ub=sp(),Fb=lp();Tn.exports=Lb;Tn.exports.JSONCookie=up;Tn.exports.JSONCookies=Ka;Tn.exports.signedCookie=dp;Tn.exports.signedCookies=fp;function Lb(n,e){var r=!n||Array.isArray(n)?n||[]:[n];return function(t,o,s){if(t.cookies)return s();var a=t.headers.cookie;if(t.secret=r[0],t.cookies=Object.create(null),t.signedCookies=Object.create(null),!a)return s();t.cookies=Ub.parse(a,e),r.length!==0&&(t.signedCookies=fp(t.cookies,r),t.signedCookies=Ka(t.signedCookies)),t.cookies=Ka(t.cookies),s()}}function up(n){if(!(typeof n!="string"||n.substr(0,2)!=="j:"))try{return JSON.parse(n.slice(2))}catch{return}}function Ka(n){for(var e=Object.keys(n),r,i,t=0;t<e.length;t++)r=e[t],i=up(n[r]),i&&(n[r]=i);return n}function dp(n,e){if(typeof n=="string"){if(n.substr(0,2)!=="s:")return n;for(var r=!e||Array.isArray(e)?e||[]:[e],i=0;i<r.length;i++){var t=Fb.unsign(n.slice(2),r[i]);if(t!==!1)return t}return!1}}function fp(n,e){for(var r=Object.keys(n),i,t,o=Object.create(null),s,a=0;a<r.length;a++)t=r[a],s=n[t],i=dp(s,e),s!==i&&(o[t]=i,delete n[t]);return o}});var vy={};Et(vy,{installSystemdService:()=>xk});function Ur(){let n=process.env.USER||"unknown",e=process.env.HOME||`/home/${n}`;return{username:n,home:e}}function Ut(n){console.log(`${fk}[INFO]${_f} ${n}`)}function ei(n){console.log(`${dk}[SUCCESS]${_f} ${n}`)}function Ft(n){console.log(`${uk}[ERROR]${_f} ${n}`)}function mk(){let{username:n,home:e}=Ur(),r=`${e}/.local/bin/vibetunnel-systemd`,i=`#!/bin/bash
# VibeTunnel Systemd Wrapper Script
# This script finds and executes vibetunnel for user: ${n}

# Function to log messages
log_info() {
    echo "[INFO] $1" >&2
}

log_error() {
    echo "[ERROR] $1" >&2
}

# Set up environment for user ${n}
export HOME="${e}"
export USER="${n}"

# Try to find vibetunnel in various ways
find_vibetunnel() {
    # Method 1: Check if vibetunnel is in PATH
    if command -v vibetunnel >/dev/null 2>&1; then
        log_info "Found vibetunnel in PATH"
        vibetunnel "$@"
        return $?
    fi
    
    # Method 2: Check for nvm installations
    if [ -d "${e}/.nvm" ]; then
        log_info "Checking nvm installation for user ${n}"
        export NVM_DIR="${e}/.nvm"
        [ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"
        if command -v vibetunnel >/dev/null 2>&1; then
            log_info "Found vibetunnel via nvm"
            vibetunnel "$@"
            return $?
        fi
    fi
    
    # Method 3: Check for fnm installations  
    if [ -d "${e}/.local/share/fnm" ] && [ -x "${e}/.local/share/fnm/fnm" ]; then
        log_info "Checking fnm installation for user ${n}"
        export FNM_DIR="${e}/.local/share/fnm"
        export PATH="${e}/.local/share/fnm:$PATH"
        export SHELL="/bin/bash"  # Force shell for fnm
        # Initialize fnm with explicit shell and use the default node version
        eval "$("${e}/.local/share/fnm/fnm" env --shell bash)" 2>/dev/null || true
        # Try to use the default node version or current version
        "${e}/.local/share/fnm/fnm" use default >/dev/null 2>&1 || "${e}/.local/share/fnm/fnm" use current >/dev/null 2>&1 || true
        if command -v vibetunnel >/dev/null 2>&1; then
            log_info "Found vibetunnel via fnm"
            vibetunnel "$@"
            return $?
        fi
    fi
    
    # Method 4: Check common global npm locations
    for npm_bin in "/usr/local/bin/npm" "/usr/bin/npm" "/opt/homebrew/bin/npm"; do
        if [ -x "$npm_bin" ]; then
            log_info "Trying npm global with $npm_bin"
            NPM_PREFIX=$("$npm_bin" config get prefix 2>/dev/null)
            if [ -n "$NPM_PREFIX" ] && [ -x "$NPM_PREFIX/bin/vibetunnel" ]; then
                log_info "Found vibetunnel via npm global: $NPM_PREFIX/bin/vibetunnel"
                "$NPM_PREFIX/bin/vibetunnel" "$@"
                return $?
            fi
        fi
    done
    
    # Method 5: Try to run with node directly using global npm package
    for node_bin in "/usr/local/bin/node" "/usr/bin/node" "/opt/homebrew/bin/node"; do
        if [ -x "$node_bin" ]; then
            for script_path in "/usr/local/lib/node_modules/vibetunnel/dist/cli.js" "/usr/lib/node_modules/vibetunnel/dist/cli.js"; do
                if [ -f "$script_path" ]; then
                    log_info "Running vibetunnel via node: $node_bin $script_path"
                    "$node_bin" "$script_path" "$@"
                    return $?
                fi
            done
        fi
    done
    
    log_error "Could not find vibetunnel installation for user ${n}"
    log_error "Please ensure vibetunnel is installed globally: npm install -g vibetunnel"
    return 1
}

# Execute the function with all arguments
find_vibetunnel "$@"
`;try{let t=`${e}/.local/bin`;return(0,nt.existsSync)(t)||((0,nt.mkdirSync)(t,{recursive:!0}),Ut(`Created directory: ${t}`)),(0,nt.writeFileSync)(r,i),(0,nt.chmodSync)(r,493),ei(`Created wrapper script at ${r}`),r}catch(t){Ft(`Failed to create wrapper script: ${t}`),process.exit(1)}}function pk(){try{let n=(0,Mt.execSync)("which vibetunnel",{encoding:"utf8",stdio:"pipe"}).trim();Ut(`Found VibeTunnel at: ${n}`)}catch{Ft("VibeTunnel is not installed or not accessible. Please install it first:"),console.log("  npm install -g vibetunnel"),process.exit(1)}return mk()}function gk(){let{home:n}=Ur(),e=`${n}/.local/bin/vibetunnel-systemd`;try{(0,nt.existsSync)(e)&&((0,nt.unlinkSync)(e),Ut("Removed wrapper script"))}catch{}}function hk(n){let{home:e}=Ur();return`[Unit]
Description=VibeTunnel - Terminal sharing server with web interface
Documentation=https://github.com/amantus-ai/vibetunnel
After=network.target
Wants=network.target

[Service]
Type=simple
WorkingDirectory=${e}
ExecStart=${n} --port 4020 --bind 0.0.0.0
Restart=always
RestartSec=10
StandardOutput=journal
StandardError=journal
SyslogIdentifier=${rt}

# Environment - preserve user environment for node version managers
Environment=NODE_ENV=production
Environment=VIBETUNNEL_LOG_LEVEL=info
Environment=HOME=%h
Environment=USER=%i

# Resource limits
LimitNOFILE=65536
MemoryHigh=512M
MemoryMax=1G

[Install]
WantedBy=default.target`}function vk(n){Ut("Installing user systemd service...");let{home:e}=Ur(),r=`${e}/.config/systemd/user`,i=hk(n),t=(0,kf.join)(r,Pf);try{(0,nt.mkdirSync)(r,{recursive:!0}),(0,nt.writeFileSync)(t,i),(0,nt.chmodSync)(t,420),(0,Mt.execSync)("systemctl --user daemon-reload",{stdio:"pipe"}),ei("User systemd service installed")}catch(o){Ft(`Failed to install service: ${o}`),process.exit(1)}}function yk(){Ut("Configuring service...");try{(0,Mt.execSync)(`systemctl --user enable ${rt}`,{stdio:"pipe"}),ei("User service enabled for automatic startup");try{let{username:n}=Ur();(0,Mt.execSync)(`loginctl enable-linger ${n}`,{stdio:"pipe"}),ei("User lingering enabled - service will start on boot")}catch(n){Ft(`Failed to enable lingering: ${n}`),Ft("Service will only start when user logs in")}}catch(n){Ft(`Failed to configure service: ${n}`),process.exit(1)}}function bk(){let{username:n,home:e}=Ur();ei("VibeTunnel systemd service installation completed!"),console.log(""),console.log("Usage:"),console.log(`  systemctl --user start ${rt}     # Start the service`),console.log(`  systemctl --user stop ${rt}      # Stop the service`),console.log(`  systemctl --user restart ${rt}   # Restart the service`),console.log(`  systemctl --user status ${rt}    # Check service status`),console.log(`  systemctl --user enable ${rt}    # Enable auto-start (already done)`),console.log(`  systemctl --user disable ${rt}   # Disable auto-start`),console.log(""),console.log("Logs:"),console.log(`  journalctl --user -u ${rt} -f    # Follow logs in real-time`),console.log(`  journalctl --user -u ${rt}       # View all logs`),console.log(""),console.log("Configuration:"),console.log("  Service runs on port 4020 by default"),console.log("  Web interface: http://localhost:4020"),console.log(`  Service runs as user: ${n}`),console.log(`  Working directory: ${e}`),console.log(`  Wrapper script: ${e}/.local/bin/vibetunnel-systemd`),console.log(""),console.log(`To customize the service, edit: ${e}/.config/systemd/user/${Pf}`),console.log(`Then run: systemctl --user daemon-reload && systemctl --user restart ${rt}`)}function wk(){Ut("Uninstalling VibeTunnel user systemd service...");try{try{(0,Mt.execSync)(`systemctl --user is-active ${rt}`,{stdio:"pipe"}),(0,Mt.execSync)(`systemctl --user stop ${rt}`,{stdio:"pipe"}),Ut("User service stopped")}catch{}try{(0,Mt.execSync)(`systemctl --user is-enabled ${rt}`,{stdio:"pipe"}),(0,Mt.execSync)(`systemctl --user disable ${rt}`,{stdio:"pipe"}),Ut("User service disabled")}catch{}let{home:n}=Ur(),e=`${n}/.config/systemd/user`,r=(0,kf.join)(e,Pf);(0,nt.existsSync)(r)&&((0,nt.unlinkSync)(r),Ut("Service file removed")),(0,Mt.execSync)("systemctl --user daemon-reload",{stdio:"pipe"}),gk();let{username:i}=Ur();Ut("Note: User lingering is still enabled. To disable:"),console.log(`  loginctl disable-linger ${i}`),ei("VibeTunnel user systemd service uninstalled")}catch(n){Ft(`Failed to uninstall service: ${n}`),process.exit(1)}}function Sk(){try{let n=(0,Mt.execSync)(`systemctl --user status ${rt}`,{encoding:"utf8"});console.log(n)}catch(n){n instanceof Error&&"stdout"in n?console.log(n.stdout):Ft(`Failed to get service status: ${n}`)}}function $k(){process.getuid&&process.getuid()===0&&(Ft("This installer must NOT be run as root!"),Ft("VibeTunnel systemd service should run as a regular user for security."),Ft("Please run this command as a regular user (without sudo)."),process.exit(1))}function xk(n="install"){switch($k(),n){case"install":{Ut("Installing VibeTunnel user systemd service...");let e=pk();vk(e),yk(),bk();break}case"uninstall":{wk();break}case"status":Sk();break;default:console.log("Usage: vibetunnel systemd [install|uninstall|status]"),console.log("  install   - Install VibeTunnel user systemd service (default)"),console.log("  uninstall - Remove VibeTunnel user systemd service"),console.log("  status    - Check service status"),process.exit(1)}}var Mt,nt,kf,uk,dk,fk,_f,rt,Pf,yy=Be(()=>{Mt=require("node:child_process"),nt=require("node:fs"),kf=require("node:path"),uk="\x1B[0;31m",dk="\x1B[0;32m",fk="\x1B[0;34m",_f="\x1B[0m",rt="vibetunnel",Pf="vibetunnel.service"});var Sy={};Et(Sy,{SocketApiClient:()=>If});var by,wy,Tf,wa,If,$y=Be(()=>{by=C(require("fs")),wy=C(require("os")),Tf=C(require("path"));Va();li();W();wa=T("socket-api"),If=class{controlSocketPath;controlDir;constructor(){this.controlDir=process.env.VIBETUNNEL_CONTROL_DIR||Tf.join(wy.homedir(),".vibetunnel"),this.controlSocketPath=Tf.join(this.controlDir,"api.sock"),wa.debug(`SocketApiClient initialized with control directory: ${this.controlDir}`),wa.debug(`Socket path: ${this.controlSocketPath}`)}isSocketAvailable(){let e=by.existsSync(this.controlSocketPath);return wa.debug(`Socket availability check: ${this.controlSocketPath} - ${e?"available":"not available"}`),e}async sendRequest(e,r,i,t=5e3){if(!this.isSocketAvailable())throw new Error("VibeTunnel server is not running");let o=new Wr(this.controlSocketPath);try{return await o.connect(),await o.sendMessageWithResponse(e,r,i,t)}catch(s){throw s instanceof Error&&s.message.includes("ENOENT")?new Error("VibeTunnel server is not running"):s}finally{o.disconnect()}}async getStatus(){if(!this.isSocketAvailable())return{running:!1};try{return await this.sendRequest(32,{},33)}catch(e){return wa.error("Failed to get server status:",e),{running:!1}}}async setFollowMode(e){return this.sendRequest(48,e,49)}async sendGitEvent(e){return this.sendRequest(50,e,51)}}});function Af(){let n=typeof process<"u"&&process.versions?.node,e=n?global:typeof globalThis<"u"?globalThis:global;if(e.__xtermErrorsSuppressed)return;e.__xtermErrorsSuppressed=!0;let r=console.error,i=console.warn;console.error=(...t)=>{jf(t)||r.apply(console,t)},console.warn=(...t)=>{jf(t)||i.apply(console,t)},n&&process.env.VIBETUNNEL_DEBUG==="1"&&i.call(console,"[suppress-xterm-errors] xterm.js error suppression activated")}function jf(n){if(!n[0]||typeof n[0]!="string")return!1;let e=n[0];return!!(e.includes("xterm.js: Parsing error:")||e.includes("Unable to process character")&&e.includes("xterm"))}Fe();var xt=C(require("fs")),qa=C(require("os")),sr=C(require("path")),rp=require("util");var Xt=(t=>(t.NONE="none",t.FILTER="filter",t.STATIC="static",t.DYNAMIC="dynamic",t))(Xt||{});var ho=require("events"),Bt=C(require("fs")),rm=C(require("path")),nm=require("util");W();W();var qy=T("PruningDetector"),Yf=["\x1B[3J","\x1Bc","\x1B[2J","\x1B[H\x1B[J","\x1B[H\x1B[2J","\x1B[?1049h","\x1B[?1049l","\x1B[?47h","\x1B[?47l"];function Na(n){let e=-1,r="";for(let i of Yf){let t=n.lastIndexOf(i);t>e&&(e=t,r=i)}return e===-1?null:{sequence:r,index:e}}function ja(n){return Yf.some(e=>n.includes(e))}function Xf(n){let e=Na(n);return e?{sequence:e.sequence,position:e.index+e.sequence.length}:null}function em(n,e,r,i,t){let o=r.substring(0,i+t),s=JSON.stringify([e,"o",""]).slice(0,-1),a=Buffer.from(s,"utf8").length,c=Buffer.from(o,"utf8").length;return n+a+c}function tm(n,e,r){let i=JSON.parse(e),t=i[2],s=JSON.stringify([i[0],i[1],""]).slice(0,-1).length,a=t.substring(0,r),c=Buffer.from(a,"utf8").length;return n-Buffer.from(`${e}
`,"utf8").length+s+c}function go(n,e,r=""){let i=n.split("\x1B").join("\\x1b");qy.debug(`Detected pruning sequence '${i}' at byte position ${e}`+(r?` ${r}`:""))}var Fr=class{queue=Promise.resolve();enqueue(e){this.queue=this.queue.then(()=>e()).catch(r=>{console.error("WriteQueue error:",r)})}async drain(){await this.queue}};var J=class extends Error{constructor(r,i,t){super(r);this.code=i;this.sessionId=t;this.name="PtyError"}};var tr=T("AsciinemaWriter"),Jy=(0,nm.promisify)(Bt.fsync),oi=class n{constructor(e,r){this.filePath=e;this.header=r;this.startTime=new Date;let i=rm.dirname(e);Bt.existsSync(i)||Bt.mkdirSync(i,{recursive:!0}),this.writeStream=Bt.createWriteStream(e,{flags:"w",encoding:"utf8",highWaterMark:0}),this.writeStream.on("open",t=>{this.fd=t}),this.writeHeader()}writeStream;startTime;utf8Buffer=Buffer.alloc(0);headerWritten=!1;fd=null;writeQueue=new Fr;bytesWritten=0;pendingBytes=0;pruningCallback;lastValidatedPosition=0;validationErrors=0;static create(e,r=80,i=24,t,o,s){let a={version:2,width:r,height:i,timestamp:Math.floor(Date.now()/1e3),command:t,title:o,env:s};return new n(e,a)}getPosition(){return{written:this.bytesWritten,pending:this.pendingBytes,total:this.bytesWritten+this.pendingBytes}}onPruningSequence(e){this.pruningCallback=e}writeHeader(){this.headerWritten||(this.writeQueue.enqueue(async()=>{let r=`${JSON.stringify(this.header)}
`,i=Buffer.from(r,"utf8").length;this.pendingBytes+=i,this.writeStream.write(r)||await(0,ho.once)(this.writeStream,"drain"),this.bytesWritten+=i,this.pendingBytes-=i}),this.headerWritten=!0)}writeOutput(e){this.writeQueue.enqueue(async()=>{let r=this.getElapsedTime(),i=Buffer.concat([this.utf8Buffer,e]),{processedData:t,remainingBuffer:o}=this.processTerminalData(i);if(t.length>0){let s=null;if(this.pruningCallback){let l=Na(t);l&&(s=l,tr.debug(`Found pruning sequence '${l.sequence.split("\x1B").join("\\x1b")}' at string index ${l.index} in output data`))}let a={time:r,type:"o",data:t},c=this.bytesWritten+this.pendingBytes;if(await this.writeEvent(a),s&&this.pruningCallback){let l=em(c,r,t,s.index,s.sequence.length),u=`${JSON.stringify([r,"o",t])}
`,d=Buffer.from(u,"utf8").length,f=c+d;Ca()&&tr.debug(`Pruning sequence byte calculation:
  Event start position: ${c}
  Event total size: ${d} bytes
  Event end position: ${f}
  Exact sequence position: ${l}
  Current file position: ${this.bytesWritten}`),l>f?tr.error(`Pruning sequence position calculation error: sequence position ${l} is beyond event end ${f}`):(this.pruningCallback({sequence:s.sequence,position:l,timestamp:r}),go(s.sequence,l,"(real-time)"))}}this.utf8Buffer=o})}writeInput(e){this.writeQueue.enqueue(async()=>{let i={time:this.getElapsedTime(),type:"i",data:e};await this.writeEvent(i)})}writeResize(e,r){this.writeQueue.enqueue(async()=>{let t={time:this.getElapsedTime(),type:"r",data:`${e}x${r}`};await this.writeEvent(t)})}writeMarker(e){this.writeQueue.enqueue(async()=>{let i={time:this.getElapsedTime(),type:"m",data:e};await this.writeEvent(i)})}writeRawJson(e){this.writeQueue.enqueue(async()=>{let i=`${JSON.stringify(e)}
`,t=Buffer.from(i,"utf8").length;this.pendingBytes+=t,this.writeStream.write(i)||await(0,ho.once)(this.writeStream,"drain"),this.bytesWritten+=t,this.pendingBytes-=t})}async writeEvent(e){let r=[e.time,e.type,e.data],t=`${JSON.stringify(r)}
`,o=Buffer.from(t,"utf8").length;if(e.type==="o"&&Ca()&&tr.debug(`Writing output event: ${o} bytes, data length: ${e.data.length} chars, position: ${this.bytesWritten+this.pendingBytes}`),this.pendingBytes+=o,this.writeStream.write(t)||(tr.debug("Write stream backpressure detected, waiting for drain"),await(0,ho.once)(this.writeStream,"drain")),this.bytesWritten+=o,this.pendingBytes-=o,this.bytesWritten-this.lastValidatedPosition>1024*1024&&await this.validateFilePosition(),this.fd!==null)try{await Jy(this.fd)}catch(a){tr.debug(`fsync failed for ${this.filePath}:`,a)}}processTerminalData(e){let r="",i=0;for(;i<e.length;)if(e[i]===27){let t=this.findEscapeSequenceEnd(e.subarray(i));if(t!==null){let o=e.subarray(i,i+t);r+=o.toString("latin1"),i+=t}else return{processedData:r,remainingBuffer:e.subarray(i)}}else{let t=i;for(;i<e.length&&e[i]!==27;)i++;let o=e.subarray(t,i);try{let s=o.toString("utf8");r+=s}catch{let{validData:a,invalidStart:c}=this.findValidUtf8(o);if(a.length>0&&(r+=a.toString("utf8")),c<o.length&&i>=e.length){let u=e.subarray(t+c);if(u.length<=4&&this.mightBeIncompleteUtf8(u))return{processedData:r,remainingBuffer:u}}let l=o.subarray(c);r+=l.toString("latin1")}}return{processedData:r,remainingBuffer:Buffer.alloc(0)}}findEscapeSequenceEnd(e){if(e.length===0||e[0]!==27||e.length<2)return null;switch(e[1]){case 91:{let r=2;for(;r<e.length;){let i=e[r];if(i>=32&&i<=63)r++;else return i>=64&&i<=126?r+1:r}return null}case 93:{let r=2;for(;r<e.length;){let i=e[r];if(i===7)return r+1;if(i===27&&r+1<e.length&&e[r+1]===92)return r+2;r++}return null}default:return 2}}findValidUtf8(e){for(let r=0;r<e.length;r++)try{e.subarray(0,r+1).toString("utf8")}catch{return{validData:e.subarray(0,r),invalidStart:r}}return{validData:e,invalidStart:e.length}}mightBeIncompleteUtf8(e){if(e.length===0)return!1;let r=e[0];if(r<128)return!1;if(r>=192){if(r<224)return e.length<2;if(r<240)return e.length<3;if(r<248)return e.length<4}return!1}getElapsedTime(){return(Date.now()-this.startTime.getTime())/1e3}async validateFilePosition(){try{let r=(await Bt.promises.stat(this.filePath)).size,i=this.bytesWritten;if(r!==i){if(this.validationErrors++,tr.error(`AsciinemaWriter position mismatch! Expected: ${i} bytes, Actual: ${r} bytes, Difference: ${r-i} bytes, Validation errors: ${this.validationErrors}`),Math.abs(r-i)>100)throw new J(`Critical byte position tracking error: expected ${i}, actual ${r}`,"POSITION_MISMATCH")}else tr.debug(`Position validation passed: ${r} bytes`);this.lastValidatedPosition=this.bytesWritten}catch(e){if(e instanceof J)throw e;tr.error("Failed to validate file position:",e)}}async close(){if(this.utf8Buffer.length>0){let r={time:this.getElapsedTime(),type:"o",data:this.utf8Buffer.toString("latin1")};this.writeQueue.enqueue(async()=>{await this.writeEvent(r)}),this.utf8Buffer=Buffer.alloc(0)}return await this.writeQueue.drain(),new Promise((e,r)=>{this.writeStream.end(i=>{i?r(new J(`Failed to close asciinema writer: ${i.message}`)):e()})})}isOpen(){return!this.writeStream.destroyed}};Fe();var kr=require("child_process"),vo=C(require("fs")),yo=C(require("os")),Lr=C(require("path"));W();var We=T("process-utils");function Ky(n){let e=yo.homedir(),r=Lr.basename(n),t={zsh:[".zshrc",".zshenv"],bash:[".bashrc",".bash_profile",".profile"],sh:[".profile"],ksh:[".kshrc",".profile"],fish:[".config/fish/config.fish"],tcsh:[".tcshrc",".cshrc"],csh:[".cshrc"],dash:[".profile"]}[r]||[];for(let s of t){let a=Lr.join(e,s);if(im(a))return a}let o=Lr.join(e,".profile");return im(o)?o:null}function im(n){try{return vo.accessSync(n,vo.constants.F_OK),!0}catch{return!1}}function Aa(n){if(!n||n<=0)return!1;try{return process.platform==="win32"?Qy(n):Yy(n)}catch(e){return We.warn(`error checking if process ${n} is running:`,e),!1}}function Qy(n){try{We.debug(`checking windows process ${n} with tasklist`);let e=(0,kr.spawnSync)("tasklist",["/FI",`PID eq ${n}`,"/NH","/FO","CSV"],{encoding:"utf8",windowsHide:!0,timeout:5e3});if(e.status===0&&e.stdout){let r=e.stdout.includes(`"${n}"`);return We.debug(`process ${n} exists: ${r}`),r}return We.debug(`tasklist command failed with status ${e.status}`),!1}catch(e){return We.warn(`windows process check failed for PID ${n}:`,e),!1}}function Yy(n){try{return process.kill(n,0),!0}catch(e){return e.code==="EPERM"}}function Xy(n){return Aa(n)?{pid:n,exists:!0}:null}function eb(n,e="SIGTERM"){if(!n||n<=0)return!1;We.debug(`attempting to kill process ${n} with signal ${e}`);try{if(process.platform==="win32"){let r=(0,kr.spawnSync)("taskkill",["/PID",n.toString(),"/F"],{windowsHide:!0,timeout:5e3});return r.status===0?(We.log(v.green(`process ${n} killed successfully`)),!0):(We.debug(`taskkill failed with status ${r.status}`),!1)}else return process.kill(n,e),We.log(v.green(`signal ${e} sent to process ${n}`)),!0}catch(r){return We.warn(`error killing process ${n}:`,r),!1}}async function tb(n,e=5e3){let r=Date.now(),i=100;for(We.debug(`waiting for process ${n} to exit (timeout: ${e}ms)`);Date.now()-r<e;){if(!Aa(n)){let t=Date.now()-r;return We.log(v.green(`process ${n} exited after ${t}ms`)),!0}await new Promise(t=>setTimeout(t,i))}return We.log(v.yellow(`process ${n} did not exit within ${e}ms timeout`)),!1}function om(n,e){if(!["bash","zsh","sh","fish","dash","ksh","tcsh","csh"].some(o=>n===o||n.endsWith(`/${o}`)))return!1;let t=["-i","--interactive","-l","--login"];return e.length===0?!0:e.some(o=>t.includes(o))}function rb(n){if(n.length===0)throw new Error("No command provided");let e=n[0],r=n.slice(1),i=process.platform==="win32"?"where":"which";try{let s=(0,kr.spawnSync)(i,[e],{encoding:"utf8",windowsHide:!0,timeout:2e3});if(s.status===0&&s.stdout&&s.stdout.trim()){if(We.debug(`Command '${e}' found at: ${s.stdout.trim()}`),om(e,r)){We.log(v.cyan(`\u2713 Starting ${e} as login shell to load configuration files`));let a=r.some(d=>d==="-i"||d==="--interactive"),c=r.some(d=>d==="-l"||d==="--login"),l=[...r],u=e==="fish"||e.endsWith("/fish");return a||l.unshift(u?"--interactive":"-i"),c||l.unshift(u?"--login":"-l"),{command:e,args:l,useShell:!1,resolvedFrom:"path",originalCommand:e,isInteractive:!0}}return{command:e,args:r,useShell:!1,resolvedFrom:"path",originalCommand:e}}}catch(s){We.debug(`Failed to check command existence for '${e}':`,s)}We.debug(`Command '${e}' not found in PATH, will use shell`);let t=sm(),o=!om(e,r);return process.platform==="win32"?t.includes("bash")?o?{command:t,args:["-c",n.join(" ")],useShell:!0,resolvedFrom:"shell"}:{command:t,args:["-i","-c",n.join(" ")],useShell:!0,resolvedFrom:"shell",isInteractive:!0}:t.includes("pwsh")||t.includes("powershell")?{command:t,args:["-NoLogo","-Command",n.join(" ")],useShell:!0,resolvedFrom:"shell"}:{command:t,args:["/C",n.join(" ")],useShell:!0,resolvedFrom:"shell"}:o?Ky(t)?{command:t,args:["-i","-l","-c",n.join(" ")],useShell:!0,resolvedFrom:"alias"}:{command:t,args:["-c",n.join(" ")],useShell:!0,resolvedFrom:"shell"}:{command:t,args:["-i","-l","-c",n.join(" ")],useShell:!0,resolvedFrom:"shell",isInteractive:!0}}function sm(){if(process.env.SHELL)return process.env.SHELL;if(process.platform==="win32"){try{if((0,kr.spawnSync)("pwsh",["-Command","echo test"],{encoding:"utf8",windowsHide:!0,timeout:1e3}).status===0)return"pwsh"}catch{}let n=Lr.join(process.env.SystemRoot||"C:\\Windows","System32","WindowsPowerShell","v1.0","powershell.exe");try{if((0,kr.spawnSync)(n,["-Command","echo test"],{encoding:"utf8",windowsHide:!0,timeout:1e3}).status===0)return n}catch{}let e=["C:\\Program Files\\Git\\bin\\bash.exe","C:\\Program Files (x86)\\Git\\bin\\bash.exe",Lr.join(process.env.ProgramFiles||"C:\\Program Files","Git","bin","bash.exe")];for(let r of e)try{if((0,kr.spawnSync)(r,["-c","echo test"],{encoding:"utf8",windowsHide:!0,timeout:1e3}).status===0)return r}catch{}return process.env.ComSpec||"cmd.exe"}else{try{let e=yo.userInfo();if("shell"in e&&e.shell)return e.shell}catch{}let n=["/bin/bash","/usr/bin/bash","/bin/zsh","/usr/bin/zsh","/bin/sh"];for(let e of n)try{if((0,kr.spawnSync)("test",["-x",e],{encoding:"utf8",timeout:500}).status===0)return e}catch{}return"/bin/sh"}}var st={isProcessRunning:Aa,getProcessInfo:Xy,killProcess:eb,waitForProcessExit:tb,resolveCommand:rb,getUserShell:sm};Fe();var Zm=require("child_process"),di=require("events"),Qe=C(require("fs")),fi=C(require("net")),$t=C(require("path")),Vm=require("util");vn();var pm=require("child_process"),gm=require("util");W();var ve=T("process-tree-analyzer"),Ra=(0,gm.promisify)(pm.exec),si=class n{async getProcessTree(e){try{return process.platform==="win32"?await this.getWindowsProcessTree(e):await this.getUnixProcessTree(e)}catch(r){return ve.warn("ProcessTreeAnalyzer",`Failed to get process tree for PID ${e}:`,r),[]}}async getUnixProcessTree(e){let r=process.platform==="darwin";ve.log("ProcessTreeAnalyzer",`Using recursive child search for ${e} to find all descendants`);try{return await this.getProcessTreeRecursive(e,r)}catch(i){ve.warn("ProcessTreeAnalyzer","Recursive process search failed:",i);try{let t=r?`ps -o pid,ppid,pgid,tty,state,lstart,command -p ${e}`:`ps -o pid,ppid,pgid,sid,tty,state,lstart,command -p ${e}`,{stdout:o}=await Ra(t,{timeout:5e3});return this.parseUnixProcessOutput(o,r)}catch(t){return ve.warn("ProcessTreeAnalyzer","Final fallback also failed:",t),[]}}}async getWindowsProcessTree(e){try{let{stdout:r}=await Ra(`wmic process where "ParentProcessId=${e}" get ProcessId,ParentProcessId,CommandLine /format:csv`,{timeout:5e3});return this.parseWindowsProcessOutput(r,e)}catch(r){return ve.warn("ProcessTreeAnalyzer","Windows process query failed:",r),[]}}parseUnixProcessOutput(e,r=!1){let i=e.trim().split(`
`),t=[];for(let o=1;o<i.length;o++){let s=i[o].trim();if(s)try{if(r){let a=s.trim().split(/\s+/);if(a.length>=10){let c=Number.parseInt(a[0]),l=Number.parseInt(a[1]),u=Number.parseInt(a[2]),d=a[3]==="?"?void 0:a[3],f=a[4],p=a.slice(5,10).join(" "),m=a.slice(10).join(" ");!Number.isNaN(c)&&!Number.isNaN(l)&&!Number.isNaN(u)&&m&&(ve.log("ProcessTreeAnalyzer",`Parsed macOS process: PID=${c}, COMMAND="${m.trim()}"`),t.push({pid:c,ppid:l,pgid:u,tty:d,state:f,startTime:p,command:m.trim()}))}}else{let a=s.match(/^\s*(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\S+)\s+(\S+)\s+(.+?)\s+(.+)$/);if(a){let[,c,l,u,d,f,p,m,g]=a;t.push({pid:Number.parseInt(c),ppid:Number.parseInt(l),pgid:Number.parseInt(u),sid:Number.parseInt(d),tty:f==="?"?void 0:f,state:p,startTime:m,command:g.trim()})}}}catch{ve.debug("ProcessTreeAnalyzer",`Failed to parse ps line: ${s}`)}}return t}parseWindowsProcessOutput(e,r){let i=e.trim().split(`
`),t=[];t.push({pid:r,ppid:0,pgid:r,command:"shell"});for(let o=1;o<i.length;o++){let s=i[o].trim();if(!s)continue;let a=s.split(",");if(a.length>=3){let c=Number.parseInt(a[1]),l=Number.parseInt(a[2]),u=a[3]||"unknown";!Number.isNaN(c)&&!Number.isNaN(l)&&t.push({pid:c,ppid:l,pgid:c,command:u})}}return t}async identifyBellSource(e){let r=await this.getProcessTree(e);if(ve.log("ProcessTreeAnalyzer",`Process tree for session ${e}: ${JSON.stringify(r.map(a=>({pid:a.pid,ppid:a.ppid,command:a.command})))}`),r.length===0)return ve.warn("ProcessTreeAnalyzer",`No processes found in tree for session ${e}`),null;let i=this.findForegroundProcess(r,e);if(i)return ve.debug("ProcessTreeAnalyzer",`Identified foreground process: ${i.command} (PID: ${i.pid})`),i;let t=this.findMostRecentChild(r,e);if(t)return ve.debug("ProcessTreeAnalyzer",`Identified recent child process: ${t.command} (PID: ${t.pid})`),t;let o=r.find(a=>a.pid!==e&&!this.isShellProcess(a.command)&&!this.isBackgroundProcess(a.command));if(o)return ve.debug("ProcessTreeAnalyzer",`Found non-shell process: ${o.command} (PID: ${o.pid})`),o;let s=r.find(a=>a.pid===e);return s?(ve.debug("ProcessTreeAnalyzer",`Defaulting to shell process: ${s.command} (PID: ${s.pid})`),s):null}findForegroundProcess(e,r){let i=e.filter(a=>a.pid!==r&&a.ppid===r&&!this.isShellProcess(a.command)&&!this.isBackgroundProcess(a.command));if(ve.log("ProcessTreeAnalyzer",`Direct child candidates: ${JSON.stringify(i.map(a=>({pid:a.pid,command:a.command})))}`),i.length===0&&(i=e.filter(a=>a.pid!==r&&!this.isShellProcess(a.command)&&!this.isBackgroundProcess(a.command)),ve.log("ProcessTreeAnalyzer",`Descendant candidates: ${JSON.stringify(i.map(a=>({pid:a.pid,command:a.command})))}`)),i.length===0)return ve.log("ProcessTreeAnalyzer","No suitable candidate processes found, bell likely from shell itself"),null;let t=new Date,o=i.filter(a=>{if(!a.startTime)return!0;let c=new Date(a.startTime),l=t.getTime()-c.getTime();return l<100?(ve.log("ProcessTreeAnalyzer",`Filtering out very recent process: ${a.command} (age: ${l}ms)`),!1):!0});if(o.length===0)return ve.log("ProcessTreeAnalyzer","All candidates were very recent (likely prompt utilities)"),null;let s=o.sort((a,c)=>a.startTime&&c.startTime?new Date(c.startTime).getTime()-new Date(a.startTime).getTime():0);return ve.log("ProcessTreeAnalyzer",`Selected foreground candidate: ${s[0].command} (PID: ${s[0].pid})`),s[0]}findMostRecentChild(e,r){let i=e.filter(o=>o.ppid===r&&o.pid!==r&&!this.isShellProcess(o.command));return i.length===0&&(i=e.filter(o=>o.ppid===r&&o.pid!==r)),ve.log("ProcessTreeAnalyzer",`Recent child candidates: ${JSON.stringify(i.map(o=>({pid:o.pid,command:o.command})))}`),i.length===0?null:i.sort((o,s)=>o.startTime&&s.startTime?new Date(s.startTime).getTime()-new Date(o.startTime).getTime():0)[0]}isShellProcess(e){let r=["bash","zsh","sh","fish","csh","tcsh","ksh"],i=n.extractProcessName(e);return r.includes(i.toLowerCase())}isBackgroundProcess(e){let r=["ssh-agent","gpg-agent","dbus-daemon","systemd","kworker","ksoftirqd","migration","watchdog"],i=["git status","git branch","hg branch","hg status","svn status","pwd","whoami","hostname","date","ps ","ls -la","df -h"],t=e.toLowerCase();return r.some(o=>t.includes(o))?!0:i.some(o=>t.includes(o))?(ve.log("ProcessTreeAnalyzer",`Identified prompt utility: ${e}`),!0):!1}async getProcessTreeRecursive(e,r){let i=[],t=new Set,o=r?"ps -eo pid,ppid,pgid,tty,state,lstart,command":"ps -eo pid,ppid,pgid,sid,tty,state,lstart,command";ve.log("ProcessTreeAnalyzer",`Getting all system processes with: ${o}`);let{stdout:s}=await Ra(o,{timeout:1e4}),a=this.parseUnixProcessOutput(s,r);ve.log("ProcessTreeAnalyzer",`Found ${a.length} total system processes`);let c=new Map;for(let d of a){c.has(d.ppid)||c.set(d.ppid,[]);let f=c.get(d.ppid);f&&f.push(d)}let l=c.get(e)||[];ve.log("ProcessTreeAnalyzer",`Direct children of ${e}: ${JSON.stringify(l.map(d=>({pid:d.pid,command:d.command})))}`);let u=d=>{if(t.has(d))return;t.add(d);let f=a.find(m=>m.pid===d);f&&i.push(f);let p=c.get(d)||[];for(let m of p)u(m.pid)};return u(e),ve.log("ProcessTreeAnalyzer",`Final process tree: ${JSON.stringify(i.map(d=>({pid:d.pid,ppid:d.ppid,command:d.command})))}`),i}async captureProcessSnapshot(e){let r=await this.getProcessTree(e),i=this.findForegroundProcess(r,e),t=await this.identifyBellSource(e);return{sessionPid:e,processTree:r,foregroundProcess:i,suspectedBellSource:t,capturedAt:new Date().toISOString()}}static extractProcessName(e){return e.replace(/^.*\//,"").replace(/\s+.*$/,"").replace(/^sudo\s+/,"").replace(/^exec\s+/,"")||"unknown"}static getProcessDescription(e){if(!e)return"unknown process";let r=n.extractProcessName(e.command);return r==="bash"||r==="zsh"||r==="sh"||r==="fish"?"shell":r}};W();var hm=require("child_process");W();var yn=T("process-tree");function vm(){let n=[],e=process.pid,r=20,i=0;for(;e>0&&i<r;)try{let o=(0,hm.execSync)(`ps -p ${e} -o pid,ppid,command`,{encoding:"utf8",stdio:["ignore","pipe","ignore"]}).trim().split(`
`);if(o.length<2)break;let a=o[1].trim().split(/\s+/);if(a.length<3)break;let c=Number.parseInt(a[0],10),l=Number.parseInt(a[1],10),u=a.slice(2).join(" ");if(n.push({pid:c,ppid:l,command:u}),e=l,i++,l===0||l===1)break}catch(t){yn.debug(`Failed to get info for PID ${e}:`,t);break}return n}function ym(){try{let n=vm(),e=[/\bclaude\b/i,/\bcly\b/i,/claude-wrapper/i,/node.*claude/i,/tsx.*claude/i,/bun.*claude/i,/npx.*claude/i,/claude-code/i];for(let r of n)if(e.some(t=>t.test(r.command)))return yn.debug(`Claude detected in process tree: PID ${r.pid}, Command: ${r.command}`),!0;return process.env.VIBETUNNEL_CLAUDE_DEBUG==="true"&&(yn.debug("Process tree:"),n.forEach((r,i)=>{yn.debug(`  ${" ".repeat(i*2)}[${r.pid}] ${r.command}`)})),!1}catch(n){return yn.debug("Failed to check process tree:",n),!1}}function bm(){try{let n=vm(),e=[/\bclaude\b/i,/\bcly\b/i,/claude-wrapper/i,/claude-code/i];for(let r of n)if(e.some(t=>t.test(r.command)))return r.command;return null}catch(n){return yn.debug("Failed to get Claude command from tree:",n),null}}W();var Oa=T("prompt-patterns"),ib=/\x1b\[[0-9;]*[a-zA-Z]/g,ob=/(?<![.>])(?:\[[^\]]*\])?[$>#%❯➜]\s*(?:\x1b\[[0-9;]*[a-zA-Z])?$/,sb=/^(?:\[[^\]]*\])?(?<!^[.>]{2})[$>#%❯➜]\s*$/,ab={python:/^>>>\s*$/,pythonContinuation:/^\.\.\.\s*$/,bracketed:/\][#$]\s*$/,root:/#\s*$/,powershell:/^PS.*>\s*$|^>\s*$/,zsh:/[%❯]\s*$/,fish:/[❯➜]\s*$/,bash:/\$\s*$/,sh:/\$\s*$/,withEscape:/[$>#%❯➜]\s*\x1b\[/},Br;(u=>{let n=new Map,e=new Map,r=0,i=1e3;function t(d){if(d.length>1e4)return Oa.warn("Unusually long prompt input detected",{length:d.length}),!1;let f=d.trim();if(e.has(f))return e.get(f)??!1;let p=sb.test(f);return a(e,f,p),p}u.isPromptOnly=t;function o(d){let f=d.slice(-100);if(n.has(f))return n.get(f)??!1;let p=d.replace(ib,""),m=ob.test(p);return a(n,f,m),m&&Oa.debug("Detected prompt at end of output"),m}u.endsWithPrompt=o;function s(d){let f=d.trim();for(let[p,m]of Object.entries(ab))if(m.test(f))return p;return null}u.getShellType=s;function a(d,f,p){if(r>=i){let m=Math.floor(i*.2),g=d.keys();for(let h=0;h<m;h++){let S=g.next().value;S&&(d.delete(S),r--)}}d.set(f,p),r++}function c(){n.clear(),e.clear(),r=0,Oa.debug("Prompt pattern caches cleared")}u.clearCache=c;function l(){return{size:r,maxSize:i,hitRate:{end:n.size,only:e.size}}}u.getCacheStats=l})(Br||={});var w_=Br.isPromptOnly,S_=Br.endsWithPrompt;var Wt=T("activity-detector"),Sm=process.env.VIBETUNNEL_CLAUDE_DEBUG==="true";function jt(n,...e){Sm&&console.log(`[ActivityDetector:DEBUG] ${n}`,...e)}var cb=/\x1b\[[0-9;]*[a-zA-Z]/g;function lb(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var wm=/(\S)\s+([\w\s]+?)…\s*\((\d+)s(?:\s*·\s*(\S?)\s*([\d.]+)\s*k?\s*tokens\s*·\s*[^)]+to\s+interrupt)?\)/gi;function ub(n){let e=n.replace(cb,"");wm.lastIndex=0,e.includes("interrupt")&&e.includes("tokens")&&(jt("Potential Claude status detected"),jt("Clean data sample:",e.substring(0,200).replace(/\n/g,"\\n")));let r=wm.exec(e);if(!r){if(e.includes("interrupt")&&e.includes("tokens")){jt("Claude status line NOT matched"),jt("Looking for pattern like: \u273B Crafting\u2026 (123s \xB7 \u2191 6.0k tokens \xB7 ... to interrupt)"),jt("Clean data preview:",e.substring(0,150));let m=e.split(`
`).find(g=>g.includes("interrupt")&&g.includes("tokens"));m&&(jt("Found status line:",m),jt("Line length:",m.length),Sm&&Array.from(m.substring(0,50)).forEach((h,S)=>{console.log(`  [${S}] '${h}' = U+${h.charCodeAt(0).toString(16).padStart(4,"0")}`)}))}return null}let[i,t,o,s,a,c]=r,l=a!==void 0&&c!==void 0;jt("Claude status MATCHED!"),jt(`Action: ${o}, Duration: ${s}s, Direction: ${a}, Tokens: ${c}`),jt(`Indicator: '${t}'`),Wt.debug(`Claude status MATCHED! Action: ${o}, Duration: ${s}s, Direction: ${a}, Tokens: ${c}`),Wt.debug(`Full match: "${i}"`);let u=e.indexOf(i),d=n;if(u>=0){let p=0,m=0;for(;m<u&&p<n.length;)if(n.startsWith("\x1B[",p)){let b=/^\x1b\[[0-9;]*[a-zA-Z]/.exec(n.substring(p));b?p+=b[0].length:p++}else p++,m++;let g=n.substring(0,Math.max(0,p-10)),h=n.substring(p+i.length+50),S=n.substring(Math.max(0,p-10),p+i.length+50),y=new RegExp(`[^
]*${lb(t)}[^
]*to\\s+interrupt[^
]*`,"gi"),k=S.replace(y,"");d=g+k+h}let f;if(l){let p=`${c}k`;f=`${o} (${s}s, ${a}${p})`}else f=`${o} (${s}s)`;return{filteredData:d,displayText:f,raw:{indicator:t,action:o,duration:Number.parseInt(s),progress:l?`${a}${c} tokens`:void 0}}}var db=[{name:"claude",detect:n=>{if(n.join(" ").toLowerCase().includes("claude"))return Wt.debug("Claude detected in command line"),!0;if(ym()){Wt.debug("Claude detected in process tree");let r=bm();return r&&Wt.debug(`Claude command from tree: ${r}`),!0}return!1},parseStatus:ub}],bn=class{lastActivityTime=Date.now();currentStatus=null;detector=null;lastStatusTime=0;ACTIVITY_TIMEOUT=5e3;STATUS_TIMEOUT=1e4;MEANINGFUL_OUTPUT_THRESHOLD=5;hadClaudeStatus=!1;onClaudeTurnCallback;sessionId;constructor(e,r){this.detector=db.find(i=>i.detect(e))||null,this.sessionId=r,this.detector?Wt.log(`ActivityDetector: Using ${this.detector.name} detector for command: ${e.join(" ")}`):Wt.debug(`ActivityDetector: No specific detector found for command: ${e.join(" ")}`)}isJustPrompt(e){return Br.isPromptOnly(e)}processOutput(e){let r=e.trim();if(r.length>this.MEANINGFUL_OUTPUT_THRESHOLD&&!this.isJustPrompt(r)&&(this.lastActivityTime=Date.now()),this.detector&&e.length>10&&jt(`Processing output with ${this.detector.name} detector (${e.length} chars)`),this.detector)try{let t=this.detector.parseStatus(e);if(t)return this.currentStatus=t,this.lastStatusTime=Date.now(),this.lastActivityTime=Date.now(),this.detector.name==="claude"&&(this.hadClaudeStatus=!0),{filteredData:t.filteredData,activity:{isActive:!0,lastActivityTime:this.lastActivityTime,specificStatus:{app:this.detector.name,status:t.displayText}}}}catch(t){Wt.error(`Error in ${this.detector.name} status parser:`,t)}return{filteredData:e,activity:this.getActivityState()}}setOnClaudeTurn(e){this.onClaudeTurnCallback=e}getActivityState(){let e=Date.now(),r=e-this.lastActivityTime<this.ACTIVITY_TIMEOUT;return this.currentStatus&&e-this.lastStatusTime>this.STATUS_TIMEOUT&&(Wt.debug("Clearing stale status - not seen for",this.STATUS_TIMEOUT,"ms"),this.currentStatus=null,this.hadClaudeStatus&&this.detector?.name==="claude"&&(Wt.log("Claude turn detected - status cleared, it's the user's turn"),this.onClaudeTurnCallback&&this.sessionId&&this.onClaudeTurnCallback(this.sessionId),this.hadClaudeStatus=!1)),{isActive:r,lastActivityTime:this.lastActivityTime,specificStatus:this.currentStatus&&this.detector?{app:this.detector.name,status:this.currentStatus.displayText}:void 0}}clearStatus(){this.currentStatus=null}};var So=class n{buffer="";static COMPLETE_TITLE_REGEX=/\x1b\][0-2];[^\x07\x1b]*(?:\x07|\x1b\\)/g;static PARTIAL_TITLE_REGEX=/\x1b\][0-2];.*\x1b$|\x1b\][0-2];[^\x07]*$|\x1b(?:\](?:[0-2])?)?$/;filter(e){this.buffer+=e;let r=this.buffer.replace(n.COMPLETE_TITLE_REGEX,""),i=r.match(n.PARTIAL_TITLE_REGEX);return i?(this.buffer=i[0],r.slice(0,-i[0].length)):(this.buffer="",r)}};W();var wn=C(require("os")),rr=C(require("path"));function $m(n){if(n==="/")return"";let e=n.split("/"),r=e[e.length-1]||n,i=[/-tree(?:test)?$/i,/-worktree$/i,/-wt-\w+$/i,/-work$/i,/-temp$/i,/-branch-\w+$/i,/-\w+$/i];for(let t of i)if(t.test(r)){let o=r.replace(t,"");if(o&&o.length>=2)return o}return r}var fb=/^\s*cd(?:\s+([^;&|\n]+?))?(?:\s*[;&|\n]|$)/;function ai(n,e,r){let i=wn.homedir(),t=n.startsWith(i)?n.replace(i,"~"):n,o=e[0]||"shell",s=rr.basename(o);if(r?.trim()){let l=r.trim();if(!(l===`${s} \xB7 ${s}`||l===s||l.match(new RegExp(`^${s}\\s*\\(.*\\)$`))))return`\x1B]2;${l}\x07`}let a=[t,s];if(r?.trim()){let l=r.trim();l===`${s} \xB7 ${s}`||l===s||l.match(new RegExp(`^${s}\\s*\\(.*\\)$`))||a.push(l)}return`\x1B]2;${a.join(" \xB7 ")}\x07`}function xm(n,e){let r=n.match(fb);if(!r)return null;if(!r[1])return wn.homedir();let i=r[1].trim();return(i.startsWith('"')&&i.endsWith('"')||i.startsWith("'")&&i.endsWith("'"))&&(i=i.slice(1,-1)),i==="-"?null:!i||i==="~"?wn.homedir():i.startsWith("~/")?rr.join(wn.homedir(),i.slice(2)):rr.isAbsolute(i)?i:rr.resolve(e,i)}function km(n){return Br.endsWithPrompt(n)}function _m(n,e,r,i,t,o){let s=wn.homedir(),a=n.startsWith(s)?n.replace(s,"~"):n,c=e[0]||"shell",l=rr.basename(c);if(i?.trim()){let f=i.trim();if(!(f===`${l} \xB7 ${l}`||f===l||f.match(new RegExp(`^${l}\\s*\\(.*\\)$`))))return r.specificStatus?`\x1B]2;${r.specificStatus.status} \xB7 ${f}\x07`:r.isActive?`\x1B]2;\u25CF ${f}\x07`:`\x1B]2;${f}\x07`}let u=[];if(t&&o){let f=$m(t);u.push(`${f}-${o}`)}else u.push(a);return u.push(l),i?.trim()&&u.push(i),r.specificStatus?`\x1B]2;${`${r.specificStatus.status} \xB7 ${u.join(" \xB7 ")}`}\x07`:r.isActive?`\x1B]2;${`\u25CF ${u.join(" \xB7 ")}`}\x07`:`\x1B]2;${u.join(" \xB7 ")}\x07`}Fe();var Pm={name:"vibetunnel",version:"1.0.0-beta.16",description:"Terminal sharing server with web interface - supports macOS, Linux, and headless environments",main:"dist/server/server.js",bin:{vibetunnel:"./bin/vibetunnel"},files:["dist/","public/","bin/","scripts/ensure-native-modules.js","scripts/postinstall-npm.js","scripts/install-vt-command.js","node-pty/lib/","node-pty/package.json","node-pty/binding.gyp","node-pty/src/","prebuilds/","README.md"],os:["darwin","linux"],engines:{node:">=20.0.0"},repository:{type:"git",url:"https://github.com/amantus-ai/vibetunnel.git",directory:"web"},homepage:"https://vibetunnel.sh",bugs:{url:"https://github.com/amantus-ai/vibetunnel/issues"},scripts:{clean:"node scripts/clean.js",dev:"node scripts/dev.js","dev:server":"tsx watch src/cli.ts --no-auth","dev:client":"node scripts/dev.js --client-only",build:"node scripts/build.js","build:ci":"node scripts/build-ci.js","build:npm":"node scripts/build-npm.js",prepublishOnly:"npm run build:npm",postinstall:"node scripts/postinstall-npm.js",prebuild:"echo 'Skipping prebuild - handled by build-npm.js'","prebuild:upload":"echo 'Skipping prebuild:upload - not used'",lint:'concurrently -n biome,tsc-server,tsc-client,tsc-sw "biome check src" "tsc --noEmit --project tsconfig.server.json" "tsc --noEmit --project tsconfig.client.json" "tsc --noEmit --project tsconfig.sw.json"',"lint:fix":"biome check src --write","lint:biome":"biome check src",typecheck:'concurrently -n server,client,sw "tsc --noEmit --project tsconfig.server.json" "tsc --noEmit --project tsconfig.client.json" "tsc --noEmit --project tsconfig.sw.json"',pretest:"node scripts/ensure-native-modules.js",test:"vitest","test:ci":"npm run pretest && vitest run --reporter=verbose","test:coverage":"vitest run --coverage","test:client":"vitest run --mode=client","test:server":"vitest run --mode=server","test:client:coverage":"vitest run --mode=client --coverage","test:server:coverage":"vitest run --mode=server --coverage",format:"biome format src --write","format:check":"biome format src",prettier:"prettier --write src --experimental-cli","prettier:check":"prettier --check src --experimental-cli","prettier:fast":"PRETTIER_EXPERIMENTAL_CLI=1 prettier --write src",check:"./scripts/check-all.sh","check:fix":"./scripts/check-fix-sequential.sh","test:vt":"./scripts/test-vt-syntax.sh",precommit:"pnpm run format && pnpm run lint:fix && pnpm run typecheck","test:e2e":"playwright test","test:e2e:headed":"playwright test --headed","test:e2e:debug":"playwright test --debug","test:e2e:skip-failing":"playwright test --config=playwright.config.skip-failing.ts","test:e2e:ui":"playwright test --ui","test:e2e:report":"playwright show-report","test:e2e:parallel":"PLAYWRIGHT_PARALLEL=true playwright test","test:e2e:parallel:headed":"PLAYWRIGHT_PARALLEL=true playwright test --headed","test:e2e:parallel:workers":"PLAYWRIGHT_PARALLEL=true PLAYWRIGHT_WORKERS=4 playwright test","test:e2e:fast":"./scripts/test-fast.sh","test:e2e:perf":"playwright test --config=playwright.config.performance.ts",prepare:"husky"},pnpm:{onlyBuiltDependencies:["authenticate-pam","esbuild","node-pty","puppeteer"]},dependencies:{"@codemirror/commands":"^6.8.1","@codemirror/lang-css":"^6.3.1","@codemirror/lang-html":"^6.4.9","@codemirror/lang-javascript":"^6.2.4","@codemirror/lang-json":"^6.0.2","@codemirror/lang-markdown":"^6.3.4","@codemirror/lang-python":"^6.2.1","@codemirror/state":"^6.5.2","@codemirror/theme-one-dark":"^6.1.3","@codemirror/view":"^6.38.1","@types/cookie-parser":"^1.4.9","@xterm/headless":"^5.5.0","authenticate-pam":"^1.0.5","bonjour-service":"^1.3.0",chalk:"^5.4.1",compression:"^1.8.1","cookie-parser":"^1.4.7",express:"^5.1.0",helmet:"^8.1.0","http-proxy-middleware":"^3.0.5",jsonwebtoken:"^9.0.2",lit:"^3.3.1","mime-types":"^3.0.1","monaco-editor":"^0.52.2",multer:"^2.0.2","node-pty":"file:node-pty",postject:"1.0.0-alpha.6","signal-exit":"^4.1.0","web-push":"^3.6.7",ws:"^8.18.3",zod:"^4.0.14"},devDependencies:{"@biomejs/biome":"^2.1.3","@open-wc/testing":"^4.0.0","@playwright/test":"^1.54.2","@prettier/plugin-oxc":"^0.0.4","@tailwindcss/postcss":"^4.1.11","@testing-library/dom":"^10.4.1","@types/compression":"^1.8.1","@types/express":"^5.0.3","@types/jsonwebtoken":"^9.0.10","@types/mime-types":"^3.0.1","@types/multer":"^2.0.0","@types/node":"^24.1.0","@types/supertest":"^6.0.3","@types/uuid":"^10.0.0","@types/web-push":"^3.6.4","@types/ws":"^8.18.1","@vitest/coverage-v8":"^3.2.4","@vitest/ui":"^3.2.4",autoprefixer:"^10.4.21",chokidar:"^4.0.3","chokidar-cli":"^3.0.0",concurrently:"^9.2.0",esbuild:"^0.25.8","happy-dom":"^18.0.1",husky:"^9.1.7","lint-staged":"^16.1.2","node-fetch":"^3.3.2",postcss:"^8.5.6","postcss-cli":"^11.0.1",prettier:"^3.6.2",puppeteer:"^24.15.0",supertest:"^7.1.4",tailwindcss:"^4.1.11",tsx:"^4.20.3",typescript:"^5.9.2",uuid:"^11.1.0",vitest:"^3.2.4","ws-mock":"^0.1.0"},keywords:["terminal","multiplexer","websocket","asciinema"],author:"",license:"MIT","lint-staged":{"src/**/*.{ts,tsx,js,jsx}":["biome check --write","bash -c 'tsc --noEmit --project tsconfig.server.json'","bash -c 'tsc --noEmit --project tsconfig.client.json'","bash -c 'tsc --noEmit --project tsconfig.sw.json'"],"../{ios,mac}/**/*.swift":["bash -c 'cd ../ios && ./scripts/lint.sh'","bash -c 'cd ../mac && ./scripts/lint.sh'"]}};W();var _r=T("version"),Le=Pm.version,Pr=process.env.BUILD_DATE||new Date().toISOString(),pb=process.env.BUILD_TIMESTAMP||Date.now(),Sn=process.env.GIT_COMMIT||"development",Tm=process.version,Im=process.platform,Em=process.arch;function ci(){_r.debug("gathering version information");let n={version:Le,buildDate:Pr,buildTimestamp:pb,gitCommit:Sn,nodeVersion:Tm,platform:Im,arch:Em,uptime:process.uptime(),pid:process.pid};return _r.debug(`version info: ${JSON.stringify(n)}`),n}function Cm(){_r.log(v.green(`VibeTunnel Server v${Le}`)),_r.log(v.gray(`Built: ${Pr}`)),_r.log(v.gray(`Platform: ${Im}/${Em} Node ${Tm}`)),_r.log(v.gray(`PID: ${process.pid}`)),Sn!=="development"&&_r.log(v.gray(`Commit: ${Sn}`)),(Sn==="development"||!process.env.BUILD_DATE)&&_r.log(v.yellow("running in development mode"))}Ir();Ba();Fe();var Om=require("child_process"),Q=C(require("fs")),Mm=C(require("os")),Ke=C(require("path"));W();var q=T("session-manager"),ir=class n{controlPath;static SESSION_ID_REGEX=/^[a-zA-Z0-9_-]+$/;constructor(e){this.controlPath=e||Ke.join(Mm.homedir(),".vibetunnel","control"),q.debug(`initializing session manager with control path: ${this.controlPath}`),this.ensureControlDirectory()}validateSessionId(e){if(!n.SESSION_ID_REGEX.test(e))throw new J(`Invalid session ID format: "${e}". Session IDs must only contain letters, numbers, hyphens (-), and underscores (_).`,"INVALID_SESSION_ID")}ensureControlDirectory(){Q.existsSync(this.controlPath)||(Q.mkdirSync(this.controlPath,{recursive:!0}),q.debug(v.green(`control directory created: ${this.controlPath}`)))}getVersionFilePath(){return Ke.join(this.controlPath,".version")}readLastVersion(){try{let e=this.getVersionFilePath();if(Q.existsSync(e)){let r=Q.readFileSync(e,"utf8").trim();return q.debug(`read last version from file: ${r}`),r}return null}catch(e){return q.warn(`failed to read version file: ${e}`),null}}writeCurrentVersion(){try{let e=this.getVersionFilePath();Q.writeFileSync(e,Le,"utf8"),q.debug(`wrote current version to file: ${Le}`)}catch(e){q.warn(`failed to write version file: ${e}`)}}createSessionDirectory(e){this.validateSessionId(e);let r=Ke.join(this.controlPath,e);Q.existsSync(r)||Q.mkdirSync(r,{recursive:!0});let i=this.getSessionPaths(e,!0);if(!i)throw new Error(`Session ${e} not found`);return this.createStdinPipe(i.stdinPath),q.debug(v.green(`session directory created for ${e}`)),i}createStdinPipe(e){try{if(process.platform!=="win32"&&(0,Om.spawnSync)("mkfifo",[e],{stdio:"ignore"}).status===0){q.debug(`FIFO pipe created: ${e}`);return}Q.existsSync(e)||Q.writeFileSync(e,"")}catch(r){q.debug(`mkfifo failed (${r instanceof Error?r.message:"unknown error"}), creating regular file: ${e}`),Q.existsSync(e)||Q.writeFileSync(e,"")}}saveSessionInfo(e,r){this.validateSessionId(e);try{let i=Ke.join(this.controlPath,e),t=Ke.join(i,"session.json"),o=`${t}.tmp`;Q.existsSync(i)||(q.warn(`Session directory ${i} does not exist, creating it`),Q.mkdirSync(i,{recursive:!0}));let s=JSON.stringify(r,null,2);if(Q.writeFileSync(o,s,"utf8"),!Q.existsSync(i))throw q.error(`Session directory ${i} was deleted during save operation`),Q.existsSync(o)&&Q.unlinkSync(o),new J("Session directory was deleted during save operation","SESSION_DIR_DELETED");Q.renameSync(o,t),q.debug(`session.json file saved for session ${e} with name: ${r.name}`)}catch(i){throw i instanceof J?i:new J(`Failed to save session info: ${i instanceof Error?i.message:String(i)}`,"SAVE_SESSION_FAILED")}}loadSessionInfo(e){let r=Ke.join(this.controlPath,e,"session.json");try{if(!Q.existsSync(r))return null;let i=Q.readFileSync(r,"utf8");return JSON.parse(i)}catch(i){return q.warn(`failed to load session info for ${e}:`,i),null}}updateSessionStatus(e,r,i,t){let o=this.loadSessionInfo(e);if(!o)throw new J("Session info not found","SESSION_NOT_FOUND");i!==void 0&&(o.pid=i),o.status=r,t!==void 0&&(o.exitCode=t),this.saveSessionInfo(e,o),q.debug(`session ${e} status updated to ${r}${i?` (pid: ${i})`:""}${t!==void 0?` (exit code: ${t})`:""}`)}ensureUniqueName(e,r){let i=this.listSessions(),t=e,o=2;for(;i.some(a=>a.name===t&&a.id!==r);)t=`${e} (${o})`,o++;return t}updateSessionName(e,r){q.debug(`[SessionManager] updateSessionName called for session ${e} with name: ${r}`);let i=this.loadSessionInfo(e);if(!i)throw q.error(`[SessionManager] Session info not found for ${e}`),new J("Session info not found","SESSION_NOT_FOUND");q.debug(`[SessionManager] Current session info: ${JSON.stringify(i)}`);let t=this.ensureUniqueName(r,e);return t!==r&&q.debug(`[SessionManager] Name "${r}" already exists, using "${t}" instead`),i.name=t,q.debug(`[SessionManager] Updated session info: ${JSON.stringify(i)}`),q.debug("[SessionManager] Calling saveSessionInfo"),this.saveSessionInfo(e,i),q.debug(`[SessionManager] session ${e} name updated to: ${t}`),t}listSessions(){try{if(!Q.existsSync(this.controlPath))return[];let e=[],r=Q.readdirSync(this.controlPath,{withFileTypes:!0});for(let i of r)if(i.isDirectory()){let t=i.name,o=Ke.join(this.controlPath,t),s=Ke.join(o,"stdout"),a=this.loadSessionInfo(t);if(a)if(a.status==="running"&&a.pid&&(st.isProcessRunning(a.pid)||(q.debug(v.yellow(`process ${a.pid} no longer running for session ${t}`)),a.status="exited",a.exitCode===void 0&&(a.exitCode=1),this.saveSessionInfo(t,a))),Q.existsSync(s)){let c=Q.statSync(s).mtime.toISOString();e.push({...a,id:t,lastModified:c})}else e.push({...a,id:t,lastModified:a.startedAt})}return e.sort((i,t)=>{let o=i.startedAt?new Date(i.startedAt).getTime():0;return(t.startedAt?new Date(t.startedAt).getTime():0)-o}),q.debug(`listSessions found ${e.length} sessions`),e.forEach(i=>{q.debug(`  - Session ${i.id}: name="${i.name}", status="${i.status}"`)}),e}catch(e){throw new J(`Failed to list sessions: ${e instanceof Error?e.message:String(e)}`,"LIST_SESSIONS_FAILED")}}sessionExists(e){let r=Ke.join(this.controlPath,e),i=Ke.join(r,"session.json");return Q.existsSync(i)}cleanupSession(e){if(!e)throw new J("Session ID is required for cleanup","INVALID_SESSION_ID");try{let r=Ke.join(this.controlPath,e);if(Q.existsSync(r)){q.debug(`Cleaning up session directory: ${r}`);let i=this.loadSessionInfo(e);i&&q.debug(`Cleaning up session ${e} with status: ${i.status}`),Q.rmSync(r,{recursive:!0,force:!0}),q.debug(v.green(`session ${e} cleaned up`))}else q.debug(`Session directory ${r} does not exist, nothing to clean up`)}catch(r){throw new J(`Failed to cleanup session ${e}: ${r instanceof Error?r.message:String(r)}`,"CLEANUP_FAILED",e)}}cleanupExitedSessions(){let e=[];try{let r=this.listSessions();for(let i of r)i.status==="exited"&&i.id&&(this.cleanupSession(i.id),e.push(i.id));return e.length>0&&q.debug(v.green(`cleaned up ${e.length} exited sessions`)),e}catch(r){throw new J(`Failed to cleanup exited sessions: ${r instanceof Error?r.message:String(r)}`,"CLEANUP_EXITED_FAILED")}}cleanupOldVersionSessions(){let e=this.readLastVersion(),r=Le;if(!e){q.debug("no previous version found, checking for legacy sessions"),this.updateZombieSessions();let t=0,o=this.listSessions();for(let s of o)s.version||(s.status==="exited"||s.pid&&!st.isProcessRunning(s.pid)?(q.debug(`cleaning up legacy zombie session ${s.id} (no version field)`),this.cleanupSession(s.id),t++):q.debug(`preserving active legacy session ${s.id}`));return this.writeCurrentVersion(),{versionChanged:!1,cleanedCount:t}}if(e===r)return q.debug(`version unchanged (${r}), skipping cleanup`),{versionChanged:!1,cleanedCount:0};q.log(v.yellow(`VibeTunnel version changed from ${e} to ${r}`)),q.log(v.yellow("cleaning up zombie sessions from old version...")),this.updateZombieSessions();let i=0;try{let t=this.listSessions();for(let o of t)(!o.version||o.version!==r)&&(o.status==="exited"||o.pid&&!st.isProcessRunning(o.pid)?(q.debug(`cleaning up zombie session ${o.id} (version: ${o.version||"unknown"})`),this.cleanupSession(o.id),i++):q.debug(`preserving active session ${o.id} (version: ${o.version||"unknown"})`));return this.writeCurrentVersion(),i>0?q.log(v.green(`cleaned up ${i} zombie sessions from previous version`)):q.log(v.gray("no zombie sessions to clean up (active sessions preserved)")),{versionChanged:!0,cleanedCount:i}}catch(t){return q.error(`failed to cleanup old version sessions: ${t}`),this.writeCurrentVersion(),{versionChanged:!0,cleanedCount:i}}}getSessionPaths(e,r=!1){let i=Ke.join(this.controlPath,e);return q.debug(`[SessionManager] getSessionPaths for ${e}, sessionDir: ${i}, checkExists: ${r}`),r&&!Q.existsSync(i)?(q.debug(`[SessionManager] Session directory does not exist: ${i}`),null):{controlDir:i,stdoutPath:Ke.join(i,"stdout"),stdinPath:Ke.join(i,"stdin"),sessionJsonPath:Ke.join(i,"session.json")}}writeToStdin(e,r){let i=this.getSessionPaths(e);if(!i)throw new J(`Session ${e} not found`,"SESSION_NOT_FOUND",e);try{Q.appendFileSync(i.stdinPath,r),q.debug(`wrote ${r.length} bytes to stdin for session ${e}`)}catch(t){throw new J(`Failed to write to stdin for session ${e}: ${t instanceof Error?t.message:String(t)}`,"STDIN_WRITE_FAILED",e)}}updateZombieSessions(){let e=[];try{let r=this.listSessions();for(let i of r)i.status==="running"&&i.pid&&(st.isProcessRunning(i.pid)||this.getSessionPaths(i.id)&&(q.debug(v.yellow(`marking zombie process ${i.pid} as exited for session ${i.id}`)),this.updateSessionStatus(i.id,"exited",void 0,1),e.push(i.id)));return e}catch(r){return q.warn("failed to update zombie sessions:",r),[]}}getControlPath(){return this.controlPath}};li();var Bm,x=T("pty-manager"),yb=1e3,bb=50,wb=10,Wm=500,Za=3e3,Sb=new Set(["cd","ls","pwd","echo","export","alias","unset"]),or=class n extends di.EventEmitter{sessions=new Map;sessionManager;defaultTerm="xterm-256color";inputSocketClients=new Map;lastTerminalSize=null;resizeEventListeners=[];sessionResizeSources=new Map;static initialized=!1;sessionEventListeners=new Map;sessionExitTimes=new Map;processTreeAnalyzer=new si;activityFileWarningsLogged=new Set;lastWrittenActivityState=new Map;sessionMonitor=null;commandTracking=new Map;constructor(e){if(super(),this.sessionManager=new ir(e),this.processTreeAnalyzer=new si,this.setupTerminalResizeDetection(),!n.initialized)throw new Error("PtyManager not initialized. Call PtyManager.initialize() first.")}static async initialize(){if(!n.initialized)try{x.log("Initializing PtyManager..."),Bm=await Promise.resolve().then(()=>C(Lm())),n.initialized=!0,x.log("\u2705 PtyManager initialized successfully")}catch(e){throw x.error("Failed to initialize PtyManager:",e),new Error(`Cannot load node-pty: ${e instanceof Error?e.message:String(e)}`)}}setSessionMonitor(e){this.sessionMonitor=e}setupTerminalResizeDetection(){if(!process.stdout.isTTY){x.debug("Not a TTY, skipping terminal resize detection");return}this.lastTerminalSize={cols:process.stdout.columns||80,rows:process.stdout.rows||24};let e=()=>{let i=process.stdout.columns||80,t=process.stdout.rows||24;this.handleTerminalResize(i,t)};process.stdout.on("resize",e),this.resizeEventListeners.push(()=>{process.stdout.removeListener("resize",e)});let r=()=>{let i=process.stdout.columns||80,t=process.stdout.rows||24;this.handleTerminalResize(i,t)};process.on("SIGWINCH",r),this.resizeEventListeners.push(()=>{process.removeListener("SIGWINCH",r)})}handleTerminalResize(e,r){if(this.lastTerminalSize&&this.lastTerminalSize.cols===e&&this.lastTerminalSize.rows===r)return;x.log(v.blue(`Terminal resized to ${e}x${r}`)),this.lastTerminalSize={cols:e,rows:r};let i=Date.now();for(let[t,o]of this.sessions)if(o.ptyProcess&&o.sessionInfo.status==="running"){let s=this.sessionResizeSources.get(t);if(!s||s.source==="terminal"||i-s.timestamp>1e3)try{o.ptyProcess.resize(e,r),o.asciinemaWriter?.writeResize(e,r),this.sessionResizeSources.set(t,{cols:e,rows:r,source:"terminal",timestamp:i}),x.debug(`Resized session ${t} to ${e}x${r} from terminal`)}catch(c){x.error(`Failed to resize session ${t}:`,c)}else x.debug(`Skipping terminal resize for session ${t} (browser has precedence)`)}}async createSession(e,r){let i=r.sessionId||Nt(),t=r.name||$t.basename(e[0]),o=$t.resolve(__dirname,"..",".."),s=r.workingDir||o,a=this.defaultTerm,c=r.cols,l=r.rows;x.debug("Session creation parameters:",{sessionId:i,sessionName:t,workingDir:s,term:a,cols:c!==void 0?c:"terminal default",rows:l!==void 0?l:"terminal default"});try{let u=this.sessionManager.createSessionDirectory(i),d=st.resolveCommand(e),{command:f,args:p}=d,m=[f,...p];d.resolvedFrom==="alias"?x.log(v.cyan(`Using alias: '${d.originalCommand}' \u2192 '${m.join(" ")}'`)):d.resolvedFrom==="path"&&d.originalCommand?x.log(v.gray(`Resolved '${d.originalCommand}' \u2192 '${f}'`)):d.useShell&&x.debug(`Using shell to execute ${d.resolvedFrom}: ${e.join(" ")}`),x.debug(v.blue(`Creating PTY session with command: ${m.join(" ")}`)),x.debug(`Working directory: ${s}`);let g=!!process.env.VIBETUNNEL_SESSION_ID,h={id:i,command:m,name:t,workingDir:s,status:"starting",startedAt:new Date().toISOString(),initialCols:c,initialRows:l,lastClearOffset:0,version:Le,gitRepoPath:r.gitRepoPath,gitBranch:r.gitBranch,gitAheadCount:r.gitAheadCount,gitBehindCount:r.gitBehindCount,gitHasChanges:r.gitHasChanges,gitIsWorktree:r.gitIsWorktree,gitMainRepoPath:r.gitMainRepoPath,attachedViaVT:g};this.sessionManager.saveSessionInfo(i,h);let S=oi.create(u.stdoutPath,c||void 0,l||void 0,e.join(" "),t,this.createEnvVars(a));S.onPruningSequence(async({sequence:z,position:L})=>{let F=this.sessionManager.loadSessionInfo(i);F&&(F.lastClearOffset=L,await this.sessionManager.saveSessionInfo(i,F),x.debug(`Updated lastClearOffset for session ${i} to exact position ${L} after detecting pruning sequence '${z.split("\x1B").join("\\x1b")}'`))});let y;try{let z={...process.env,TERM:a,VIBETUNNEL_SESSION_ID:i};x.debug("PTY spawn parameters:",{command:f,args:p,options:{name:a,cols:c!==void 0?c:"terminal default",rows:l!==void 0?l:"terminal default",cwd:s,hasEnv:!!z,envKeys:Object.keys(z).length}});let L={name:a,cwd:s,env:z};c!==void 0&&(L.cols=c),l!==void 0&&(L.rows=l),y=Bm.spawn(f,p,L);let F=X=>{let K=Date.now()-Date.parse(h.startedAt);K<1e3&&(x.error(`PTY process exited quickly after spawn! Exit code: ${X.exitCode}, signal: ${X.signal}, time: ${K}ms`),x.error("This often happens in CI when PTY allocation fails or shell is misconfigured"),x.error("Debug info:",{SHELL:process.env.SHELL,TERM:process.env.TERM,CI:process.env.CI,NODE_ENV:process.env.NODE_ENV,command:f,args:p,cwd:s,cwdExists:Qe.existsSync(s),commandExists:Qe.existsSync(f)}))};y.onExit(F)}catch(z){x.debug("Raw spawn error:",{type:typeof z,isError:z instanceof Error,errorString:String(z),errorKeys:z&&typeof z=="object"?Object.keys(z):[]});let L=z instanceof Error?z.message:String(z),F=z instanceof Error&&"code"in z?z.code:void 0;F==="ENOENT"||L.includes("ENOENT")?L=`Command not found: '${e[0]}'. Please ensure the command exists and is in your PATH.`:F==="EACCES"||L.includes("EACCES")?L=`Permission denied: '${e[0]}'. The command exists but is not executable.`:F==="ENXIO"||L.includes("ENXIO")?L=`Failed to allocate terminal for '${e[0]}'. This may occur if the command doesn't exist or the system cannot create a pseudo-terminal.`:(L.includes("cwd")||L.includes("working directory"))&&(L=`Working directory does not exist: '${s}'`);let X=z instanceof Error?{...z,message:z.message,stack:z.stack,code:z.code}:z;throw x.error(`Failed to spawn PTY for command '${e.join(" ")}':`,X),new J(L,"SPAWN_FAILED")}let k=r.titleMode;k||e.some(L=>L.toLowerCase().includes("claude"))&&(k="dynamic",x.log(v.cyan("\u2713 Auto-selected dynamic title mode for Claude")),x.debug(`Detected Claude in command: ${e.join(" ")}`));let b=m.includes("tmux")&&(m.includes("attach-session")||m.includes("attach")||m.includes("a"))||t.startsWith("tmux:"),R={id:i,sessionInfo:h,ptyProcess:y,asciinemaWriter:S,controlDir:u.controlDir,stdoutPath:u.stdoutPath,stdinPath:u.stdinPath,sessionJsonPath:u.sessionJsonPath,startTime:new Date,titleMode:k||"none",isExternalTerminal:!!r.forwardToStdout,currentWorkingDir:s,titleFilter:new So,isTmuxAttachment:b};return this.sessions.set(i,R),h.pid=y.pid,h.status="running",this.sessionManager.saveSessionInfo(i,h),r.forwardToStdout&&this.setupSessionWatcher(R),x.debug(v.green(`Session ${i} created successfully (PID: ${y.pid})`)),x.log(v.gray(`Running: ${m.join(" ")} in ${s}`)),this.setupPtyHandlers(R,r.forwardToStdout||!1,r.onExit),this.startForegroundProcessTracking(R),this.emit("sessionStarted",i,h.name||h.command.join(" ")),ee.isMacAppConnected()&&ee.sendNotification("Session Started",h.name||h.command.join(" "),{type:"session-start",sessionId:i,sessionName:h.name||h.command.join(" ")}),{sessionId:i,sessionInfo:h}}catch(u){try{this.sessionManager.cleanupSession(i)}catch(d){x.warn(`Failed to cleanup session ${i} after creation failure:`,d)}throw new J(`Failed to create session: ${u instanceof Error?u.message:String(u)}`,"SESSION_CREATE_FAILED")}}getPtyForSession(e){return this.sessions.get(e)?.ptyProcess||null}getInternalSession(e){return this.sessions.get(e)}setupPtyHandlers(e,r,i){let{ptyProcess:t,asciinemaWriter:o}=e;if(!t){x.error(`No PTY process found for session ${e.id}`);return}let s=r?new Fr:null;s&&(e.stdoutQueue=s);let a=new Fr;if(e.inputQueue=a,e.titleMode==="dynamic"&&(e.activityDetector=new bn(e.sessionInfo.command,e.id),e.activityDetector.setOnClaudeTurn(c=>{x.info(`\u{1F514} NOTIFICATION DEBUG: Claude turn detected for session ${c}`),this.emit("claudeTurn",c,e.sessionInfo.name||e.sessionInfo.command.join(" "))})),e.titleMode!=="none"&&e.titleMode!=="filter"&&r){let c=null;e.titleUpdateInterval=setInterval(()=>{if(e.titleMode==="dynamic"&&e.activityDetector){let l=e.activityDetector.getActivityState();(c===null||l.isActive!==c.isActive||l.specificStatus?.status!==c.specificStatus)&&(c={isActive:l.isActive,specificStatus:l.specificStatus?.status},this.markTitleUpdateNeeded(e),x.debug(`Activity state changed for session ${e.id}: active=${l.isActive}, status=${l.specificStatus?.status||"none"}`),!l.isActive&&l.specificStatus?.status==="waiting"&&(x.info(`\u{1F514} NOTIFICATION DEBUG: Claude turn detected for session ${e.id}`),this.emit("claudeTurn",e.id,e.sessionInfo.name||e.sessionInfo.command.join(" ")),ee.isMacAppConnected()&&ee.sendNotification("Your Turn","Claude has finished responding",{type:"your-turn",sessionId:e.id,sessionName:e.sessionInfo.name||e.sessionInfo.command.join(" ")}))),this.writeActivityState(e,l)}this.checkAndUpdateTitle(e)},yb)}t.onData(c=>{let l=c;if(this.sessionMonitor&&this.sessionMonitor.trackPtyOutput(e.id,c),e.titleMode!==void 0&&e.titleMode!=="none"&&(l=e.titleFilter?e.titleFilter.filter(c):c),e.titleMode==="dynamic"&&e.activityDetector){let{filteredData:u,activity:d}=e.activityDetector.processOutput(l);if(l=u,d.specificStatus?.status!==e.lastActivityStatus&&(e.lastActivityStatus=d.specificStatus?.status,this.markTitleUpdateNeeded(e),this.sessionMonitor)){let f=d.specificStatus?.status==="working";this.sessionMonitor.updateSessionActivity(e.id,f,d.specificStatus?.app)}}e.titleMode==="static"&&r&&(!e.initialTitleSent||km(l))&&(this.markTitleUpdateNeeded(e),e.initialTitleSent||(e.initialTitleSent=!0)),o?.writeOutput(Buffer.from(l,"utf8")),r&&s&&s.enqueue(async()=>{let u=process.stdout.write(l);e.lastWriteTimestamp=Date.now(),u||await(0,di.once)(process.stdout,"drain")})}),t.onExit(async({exitCode:c,signal:l})=>{try{if(this.sessionExitTimes.set(e.id,Date.now()),o?.isOpen()&&(o.writeRawJson(["exit",c||0,e.id]),o.close().catch(u=>x.error(`Failed to close asciinema writer for session ${e.id}:`,u))),this.sessionManager.updateSessionStatus(e.id,"exited",void 0,c||(l?128+(typeof l=="number"?l:1):1)),e.stdoutQueue)try{await e.stdoutQueue.drain()}catch(u){x.error(`Failed to drain stdout queue for session ${e.id}:`,u)}this.cleanupSessionResources(e),this.sessions.delete(e.id),this.commandTracking.delete(e.id),this.emit("sessionExited",e.id,e.sessionInfo.name||e.sessionInfo.command.join(" "),c),ee.isMacAppConnected()&&ee.sendNotification("Session Ended",e.sessionInfo.name||e.sessionInfo.command.join(" "),{type:"session-exit",sessionId:e.id,sessionName:e.sessionInfo.name||e.sessionInfo.command.join(" ")}),i&&i(c||0,l)}catch(u){x.error(`Failed to handle exit for session ${e.id}:`,u)}}),r&&(e.titleMode==="static"||e.titleMode==="dynamic")&&(this.markTitleUpdateNeeded(e),e.initialTitleSent=!0,x.debug(`Marked initial title update for session ${e.id}`)),this.setupIPCSocket(e)}setupIPCSocket(e){if(!e.ptyProcess){x.error(`No PTY process found for session ${e.id}`);return}let i=$t.join(e.controlDir,"ipc.sock");if(i.length>103){let t=new Error(`Socket path too long: ${i.length} characters`);throw x.error(`Socket path too long (${i.length} chars): ${i}`),x.error("macOS limit is 103 characters. Consider using shorter session IDs or control paths."),t}try{try{Qe.unlinkSync(i)}catch{}e.connectedClients||(e.connectedClients=new Set);let t=fi.createServer(o=>{let s=new Cr;o.setNoDelay(!0),e.connectedClients?.add(o),x.debug(`Client connected to session ${e.id}, total clients: ${e.connectedClients?.size}`),o.on("data",a=>{s.addData(a);for(let{type:c,payload:l}of s.parseMessages())this.handleSocketMessage(e,c,l)}),o.on("error",a=>{x.debug(`Client socket error for session ${e.id}:`,a)}),o.on("close",()=>{e.connectedClients?.delete(o),x.debug(`Client disconnected from session ${e.id}, remaining clients: ${e.connectedClients?.size}`)})});t.listen(i,()=>{try{Qe.chmodSync(i,438)}catch(o){x.debug(`Failed to chmod input socket for session ${e.id}:`,o)}x.debug(`Input socket created for session ${e.id}`)}),e.inputSocketServer=t}catch(t){x.error(`Failed to create input socket for session ${e.id}:`,t)}}setupSessionWatcher(e){let r=$t.join(e.controlDir,"session.json");try{let i=setInterval(()=>{try{let t=this.sessionManager.loadSessionInfo(e.id);if(t&&t.name!==e.sessionInfo.name){let o=e.sessionInfo.name;e.sessionInfo.name=t.name,x.debug(`Session ${e.id} name changed from "${o}" to "${t.name}"`),this.trackAndEmit("sessionNameChanged",e.id,t.name),e.isExternalTerminal&&(e.titleMode==="static"||e.titleMode==="dynamic")&&this.markTitleUpdateNeeded(e)}}catch(t){x.debug(`Failed to read session file for ${e.id}:`,t)}},100);e.sessionJsonInterval=i,x.debug(`Session watcher setup for ${e.id}`)}catch(i){x.error(`Failed to setup session watcher for ${e.id}:`,i)}}handleSocketMessage(e,r,i){try{let t=kn(r,i);switch(r){case 1:{let o=t;e.ptyProcess&&e.inputQueue&&e.inputQueue.enqueue(()=>{e.ptyProcess&&e.ptyProcess.write(o),e.asciinemaWriter?.writeInput(o)});break}case 2:{let o=t;this.handleControlMessage(e,o);break}case 3:{let o=t;if(e.activityStatus||(e.activityStatus={}),e.activityStatus.specificStatus={app:o.app,status:o.status},x.debug(`Updated status for session ${e.id}:`,o),e.connectedClients&&e.connectedClients.size>0){let s=Ee(3,o);for(let a of e.connectedClients)try{a.write(s)}catch(c){x.debug("Failed to broadcast status to client:",c)}x.debug(`Broadcasted status update to ${e.connectedClients.size} clients`)}break}case 4:break;default:x.debug(`Unknown message type ${r} for session ${e.id}`)}}catch(t){let o=t instanceof Error?t.message:String(t);x.error(`Failed to handle socket message for session ${e.id}: ${o}`)}}handleControlMessage(e,r){if(r.cmd==="resize"&&typeof r.cols=="number"&&typeof r.rows=="number")try{e.ptyProcess&&(e.ptyProcess.resize(r.cols,r.rows),e.asciinemaWriter?.writeResize(r.cols,r.rows))}catch(i){x.warn(`Failed to resize session ${e.id} to ${r.cols}x${r.rows}:`,i)}else if(r.cmd==="kill"){let i=typeof r.signal=="string"||typeof r.signal=="number"?r.signal:"SIGTERM";try{e.ptyProcess&&e.ptyProcess.kill(i)}catch(t){x.warn(`Failed to kill session ${e.id} with signal ${i}:`,t)}}else if(r.cmd==="reset-size")try{if(e.ptyProcess){let i=process.stdout.columns||80,t=process.stdout.rows||24;e.ptyProcess.resize(i,t),e.asciinemaWriter?.writeResize(i,t),x.debug(`Reset session ${e.id} size to terminal size: ${i}x${t}`)}}catch(i){x.warn(`Failed to reset session ${e.id} size to terminal size:`,i)}else r.cmd==="update-title"&&typeof r.title=="string"&&(x.debug(`[IPC] Received title update for session ${e.id}: "${r.title}"`),x.debug(`[IPC] Current session name before update: "${e.sessionInfo.name}"`),this.updateSessionName(e.id,r.title))}async getFishCompletions(e,r){try{let i=this.sessions.get(e);if(!i)return[];let t=st.getUserShell();if(!xn.isFishShell(t))return[];let{fishHandler:o}=await Promise.resolve().then(()=>(Ba(),Rm)),s=i.currentWorkingDir||process.cwd();return await o.getCompletions(r,s)}catch(i){return x.warn(`Fish completions failed: ${i}`),[]}}sendInput(e,r){try{let i="";if(r.text!==void 0)i=r.text,x.debug(`Received text input: ${JSON.stringify(r.text)} -> sending: ${JSON.stringify(i)}`);else if(r.key!==void 0)i=this.convertSpecialKey(r.key),x.debug(`Received special key: "${r.key}" -> converted to: ${JSON.stringify(i)}`);else throw new J("No text or key specified in input","INVALID_INPUT");let t=this.sessions.get(e);if(t?.ptyProcess&&t.inputQueue){t.inputQueue.enqueue(()=>{if(t.ptyProcess&&t.ptyProcess.write(i),t.asciinemaWriter?.writeInput(i),(t.titleMode==="static"||t.titleMode==="dynamic")&&r.text){let o=xm(r.text,t.currentWorkingDir||t.sessionInfo.workingDir);o&&(t.currentWorkingDir=o,this.markTitleUpdateNeeded(t),x.debug(`Session ${e} changed directory to: ${o}`))}});return}else{let o=this.sessionManager.getSessionPaths(e);if(!o)throw new J(`Session ${e} paths not found`,"SESSION_PATHS_NOT_FOUND",e);let s=$t.join(o.controlDir,"ipc.sock"),a=this.inputSocketClients.get(e);if(!a||a.destroyed)try{a=fi.createConnection(s),a.setNoDelay(!0),a.setKeepAlive(!0,0),this.inputSocketClients.set(e,a),a.on("error",()=>{this.inputSocketClients.delete(e)}),a.on("close",()=>{this.inputSocketClients.delete(e)})}catch(c){x.debug(`Failed to connect to input socket for session ${e}:`,c),a=void 0}if(a&&!a.destroyed){let c=Ee(1,i);a.write(c)||x.debug(`Socket buffer full for session ${e}, data queued`)}else throw new J(`No socket connection available for session ${e}`,"NO_SOCKET_CONNECTION",e)}}catch(i){throw new J(`Failed to send input to session ${e}: ${i instanceof Error?i.message:String(i)}`,"SEND_INPUT_FAILED",e)}}sendControlMessage(e,r){let i=this.sessionManager.getSessionPaths(e);if(!i)return!1;try{let t=$t.join(i.controlDir,"ipc.sock"),o=this.inputSocketClients.get(e);if(!o||o.destroyed)try{o=fi.createConnection(t),o.setNoDelay(!0),o.setKeepAlive(!0,0),this.inputSocketClients.set(e,o),o.on("error",()=>{this.inputSocketClients.delete(e)}),o.on("close",()=>{this.inputSocketClients.delete(e)})}catch(s){return x.debug(`Failed to connect to control socket for session ${e}:`,s),!1}if(o&&!o.destroyed){let s=Ee(2,r);return o.write(s)}}catch(t){x.error(`Failed to send control message to session ${e}:`,t)}return!1}convertSpecialKey(e){let i={arrow_up:"\x1B[A",arrow_down:"\x1B[B",arrow_right:"\x1B[C",arrow_left:"\x1B[D",escape:"\x1B",enter:"\r",ctrl_enter:`
`,shift_enter:`\r
`,backspace:"\x7F",tab:"	",shift_tab:"\x1B[Z",page_up:"\x1B[5~",page_down:"\x1B[6~",home:"\x1B[H",end:"\x1B[F",delete:"\x1B[3~",f1:"\x1BOP",f2:"\x1BOQ",f3:"\x1BOR",f4:"\x1BOS",f5:"\x1B[15~",f6:"\x1B[17~",f7:"\x1B[18~",f8:"\x1B[19~",f9:"\x1B[20~",f10:"\x1B[21~",f11:"\x1B[23~",f12:"\x1B[24~"}[e];if(!i)throw new J(`Unknown special key: ${e}`,"UNKNOWN_KEY");return i}resizeSession(e,r,i){let t=this.sessions.get(e),o=Date.now(),s=this.sessionResizeSources.get(e);if(s){let a=o-s.timestamp;a<100&&x.warn(`Rapid resize detected for session ${e}: ${a}ms since last resize (${s.cols}x${s.rows} -> ${r}x${i})`)}try{if(t?.ptyProcess)t.ptyProcess.resize(r,i),t.asciinemaWriter?.writeResize(r,i),this.sessionResizeSources.set(e,{cols:r,rows:i,source:"browser",timestamp:o}),x.debug(`Resized session ${e} to ${r}x${i}`);else{let a={cmd:"resize",cols:r,rows:i};this.sendControlMessage(e,a),this.sessionResizeSources.set(e,{cols:r,rows:i,source:"browser",timestamp:o})}}catch(a){throw new J(`Failed to resize session ${e}: ${a instanceof Error?a.message:String(a)}`,"RESIZE_FAILED",e)}}updateSessionName(e,r){x.debug(`[PtyManager] updateSessionName called for session ${e} with name: ${r}`),x.debug("[PtyManager] Calling sessionManager.updateSessionName");let i=this.sessionManager.updateSessionName(e,r),t=this.sessions.get(e);if(t?.sessionInfo){x.debug("[PtyManager] Found in-memory session, updating...");let o=t.sessionInfo.name;t.sessionInfo.name=i,x.debug("[PtyManager] Session info after update:",{sessionId:t.id,newName:t.sessionInfo.name,oldCurrentTitle:`${t.currentTitle?.substring(0,50)}...`}),t.isExternalTerminal&&t.stdoutQueue&&(x.debug(`[PtyManager] Forcing immediate title update for session ${e}`,{titleMode:t.titleMode,hadCurrentTitle:!!t.currentTitle,titleUpdateNeeded:t.titleUpdateNeeded}),t.currentTitle=void 0,this.updateTerminalTitleForSessionName(t)),x.log(`[PtyManager] Updated session ${e} name from "${o}" to "${i}"`)}else x.debug(`[PtyManager] No in-memory session found for ${e}`,{sessionsMapSize:this.sessions.size,sessionIds:Array.from(this.sessions.keys())});return this.trackAndEmit("sessionNameChanged",e,i),x.debug(`[PtyManager] Updated session ${e} name to: ${i}`),i}resetSessionSize(e){let r=this.sessions.get(e);try{if(r?.ptyProcess)throw new J(`Cannot reset size for in-memory session ${e}`,"INVALID_OPERATION",e);let i={cmd:"reset-size"};if(!this.sendControlMessage(e,i))throw new J(`Failed to send reset-size command to session ${e}`,"CONTROL_MESSAGE_FAILED",e);x.debug(`Sent reset-size command to session ${e}`)}catch(i){throw new J(`Failed to reset session size for ${e}: ${i instanceof Error?i.message:String(i)}`,"RESET_SIZE_FAILED",e)}}async detachFromTmux(e){let r=this.sessions.get(e);if(!r||!r.isTmuxAttachment||!r.ptyProcess)return!1;try{return x.log(v.cyan(`Detaching from tmux session (${e})`)),await this.sendInput(e,{text:"d"}),await new Promise(i=>setTimeout(i,300)),st.isProcessRunning(r.ptyProcess.pid)?(x.debug("First detach attempt failed, trying detach-client command"),await this.sendInput(e,{text:`:detach-client
`}),await new Promise(i=>setTimeout(i,500)),st.isProcessRunning(r.ptyProcess.pid)?!1:(x.log(v.green(`Successfully detached from tmux using detach-client (${e})`)),!0)):(x.log(v.green(`Successfully detached from tmux (${e})`)),!0)}catch(i){return x.error(`Error detaching from tmux: ${i}`),!1}}async killSession(e,r="SIGTERM"){let i=this.sessions.get(e);try{if(i?.isTmuxAttachment){if(await this.detachFromTmux(e))return;x.warn("Failed to detach from tmux, falling back to normal kill")}if(i?.ptyProcess){if(r==="SIGKILL"||r===9){i.ptyProcess.kill("SIGKILL"),this.sessions.delete(e),await new Promise(t=>setTimeout(t,100));return}await this.killSessionWithEscalation(e,i)}else{let t={cmd:"kill",signal:r};this.sendControlMessage(e,t)&&await new Promise(a=>setTimeout(a,500));let s=this.sessionManager.loadSessionInfo(e);if(!s)throw new J(`Session ${e} not found`,"SESSION_NOT_FOUND",e);if(s.pid&&st.isProcessRunning(s.pid)){if(x.log(v.yellow(`Killing external session ${e} (PID: ${s.pid})`)),r==="SIGKILL"||r===9){process.kill(s.pid,"SIGKILL"),await new Promise(u=>setTimeout(u,100));return}process.kill(s.pid,"SIGTERM");let a=3e3,c=500,l=a/c;for(let u=0;u<l;u++)if(await new Promise(d=>setTimeout(d,c)),!st.isProcessRunning(s.pid)){x.debug(v.green(`External session ${e} terminated gracefully`));return}x.debug(v.yellow(`External session ${e} requires SIGKILL`)),process.kill(s.pid,"SIGKILL"),await new Promise(u=>setTimeout(u,100))}}}catch(t){throw new J(`Failed to kill session ${e}: ${t instanceof Error?t.message:String(t)}`,"KILL_FAILED",e)}}async killSessionWithEscalation(e,r){if(!r.ptyProcess){this.sessions.delete(e);return}let i=r.ptyProcess.pid;x.debug(v.yellow(`Terminating session ${e} (PID: ${i})`));try{r.ptyProcess.kill("SIGTERM");let t=3e3,o=500,s=t/o;for(let a=0;a<s;a++){if(await new Promise(c=>setTimeout(c,o)),!st.isProcessRunning(i)){x.debug(v.green(`Session ${e} terminated gracefully`)),this.sessions.delete(e);return}x.debug(`Session ${e} still running after ${(a+1)*o}ms`)}x.debug(v.yellow(`Session ${e} requires SIGKILL`));try{r.ptyProcess.kill("SIGKILL"),await new Promise(a=>setTimeout(a,100))}catch{x.debug(`SIGKILL failed for session ${e} (process already terminated)`)}this.sessions.delete(e),x.debug(v.yellow(`Session ${e} forcefully terminated`))}catch(t){throw this.sessions.delete(e),new J(`Failed to terminate session ${e}: ${t instanceof Error?t.message:String(t)}`,"KILL_FAILED",e)}}listSessions(){let e=this.sessionManager.updateZombieSessions();for(let i of e){let t=this.inputSocketClients.get(i);t&&(t.destroy(),this.inputSocketClients.delete(i))}return this.sessionManager.listSessions().map(i=>{let t=this.sessions.get(i.id);if(t?.activityStatus)return{...i,activityStatus:t.activityStatus};if(t?.activityDetector){let o=t.activityDetector.getActivityState();return{...i,activityStatus:{isActive:o.isActive,specificStatus:o.specificStatus}}}try{let o=this.sessionManager.getSessionPaths(i.id);if(!o)return i;let s=$t.join(o.controlDir,"claude-activity.json");if(Qe.existsSync(s)){let a=JSON.parse(Qe.readFileSync(s,"utf-8")),c=Math.abs(Date.now()-new Date(a.timestamp).getTime());if(c<6e4)return x.debug(`Found recent activity for external session ${i.id}:`,{isActive:a.isActive,specificStatus:a.specificStatus}),{...i,activityStatus:{isActive:a.isActive,specificStatus:a.specificStatus}};x.debug(`Activity file for session ${i.id} is stale (time diff: ${c}ms)`)}else this.activityFileWarningsLogged.has(i.id)||(this.activityFileWarningsLogged.add(i.id),x.debug(`No claude-activity.json found for session ${i.id} at ${s}`))}catch(o){x.debug(`Failed to read activity file for session ${i.id}:`,o)}return i})}getSession(e){x.debug(`[PtyManager] getSession called for sessionId: ${e}`);let r=this.sessionManager.getSessionPaths(e,!0);if(!r)return x.debug(`[PtyManager] No session paths found for ${e}`),null;let i=this.sessionManager.loadSessionInfo(e);if(!i)return x.debug(`[PtyManager] No session info found for ${e}`),null;let t={...i,id:e,lastModified:i.startedAt};if(Qe.existsSync(r.stdoutPath)){let o=Qe.statSync(r.stdoutPath).mtime.toISOString();t.lastModified=o}return x.debug(`[PtyManager] Found session: ${JSON.stringify(t)}`),t}getSessionPaths(e){return this.sessionManager.getSessionPaths(e)}cleanupSession(e){this.sessions.has(e)&&this.killSession(e).catch(i=>{x.error(`Failed to kill session ${e} during cleanup:`,i)}),this.sessionManager.cleanupSession(e);let r=this.inputSocketClients.get(e);r&&(r.destroy(),this.inputSocketClients.delete(e))}cleanupExitedSessions(){return this.sessionManager.cleanupExitedSessions()}createEnvVars(e){let r={TERM:e},i=["SHELL","LANG","LC_ALL","PATH","USER","HOME"];for(let t of i){let o=process.env[t];o&&(r[t]=o)}return r}getActiveSessionCount(){return this.sessions.size}isSessionActive(e){return this.sessions.has(e)}async shutdown(){for(let[e,r]of Array.from(this.sessions.entries()))try{r.ptyProcess&&r.ptyProcess.kill(),r.asciinemaWriter?.isOpen()&&await r.asciinemaWriter.close(),this.cleanupSessionResources(r)}catch(i){x.error(`Failed to cleanup session ${e} during shutdown:`,i)}this.sessions.clear();for(let[e,r]of this.inputSocketClients.entries())try{r.destroy()}catch{}this.inputSocketClients.clear();for(let e of this.resizeEventListeners)try{e()}catch(r){x.error("Failed to remove resize event listener:",r)}this.resizeEventListeners.length=0}getSessionManager(){return this.sessionManager}writeActivityState(e,r){let i=$t.join(e.controlDir,"claude-activity.json"),t={isActive:r.isActive,specificStatus:r.specificStatus,timestamp:new Date().toISOString()},o=JSON.stringify(t);if(this.lastWrittenActivityState.get(e.id)!==o)try{Qe.writeFileSync(i,JSON.stringify(t,null,2)),this.lastWrittenActivityState.set(e.id,o),e.activityFileWritten||(e.activityFileWritten=!0,x.debug(`Writing activity state to ${i} for session ${e.id}`,{activityState:r,timestamp:t.timestamp}))}catch(a){x.error(`Failed to write activity state for session ${e.id}:`,a)}}trackAndEmit(e,r,...i){let t=this.listeners(e);this.sessionEventListeners.has(r)||this.sessionEventListeners.set(r,new Set);let o=this.sessionEventListeners.get(r);o&&(t.forEach(s=>o.add(s)),this.emit(e,r,...i))}cleanupSessionResources(e){if(this.sessionResizeSources.delete(e.id),e.titleUpdateInterval&&(clearInterval(e.titleUpdateInterval),e.titleUpdateInterval=void 0),e.activityDetector&&(e.activityDetector.clearStatus(),e.activityDetector=void 0),e.titleFilter&&(e.titleFilter=void 0),e.sessionJsonWatcher&&(e.sessionJsonWatcher.close(),e.sessionJsonWatcher=void 0),e.sessionJsonInterval&&(clearInterval(e.sessionJsonInterval),e.sessionJsonInterval=void 0),e.connectedClients){for(let i of e.connectedClients)try{i.destroy()}catch{}e.connectedClients.clear()}if(e.inputSocketServer){e.inputSocketServer.close(),e.inputSocketServer.unref();try{Qe.unlinkSync($t.join(e.controlDir,"ipc.sock"))}catch{}}let r=this.sessionEventListeners.get(e.id);r&&(r.forEach(i=>{this.removeListener("sessionNameChanged",i),this.removeListener("watcherError",i),this.removeListener("bell",i)}),this.sessionEventListeners.delete(e.id)),this.lastWrittenActivityState.delete(e.id),e.titleInjectionTimer&&(clearInterval(e.titleInjectionTimer),e.titleInjectionTimer=void 0)}markTitleUpdateNeeded(e){if(x.debug(`[markTitleUpdateNeeded] Called for session ${e.id}`,{titleMode:e.titleMode,sessionName:e.sessionInfo.name,titleUpdateNeeded:e.titleUpdateNeeded}),!e.titleMode||e.titleMode==="none"){x.debug("[markTitleUpdateNeeded] Skipping - title mode is NONE or undefined");return}e.titleUpdateNeeded=!0,x.debug("[markTitleUpdateNeeded] Set titleUpdateNeeded=true, calling checkAndUpdateTitle"),this.checkAndUpdateTitle(e)}updateTerminalTitleForSessionName(e){if(!e.stdoutQueue||!e.isExternalTerminal){x.debug("[updateTerminalTitleForSessionName] Early return - no stdout queue or not external terminal");return}let r=null;!e.titleMode||e.titleMode==="none"||e.titleMode==="filter"?r=ai(e.currentWorkingDir||e.sessionInfo.workingDir,e.sessionInfo.command,e.sessionInfo.name||"VibeTunnel"):r=this.generateTerminalTitle(e),r&&r!==e.currentTitle&&(x.debug("[updateTerminalTitleForSessionName] Updating title for session name change"),e.pendingTitleToInject=r,e.titleUpdateNeeded=!0,e.titleInjectionTimer||this.startTitleInjectionMonitor(e))}checkAndUpdateTitle(e){if(x.debug(`[checkAndUpdateTitle] Called for session ${e.id}`,{titleUpdateNeeded:e.titleUpdateNeeded,hasStdoutQueue:!!e.stdoutQueue,isExternalTerminal:e.isExternalTerminal,sessionName:e.sessionInfo.name}),!e.titleUpdateNeeded||!e.stdoutQueue||!e.isExternalTerminal){x.debug("[checkAndUpdateTitle] Early return - conditions not met");return}x.debug("[checkAndUpdateTitle] Generating new title...");let r=this.generateTerminalTitle(e);x.debug(`[Title Update] Session ${e.id}:`,{sessionName:e.sessionInfo.name,newTitle:r?`${r.substring(0,50)}...`:null,currentTitle:e.currentTitle?`${e.currentTitle.substring(0,50)}...`:null,titleChanged:r!==e.currentTitle}),r&&r!==e.currentTitle?(x.debug("[checkAndUpdateTitle] Title changed, queueing for injection"),e.pendingTitleToInject=r,e.titleInjectionTimer||(x.debug("[checkAndUpdateTitle] Starting title injection monitor"),this.startTitleInjectionMonitor(e))):x.debug("[checkAndUpdateTitle] Title unchanged or null, skipping injection",{newTitleNull:!r,titlesEqual:r===e.currentTitle}),e.titleUpdateNeeded=!1}startTitleInjectionMonitor(e){e.titleInjectionTimer=setInterval(()=>{if(!e.pendingTitleToInject||!e.stdoutQueue){e.titleInjectionTimer&&(clearInterval(e.titleInjectionTimer),e.titleInjectionTimer=void 0);return}let i=Date.now()-(e.lastWriteTimestamp||0);if(i>=bb&&!e.titleInjectionInProgress){let t=e.pendingTitleToInject;if(!t)return;e.titleInjectionInProgress=!0,e.lastWriteTimestamp=Date.now(),e.stdoutQueue.enqueue(async()=>{try{x.debug(`[Title Injection] Writing title to stdout for session ${e.id}:`,{title:`${t.substring(0,50)}...`}),process.stdout.write(t)||await(0,di.once)(process.stdout,"drain"),e.currentTitle=t,x.debug(`[Title Injection] Successfully injected title for session ${e.id}`),e.pendingTitleToInject===t&&(e.pendingTitleToInject=void 0),!e.pendingTitleToInject&&e.titleInjectionTimer&&(clearInterval(e.titleInjectionTimer),e.titleInjectionTimer=void 0)}finally{e.titleInjectionInProgress=!1}}),x.debug(`Injected title during quiet period (${i}ms) for session ${e.id}`)}},wb)}generateTerminalTitle(e){if(!e.titleMode||e.titleMode==="none")return null;let r=e.currentWorkingDir||e.sessionInfo.workingDir;if(x.debug(`[generateTerminalTitle] Session ${e.id}:`,{titleMode:e.titleMode,sessionName:e.sessionInfo.name,sessionInfoObjectId:e.sessionInfo,currentDir:r,command:e.sessionInfo.command,activityDetectorExists:!!e.activityDetector}),e.titleMode==="static")return ai(r,e.sessionInfo.command,e.sessionInfo.name);if(e.titleMode==="dynamic"&&e.activityDetector){let i=e.activityDetector.getActivityState();return x.debug("[generateTerminalTitle] Calling generateDynamicTitle with:",{currentDir:r,command:e.sessionInfo.command,sessionName:e.sessionInfo.name,activity:i}),_m(r,e.sessionInfo.command,i,e.sessionInfo.name,e.sessionInfo.gitRepoPath,void 0)}return null}startForegroundProcessTracking(e){if(!e.ptyProcess)return;x.debug(`Starting foreground process tracking for session ${e.id}`);let r=e.ptyProcess.pid;this.getProcessPgid(r).then(i=>{i?(e.shellPgid=i,e.currentForegroundPgid=i,x.info(`\u{1F514} NOTIFICATION DEBUG: Starting command tracking for session ${e.id} - shellPgid: ${i}, polling every ${Wm}ms`),x.debug(`Session ${e.id}: Shell PGID is ${i}, starting polling`),e.processPollingInterval=setInterval(()=>{this.checkForegroundProcess(e)},Wm)):x.warn(`Session ${e.id}: Could not get shell PGID`)}).catch(i=>{x.warn(`Failed to get shell PGID for session ${e.id}:`,i)})}async getProcessPgid(e){try{let{stdout:r}=await this.execAsync(`ps -o pgid= -p ${e}`,{timeout:1e3}),i=Number.parseInt(r.trim(),10);return Number.isNaN(i)?null:i}catch{return null}}async getTerminalForegroundPgid(e){if(!e.ptyProcess)return null;try{let r=e.ptyProcess._pty;if(!r)return x.debug(`Session ${e.id}: No TTY name found, falling back to process tree`),this.getForegroundFromProcessTree(e);let i=`ps -t ${r} -o pgid,pid,ppid,command | grep -v PGID | head -1`,{stdout:t}=await this.execAsync(i,{timeout:1e3}),o=t.trim().split(`
`);if(o.length>0&&o[0].trim()){let s=o[0].trim().split(/\s+/),a=Number.parseInt(s[0],10);if(x.debug(`Session ${e.id}: ps output for TTY ${r}: "${o[0].trim()}"`),!Number.isNaN(a))return a}x.debug(`Session ${e.id}: Could not parse PGID from ps output, falling back`)}catch(r){return x.debug(`Session ${e.id}: Error getting terminal PGID: ${r}, falling back`),this.getForegroundFromProcessTree(e)}return null}async getForegroundFromProcessTree(e){if(!e.ptyProcess)return null;try{let r=await this.processTreeAnalyzer.getProcessTree(e.ptyProcess.pid);for(let i of r)if(i.pgid!==e.shellPgid&&i.command&&!this.isShellProcess(i.command))return i.pgid}catch(r){x.debug(`Failed to analyze process tree for session ${e.id}:`,r)}return e.shellPgid||null}isShellProcess(e){let r=["bash","zsh","fish","sh","dash","tcsh","csh"],i=e.toLowerCase();return r.some(t=>i.includes(t))}async checkForegroundProcess(e){if(!(!e.ptyProcess||!e.shellPgid))try{let r=await this.getTerminalForegroundPgid(e),i=new Date().toISOString();if(x.debug(v.gray(`[${i}] Session ${e.id} PGID check: current=${r}, previous=${e.currentForegroundPgid}, shell=${e.shellPgid}`)),r!==e.currentForegroundPgid&&(x.info(`\u{1F514} NOTIFICATION DEBUG: PGID change detected - sessionId: ${e.id}, from ${e.currentForegroundPgid} to ${r}, shellPgid: ${e.shellPgid}`),x.debug(v.yellow(`Session ${e.id}: Foreground PGID changed from ${e.currentForegroundPgid} to ${r}`))),r&&r!==e.currentForegroundPgid){let t=e.currentForegroundPgid;e.currentForegroundPgid=r,r===e.shellPgid&&t!==e.shellPgid?(x.debug(v.green(`Session ${e.id}: Command finished, returning to shell (PGID ${t} \u2192 ${r})`)),await this.handleCommandFinished(e,t)):r!==e.shellPgid&&(x.debug(v.blue(`Session ${e.id}: New command started (PGID ${r})`)),await this.handleCommandStarted(e,r))}}catch(r){x.debug(`Error checking foreground process for session ${e.id}:`,r)}}async handleCommandStarted(e,r){try{if(!e.ptyProcess)return;let i=await this.processTreeAnalyzer.getProcessTree(e.ptyProcess.pid),t=i.find(o=>o.pgid===r);t?(e.currentCommand=t.command,e.commandStartTime=Date.now(),this.sessionMonitor&&this.sessionMonitor.updateCommand(e.id,t.command),t.command.toLowerCase().includes("claude")?x.log(v.cyan(`\u{1F916} Session ${e.id}: Claude command started: "${t.command}" (PGID: ${r})`)):x.debug(`Session ${e.id}: Command started: "${t.command}" (PGID: ${r})`),x.debug(`Process tree for session ${e.id}:`,i.map(s=>`  PID: ${s.pid}, PGID: ${s.pgid}, CMD: ${s.command}`).join(`
`))):x.warn(v.yellow(`Session ${e.id}: Could not find process info for PGID ${r}`))}catch(i){x.debug(`Failed to get command info for session ${e.id}:`,i)}}async handleCommandFinished(e,r){if(!r||!e.commandStartTime||!e.currentCommand){x.debug(v.red(`Session ${e.id}: Cannot handle command finished - missing data: pgid=${r}, startTime=${e.commandStartTime}, command="${e.currentCommand}"`));return}let i=Date.now()-e.commandStartTime,t=e.currentCommand,o=t.toLowerCase().includes("claude");if(e.currentCommand=void 0,e.commandStartTime=void 0,o&&x.log(v.cyan(`\u{1F916} Session ${e.id}: Claude command completed: "${t}" (duration: ${i}ms)`)),!o&&i<Za){x.debug(`Session ${e.id}: Command "${t}" too short (${i}ms < ${Za}ms), not notifying`);return}o&&i<Za&&x.log(v.yellow(`\u26A1 Session ${e.id}: Claude command completed quickly (${i}ms) - still notifying`));let s=t.split(/\s+/)[0];if(Sb.has(s)){x.debug(`Session ${e.id}: Ignoring built-in command: ${s}`);return}let a=0;try{let{stdout:l}=await this.execAsync(`ps -o pid,stat -p ${r} 2>/dev/null || echo "NOTFOUND"`,{timeout:500});(l.includes("NOTFOUND")||l.includes("Z"))&&x.debug(`Session ${e.id}: Process ${r} not found or zombie, assuming exit code 0`)}catch{x.debug(`Session ${e.id}: Could not detect exit code for process ${r}`)}let c={sessionId:e.id,command:t,exitCode:a,duration:i,timestamp:new Date().toISOString()};if(x.info(`\u{1F514} NOTIFICATION DEBUG: Emitting commandFinished event - sessionId: ${e.id}, command: "${t}", duration: ${i}ms, exitCode: ${a}`),this.emit("commandFinished",c),ee.isMacAppConnected()){let l=o?"Claude Task Finished":"Command Finished",u=`"${t}" completed in ${Math.round(i/1e3)}s.`;x.info(`\u{1F514} NOTIFICATION DEBUG: Sending command notification to Mac - title: "${l}", body: "${u}"`),ee.sendNotification("Your Turn",u,{type:"your-turn",sessionId:e.id,sessionName:e.sessionInfo.name||e.sessionInfo.command.join(" ")})}else x.warn("\u{1F514} NOTIFICATION DEBUG: Cannot send command notification - Mac app not connected");o?x.log(v.green(`\u2705 Session ${e.id}: Claude command notification event emitted: "${t}" (duration: ${i}ms, exit: ${a})`)):x.log(`Session ${e.id}: Command finished: "${t}" (duration: ${i}ms)`),x.debug(`Session ${e.id}: commandFinished event data:`,c)}execAsync=(0,Vm.promisify)(Zm.exec)};Va();var xo=require("child_process"),it=C(require("fs")),Jm=C(require("os")),Pn=C(require("path"));W();var Se=T("claude-patcher"),ko=new Map;function $b(){for(let[n,e]of ko.entries())try{if(it.default.existsSync(e)){it.default.copyFileSync(e,n),Se.debug(`Restored binary: ${n}`);try{it.default.unlinkSync(e),Se.debug(`Cleaned up backup: ${e}`)}catch(r){Se.debug(`Failed to clean up backup ${e}:`,r)}}}catch(r){Se.error(`Failed to restore binary ${n}:`,r)}ko.clear()}var qm=!1;function xb(){if(qm)return;qm=!0;let n=()=>{$b()};process.on("exit",n),process.on("SIGINT",()=>{n(),process.exit(130)}),process.on("SIGTERM",()=>{n(),process.exit(143)})}function kb(n){if(ko.has(n))return Se.debug(`Binary already patched: ${n}`),n;let e=Pn.default.basename(n),r=Jm.default.tmpdir(),i=Pn.default.join(r,`vibetunnel-claude-backup-${Date.now()}-${e}`);it.default.copyFileSync(n,i),Se.debug(`Created backup at ${i}`);let t=it.default.readFileSync(n,"utf8"),o=[/if\([A-Za-z0-9_$]+\(\)\)process\.exit\(1\);/g,/if\s*\([A-Za-z0-9_$]+\(\)\)\s*process\.exit\(1\);/g,/if\([A-Za-z0-9_$]+\(\)\)process\.exit\(\d+\);/g],s=t,a=!1;for(let c of o){let l=s.replace(c,"if(false)process.exit(1);");l!==s&&(s=l,a=!0,Se.debug(`Applied patch for pattern: ${c}`))}return a?(it.default.writeFileSync(n,s),ko.set(n,i),xb(),Se.log("Patched Claude binary"),n):(Se.warn("No anti-debugging pattern found - Claude binary may have changed"),n)}function Km(n){if(n.length===0)return n;let e=n[0];Se.debug(`Checking command: ${e}`);try{let o=process.env.SHELL||"/bin/bash",a=Pn.default.basename(o)==="zsh"?`${o} -i -c "alias ${e} 2>/dev/null"`:`${o} -i -c "alias ${e} 2>&1"`,c=(0,xo.execSync)(a,{encoding:"utf8"}).trim();if(c&&!c.includes("not found")){let l=c.match(/^(?:alias\s+)?[^=]+=["']?(.+?)["']?$/);if(l){let u=l[1].split(" ")[0];Se.debug(`Resolved alias: ${e} \u2192 ${u}`),e=u}}}catch{Se.debug(`No alias found for: ${e}`)}let r=e;if(!Pn.default.isAbsolute(e))try{let o=(0,xo.execSync)(`which "${e}" 2>/dev/null`,{encoding:"utf8"}).trim();if(o)r=o,Se.debug(`Found in PATH: ${r}`);else try{let s=(0,xo.execSync)(`command -v "${e}" 2>/dev/null`,{encoding:"utf8",shell:"/bin/sh"}).trim();s&&s!==e&&(r=s,Se.debug(`Found via command -v: ${r}`))}catch{}}catch{Se.debug(`Could not find ${e} in PATH`)}try{if(it.default.existsSync(r)&&it.default.lstatSync(r).isSymbolicLink()){let o=it.default.realpathSync(r);Se.debug(`Resolved symlink: ${r} \u2192 ${o}`),r=o}}catch(o){Se.debug(`Could not resolve symlink: ${o}`)}if(!it.default.existsSync(r))return Se.debug(`Resolved path does not exist: ${r}`),n;try{let o=it.default.openSync(r,"r"),s=Buffer.alloc(1024),a=it.default.readSync(o,s,0,1024,0);it.default.closeSync(o);let c=s.toString("utf8",0,a);if(!(c.includes("#!/usr/bin/env")&&c.includes("node")&&c.includes("Anthropic PBC")))return Se.debug(`Not a Claude CLI binary: ${Pn.default.basename(r)}`),n;let u=it.default.readFileSync(r,"utf8");if(!(u.includes("process.exit(1)")||u.includes("PF5()")))return Se.debug("Claude CLI detected but no anti-debugging patterns found"),n}catch(o){return Se.debug(`Could not read file to verify Claude binary: ${o}`),n}Se.log(`Detected Claude CLI binary at: ${r}`);let t=[kb(r),...n.slice(1)];return Se.log(`Using patched command: ${t.join(" ")}`),t}var Qm=require("child_process"),Ga=C(require("fs")),Ha=C(require("path")),Ym=require("util"),_o=(0,Ym.promisify)(Qm.execFile);async function _b(n){try{let e=Ha.join(n,".git"),i=(await Ga.promises.readFile(e,"utf-8")).match(/^gitdir:\s*(.+)$/m);if(!i)return;let o=i[1].trim().match(/^(.+)\/\.git\/worktrees\/.+$/);return o?o[1]:void 0}catch{return}}var Po=new Map,Pb=5e3;async function Zr(n){let e=Po.get(n);if(e&&Date.now()-e.timestamp<Pb)return e.info;try{let{stdout:r}=await _o("git",["rev-parse","--show-toplevel"],{cwd:n,timeout:5e3,env:{...process.env,GIT_TERMINAL_PROMPT:"0"}}),i=r.trim();try{let{stdout:t}=await _o("git",["branch","--show-current"],{cwd:n,timeout:5e3,env:{...process.env,GIT_TERMINAL_PROMPT:"0"}}),o=t.trim(),s,a,c=!1,l=!1;try{let f=Ha.join(n,".git"),p=await Ga.promises.stat(f).catch(()=>null);p&&!p.isDirectory()&&(l=!0);let{stdout:m}=await _o("git",["rev-list","--left-right","--count","HEAD...@{upstream}"],{cwd:n,timeout:5e3,env:{...process.env,GIT_TERMINAL_PROMPT:"0"}}),[g,h]=m.trim().split("	").map(Number);s=g,a=h}catch{}try{await _o("git",["diff-index","--quiet","HEAD","--"],{cwd:n,timeout:5e3,env:{...process.env,GIT_TERMINAL_PROMPT:"0"}}),c=!1}catch{c=!0}let u=l?await _b(n):i,d={gitRepoPath:i,gitBranch:o,gitAheadCount:s,gitBehindCount:a,gitHasChanges:c,gitIsWorktree:l,gitMainRepoPath:u};return Po.set(n,{info:d,timestamp:Date.now()}),d}catch{let o={gitRepoPath:i,gitBranch:""};return Po.set(n,{info:o,timestamp:Date.now()}),o}}catch{let r={};return Po.set(n,{info:r,timestamp:Date.now()}),r}}W();var Xm=C(require("os")),ep=C(require("path"));function Tb(n){if(!n)return"";let e=Xm.homedir(),r=n;n.startsWith(e)&&(r=`~${n.slice(e.length)}`),r=r.replace("/Development/","/Dev/").replace("/Documents/","/Docs/").replace("/Applications/","/Apps/");let i=r.split("/").filter(t=>t);return i.length>3?`\u2026/${i.slice(-2).join("/")}`:r}function mi(n,e){let r=ep.basename(n[0]),i=Tb(e);return i?`${r} (${i})`:r}W();function To(){if(process.env.VIBETUNNEL_LOG_LEVEL){let n=mo(process.env.VIBETUNNEL_LOG_LEVEL);if(n!==void 0)return n;console.warn(`Invalid VIBETUNNEL_LOG_LEVEL: ${process.env.VIBETUNNEL_LOG_LEVEL}`),console.warn("Valid levels: silent, error, warn, info, verbose, debug")}if(process.env.VIBETUNNEL_DEBUG==="1"||process.env.VIBETUNNEL_DEBUG==="true")return 5}var U=T("fwd"),B0=(0,rp.promisify)(require("child_process").execFile);function tp(){console.log(v.blue(`VibeTunnel Forward v${Le}`)+v.gray(` (${Pr})`)),console.log(""),console.log("Usage:"),console.log("  pnpm exec tsx src/fwd.ts [--session-id <id>] [--title-mode <mode>] [--verbosity <level>] <command> [args...]"),console.log(""),console.log("Options:"),console.log("  --session-id <id>     Use a pre-generated session ID"),console.log("  --title-mode <mode>   Terminal title mode: none, filter, static, dynamic"),console.log("                        (defaults to none for most commands, dynamic for claude)"),console.log("  --update-title <title> Update session title and exit (requires --session-id)"),console.log("  --verbosity <level>   Set logging verbosity: silent, error, warn, info, verbose, debug"),console.log("                        (defaults to error)"),console.log("  --log-file <path>     Override default log file location"),console.log("                        (defaults to ~/.vibetunnel/log.txt)"),console.log(""),console.log("Title Modes:"),console.log("  none     - No title management (default)"),console.log("  filter   - Block all title changes from applications"),console.log("  static   - Show working directory and command"),console.log("  dynamic  - Show directory, command, and activity (auto-selected for claude)"),console.log(""),console.log("Verbosity Levels:"),console.log(`  ${v.gray("silent")}   - No output except critical errors`),console.log(`  ${v.red("error")}    - Only errors ${v.gray("(default)")}`),console.log(`  ${v.yellow("warn")}     - Errors and warnings`),console.log(`  ${v.green("info")}     - Errors, warnings, and informational messages`),console.log(`  ${v.blue("verbose")}  - All messages except debug`),console.log(`  ${v.magenta("debug")}    - All messages including debug`),console.log(""),console.log(`Quick verbosity: ${v.cyan("-q (quiet), -v (verbose), -vv (extra), -vvv (debug)")}`),console.log(""),console.log("Environment Variables:"),console.log("  VIBETUNNEL_TITLE_MODE=<mode>         Set default title mode"),console.log("  VIBETUNNEL_CLAUDE_DYNAMIC_TITLE=1    Force dynamic title for Claude"),console.log("  VIBETUNNEL_LOG_LEVEL=<level>         Set default verbosity level"),console.log("  VIBETUNNEL_DEBUG=1                   Enable debug mode (legacy)"),console.log(""),console.log("Examples:"),console.log("  pnpm exec tsx src/fwd.ts claude --resume"),console.log("  pnpm exec tsx src/fwd.ts --title-mode static bash -l"),console.log("  pnpm exec tsx src/fwd.ts --title-mode filter vim"),console.log("  pnpm exec tsx src/fwd.ts --session-id abc123 claude"),console.log('  pnpm exec tsx src/fwd.ts --update-title "New Title" --session-id abc123'),console.log("  pnpm exec tsx src/fwd.ts --verbosity silent npm test"),console.log(""),console.log("The command will be spawned in the current working directory"),console.log("and managed through the VibeTunnel PTY infrastructure.")}async function np(n){let e=To();e===5&&U.setDebugMode(!0),(n.length===0||n[0]==="--help"||n[0]==="-h")&&(tp(),he(),process.exit(0)),U.debug(v.blue(`VibeTunnel Forward v${Le}`)+v.gray(` (${Pr})`)),U.debug(`Full command: ${n.join(" ")}`);let r,i="none",t,o,s=n;if(process.env.VIBETUNNEL_TITLE_MODE){let m=process.env.VIBETUNNEL_TITLE_MODE.toLowerCase();Object.values(Xt).includes(m)&&(i=m,U.debug(`Title mode set from environment: ${i}`))}for((process.env.VIBETUNNEL_CLAUDE_DYNAMIC_TITLE==="1"||process.env.VIBETUNNEL_CLAUDE_DYNAMIC_TITLE==="true")&&(i="dynamic",U.debug("Forced dynamic title mode for Claude via environment variable"));s.length>0;)if(s[0]==="--session-id"&&s.length>1)r=s[1],s=s.slice(2);else if(s[0]==="--update-title"&&s.length>1)t=s[1],s=s.slice(2);else if(s[0]==="--title-mode"&&s.length>1){let m=s[1].toLowerCase();Object.values(Xt).includes(m)?i=m:(U.error(`Invalid title mode: ${s[1]}`),U.error(`Valid modes: ${Object.values(Xt).join(", ")}`),he(),process.exit(1)),s=s.slice(2)}else if(s[0]==="--verbosity"&&s.length>1){let m=mo(s[1]);m!==void 0?e=m:(U.error(`Invalid verbosity level: ${s[1]}`),U.error("Valid levels: silent, error, warn, info, verbose, debug"),he(),process.exit(1)),s=s.slice(2)}else if(s[0]==="--log-file"&&s.length>1)o=s[1],s=s.slice(2);else break;if(s[0]==="--"&&s.length>1&&(s=s.slice(1)),o!==void 0&&(Jf(o),U.debug(`Log file path set to: ${o}`)),e!==void 0&&(Ea(e),e>=3&&U.log(`Verbosity level set to: ${ii[e].toLowerCase()}`)),t!==void 0){r||(U.error("--update-title requires --session-id"),he(),process.exit(1));let m=sr.join(qa.homedir(),".vibetunnel","control"),g=new ir(m);/^[a-zA-Z0-9_-]+$/.test(r)||(U.error(`Invalid session ID format: "${r}". Session IDs must only contain letters, numbers, hyphens (-), and underscores (_).`),he(),process.exit(1));try{let h=g.loadSessionInfo(r);h||(U.error(`Session ${r} not found`),he(),process.exit(1));let S=t.substring(0,256).split("").filter(k=>{let b=k.charCodeAt(0);return b>=32&&b!==127&&(b<128||b>159)}).join(""),y=sr.join(m,r,"ipc.sock");if(xt.existsSync(y)){U.debug("IPC socket found, sending title update via IPC");let k=new Wr(y,{autoReconnect:!1});try{await k.connect(),k.updateTitle(S)?(U.log(`Session title updated to: ${S}`),k.disconnect(),he(),process.exit(0)):U.warn("Failed to send title update via IPC, falling back to file update"),k.disconnect()}catch(b){U.warn(`IPC connection failed: ${b}, falling back to file update`)}}else U.debug("No IPC socket found, session might not be active");h.name=S,g.saveSessionInfo(r,h),U.log(`Session title updated to: ${S}`),he(),process.exit(0)}catch(h){U.error(`Failed to update session title: ${h instanceof Error?h.message:String(h)}`),he(),process.exit(1)}}let a=s;if(a.length===0&&(U.error("No command specified"),tp(),he(),process.exit(1)),process.env.VIBETUNNEL_DEBUG==="1"||process.env.VIBETUNNEL_DEBUG==="true"){let m=Km(a);m!==a&&(a=m,U.debug("Command updated after patching"))}i==="none"&&a.some(g=>g.toLowerCase().includes("claude"))&&(i="dynamic",U.log(v.cyan("\u2713 Auto-selected dynamic title mode for Claude")),U.debug(`Detected Claude in command: ${a.join(" ")}`));let c=process.cwd(),l=sr.join(qa.homedir(),".vibetunnel","control");U.debug(`Control path: ${l}`),await or.initialize().catch(m=>{U.error("Failed to initialize PTY manager:",m),he(),process.exit(1)});let u=new or(l),d=process.env.VIBETUNNEL_SESSION_ID!==void 0,f,p;d?(await new Promise(m=>setTimeout(m,100)),process.stdout.isTTY&&process.stdout.columns&&process.stdout.rows?(f=process.stdout.columns,p=process.stdout.rows,U.debug(`External spawn using actual terminal size: ${f}x${p}`)):U.debug("External spawn: terminal dimensions not available, using terminal defaults")):(f=process.stdout.columns||120,p=process.stdout.rows||40,U.debug(`Regular spawn with dimensions: ${f}x${p}`));try{let m=mi(a,c),g=r||`fwd_${Date.now()}`;if(U.log(`Creating session for command: ${a.join(" ")}`),U.debug(`Session ID: ${g}, working directory: ${c}`),i!=="none"){let E={filter:"Terminal title changes will be blocked",static:"Terminal title will show path and command",dynamic:"Terminal title will show path, command, and activity"};U.log(v.cyan(`\u2713 ${E[i]}`))}let h=await Zr(c),S,y,k=!1,b={sessionId:g,name:m,workingDir:c,titleMode:i,forwardToStdout:!0,gitRepoPath:h.gitRepoPath,gitBranch:h.gitBranch,gitAheadCount:h.gitAheadCount,gitBehindCount:h.gitBehindCount,gitHasChanges:h.gitHasChanges,gitIsWorktree:h.gitIsWorktree,gitMainRepoPath:h.gitMainRepoPath,onExit:async E=>{k=!0,U.log(v.yellow(`
\u2713 VibeTunnel session ended`)+v.gray(` (exit code: ${E})`)),process.stdout.removeListener("resize",X),process.stdin.isTTY&&(U.debug("Restoring terminal to normal mode"),process.stdin.setRawMode(!1)),process.stdin.pause(),process.stdin.removeAllListeners(),process.stdin.destroy&&process.stdin.destroy(),N&&N(),S&&(S.close(),S=void 0,U.debug("Closed session file watcher")),y&&clearTimeout(y),xt.unwatchFile(K),U.debug(`Cleaning up session ${g}`);try{await u.killSession(g)}catch(B){U.debug(`Session ${g} cleanup error (likely already cleaned):`,B)}he(),process.exit(E||0)}};f!==void 0&&p!==void 0&&(b.cols=f,b.rows=p);let R=await u.createSession(a,b);if(!u.getSession(R.sessionId))throw new Error("Session not found after creation");U.log(v.green("\u2713 VibeTunnel session started")+v.gray(` (v${Le})`)),U.log(v.gray("Command:"),a.join(" ")),U.log(v.gray("Control directory:"),sr.join(l,R.sessionId)),U.log(v.gray("Build:"),`${Pr} | Commit: ${Sn}`);let L=sr.join(l,R.sessionId,"ipc.sock"),F=new Wr(L,{autoReconnect:!0,heartbeatInterval:3e4});try{await F.connect(),U.debug("Connected to session IPC socket")}catch(E){throw U.error("Failed to connect to session socket:",E),E}let X=()=>{let E=process.stdout.columns||80,B=process.stdout.rows||24;U.debug(`Terminal resized to ${E}x${B}`),F.resize(E,B)||U.error("Failed to send resize command")};process.stdout.on("resize",X);let K=sr.join(l,R.sessionId,"session.json"),ge=R.sessionInfo.name,dt=async(E=0)=>{let me=500*2**E;try{if(!xt.existsSync(K))if(E<5){U.debug(`Session file not found, retrying in ${me}ms (attempt ${E+1}/5)`),setTimeout(()=>dt(E+1),me);return}else{U.warn(`Session file not found after 5 attempts: ${K}`);return}U.log("Setting up file watcher for session name changes");let ae=()=>{try{if(!xt.existsSync(K))return;let V=xt.readFileSync(K,"utf-8"),ue=JSON.parse(V);if(ue.name!==ge){U.debug(`[File Watch] Session name changed from "${ge}" to "${ue.name}"`),ge=ue.name;let Ue;i==="none"||i==="filter"?Ue=`\x1B]2;${ue.name}\x07`:Ue=ai(c,a,ue.name),process.stdout.write(Ue),U.log(`Updated terminal title to "${ue.name}" via file watcher`)}}catch(V){U.error("Failed to check session.json:",V)}};xt.watchFile(K,{interval:500},(V,ue)=>{U.debug(`[File Watch] File stats changed - mtime: ${V.mtime} vs ${ue.mtime}`),V.mtime!==ue.mtime&&ae()});try{let V=sr.dirname(K);S=xt.watch(V,(ue,Ue)=>{U.debug(`[File Watch] Directory event: ${ue} on ${Ue||"unknown"}`),Ue&&(Ue==="session.json"||Ue==="session.json.tmp")&&(y&&clearTimeout(y),y=setTimeout(ae,100))})}catch(V){U.warn("Failed to set up fs.watch, relying on fs.watchFile:",V)}U.log("File watcher successfully set up with polling fallback"),S?.on("error",V=>{U.error("File watcher error:",V),S?.close(),S=void 0})}catch(ae){U.error("Failed to set up file watcher:",ae),E<5&&setTimeout(()=>dt(E+1),me)}};setTimeout(()=>dt(),500);let P,N;if(i==="dynamic"){P=new bn(a,r);let E=process.stdout.write.bind(process.stdout),B=!1,me=function(ae,V,ue){if(typeof V=="function"&&(ue=V,V=void 0),B)return ue?E.call(this,ae,V,ue):V&&typeof V=="string"?E.call(this,ae,V):E.call(this,ae);B=!0;try{if(P&&typeof ae=="string"){let{filteredData:Ue,activity:Lt}=P.processOutput(ae);return Lt.specificStatus&&F.sendStatus(Lt.specificStatus.app,Lt.specificStatus.status),ue?E.call(this,Ue,V,ue):V&&typeof V=="string"?E.call(this,Ue,V):E.call(this,Ue)}return ue?E.call(this,ae,V,ue):V&&typeof V=="string"?E.call(this,ae,V):E.call(this,ae)}finally{B=!1}};process.stdout.write=me,N=()=>{process.stdout.write=E},process.on("exit",N),process.on("SIGINT",N),process.on("SIGTERM",N)}process.stdin.isTTY&&(U.debug("Setting terminal to raw mode for input forwarding"),process.stdin.setRawMode(!0)),process.stdin.resume(),process.stdin.setEncoding("utf8"),process.stdin.on("data",E=>{F.sendStdin(E)||U.error("Failed to send stdin data")}),F.on("disconnect",E=>{if(k){U.debug("Socket disconnected during normal exit");return}let B=E?.message||"";B.includes("EPIPE")||B.includes("ECONNRESET")||B.includes("socket hang up")||B==="Unknown error"||!E?U.debug("Socket disconnected (normal termination)"):U.error("Socket disconnected:",E?.message||"Unknown error"),process.exit(1)}),F.on("error",E=>{U.error("Socket error:",E)})}catch(m){U.error("Failed to create or manage session:",m),he(),process.exit(1)}}Fe();var $f=C(require("compression")),xf=C(mp()),dy=C(require("crypto")),va=C(require("express")),ya=C(require("fs")),fy=C(require("helmet")),my=require("http"),ba=C(require("os")),Ie=C(require("path"));vn();var py=require("ws");var Gr=C(require("fs")),Sp=C(require("net")),$p=C(require("os")),kt=C(require("path")),xp=require("util");li();function Qa(n){return n instanceof Error&&(typeof n.code=="string"||typeof n.stderr=="string"||typeof n.exitCode=="number")}function Nr(n,e){let r=new Error(e?`${e}: ${n instanceof Error?n.message:String(n)}`:n instanceof Error?n.message:String(n));if(n instanceof Error){r.stack=n.stack,r.name=n.name;let i=n;typeof i.code=="string"&&(r.code=i.code),typeof i.stderr=="string"?r.stderr=i.stderr:i.stderr&&typeof i.stderr=="object"&&(r.stderr=String(i.stderr)),typeof i.exitCode=="number"&&(r.exitCode=i.exitCode)}return r}function pp(n){return Qa(n)&&n.code==="ENOENT"}function pi(n){return Qa(n)&&(n.stderr?.includes("not a git repository")??!1)}function gp(n){return Qa(n)&&n.exitCode===5}var Ae=C(require("fs/promises")),Vr=C(require("path")),yp=require("util");W();var zt=T("git-hooks"),Bb=(0,yp.promisify)(require("child_process").execFile);async function Wb(n,e={}){try{let{stdout:r,stderr:i}=await Bb("git",n,{cwd:e.cwd||process.cwd(),timeout:5e3,env:{...process.env,GIT_TERMINAL_PROMPT:"0"}});return{stdout:r.toString(),stderr:i.toString()}}catch(r){throw Nr(r,"Git command failed")}}async function Ya(n){try{let{stdout:e}=await Wb(["config","core.hooksPath"],{cwd:n}),r=e.trim();if(r)return Vr.resolve(n,r)}catch{}return Vr.join(n,".git","hooks")}function Zb(n){return`#!/bin/sh
# VibeTunnel Git hook - ${n}
# This hook notifies VibeTunnel when Git events occur

# Check if vt command is available
if command -v vt >/dev/null 2>&1; then
  # Run in background to avoid blocking Git operations
  vt git event &
fi

# Always exit successfully
exit 0
`}async function hp(n,e){try{let r=await Ya(n),i=Vr.join(r,e),t=`${i}.vtbak`;await Ae.mkdir(r,{recursive:!0});let o=null;try{o=await Ae.readFile(i,"utf8")}catch{}if(o?.includes("VibeTunnel Git hook"))return zt.debug(`${e} hook already installed`),{success:!0};o&&(await Ae.writeFile(t,o),zt.debug(`Backed up existing ${e} hook to ${t}`));let s=Zb(e);return o&&(s=`#!/bin/sh
# VibeTunnel Git hook - ${e}
# This hook notifies VibeTunnel when Git events occur

# Check if vt command is available
if command -v vt >/dev/null 2>&1; then
  # Run in background to avoid blocking Git operations
  vt git event &
fi

# Execute the original hook if it exists
if [ -f "${t}" ]; then
  exec "${t}" "$@"
fi

exit 0
`),await Ae.writeFile(i,s),await Ae.chmod(i,493),zt.info(`Successfully installed ${e} hook`),{success:!0,backedUp:!!o}}catch(r){return zt.error(`Failed to install ${e} hook:`,r),{success:!1,error:r instanceof Error?r.message:String(r)}}}async function vp(n,e){try{let r=await Ya(n),i=Vr.join(r,e),t=`${i}.vtbak`,o=null;try{o=await Ae.readFile(i,"utf8")}catch{return{success:!0}}if(!o.includes("VibeTunnel Git hook"))return zt.debug(`${e} hook is not ours, skipping uninstall`),{success:!0};let s=!1;try{await Ae.access(t),s=!0}catch{}if(s){let a=await Ae.readFile(t,"utf8");return await Ae.writeFile(i,a),await Ae.chmod(i,493),await Ae.unlink(t),zt.info(`Restored original ${e} hook from backup`),{success:!0,restored:!0}}else return await Ae.unlink(i),zt.info(`Removed ${e} hook`),{success:!0,restored:!1}}catch(r){return zt.error(`Failed to uninstall ${e} hook:`,r),{success:!1,error:r instanceof Error?r.message:String(r)}}}async function In(n){zt.info(`Installing Git hooks for repository: ${n}`);let r=(await Promise.all([hp(n,"post-commit"),hp(n,"post-checkout")])).filter(i=>!i.success).map(i=>i.error).filter(i=>!!i);return r.length>0?{success:!1,errors:r}:{success:!0}}async function gi(n){zt.info(`Uninstalling Git hooks for repository: ${n}`);let r=(await Promise.all([vp(n,"post-commit"),vp(n,"post-checkout")])).filter(i=>!i.success).map(i=>i.error).filter(i=>!!i);return r.length>0?{success:!1,errors:r}:{success:!0}}async function En(n){try{let e=await Ya(n),r=["post-commit","post-checkout"];for(let i of r){let t=Vr.join(e,i);try{if(!(await Ae.readFile(t,"utf8")).includes("VibeTunnel Git hook"))return!1}catch{return!1}}return!0}catch(e){return zt.error("Failed to check hook installation:",e),!1}}W();var bp=C(require("os"));function wp(n){let e=bp.homedir();return n.startsWith(e)?`~${n.slice(e.length)}`:n}$n();Ir();var ze=T("api-socket"),Vb=(0,xp.promisify)(require("child_process").execFile);async function Zt(n,e={}){try{let{stdout:r,stderr:i}=await Vb("git",n,{cwd:e.cwd||process.cwd(),timeout:e.timeout||5e3,maxBuffer:1048576,env:{...process.env,GIT_TERMINAL_PROMPT:"0"}});return{stdout:r.toString(),stderr:i.toString()}}catch(r){throw Nr(r,"Git command failed")}}var Xa=class{server=null;socketPath;serverPort;serverUrl;constructor(){let r=process.env.VIBETUNNEL_CONTROL_DIR||kt.join($p.homedir(),".vibetunnel");Gr.existsSync(r)||Gr.mkdirSync(r,{recursive:!0}),this.socketPath=kt.join(r,"api.sock")}setServerInfo(e,r){this.serverPort=e,this.serverUrl=r}async start(){try{Gr.unlinkSync(this.socketPath)}catch{}return new Promise((e,r)=>{this.server=Sp.createServer(i=>{this.handleConnection(i)}),this.server.on("error",i=>{ze.error("API socket server error:",i),r(i)}),this.server.listen(this.socketPath,()=>{ze.log(`API socket server listening on ${this.socketPath}`),e()})})}stop(){this.server&&(this.server.close(),this.server=null);try{Gr.unlinkSync(this.socketPath)}catch{}}handleConnection(e){let r=new Cr;e.on("data",i=>{r.addData(i);for(let{type:t,payload:o}of r.parseMessages())this.handleMessage(e,t,o)}),e.on("error",i=>{ze.error("API socket connection error:",i)})}async handleMessage(e,r,i){try{let t=kn(r,i);switch(r){case 32:await this.handleStatusRequest(e);break;case 48:await this.handleGitFollowRequest(e,t);break;case 50:await this.handleGitEventNotify(e,t);break;default:ze.warn(`Unhandled message type: ${r}`)}}catch(t){ze.error("Failed to handle message:",t),this.sendError(e,t instanceof Error?t.message:"Unknown error")}}async handleStatusRequest(e){try{let r=process.cwd(),i;try{let{stdout:o}=await Zt(["rev-parse","--show-toplevel"],{cwd:r}),s=o.trim(),{stdout:a}=await Zt(["rev-parse","--git-dir"],{cwd:r}),c=a.trim(),l=c.includes("/.git/worktrees/"),u=s;l&&(u=c.replace(/\/\.git\/worktrees\/.*$/,""));try{let{stdout:d}=await Zt(["config","vibetunnel.followWorktree"],{cwd:u}),f=d.trim();if(f){let p=kt.basename(f);try{let{stdout:m}=await Zt(["branch","--show-current"],{cwd:f});m.trim()&&(p=m.trim())}catch{}i={enabled:!0,branch:p,repoPath:wp(f)}}}catch{}}catch{}let t={running:!0,port:this.serverPort,url:this.serverUrl,version:Le,buildDate:Pr,followMode:i};e.write(de.statusResponse(t))}catch(r){ze.error("Failed to get status:",r),this.sendError(e,"Failed to get server status")}}async handleGitFollowRequest(e,r){try{let{repoPath:i,branch:t,enable:o,worktreePath:s,mainRepoPath:a}=r,c=a||i;if(!c)throw new Error("No repository path provided");let l=kt.resolve(c),u=s?kt.resolve(s):void 0;if(ze.debug(`${o?"Enabling":"Disabling"} follow mode${u?` for worktree: ${u}`:t?` for branch: ${t}`:""}`),o){if(!await En(l)&&(ze.info("Installing Git hooks for follow mode"),!(await In(l)).success)){let y={success:!1,error:"Failed to install Git hooks"};e.write(de.gitFollowResponse(y));return}let f,p;if(u){f=u;try{let{stdout:S}=await Zt(["branch","--show-current"],{cwd:u});p=S.trim()||kt.basename(u)}catch{p=kt.basename(u)}}else if(t)try{let{stdout:S}=await Zt(["worktree","list","--porcelain"],{cwd:l}),y=S.split(`
`),k;for(let b=0;b<y.length;b++)if(y[b].startsWith("worktree ")){let R=y[b].substring(9);if(b+2<y.length&&y[b+2]===`branch refs/heads/${t}`&&R!==l){k=R;break}}if(!k)throw new Error(`No worktree found for branch '${t}'`);f=k,p=t}catch(S){throw new Error(`Failed to find worktree: ${S instanceof Error?S.message:String(S)}`)}else try{let{stdout:S}=await Zt(["branch","--show-current"],{cwd:l}),y=S.trim();if(!y)throw new Error("Not on a branch (detached HEAD)");return this.handleGitFollowRequest(e,{...r,branch:y})}catch(S){throw new Error(`Failed to get current branch: ${S instanceof Error?S.message:String(S)}`)}if(await Zt(["config","--local","vibetunnel.followWorktree",f],{cwd:l}),!await En(l)&&(ze.info("Installing Git hooks in main repository"),!(await In(l)).success))throw new Error("Failed to install Git hooks in main repository");if(await En(f)||(ze.info("Installing Git hooks in worktree"),(await In(f)).success||ze.warn("Failed to install Git hooks in worktree, continuing anyway")),ee.isMacAppConnected()){let S=Je("system","notification",{level:"info",title:"Follow Mode Enabled",message:`Now following ${p} in ${kt.basename(l)}`});ee.sendToMac(S)}let h={success:!0,currentBranch:p};e.write(de.gitFollowResponse(h))}else{await Zt(["config","--local","--unset","vibetunnel.followWorktree"],{cwd:l});let d;try{let{stdout:m}=await Zt(["config","vibetunnel.followWorktree"],{cwd:l});d=m.trim()}catch{}ze.info("Uninstalling Git hooks from main repository");let f=await gi(l);if(d&&d!==l){ze.info("Uninstalling Git hooks from worktree");let m=await gi(d);m.success||ze.warn("Failed to uninstall some Git hooks from worktree:",m.errors)}if(f.success?ze.info("Git hooks uninstalled successfully from main repository"):ze.warn("Failed to uninstall some Git hooks from main repo:",f.errors),ee.isMacAppConnected()){let m=Je("system","notification",{level:"info",title:"Follow Mode Disabled",message:`Follow mode disabled in ${kt.basename(l)}`});ee.sendToMac(m)}let p={success:!0};e.write(de.gitFollowResponse(p))}}catch(i){let t={success:!1,error:i instanceof Error?i.message:"Unknown error"};e.write(de.gitFollowResponse(t))}}async handleGitEventNotify(e,r){ze.debug(`Git event notification received: ${r.type} for ${r.repoPath}`);try{let t=`http://localhost:${this.serverPort||4020}/api/git/event`,o=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({repoPath:r.repoPath,event:r.type})});if(!o.ok)throw new Error(`HTTP endpoint returned ${o.status}: ${o.statusText}`);let s=await o.json();ze.debug("Git event processed successfully:",s);let a={handled:!0};e.write(de.gitEventAck(a))}catch(i){ze.error("Failed to forward git event to HTTP endpoint:",i);let t={handled:!1};e.write(de.gitEventAck(t))}}sendError(e,r){e.write(de.error("API_ERROR",r))}},ec=new Xa;W();var Ye=T("auth");function Gb(n){let e=n.ip||n.socket.remoteAddress||"",i=["127.0.0.1","::1","::ffff:127.0.0.1","localhost"].includes(e),t=!n.headers["x-forwarded-for"],o=!n.headers["x-real-ip"],s=!n.headers["x-forwarded-host"],a=n.hostname==="localhost"||n.hostname==="127.0.0.1"||n.hostname==="[::1]";return Ye.debug(`Local request check - IP: ${e}, Host: ${n.hostname}, Forwarded headers: ${!t||!o||!s}`),i&&t&&o&&s&&a}function Hb(n){let e=n.socket.remoteAddress;return e==="127.0.0.1"||e==="::1"||e==="::ffff:127.0.0.1"}function kp(n){let e=n.headers,r=e["tailscale-user-login"],i=e["tailscale-user-name"],t=e["tailscale-user-profile-pic"];return r?{login:r,name:i||r,profilePic:t}:null}function _p(n){return(e,r,i)=>{if(e.path.startsWith("/auth")||e.path.startsWith("/api/auth")||e.path.startsWith("/logs")||e.path==="/sessions/tailscale/status"||e.path.startsWith("/push")){if(n.allowTailscaleAuth&&(e.path.startsWith("/auth")||e.path.startsWith("/api/auth"))){let s=kp(e);s&&(e.authMethod="tailscale",e.userId=s.login,e.tailscaleUser=s)}return i()}if(n.noAuth)return e.authMethod="no-auth",e.userId="no-auth-user",i();if(n.allowTailscaleAuth){let s=kp(e);if(s)return Hb(e)?!(e.headers["x-forwarded-proto"]&&e.headers["x-forwarded-for"]&&e.headers["x-forwarded-host"])?(Ye.warn("Tailscale headers present but missing proxy headers"),r.status(401).json({error:"Invalid proxy configuration"})):(Ye.info(`Tailscale authentication successful for user: ${s.login}`),Ye.info(`User details - Name: ${s.name}, Has profile pic: ${!!s.profilePic}`),e.authMethod="tailscale",e.userId=s.login,e.tailscaleUser=s,i()):(Ye.warn(`Tailscale headers present but request not from localhost: ${e.socket.remoteAddress}`),r.status(401).json({error:"Invalid request origin"}))}if(n.allowLocalBypass&&Gb(e))if(n.localAuthToken){if(e.headers["x-vibetunnel-local"]===n.localAuthToken)return Ye.debug("Local request authenticated with token"),e.authMethod="local-bypass",e.userId="local-user",i();Ye.debug("Local request missing or invalid token")}else return Ye.debug("Local request authenticated without token"),e.authMethod="local-bypass",e.userId="local-user",i();let t=e.headers.authorization,o=e.query.token;if(t?.startsWith("Bearer ")){let s=t.substring(7);if(n.isHQMode&&n.bearerToken&&s===n.bearerToken)return Ye.debug("Valid HQ bearer token authentication"),e.isHQRequest=!0,e.authMethod="hq-bearer",i();if(n.authService&&n.enableSSHKeys){let a=n.authService.verifyToken(s);if(a.valid&&a.userId)return e.userId=a.userId,e.authMethod="ssh-key",i();Ye.error("Invalid JWT token")}else if(n.authService){let a=n.authService.verifyToken(s);if(a.valid&&a.userId)return e.userId=a.userId,e.authMethod="password",i();Ye.error("Invalid JWT token")}if(!n.isHQMode&&n.bearerToken&&s===n.bearerToken)return Ye.debug("Valid remote bearer token authentication"),e.authMethod="hq-bearer",i();Ye.error(`Bearer token rejected - HQ mode: ${n.isHQMode}, token matches: ${n.bearerToken===s}`)}if(o&&n.authService){let s=n.authService.verifyToken(o);if(s.valid&&s.userId)return Ye.debug(`Valid query token for user: ${s.userId}`),e.userId=s.userId,e.authMethod=n.enableSSHKeys?"ssh-key":"password",i();Ye.error("Invalid query token")}Ye.error(`Unauthorized request to ${e.method} ${e.path} from ${e.ip}`),r.setHeader("WWW-Authenticate",'Bearer realm="VibeTunnel"'),r.status(401).json({error:"Authentication required"})}}var Pp=require("express"),tc=require("util");function Tp(n){let e=(0,Pp.Router)(),{authService:r}=n;return e.post("/challenge",async(i,t)=>{try{let{userId:o}=i.body;if(!o)return t.status(400).json({error:"User ID is required"});if(!await r.userExists(o))return t.status(404).json({error:"User not found"});let a=r.createChallenge(o);t.json({challengeId:a.challengeId,challenge:a.challenge,expiresAt:Date.now()+300*1e3})}catch(o){console.error("Error creating auth challenge:",o),t.status(500).json({error:"Failed to create authentication challenge"})}}),e.post("/ssh-key",async(i,t)=>{try{let{challengeId:o,publicKey:s,signature:a}=i.body;if(!o||!s||!a)return t.status(400).json({error:"Challenge ID, public key, and signature are required"});let c=await r.authenticateWithSSHKey({challengeId:o,publicKey:s,signature:a});c.success?t.json({success:!0,token:c.token,userId:c.userId,authMethod:"ssh-key"}):t.status(401).json({success:!1,error:c.error})}catch(o){console.error("Error authenticating with SSH key:",o),t.status(500).json({error:"SSH key authentication failed"})}}),e.post("/password",async(i,t)=>{try{let{userId:o,password:s}=i.body;if(!o||!s)return t.status(400).json({error:"User ID and password are required"});let a=await r.authenticateWithPassword(o,s);a.success?t.json({success:!0,token:a.token,userId:a.userId,authMethod:"password"}):t.status(401).json({success:!1,error:a.error})}catch(o){console.error("Error authenticating with password:",o),t.status(500).json({error:"Password authentication failed"})}}),e.get("/verify",(i,t)=>{try{let o=i.headers.authorization;if(!o||!o.startsWith("Bearer "))return t.status(401).json({valid:!1,error:"No token provided"});let s=o.slice(7),a=r.verifyToken(s);a.valid?t.json({valid:!0,userId:a.userId}):t.status(401).json({valid:!1,error:"Invalid or expired token"})}catch(o){console.error("Error verifying token:",o),t.status(500).json({error:"Token verification failed"})}}),e.get("/current-user",(i,t)=>{try{let o=r.getCurrentUser();t.json({userId:o})}catch(o){console.error("Error getting current user:",o),t.status(500).json({error:"Failed to get current user"})}}),e.get("/config",(i,t)=>{try{let o={enableSSHKeys:n.enableSSHKeys||!1,disallowUserPassword:n.disallowUserPassword||!1,noAuth:n.noAuth||!1};i.authMethod==="tailscale"&&i.userId&&(o.tailscaleAuth=!0,o.authenticatedUser=i.userId,o.tailscaleUser=i.tailscaleUser),t.json(o)}catch(o){console.error("Error getting auth config:",o),t.status(500).json({error:"Failed to get auth config"})}}),e.get("/avatar/:userId",async(i,t)=>{try{let{userId:o}=i.params;if(!o||!/^[a-zA-Z0-9._-]+$/.test(o))return t.status(400).json({error:"Invalid user ID format"});if(o.length>255)return t.status(400).json({error:"User ID too long"});if(process.platform!=="darwin")return t.json({avatar:null,platform:process.platform});try{let{execFile:s}=await import("child_process"),a=(0,tc.promisify)(s),{stdout:c}=await a("dscl",[".","-read",`/Users/${o}`,"JPEGPhoto"]);if(c.includes("JPEGPhoto:")){let u=c.split(`
`).slice(1).filter(d=>d.trim()&&!d.startsWith("dsAttrTypeNative"));if(u.length>0){let d=u.join("").replace(/\s/g,""),p=Buffer.from(d,"hex").toString("base64");return t.json({avatar:`data:image/jpeg;base64,${p}`,platform:"darwin",source:"dscl"})}}}catch{console.log("No JPEGPhoto found for user, trying Picture attribute")}try{let{execFile:s}=await import("child_process"),a=(0,tc.promisify)(s),{stdout:c}=await a("dscl",[".","-read",`/Users/${o}`,"Picture"]);if(c.includes("Picture:")){let l=c.split("Picture:")[1].trim();if(l&&l!=="Picture:")return t.json({avatar:l,platform:"darwin",source:"picture_path"})}}catch{console.log("No Picture attribute found for user")}t.json({avatar:null,platform:"darwin"})}catch(o){console.error("Error getting user avatar:",o),t.status(500).json({error:"Failed to get user avatar"})}}),e.post("/logout",(i,t)=>{t.json({success:!0,message:"Logged out successfully"})}),e}var Eh=require("express");var M={};Et(M,{$brand:()=>nc,$input:()=>pu,$output:()=>mu,NEVER:()=>rc,TimePrecision:()=>vu,ZodAny:()=>Jg,ZodArray:()=>Xg,ZodBase64:()=>Td,ZodBase64URL:()=>Id,ZodBigInt:()=>Yi,ZodBigIntFormat:()=>jd,ZodBoolean:()=>Qi,ZodCIDRv4:()=>_d,ZodCIDRv6:()=>Pd,ZodCUID:()=>yd,ZodCUID2:()=>bd,ZodCatch:()=>yh,ZodCustom:()=>Is,ZodCustomStringFormat:()=>Nd,ZodDate:()=>Ps,ZodDefault:()=>fh,ZodDiscriminatedUnion:()=>eh,ZodE164:()=>Ed,ZodEmail:()=>pd,ZodEmoji:()=>hd,ZodEnum:()=>qi,ZodError:()=>US,ZodFile:()=>uh,ZodFirstPartyTypeKind:()=>Wd,ZodGUID:()=>Ss,ZodIPv4:()=>xd,ZodIPv6:()=>kd,ZodISODate:()=>vs,ZodISODateTime:()=>hs,ZodISODuration:()=>bs,ZodISOTime:()=>ys,ZodIntersection:()=>th,ZodIssueCode:()=>V$,ZodJWT:()=>Cd,ZodKSUID:()=>$d,ZodLazy:()=>kh,ZodLiteral:()=>ch,ZodMap:()=>oh,ZodNaN:()=>wh,ZodNanoID:()=>vd,ZodNever:()=>Qg,ZodNonOptional:()=>Ld,ZodNull:()=>Hg,ZodNullable:()=>dh,ZodNumber:()=>Ki,ZodNumberFormat:()=>Wn,ZodObject:()=>Ts,ZodOptional:()=>Fd,ZodPipe:()=>Bd,ZodPrefault:()=>ph,ZodPromise:()=>Ph,ZodReadonly:()=>Sh,ZodRealError:()=>Bn,ZodRecord:()=>Od,ZodSet:()=>sh,ZodString:()=>Ji,ZodStringFormat:()=>pe,ZodSuccess:()=>vh,ZodSymbol:()=>Vg,ZodTemplateLiteral:()=>xh,ZodTransform:()=>Md,ZodTuple:()=>nh,ZodType:()=>Y,ZodULID:()=>wd,ZodURL:()=>gd,ZodUUID:()=>fr,ZodUndefined:()=>Gg,ZodUnion:()=>Dd,ZodUnknown:()=>Kg,ZodVoid:()=>Yg,ZodXID:()=>Sd,_ZodString:()=>md,_default:()=>mh,any:()=>w$,array:()=>zd,base64:()=>o$,base64url:()=>s$,bigint:()=>g$,boolean:()=>Zg,catch:()=>bh,check:()=>U$,cidrv4:()=>n$,cidrv6:()=>i$,clone:()=>at,coerce:()=>Zd,config:()=>Ce,core:()=>dr,cuid:()=>KS,cuid2:()=>QS,custom:()=>F$,date:()=>$$,discriminatedUnion:()=>T$,e164:()=>a$,email:()=>LS,emoji:()=>qS,endsWith:()=>Fi,enum:()=>ah,file:()=>A$,flattenError:()=>_i,float32:()=>d$,float64:()=>f$,formatError:()=>Pi,function:()=>td,getErrorMap:()=>H$,globalRegistry:()=>Ht,gt:()=>lr,gte:()=>ct,guid:()=>BS,hostname:()=>u$,includes:()=>Mi,instanceof:()=>L$,int:()=>fd,int32:()=>m$,int64:()=>h$,intersection:()=>rh,ipv4:()=>t$,ipv6:()=>r$,iso:()=>ws,json:()=>W$,jwt:()=>c$,keyof:()=>x$,ksuid:()=>e$,lazy:()=>_h,length:()=>Ln,literal:()=>lh,locales:()=>ji,looseObject:()=>P$,lowercase:()=>Ri,lt:()=>cr,lte:()=>_t,map:()=>C$,maxLength:()=>Fn,maxSize:()=>Un,mime:()=>Li,minLength:()=>zr,minSize:()=>Xr,multipleOf:()=>Yr,nan:()=>R$,nanoid:()=>JS,nativeEnum:()=>j$,negative:()=>Vu,never:()=>Ad,nonnegative:()=>Hu,nonoptional:()=>hh,nonpositive:()=>Gu,normalize:()=>Bi,null:()=>qg,nullable:()=>ks,nullish:()=>z$,number:()=>Wg,object:()=>k$,optional:()=>xs,overwrite:()=>ur,parse:()=>ad,parseAsync:()=>cd,partialRecord:()=>E$,pipe:()=>_s,positive:()=>Zu,prefault:()=>gh,preprocess:()=>Z$,prettifyError:()=>mc,promise:()=>M$,property:()=>qu,readonly:()=>$h,record:()=>ih,refine:()=>Th,regex:()=>Di,regexes:()=>ar,registry:()=>Go,safeParse:()=>ld,safeParseAsync:()=>ud,set:()=>N$,setErrorMap:()=>G$,size:()=>zi,startsWith:()=>Ui,strictObject:()=>_$,string:()=>dd,stringFormat:()=>l$,stringbool:()=>B$,success:()=>D$,superRefine:()=>Ih,symbol:()=>y$,templateLiteral:()=>O$,toJSONSchema:()=>rd,toLowerCase:()=>Zi,toUpperCase:()=>Vi,transform:()=>Ud,treeifyError:()=>fc,trim:()=>Wi,tuple:()=>I$,uint32:()=>p$,uint64:()=>v$,ulid:()=>YS,undefined:()=>b$,union:()=>Rd,unknown:()=>$s,uppercase:()=>Oi,url:()=>HS,uuid:()=>WS,uuidv4:()=>ZS,uuidv6:()=>VS,uuidv7:()=>GS,void:()=>S$,xid:()=>XS});var dr={};Et(dr,{$ZodAny:()=>Ll,$ZodArray:()=>Ei,$ZodAsyncError:()=>Vt,$ZodBase64:()=>Nl,$ZodBase64URL:()=>jl,$ZodBigInt:()=>Wo,$ZodBigIntFormat:()=>Ol,$ZodBoolean:()=>Ii,$ZodCIDRv4:()=>Il,$ZodCIDRv6:()=>El,$ZodCUID:()=>vl,$ZodCUID2:()=>yl,$ZodCatch:()=>su,$ZodCheck:()=>ye,$ZodCheckBigIntFormat:()=>Hc,$ZodCheckEndsWith:()=>ol,$ZodCheckGreaterThan:()=>Uo,$ZodCheckIncludes:()=>nl,$ZodCheckLengthEquals:()=>Xc,$ZodCheckLessThan:()=>Mo,$ZodCheckLowerCase:()=>tl,$ZodCheckMaxLength:()=>Qc,$ZodCheckMaxSize:()=>qc,$ZodCheckMimeType:()=>al,$ZodCheckMinLength:()=>Yc,$ZodCheckMinSize:()=>Jc,$ZodCheckMultipleOf:()=>Vc,$ZodCheckNumberFormat:()=>Gc,$ZodCheckOverwrite:()=>cl,$ZodCheckProperty:()=>sl,$ZodCheckRegex:()=>el,$ZodCheckSizeEquals:()=>Kc,$ZodCheckStartsWith:()=>il,$ZodCheckStringFormat:()=>Dn,$ZodCheckUpperCase:()=>rl,$ZodCustom:()=>fu,$ZodCustomStringFormat:()=>Dl,$ZodDate:()=>Zl,$ZodDefault:()=>ru,$ZodDiscriminatedUnion:()=>Gl,$ZodE164:()=>Al,$ZodEmail:()=>ml,$ZodEmoji:()=>gl,$ZodEnum:()=>Ql,$ZodError:()=>ki,$ZodFile:()=>Xl,$ZodFunction:()=>gs,$ZodGUID:()=>dl,$ZodIPv4:()=>Pl,$ZodIPv6:()=>Tl,$ZodISODate:()=>xl,$ZodISODateTime:()=>$l,$ZodISODuration:()=>_l,$ZodISOTime:()=>kl,$ZodIntersection:()=>Hl,$ZodJWT:()=>zl,$ZodKSUID:()=>Sl,$ZodLazy:()=>du,$ZodLiteral:()=>Yl,$ZodMap:()=>Jl,$ZodNaN:()=>au,$ZodNanoID:()=>hl,$ZodNever:()=>Bl,$ZodNonOptional:()=>iu,$ZodNull:()=>Fl,$ZodNullable:()=>tu,$ZodNumber:()=>Bo,$ZodNumberFormat:()=>Rl,$ZodObject:()=>Vl,$ZodOptional:()=>eu,$ZodPipe:()=>Ni,$ZodPrefault:()=>nu,$ZodPromise:()=>uu,$ZodReadonly:()=>cu,$ZodRealError:()=>zn,$ZodRecord:()=>ql,$ZodRegistry:()=>On,$ZodSet:()=>Kl,$ZodString:()=>Kr,$ZodStringFormat:()=>fe,$ZodSuccess:()=>ou,$ZodSymbol:()=>Ml,$ZodTemplateLiteral:()=>lu,$ZodTransform:()=>Ci,$ZodTuple:()=>Qr,$ZodType:()=>G,$ZodULID:()=>bl,$ZodURL:()=>pl,$ZodUUID:()=>fl,$ZodUndefined:()=>Ul,$ZodUnion:()=>Zo,$ZodUnknown:()=>Rn,$ZodVoid:()=>Wl,$ZodXID:()=>wl,$brand:()=>nc,$constructor:()=>w,$input:()=>pu,$output:()=>mu,Doc:()=>Ti,JSONSchema:()=>Fg,JSONSchemaGenerator:()=>Hi,NEVER:()=>rc,TimePrecision:()=>vu,_any:()=>Mu,_array:()=>Gi,_base64:()=>us,_base64url:()=>ds,_bigint:()=>Nu,_boolean:()=>Eu,_catch:()=>jS,_check:()=>Ug,_cidrv4:()=>cs,_cidrv6:()=>ls,_coercedBigint:()=>ju,_coercedBoolean:()=>Cu,_coercedDate:()=>Bu,_coercedNumber:()=>xu,_coercedString:()=>hu,_cuid:()=>ts,_cuid2:()=>rs,_custom:()=>Qu,_date:()=>Lu,_default:()=>ES,_discriminatedUnion:()=>yS,_e164:()=>fs,_email:()=>Ho,_emoji:()=>Xo,_endsWith:()=>Fi,_enum:()=>xS,_file:()=>Ku,_float32:()=>_u,_float64:()=>Pu,_gt:()=>lr,_gte:()=>ct,_guid:()=>Ai,_includes:()=>Mi,_int:()=>ku,_int32:()=>Tu,_int64:()=>Au,_intersection:()=>bS,_ipv4:()=>ss,_ipv6:()=>as,_isoDate:()=>bu,_isoDateTime:()=>yu,_isoDuration:()=>Su,_isoTime:()=>wu,_jwt:()=>ms,_ksuid:()=>os,_lazy:()=>RS,_length:()=>Ln,_literal:()=>_S,_lowercase:()=>Ri,_lt:()=>cr,_lte:()=>_t,_map:()=>SS,_max:()=>_t,_maxLength:()=>Fn,_maxSize:()=>Un,_mime:()=>Li,_min:()=>ct,_minLength:()=>zr,_minSize:()=>Xr,_multipleOf:()=>Yr,_nan:()=>Wu,_nanoid:()=>es,_nativeEnum:()=>kS,_negative:()=>Vu,_never:()=>Uu,_nonnegative:()=>Hu,_nonoptional:()=>CS,_nonpositive:()=>Gu,_normalize:()=>Bi,_null:()=>Ou,_nullable:()=>IS,_number:()=>$u,_optional:()=>TS,_overwrite:()=>ur,_parse:()=>No,_parseAsync:()=>Ao,_pipe:()=>AS,_positive:()=>Zu,_promise:()=>OS,_property:()=>qu,_readonly:()=>zS,_record:()=>wS,_refine:()=>Yu,_regex:()=>Di,_safeParse:()=>Do,_safeParseAsync:()=>Ro,_set:()=>$S,_size:()=>zi,_startsWith:()=>Ui,_string:()=>gu,_stringFormat:()=>ps,_stringbool:()=>ed,_success:()=>NS,_superRefine:()=>Xu,_symbol:()=>Du,_templateLiteral:()=>DS,_toLowerCase:()=>Zi,_toUpperCase:()=>Vi,_transform:()=>PS,_trim:()=>Wi,_tuple:()=>Ju,_uint32:()=>Iu,_uint64:()=>zu,_ulid:()=>ns,_undefined:()=>Ru,_union:()=>vS,_unknown:()=>Mn,_uppercase:()=>Oi,_url:()=>Yo,_uuid:()=>qo,_uuidv4:()=>Jo,_uuidv6:()=>Ko,_uuidv7:()=>Qo,_void:()=>Fu,_xid:()=>is,clone:()=>at,config:()=>Ce,flattenError:()=>_i,formatError:()=>Pi,function:()=>td,globalConfig:()=>hi,globalRegistry:()=>Ht,isValidBase64:()=>Cl,isValidBase64URL:()=>Hp,isValidJWT:()=>qp,locales:()=>ji,parse:()=>jo,parseAsync:()=>zo,prettifyError:()=>mc,regexes:()=>ar,registry:()=>Go,safeParse:()=>pc,safeParseAsync:()=>gc,toDotPath:()=>Cp,toJSONSchema:()=>rd,treeifyError:()=>fc,util:()=>D,version:()=>ll});var rc=Object.freeze({status:"aborted"});function w(n,e,r){function i(a,c){var l;Object.defineProperty(a,"_zod",{value:a._zod??{},enumerable:!1}),(l=a._zod).traits??(l.traits=new Set),a._zod.traits.add(n),e(a,c);for(let u in s.prototype)u in a||Object.defineProperty(a,u,{value:s.prototype[u].bind(a)});a._zod.constr=s,a._zod.def=c}let t=r?.Parent??Object;class o extends t{}Object.defineProperty(o,"name",{value:n});function s(a){var c;let l=r?.Parent?new o:this;i(l,a),(c=l._zod).deferred??(c.deferred=[]);for(let u of l._zod.deferred)u();return l}return Object.defineProperty(s,"init",{value:i}),Object.defineProperty(s,Symbol.hasInstance,{value:a=>r?.Parent&&a instanceof r.Parent?!0:a?._zod?.traits?.has(n)}),Object.defineProperty(s,"name",{value:n}),s}var nc=Symbol("zod_brand"),Vt=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}},hi={};function Ce(n){return n&&Object.assign(hi,n),hi}var D={};Et(D,{BIGINT_FORMAT_RANGES:()=>dc,Class:()=>oc,NUMBER_FORMAT_RANGES:()=>uc,aborted:()=>qr,allowsEval:()=>ac,assert:()=>Yb,assertEqual:()=>qb,assertIs:()=>Kb,assertNever:()=>Qb,assertNotEqual:()=>Jb,assignProp:()=>Hr,cached:()=>bi,captureStackTrace:()=>Co,cleanEnum:()=>fw,cleanRegex:()=>wi,clone:()=>at,cloneDef:()=>Xb,createTransparentProxy:()=>ow,defineLazy:()=>ie,esc:()=>Eo,escapeRegex:()=>Gt,extend:()=>cw,finalizeIssue:()=>pt,floatSafeRemainder:()=>sc,getElementAtPath:()=>ew,getEnumValues:()=>yi,getLengthableOrigin:()=>xi,getParsedType:()=>iw,getSizableOrigin:()=>$i,isObject:()=>Cn,isPlainObject:()=>jn,issue:()=>An,joinValues:()=>_,jsonStringifyReplacer:()=>Nn,merge:()=>lw,mergeDefs:()=>Ar,normalizeParams:()=>j,nullish:()=>jr,numKeys:()=>nw,omit:()=>aw,optionalKeys:()=>lc,partial:()=>uw,pick:()=>sw,prefixIssues:()=>mt,primitiveTypes:()=>cc,promiseAllObject:()=>tw,propertyKeyTypes:()=>Si,randomString:()=>rw,required:()=>dw,stringifyPrimitive:()=>A,unwrapMessage:()=>vi});function qb(n){return n}function Jb(n){return n}function Kb(n){}function Qb(n){throw new Error}function Yb(n){}function yi(n){let e=Object.values(n).filter(i=>typeof i=="number");return Object.entries(n).filter(([i,t])=>e.indexOf(+i)===-1).map(([i,t])=>t)}function _(n,e="|"){return n.map(r=>A(r)).join(e)}function Nn(n,e){return typeof e=="bigint"?e.toString():e}function bi(n){return{get value(){{let r=n();return Object.defineProperty(this,"value",{value:r}),r}throw new Error("cached value already set")}}}function jr(n){return n==null}function wi(n){let e=n.startsWith("^")?1:0,r=n.endsWith("$")?n.length-1:n.length;return n.slice(e,r)}function sc(n,e){let r=(n.toString().split(".")[1]||"").length,i=e.toString(),t=(i.split(".")[1]||"").length;if(t===0&&/\d?e-\d?/.test(i)){let c=i.match(/\d?e-(\d?)/);c?.[1]&&(t=Number.parseInt(c[1]))}let o=r>t?r:t,s=Number.parseInt(n.toFixed(o).replace(".","")),a=Number.parseInt(e.toFixed(o).replace(".",""));return s%a/10**o}var Ip=Symbol("evaluating");function ie(n,e,r){let i;Object.defineProperty(n,e,{get(){if(i!==Ip)return i===void 0&&(i=Ip,i=r()),i},set(t){Object.defineProperty(n,e,{value:t})},configurable:!0})}function Hr(n,e,r){Object.defineProperty(n,e,{value:r,writable:!0,enumerable:!0,configurable:!0})}function Ar(...n){let e={};for(let r of n){let i=Object.getOwnPropertyDescriptors(r);Object.assign(e,i)}return Object.defineProperties({},e)}function Xb(n){return Ar(n._zod.def)}function ew(n,e){return e?e.reduce((r,i)=>r?.[i],n):n}function tw(n){let e=Object.keys(n),r=e.map(i=>n[i]);return Promise.all(r).then(i=>{let t={};for(let o=0;o<e.length;o++)t[e[o]]=i[o];return t})}function rw(n=10){let e="abcdefghijklmnopqrstuvwxyz",r="";for(let i=0;i<n;i++)r+=e[Math.floor(Math.random()*e.length)];return r}function Eo(n){return JSON.stringify(n)}var Co="captureStackTrace"in Error?Error.captureStackTrace:(...n)=>{};function Cn(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}var ac=bi(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{let n=Function;return new n(""),!0}catch{return!1}});function jn(n){if(Cn(n)===!1)return!1;let e=n.constructor;if(e===void 0)return!0;let r=e.prototype;return!(Cn(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}function nw(n){let e=0;for(let r in n)Object.prototype.hasOwnProperty.call(n,r)&&e++;return e}var iw=n=>{let e=typeof n;switch(e){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(n)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":return Array.isArray(n)?"array":n===null?"null":n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?"promise":typeof Map<"u"&&n instanceof Map?"map":typeof Set<"u"&&n instanceof Set?"set":typeof Date<"u"&&n instanceof Date?"date":typeof File<"u"&&n instanceof File?"file":"object";default:throw new Error(`Unknown data type: ${e}`)}},Si=new Set(["string","number","symbol"]),cc=new Set(["string","number","bigint","boolean","symbol","undefined"]);function Gt(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function at(n,e,r){let i=new n._zod.constr(e??n._zod.def);return(!e||r?.parent)&&(i._zod.parent=n),i}function j(n){let e=n;if(!e)return{};if(typeof e=="string")return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function ow(n){let e;return new Proxy({},{get(r,i,t){return e??(e=n()),Reflect.get(e,i,t)},set(r,i,t,o){return e??(e=n()),Reflect.set(e,i,t,o)},has(r,i){return e??(e=n()),Reflect.has(e,i)},deleteProperty(r,i){return e??(e=n()),Reflect.deleteProperty(e,i)},ownKeys(r){return e??(e=n()),Reflect.ownKeys(e)},getOwnPropertyDescriptor(r,i){return e??(e=n()),Reflect.getOwnPropertyDescriptor(e,i)},defineProperty(r,i,t){return e??(e=n()),Reflect.defineProperty(e,i,t)}})}function A(n){return typeof n=="bigint"?n.toString()+"n":typeof n=="string"?`"${n}"`:`${n}`}function lc(n){return Object.keys(n).filter(e=>n[e]._zod.optin==="optional"&&n[e]._zod.optout==="optional")}var uc={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},dc={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function sw(n,e){let r=n._zod.def,i=Ar(n._zod.def,{get shape(){let t={};for(let o in e){if(!(o in r.shape))throw new Error(`Unrecognized key: "${o}"`);e[o]&&(t[o]=r.shape[o])}return Hr(this,"shape",t),t},checks:[]});return at(n,i)}function aw(n,e){let r=n._zod.def,i=Ar(n._zod.def,{get shape(){let t={...n._zod.def.shape};for(let o in e){if(!(o in r.shape))throw new Error(`Unrecognized key: "${o}"`);e[o]&&delete t[o]}return Hr(this,"shape",t),t},checks:[]});return at(n,i)}function cw(n,e){if(!jn(e))throw new Error("Invalid input to extend: expected a plain object");let r=Ar(n._zod.def,{get shape(){let i={...n._zod.def.shape,...e};return Hr(this,"shape",i),i},checks:[]});return at(n,r)}function lw(n,e){let r=Ar(n._zod.def,{get shape(){let i={...n._zod.def.shape,...e._zod.def.shape};return Hr(this,"shape",i),i},get catchall(){return e._zod.def.catchall},checks:[]});return at(n,r)}function uw(n,e,r){let i=Ar(e._zod.def,{get shape(){let t=e._zod.def.shape,o={...t};if(r)for(let s in r){if(!(s in t))throw new Error(`Unrecognized key: "${s}"`);r[s]&&(o[s]=n?new n({type:"optional",innerType:t[s]}):t[s])}else for(let s in t)o[s]=n?new n({type:"optional",innerType:t[s]}):t[s];return Hr(this,"shape",o),o},checks:[]});return at(e,i)}function dw(n,e,r){let i=Ar(e._zod.def,{get shape(){let t=e._zod.def.shape,o={...t};if(r)for(let s in r){if(!(s in o))throw new Error(`Unrecognized key: "${s}"`);r[s]&&(o[s]=new n({type:"nonoptional",innerType:t[s]}))}else for(let s in t)o[s]=new n({type:"nonoptional",innerType:t[s]});return Hr(this,"shape",o),o},checks:[]});return at(e,i)}function qr(n,e=0){for(let r=e;r<n.issues.length;r++)if(n.issues[r]?.continue!==!0)return!0;return!1}function mt(n,e){return e.map(r=>{var i;return(i=r).path??(i.path=[]),r.path.unshift(n),r})}function vi(n){return typeof n=="string"?n:n?.message}function pt(n,e,r){let i={...n,path:n.path??[]};if(!n.message){let t=vi(n.inst?._zod.def?.error?.(n))??vi(e?.error?.(n))??vi(r.customError?.(n))??vi(r.localeError?.(n))??"Invalid input";i.message=t}return delete i.inst,delete i.continue,e?.reportInput||delete i.input,i}function $i(n){return n instanceof Set?"set":n instanceof Map?"map":n instanceof File?"file":"unknown"}function xi(n){return Array.isArray(n)?"array":typeof n=="string"?"string":"unknown"}function An(...n){let[e,r,i]=n;return typeof e=="string"?{message:e,code:"custom",input:r,inst:i}:{...e}}function fw(n){return Object.entries(n).filter(([e,r])=>Number.isNaN(Number.parseInt(e,10))).map(e=>e[1])}var oc=class{constructor(...e){}};var Ep=(n,e)=>{n.name="$ZodError",Object.defineProperty(n,"_zod",{value:n._zod,enumerable:!1}),Object.defineProperty(n,"issues",{value:e,enumerable:!1}),n.message=JSON.stringify(e,Nn,2),Object.defineProperty(n,"toString",{value:()=>n.message,enumerable:!1})},ki=w("$ZodError",Ep),zn=w("$ZodError",Ep,{Parent:Error});function _i(n,e=r=>r.message){let r={},i=[];for(let t of n.issues)t.path.length>0?(r[t.path[0]]=r[t.path[0]]||[],r[t.path[0]].push(e(t))):i.push(e(t));return{formErrors:i,fieldErrors:r}}function Pi(n,e){let r=e||function(o){return o.message},i={_errors:[]},t=o=>{for(let s of o.issues)if(s.code==="invalid_union"&&s.errors.length)s.errors.map(a=>t({issues:a}));else if(s.code==="invalid_key")t({issues:s.issues});else if(s.code==="invalid_element")t({issues:s.issues});else if(s.path.length===0)i._errors.push(r(s));else{let a=i,c=0;for(;c<s.path.length;){let l=s.path[c];c===s.path.length-1?(a[l]=a[l]||{_errors:[]},a[l]._errors.push(r(s))):a[l]=a[l]||{_errors:[]},a=a[l],c++}}};return t(n),i}function fc(n,e){let r=e||function(o){return o.message},i={errors:[]},t=(o,s=[])=>{var a,c;for(let l of o.issues)if(l.code==="invalid_union"&&l.errors.length)l.errors.map(u=>t({issues:u},l.path));else if(l.code==="invalid_key")t({issues:l.issues},l.path);else if(l.code==="invalid_element")t({issues:l.issues},l.path);else{let u=[...s,...l.path];if(u.length===0){i.errors.push(r(l));continue}let d=i,f=0;for(;f<u.length;){let p=u[f],m=f===u.length-1;typeof p=="string"?(d.properties??(d.properties={}),(a=d.properties)[p]??(a[p]={errors:[]}),d=d.properties[p]):(d.items??(d.items=[]),(c=d.items)[p]??(c[p]={errors:[]}),d=d.items[p]),m&&d.errors.push(r(l)),f++}}};return t(n),i}function Cp(n){let e=[],r=n.map(i=>typeof i=="object"?i.key:i);for(let i of r)typeof i=="number"?e.push(`[${i}]`):typeof i=="symbol"?e.push(`[${JSON.stringify(String(i))}]`):/[^\w$]/.test(i)?e.push(`[${JSON.stringify(i)}]`):(e.length&&e.push("."),e.push(i));return e.join("")}function mc(n){let e=[],r=[...n.issues].sort((i,t)=>(i.path??[]).length-(t.path??[]).length);for(let i of r)e.push(`\u2716 ${i.message}`),i.path?.length&&e.push(`  \u2192 at ${Cp(i.path)}`);return e.join(`
`)}var No=n=>(e,r,i,t)=>{let o=i?Object.assign(i,{async:!1}):{async:!1},s=e._zod.run({value:r,issues:[]},o);if(s instanceof Promise)throw new Vt;if(s.issues.length){let a=new(t?.Err??n)(s.issues.map(c=>pt(c,o,Ce())));throw Co(a,t?.callee),a}return s.value},jo=No(zn),Ao=n=>async(e,r,i,t)=>{let o=i?Object.assign(i,{async:!0}):{async:!0},s=e._zod.run({value:r,issues:[]},o);if(s instanceof Promise&&(s=await s),s.issues.length){let a=new(t?.Err??n)(s.issues.map(c=>pt(c,o,Ce())));throw Co(a,t?.callee),a}return s.value},zo=Ao(zn),Do=n=>(e,r,i)=>{let t=i?{...i,async:!1}:{async:!1},o=e._zod.run({value:r,issues:[]},t);if(o instanceof Promise)throw new Vt;return o.issues.length?{success:!1,error:new(n??ki)(o.issues.map(s=>pt(s,t,Ce())))}:{success:!0,data:o.value}},pc=Do(zn),Ro=n=>async(e,r,i)=>{let t=i?Object.assign(i,{async:!0}):{async:!0},o=e._zod.run({value:r,issues:[]},t);return o instanceof Promise&&(o=await o),o.issues.length?{success:!1,error:new n(o.issues.map(s=>pt(s,t,Ce())))}:{success:!0,data:o.value}},gc=Ro(zn);var ar={};Et(ar,{base64:()=>Cc,base64url:()=>Oo,bigint:()=>Oc,boolean:()=>Fc,browserEmail:()=>$w,cidrv4:()=>Ic,cidrv6:()=>Ec,cuid:()=>hc,cuid2:()=>vc,date:()=>Ac,datetime:()=>Dc,domain:()=>kw,duration:()=>$c,e164:()=>jc,email:()=>kc,emoji:()=>_c,extendedDuration:()=>pw,guid:()=>xc,hostname:()=>Nc,html5Email:()=>yw,idnEmail:()=>Sw,integer:()=>Mc,ipv4:()=>Pc,ipv6:()=>Tc,ksuid:()=>wc,lowercase:()=>Wc,nanoid:()=>Sc,null:()=>Lc,number:()=>Uc,rfc5322Email:()=>bw,string:()=>Rc,time:()=>zc,ulid:()=>yc,undefined:()=>Bc,unicodeEmail:()=>ww,uppercase:()=>Zc,uuid:()=>Jr,uuid4:()=>gw,uuid6:()=>hw,uuid7:()=>vw,xid:()=>bc});var hc=/^[cC][^\s-]{8,}$/,vc=/^[0-9a-z]+$/,yc=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,bc=/^[0-9a-vA-V]{20}$/,wc=/^[A-Za-z0-9]{27}$/,Sc=/^[a-zA-Z0-9_-]{21}$/,$c=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,pw=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,xc=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Jr=n=>n?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${n}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/,gw=Jr(4),hw=Jr(6),vw=Jr(7),kc=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,yw=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,bw=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,ww=/^[^\s@"]{1,64}@[^\s@]{1,255}$/u,Sw=/^[^\s@"]{1,64}@[^\s@]{1,255}$/u,$w=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,xw="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function _c(){return new RegExp(xw,"u")}var Pc=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Tc=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,Ic=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,Ec=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Cc=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,Oo=/^[A-Za-z0-9_-]*$/,Nc=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,kw=/^([a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/,jc=/^\+(?:[0-9]){6,14}[0-9]$/,Np="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",Ac=new RegExp(`^${Np}$`);function jp(n){let e="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof n.precision=="number"?n.precision===-1?`${e}`:n.precision===0?`${e}:[0-5]\\d`:`${e}:[0-5]\\d\\.\\d{${n.precision}}`:`${e}(?::[0-5]\\d(?:\\.\\d+)?)?`}function zc(n){return new RegExp(`^${jp(n)}$`)}function Dc(n){let e=jp({precision:n.precision}),r=["Z"];n.local&&r.push(""),n.offset&&r.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");let i=`${e}(?:${r.join("|")})`;return new RegExp(`^${Np}T(?:${i})$`)}var Rc=n=>{let e=n?`[\\s\\S]{${n?.minimum??0},${n?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)},Oc=/^\d+n?$/,Mc=/^\d+$/,Uc=/^-?\d+(?:\.\d+)?/i,Fc=/true|false/i,Lc=/null/i;var Bc=/undefined/i;var Wc=/^[^A-Z]*$/,Zc=/^[^a-z]*$/;var ye=w("$ZodCheck",(n,e)=>{var r;n._zod??(n._zod={}),n._zod.def=e,(r=n._zod).onattach??(r.onattach=[])}),zp={number:"number",bigint:"bigint",object:"date"},Mo=w("$ZodCheckLessThan",(n,e)=>{ye.init(n,e);let r=zp[typeof e.value];n._zod.onattach.push(i=>{let t=i._zod.bag,o=(e.inclusive?t.maximum:t.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<o&&(e.inclusive?t.maximum=e.value:t.exclusiveMaximum=e.value)}),n._zod.check=i=>{(e.inclusive?i.value<=e.value:i.value<e.value)||i.issues.push({origin:r,code:"too_big",maximum:e.value,input:i.value,inclusive:e.inclusive,inst:n,continue:!e.abort})}}),Uo=w("$ZodCheckGreaterThan",(n,e)=>{ye.init(n,e);let r=zp[typeof e.value];n._zod.onattach.push(i=>{let t=i._zod.bag,o=(e.inclusive?t.minimum:t.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>o&&(e.inclusive?t.minimum=e.value:t.exclusiveMinimum=e.value)}),n._zod.check=i=>{(e.inclusive?i.value>=e.value:i.value>e.value)||i.issues.push({origin:r,code:"too_small",minimum:e.value,input:i.value,inclusive:e.inclusive,inst:n,continue:!e.abort})}}),Vc=w("$ZodCheckMultipleOf",(n,e)=>{ye.init(n,e),n._zod.onattach.push(r=>{var i;(i=r._zod.bag).multipleOf??(i.multipleOf=e.value)}),n._zod.check=r=>{if(typeof r.value!=typeof e.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%e.value===BigInt(0):sc(r.value,e.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:e.value,input:r.value,inst:n,continue:!e.abort})}}),Gc=w("$ZodCheckNumberFormat",(n,e)=>{ye.init(n,e),e.format=e.format||"float64";let r=e.format?.includes("int"),i=r?"int":"number",[t,o]=uc[e.format];n._zod.onattach.push(s=>{let a=s._zod.bag;a.format=e.format,a.minimum=t,a.maximum=o,r&&(a.pattern=Mc)}),n._zod.check=s=>{let a=s.value;if(r){if(!Number.isInteger(a)){s.issues.push({expected:i,format:e.format,code:"invalid_type",continue:!1,input:a,inst:n});return}if(!Number.isSafeInteger(a)){a>0?s.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:n,origin:i,continue:!e.abort}):s.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:n,origin:i,continue:!e.abort});return}}a<t&&s.issues.push({origin:"number",input:a,code:"too_small",minimum:t,inclusive:!0,inst:n,continue:!e.abort}),a>o&&s.issues.push({origin:"number",input:a,code:"too_big",maximum:o,inst:n})}}),Hc=w("$ZodCheckBigIntFormat",(n,e)=>{ye.init(n,e);let[r,i]=dc[e.format];n._zod.onattach.push(t=>{let o=t._zod.bag;o.format=e.format,o.minimum=r,o.maximum=i}),n._zod.check=t=>{let o=t.value;o<r&&t.issues.push({origin:"bigint",input:o,code:"too_small",minimum:r,inclusive:!0,inst:n,continue:!e.abort}),o>i&&t.issues.push({origin:"bigint",input:o,code:"too_big",maximum:i,inst:n})}}),qc=w("$ZodCheckMaxSize",(n,e)=>{var r;ye.init(n,e),(r=n._zod.def).when??(r.when=i=>{let t=i.value;return!jr(t)&&t.size!==void 0}),n._zod.onattach.push(i=>{let t=i._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<t&&(i._zod.bag.maximum=e.maximum)}),n._zod.check=i=>{let t=i.value;t.size<=e.maximum||i.issues.push({origin:$i(t),code:"too_big",maximum:e.maximum,input:t,inst:n,continue:!e.abort})}}),Jc=w("$ZodCheckMinSize",(n,e)=>{var r;ye.init(n,e),(r=n._zod.def).when??(r.when=i=>{let t=i.value;return!jr(t)&&t.size!==void 0}),n._zod.onattach.push(i=>{let t=i._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>t&&(i._zod.bag.minimum=e.minimum)}),n._zod.check=i=>{let t=i.value;t.size>=e.minimum||i.issues.push({origin:$i(t),code:"too_small",minimum:e.minimum,input:t,inst:n,continue:!e.abort})}}),Kc=w("$ZodCheckSizeEquals",(n,e)=>{var r;ye.init(n,e),(r=n._zod.def).when??(r.when=i=>{let t=i.value;return!jr(t)&&t.size!==void 0}),n._zod.onattach.push(i=>{let t=i._zod.bag;t.minimum=e.size,t.maximum=e.size,t.size=e.size}),n._zod.check=i=>{let t=i.value,o=t.size;if(o===e.size)return;let s=o>e.size;i.issues.push({origin:$i(t),...s?{code:"too_big",maximum:e.size}:{code:"too_small",minimum:e.size},inclusive:!0,exact:!0,input:i.value,inst:n,continue:!e.abort})}}),Qc=w("$ZodCheckMaxLength",(n,e)=>{var r;ye.init(n,e),(r=n._zod.def).when??(r.when=i=>{let t=i.value;return!jr(t)&&t.length!==void 0}),n._zod.onattach.push(i=>{let t=i._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<t&&(i._zod.bag.maximum=e.maximum)}),n._zod.check=i=>{let t=i.value;if(t.length<=e.maximum)return;let s=xi(t);i.issues.push({origin:s,code:"too_big",maximum:e.maximum,inclusive:!0,input:t,inst:n,continue:!e.abort})}}),Yc=w("$ZodCheckMinLength",(n,e)=>{var r;ye.init(n,e),(r=n._zod.def).when??(r.when=i=>{let t=i.value;return!jr(t)&&t.length!==void 0}),n._zod.onattach.push(i=>{let t=i._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>t&&(i._zod.bag.minimum=e.minimum)}),n._zod.check=i=>{let t=i.value;if(t.length>=e.minimum)return;let s=xi(t);i.issues.push({origin:s,code:"too_small",minimum:e.minimum,inclusive:!0,input:t,inst:n,continue:!e.abort})}}),Xc=w("$ZodCheckLengthEquals",(n,e)=>{var r;ye.init(n,e),(r=n._zod.def).when??(r.when=i=>{let t=i.value;return!jr(t)&&t.length!==void 0}),n._zod.onattach.push(i=>{let t=i._zod.bag;t.minimum=e.length,t.maximum=e.length,t.length=e.length}),n._zod.check=i=>{let t=i.value,o=t.length;if(o===e.length)return;let s=xi(t),a=o>e.length;i.issues.push({origin:s,...a?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:i.value,inst:n,continue:!e.abort})}}),Dn=w("$ZodCheckStringFormat",(n,e)=>{var r,i;ye.init(n,e),n._zod.onattach.push(t=>{let o=t._zod.bag;o.format=e.format,e.pattern&&(o.patterns??(o.patterns=new Set),o.patterns.add(e.pattern))}),e.pattern?(r=n._zod).check??(r.check=t=>{e.pattern.lastIndex=0,!e.pattern.test(t.value)&&t.issues.push({origin:"string",code:"invalid_format",format:e.format,input:t.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:n,continue:!e.abort})}):(i=n._zod).check??(i.check=()=>{})}),el=w("$ZodCheckRegex",(n,e)=>{Dn.init(n,e),n._zod.check=r=>{e.pattern.lastIndex=0,!e.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:e.pattern.toString(),inst:n,continue:!e.abort})}}),tl=w("$ZodCheckLowerCase",(n,e)=>{e.pattern??(e.pattern=Wc),Dn.init(n,e)}),rl=w("$ZodCheckUpperCase",(n,e)=>{e.pattern??(e.pattern=Zc),Dn.init(n,e)}),nl=w("$ZodCheckIncludes",(n,e)=>{ye.init(n,e);let r=Gt(e.includes),i=new RegExp(typeof e.position=="number"?`^.{${e.position}}${r}`:r);e.pattern=i,n._zod.onattach.push(t=>{let o=t._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(i)}),n._zod.check=t=>{t.value.includes(e.includes,e.position)||t.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:t.value,inst:n,continue:!e.abort})}}),il=w("$ZodCheckStartsWith",(n,e)=>{ye.init(n,e);let r=new RegExp(`^${Gt(e.prefix)}.*`);e.pattern??(e.pattern=r),n._zod.onattach.push(i=>{let t=i._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(r)}),n._zod.check=i=>{i.value.startsWith(e.prefix)||i.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:i.value,inst:n,continue:!e.abort})}}),ol=w("$ZodCheckEndsWith",(n,e)=>{ye.init(n,e);let r=new RegExp(`.*${Gt(e.suffix)}$`);e.pattern??(e.pattern=r),n._zod.onattach.push(i=>{let t=i._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(r)}),n._zod.check=i=>{i.value.endsWith(e.suffix)||i.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:i.value,inst:n,continue:!e.abort})}});function Ap(n,e,r){n.issues.length&&e.issues.push(...mt(r,n.issues))}var sl=w("$ZodCheckProperty",(n,e)=>{ye.init(n,e),n._zod.check=r=>{let i=e.schema._zod.run({value:r.value[e.property],issues:[]},{});if(i instanceof Promise)return i.then(t=>Ap(t,r,e.property));Ap(i,r,e.property)}}),al=w("$ZodCheckMimeType",(n,e)=>{ye.init(n,e);let r=new Set(e.mime);n._zod.onattach.push(i=>{i._zod.bag.mime=e.mime}),n._zod.check=i=>{r.has(i.value.type)||i.issues.push({code:"invalid_value",values:e.mime,input:i.value.type,inst:n,continue:!e.abort})}}),cl=w("$ZodCheckOverwrite",(n,e)=>{ye.init(n,e),n._zod.check=r=>{r.value=e.tx(r.value)}});var Ti=class{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}let i=e.split(`
`).filter(s=>s),t=Math.min(...i.map(s=>s.length-s.trimStart().length)),o=i.map(s=>s.slice(t)).map(s=>" ".repeat(this.indent*2)+s);for(let s of o)this.content.push(s)}compile(){let e=Function,r=this?.args,t=[...(this?.content??[""]).map(o=>`  ${o}`)];return new e(...r,t.join(`
`))}};var ll={major:4,minor:0,patch:14};var G=w("$ZodType",(n,e)=>{var r;n??(n={}),n._zod.def=e,n._zod.bag=n._zod.bag||{},n._zod.version=ll;let i=[...n._zod.def.checks??[]];n._zod.traits.has("$ZodCheck")&&i.unshift(n);for(let t of i)for(let o of t._zod.onattach)o(n);if(i.length===0)(r=n._zod).deferred??(r.deferred=[]),n._zod.deferred?.push(()=>{n._zod.run=n._zod.parse});else{let t=(o,s,a)=>{let c=qr(o),l;for(let u of s){if(u._zod.def.when){if(!u._zod.def.when(o))continue}else if(c)continue;let d=o.issues.length,f=u._zod.check(o);if(f instanceof Promise&&a?.async===!1)throw new Vt;if(l||f instanceof Promise)l=(l??Promise.resolve()).then(async()=>{await f,o.issues.length!==d&&(c||(c=qr(o,d)))});else{if(o.issues.length===d)continue;c||(c=qr(o,d))}}return l?l.then(()=>o):o};n._zod.run=(o,s)=>{let a=n._zod.parse(o,s);if(a instanceof Promise){if(s.async===!1)throw new Vt;return a.then(c=>t(c,i,s))}return t(a,i,s)}}n["~standard"]={validate:t=>{try{let o=pc(n,t);return o.success?{value:o.data}:{issues:o.error?.issues}}catch{return gc(n,t).then(s=>s.success?{value:s.data}:{issues:s.error?.issues})}},vendor:"zod",version:1}}),Kr=w("$ZodString",(n,e)=>{G.init(n,e),n._zod.pattern=[...n?._zod.bag?.patterns??[]].pop()??Rc(n._zod.bag),n._zod.parse=(r,i)=>{if(e.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:n}),r}}),fe=w("$ZodStringFormat",(n,e)=>{Dn.init(n,e),Kr.init(n,e)}),dl=w("$ZodGUID",(n,e)=>{e.pattern??(e.pattern=xc),fe.init(n,e)}),fl=w("$ZodUUID",(n,e)=>{if(e.version){let i={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(i===void 0)throw new Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=Jr(i))}else e.pattern??(e.pattern=Jr());fe.init(n,e)}),ml=w("$ZodEmail",(n,e)=>{e.pattern??(e.pattern=kc),fe.init(n,e)}),pl=w("$ZodURL",(n,e)=>{fe.init(n,e),n._zod.check=r=>{try{let i=r.value.trim(),t=new URL(i);e.hostname&&(e.hostname.lastIndex=0,e.hostname.test(t.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:Nc.source,input:r.value,inst:n,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,e.protocol.test(t.protocol.endsWith(":")?t.protocol.slice(0,-1):t.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:r.value,inst:n,continue:!e.abort})),e.normalize?r.value=t.href:r.value=i;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:n,continue:!e.abort})}}}),gl=w("$ZodEmoji",(n,e)=>{e.pattern??(e.pattern=_c()),fe.init(n,e)}),hl=w("$ZodNanoID",(n,e)=>{e.pattern??(e.pattern=Sc),fe.init(n,e)}),vl=w("$ZodCUID",(n,e)=>{e.pattern??(e.pattern=hc),fe.init(n,e)}),yl=w("$ZodCUID2",(n,e)=>{e.pattern??(e.pattern=vc),fe.init(n,e)}),bl=w("$ZodULID",(n,e)=>{e.pattern??(e.pattern=yc),fe.init(n,e)}),wl=w("$ZodXID",(n,e)=>{e.pattern??(e.pattern=bc),fe.init(n,e)}),Sl=w("$ZodKSUID",(n,e)=>{e.pattern??(e.pattern=wc),fe.init(n,e)}),$l=w("$ZodISODateTime",(n,e)=>{e.pattern??(e.pattern=Dc(e)),fe.init(n,e)}),xl=w("$ZodISODate",(n,e)=>{e.pattern??(e.pattern=Ac),fe.init(n,e)}),kl=w("$ZodISOTime",(n,e)=>{e.pattern??(e.pattern=zc(e)),fe.init(n,e)}),_l=w("$ZodISODuration",(n,e)=>{e.pattern??(e.pattern=$c),fe.init(n,e)}),Pl=w("$ZodIPv4",(n,e)=>{e.pattern??(e.pattern=Pc),fe.init(n,e),n._zod.onattach.push(r=>{let i=r._zod.bag;i.format="ipv4"})}),Tl=w("$ZodIPv6",(n,e)=>{e.pattern??(e.pattern=Tc),fe.init(n,e),n._zod.onattach.push(r=>{let i=r._zod.bag;i.format="ipv6"}),n._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:n,continue:!e.abort})}}}),Il=w("$ZodCIDRv4",(n,e)=>{e.pattern??(e.pattern=Ic),fe.init(n,e)}),El=w("$ZodCIDRv6",(n,e)=>{e.pattern??(e.pattern=Ec),fe.init(n,e),n._zod.check=r=>{let[i,t]=r.value.split("/");try{if(!t)throw new Error;let o=Number(t);if(`${o}`!==t)throw new Error;if(o<0||o>128)throw new Error;new URL(`http://[${i}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:n,continue:!e.abort})}}});function Cl(n){if(n==="")return!0;if(n.length%4!==0)return!1;try{return atob(n),!0}catch{return!1}}var Nl=w("$ZodBase64",(n,e)=>{e.pattern??(e.pattern=Cc),fe.init(n,e),n._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64"}),n._zod.check=r=>{Cl(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:n,continue:!e.abort})}});function Hp(n){if(!Oo.test(n))return!1;let e=n.replace(/[-_]/g,i=>i==="-"?"+":"/"),r=e.padEnd(Math.ceil(e.length/4)*4,"=");return Cl(r)}var jl=w("$ZodBase64URL",(n,e)=>{e.pattern??(e.pattern=Oo),fe.init(n,e),n._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64url"}),n._zod.check=r=>{Hp(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:n,continue:!e.abort})}}),Al=w("$ZodE164",(n,e)=>{e.pattern??(e.pattern=jc),fe.init(n,e)});function qp(n,e=null){try{let r=n.split(".");if(r.length!==3)return!1;let[i]=r;if(!i)return!1;let t=JSON.parse(atob(i));return!("typ"in t&&t?.typ!=="JWT"||!t.alg||e&&(!("alg"in t)||t.alg!==e))}catch{return!1}}var zl=w("$ZodJWT",(n,e)=>{fe.init(n,e),n._zod.check=r=>{qp(r.value,e.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:n,continue:!e.abort})}}),Dl=w("$ZodCustomStringFormat",(n,e)=>{fe.init(n,e),n._zod.check=r=>{e.fn(r.value)||r.issues.push({code:"invalid_format",format:e.format,input:r.value,inst:n,continue:!e.abort})}}),Bo=w("$ZodNumber",(n,e)=>{G.init(n,e),n._zod.pattern=n._zod.bag.pattern??Uc,n._zod.parse=(r,i)=>{if(e.coerce)try{r.value=Number(r.value)}catch{}let t=r.value;if(typeof t=="number"&&!Number.isNaN(t)&&Number.isFinite(t))return r;let o=typeof t=="number"?Number.isNaN(t)?"NaN":Number.isFinite(t)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:t,inst:n,...o?{received:o}:{}}),r}}),Rl=w("$ZodNumber",(n,e)=>{Gc.init(n,e),Bo.init(n,e)}),Ii=w("$ZodBoolean",(n,e)=>{G.init(n,e),n._zod.pattern=Fc,n._zod.parse=(r,i)=>{if(e.coerce)try{r.value=!!r.value}catch{}let t=r.value;return typeof t=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:t,inst:n}),r}}),Wo=w("$ZodBigInt",(n,e)=>{G.init(n,e),n._zod.pattern=Oc,n._zod.parse=(r,i)=>{if(e.coerce)try{r.value=BigInt(r.value)}catch{}return typeof r.value=="bigint"||r.issues.push({expected:"bigint",code:"invalid_type",input:r.value,inst:n}),r}}),Ol=w("$ZodBigInt",(n,e)=>{Hc.init(n,e),Wo.init(n,e)}),Ml=w("$ZodSymbol",(n,e)=>{G.init(n,e),n._zod.parse=(r,i)=>{let t=r.value;return typeof t=="symbol"||r.issues.push({expected:"symbol",code:"invalid_type",input:t,inst:n}),r}}),Ul=w("$ZodUndefined",(n,e)=>{G.init(n,e),n._zod.pattern=Bc,n._zod.values=new Set([void 0]),n._zod.optin="optional",n._zod.optout="optional",n._zod.parse=(r,i)=>{let t=r.value;return typeof t>"u"||r.issues.push({expected:"undefined",code:"invalid_type",input:t,inst:n}),r}}),Fl=w("$ZodNull",(n,e)=>{G.init(n,e),n._zod.pattern=Lc,n._zod.values=new Set([null]),n._zod.parse=(r,i)=>{let t=r.value;return t===null||r.issues.push({expected:"null",code:"invalid_type",input:t,inst:n}),r}}),Ll=w("$ZodAny",(n,e)=>{G.init(n,e),n._zod.parse=r=>r}),Rn=w("$ZodUnknown",(n,e)=>{G.init(n,e),n._zod.parse=r=>r}),Bl=w("$ZodNever",(n,e)=>{G.init(n,e),n._zod.parse=(r,i)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:n}),r)}),Wl=w("$ZodVoid",(n,e)=>{G.init(n,e),n._zod.parse=(r,i)=>{let t=r.value;return typeof t>"u"||r.issues.push({expected:"void",code:"invalid_type",input:t,inst:n}),r}}),Zl=w("$ZodDate",(n,e)=>{G.init(n,e),n._zod.parse=(r,i)=>{if(e.coerce)try{r.value=new Date(r.value)}catch{}let t=r.value,o=t instanceof Date;return o&&!Number.isNaN(t.getTime())||r.issues.push({expected:"date",code:"invalid_type",input:t,...o?{received:"Invalid Date"}:{},inst:n}),r}});function Rp(n,e,r){n.issues.length&&e.issues.push(...mt(r,n.issues)),e.value[r]=n.value}var Ei=w("$ZodArray",(n,e)=>{G.init(n,e),n._zod.parse=(r,i)=>{let t=r.value;if(!Array.isArray(t))return r.issues.push({expected:"array",code:"invalid_type",input:t,inst:n}),r;r.value=Array(t.length);let o=[];for(let s=0;s<t.length;s++){let a=t[s],c=e.element._zod.run({value:a,issues:[]},i);c instanceof Promise?o.push(c.then(l=>Rp(l,r,s))):Rp(c,r,s)}return o.length?Promise.all(o).then(()=>r):r}});function Fo(n,e,r,i){n.issues.length&&e.issues.push(...mt(r,n.issues)),n.value===void 0?r in i&&(e.value[r]=void 0):e.value[r]=n.value}var Vl=w("$ZodObject",(n,e)=>{G.init(n,e);let r=bi(()=>{let d=Object.keys(e.shape);for(let p of d)if(!(e.shape[p]instanceof G))throw new Error(`Invalid element at key "${p}": expected a Zod schema`);let f=lc(e.shape);return{shape:e.shape,keys:d,keySet:new Set(d),numKeys:d.length,optionalKeys:new Set(f)}});ie(n._zod,"propValues",()=>{let d=e.shape,f={};for(let p in d){let m=d[p]._zod;if(m.values){f[p]??(f[p]=new Set);for(let g of m.values)f[p].add(g)}}return f});let i=d=>{let f=new Ti(["shape","payload","ctx"]),p=r.value,m=y=>{let k=Eo(y);return`shape[${k}]._zod.run({ value: input[${k}], issues: [] }, ctx)`};f.write("const input = payload.value;");let g=Object.create(null),h=0;for(let y of p.keys)g[y]=`key_${h++}`;f.write("const newResult = {}");for(let y of p.keys){let k=g[y],b=Eo(y);f.write(`const ${k} = ${m(y)};`),f.write(`
        if (${k}.issues.length) {
          payload.issues = payload.issues.concat(${k}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${b}, ...iss.path] : [${b}]
          })));
        }
        
        if (${k}.value === undefined) {
          if (${b} in input) {
            newResult[${b}] = undefined;
          }
        } else {
          newResult[${b}] = ${k}.value;
        }
      `)}f.write("payload.value = newResult;"),f.write("return payload;");let S=f.compile();return(y,k)=>S(d,y,k)},t,o=Cn,s=!hi.jitless,c=s&&ac.value,l=e.catchall,u;n._zod.parse=(d,f)=>{u??(u=r.value);let p=d.value;if(!o(p))return d.issues.push({expected:"object",code:"invalid_type",input:p,inst:n}),d;let m=[];if(s&&c&&f?.async===!1&&f.jitless!==!0)t||(t=i(e.shape)),d=t(d,f);else{d.value={};let k=u.shape;for(let b of u.keys){let z=k[b]._zod.run({value:p[b],issues:[]},f);z instanceof Promise?m.push(z.then(L=>Fo(L,d,b,p))):Fo(z,d,b,p)}}if(!l)return m.length?Promise.all(m).then(()=>d):d;let g=[],h=u.keySet,S=l._zod,y=S.def.type;for(let k of Object.keys(p)){if(h.has(k))continue;if(y==="never"){g.push(k);continue}let b=S.run({value:p[k],issues:[]},f);b instanceof Promise?m.push(b.then(R=>Fo(R,d,k,p))):Fo(b,d,k,p)}return g.length&&d.issues.push({code:"unrecognized_keys",keys:g,input:p,inst:n}),m.length?Promise.all(m).then(()=>d):d}});function Op(n,e,r,i){for(let o of n)if(o.issues.length===0)return e.value=o.value,e;let t=n.filter(o=>!qr(o));return t.length===1?(e.value=t[0].value,t[0]):(e.issues.push({code:"invalid_union",input:e.value,inst:r,errors:n.map(o=>o.issues.map(s=>pt(s,i,Ce())))}),e)}var Zo=w("$ZodUnion",(n,e)=>{G.init(n,e),ie(n._zod,"optin",()=>e.options.some(t=>t._zod.optin==="optional")?"optional":void 0),ie(n._zod,"optout",()=>e.options.some(t=>t._zod.optout==="optional")?"optional":void 0),ie(n._zod,"values",()=>{if(e.options.every(t=>t._zod.values))return new Set(e.options.flatMap(t=>Array.from(t._zod.values)))}),ie(n._zod,"pattern",()=>{if(e.options.every(t=>t._zod.pattern)){let t=e.options.map(o=>o._zod.pattern);return new RegExp(`^(${t.map(o=>wi(o.source)).join("|")})$`)}});let r=e.options.length===1,i=e.options[0]._zod.run;n._zod.parse=(t,o)=>{if(r)return i(t,o);let s=!1,a=[];for(let c of e.options){let l=c._zod.run({value:t.value,issues:[]},o);if(l instanceof Promise)a.push(l),s=!0;else{if(l.issues.length===0)return l;a.push(l)}}return s?Promise.all(a).then(c=>Op(c,t,n,o)):Op(a,t,n,o)}}),Gl=w("$ZodDiscriminatedUnion",(n,e)=>{Zo.init(n,e);let r=n._zod.parse;ie(n._zod,"propValues",()=>{let t={};for(let o of e.options){let s=o._zod.propValues;if(!s||Object.keys(s).length===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(o)}"`);for(let[a,c]of Object.entries(s)){t[a]||(t[a]=new Set);for(let l of c)t[a].add(l)}}return t});let i=bi(()=>{let t=e.options,o=new Map;for(let s of t){let a=s._zod.propValues?.[e.discriminator];if(!a||a.size===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(s)}"`);for(let c of a){if(o.has(c))throw new Error(`Duplicate discriminator value "${String(c)}"`);o.set(c,s)}}return o});n._zod.parse=(t,o)=>{let s=t.value;if(!Cn(s))return t.issues.push({code:"invalid_type",expected:"object",input:s,inst:n}),t;let a=i.value.get(s?.[e.discriminator]);return a?a._zod.run(t,o):e.unionFallback?r(t,o):(t.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",discriminator:e.discriminator,input:s,path:[e.discriminator],inst:n}),t)}}),Hl=w("$ZodIntersection",(n,e)=>{G.init(n,e),n._zod.parse=(r,i)=>{let t=r.value,o=e.left._zod.run({value:t,issues:[]},i),s=e.right._zod.run({value:t,issues:[]},i);return o instanceof Promise||s instanceof Promise?Promise.all([o,s]).then(([c,l])=>Mp(r,c,l)):Mp(r,o,s)}});function ul(n,e){if(n===e)return{valid:!0,data:n};if(n instanceof Date&&e instanceof Date&&+n==+e)return{valid:!0,data:n};if(jn(n)&&jn(e)){let r=Object.keys(e),i=Object.keys(n).filter(o=>r.indexOf(o)!==-1),t={...n,...e};for(let o of i){let s=ul(n[o],e[o]);if(!s.valid)return{valid:!1,mergeErrorPath:[o,...s.mergeErrorPath]};t[o]=s.data}return{valid:!0,data:t}}if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return{valid:!1,mergeErrorPath:[]};let r=[];for(let i=0;i<n.length;i++){let t=n[i],o=e[i],s=ul(t,o);if(!s.valid)return{valid:!1,mergeErrorPath:[i,...s.mergeErrorPath]};r.push(s.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function Mp(n,e,r){if(e.issues.length&&n.issues.push(...e.issues),r.issues.length&&n.issues.push(...r.issues),qr(n))return n;let i=ul(e.value,r.value);if(!i.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(i.mergeErrorPath)}`);return n.value=i.data,n}var Qr=w("$ZodTuple",(n,e)=>{G.init(n,e);let r=e.items,i=r.length-[...r].reverse().findIndex(t=>t._zod.optin!=="optional");n._zod.parse=(t,o)=>{let s=t.value;if(!Array.isArray(s))return t.issues.push({input:s,inst:n,expected:"tuple",code:"invalid_type"}),t;t.value=[];let a=[];if(!e.rest){let l=s.length>r.length,u=s.length<i-1;if(l||u)return t.issues.push({...l?{code:"too_big",maximum:r.length}:{code:"too_small",minimum:r.length},input:s,inst:n,origin:"array"}),t}let c=-1;for(let l of r){if(c++,c>=s.length&&c>=i)continue;let u=l._zod.run({value:s[c],issues:[]},o);u instanceof Promise?a.push(u.then(d=>Lo(d,t,c))):Lo(u,t,c)}if(e.rest){let l=s.slice(r.length);for(let u of l){c++;let d=e.rest._zod.run({value:u,issues:[]},o);d instanceof Promise?a.push(d.then(f=>Lo(f,t,c))):Lo(d,t,c)}}return a.length?Promise.all(a).then(()=>t):t}});function Lo(n,e,r){n.issues.length&&e.issues.push(...mt(r,n.issues)),e.value[r]=n.value}var ql=w("$ZodRecord",(n,e)=>{G.init(n,e),n._zod.parse=(r,i)=>{let t=r.value;if(!jn(t))return r.issues.push({expected:"record",code:"invalid_type",input:t,inst:n}),r;let o=[];if(e.keyType._zod.values){let s=e.keyType._zod.values;r.value={};for(let c of s)if(typeof c=="string"||typeof c=="number"||typeof c=="symbol"){let l=e.valueType._zod.run({value:t[c],issues:[]},i);l instanceof Promise?o.push(l.then(u=>{u.issues.length&&r.issues.push(...mt(c,u.issues)),r.value[c]=u.value})):(l.issues.length&&r.issues.push(...mt(c,l.issues)),r.value[c]=l.value)}let a;for(let c in t)s.has(c)||(a=a??[],a.push(c));a&&a.length>0&&r.issues.push({code:"unrecognized_keys",input:t,inst:n,keys:a})}else{r.value={};for(let s of Reflect.ownKeys(t)){if(s==="__proto__")continue;let a=e.keyType._zod.run({value:s,issues:[]},i);if(a instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(a.issues.length){r.issues.push({code:"invalid_key",origin:"record",issues:a.issues.map(l=>pt(l,i,Ce())),input:s,path:[s],inst:n}),r.value[a.value]=a.value;continue}let c=e.valueType._zod.run({value:t[s],issues:[]},i);c instanceof Promise?o.push(c.then(l=>{l.issues.length&&r.issues.push(...mt(s,l.issues)),r.value[a.value]=l.value})):(c.issues.length&&r.issues.push(...mt(s,c.issues)),r.value[a.value]=c.value)}}return o.length?Promise.all(o).then(()=>r):r}}),Jl=w("$ZodMap",(n,e)=>{G.init(n,e),n._zod.parse=(r,i)=>{let t=r.value;if(!(t instanceof Map))return r.issues.push({expected:"map",code:"invalid_type",input:t,inst:n}),r;let o=[];r.value=new Map;for(let[s,a]of t){let c=e.keyType._zod.run({value:s,issues:[]},i),l=e.valueType._zod.run({value:a,issues:[]},i);c instanceof Promise||l instanceof Promise?o.push(Promise.all([c,l]).then(([u,d])=>{Up(u,d,r,s,t,n,i)})):Up(c,l,r,s,t,n,i)}return o.length?Promise.all(o).then(()=>r):r}});function Up(n,e,r,i,t,o,s){n.issues.length&&(Si.has(typeof i)?r.issues.push(...mt(i,n.issues)):r.issues.push({code:"invalid_key",origin:"map",input:t,inst:o,issues:n.issues.map(a=>pt(a,s,Ce()))})),e.issues.length&&(Si.has(typeof i)?r.issues.push(...mt(i,e.issues)):r.issues.push({origin:"map",code:"invalid_element",input:t,inst:o,key:i,issues:e.issues.map(a=>pt(a,s,Ce()))})),r.value.set(n.value,e.value)}var Kl=w("$ZodSet",(n,e)=>{G.init(n,e),n._zod.parse=(r,i)=>{let t=r.value;if(!(t instanceof Set))return r.issues.push({input:t,inst:n,expected:"set",code:"invalid_type"}),r;let o=[];r.value=new Set;for(let s of t){let a=e.valueType._zod.run({value:s,issues:[]},i);a instanceof Promise?o.push(a.then(c=>Fp(c,r))):Fp(a,r)}return o.length?Promise.all(o).then(()=>r):r}});function Fp(n,e){n.issues.length&&e.issues.push(...n.issues),e.value.add(n.value)}var Ql=w("$ZodEnum",(n,e)=>{G.init(n,e);let r=yi(e.entries),i=new Set(r);n._zod.values=i,n._zod.pattern=new RegExp(`^(${r.filter(t=>Si.has(typeof t)).map(t=>typeof t=="string"?Gt(t):t.toString()).join("|")})$`),n._zod.parse=(t,o)=>{let s=t.value;return i.has(s)||t.issues.push({code:"invalid_value",values:r,input:s,inst:n}),t}}),Yl=w("$ZodLiteral",(n,e)=>{if(G.init(n,e),e.values.length===0)throw new Error("Cannot create literal schema with no valid values");n._zod.values=new Set(e.values),n._zod.pattern=new RegExp(`^(${e.values.map(r=>typeof r=="string"?Gt(r):r?Gt(r.toString()):String(r)).join("|")})$`),n._zod.parse=(r,i)=>{let t=r.value;return n._zod.values.has(t)||r.issues.push({code:"invalid_value",values:e.values,input:t,inst:n}),r}}),Xl=w("$ZodFile",(n,e)=>{G.init(n,e),n._zod.parse=(r,i)=>{let t=r.value;return t instanceof File||r.issues.push({expected:"file",code:"invalid_type",input:t,inst:n}),r}}),Ci=w("$ZodTransform",(n,e)=>{G.init(n,e),n._zod.parse=(r,i)=>{let t=e.transform(r.value,r);if(i.async)return(t instanceof Promise?t:Promise.resolve(t)).then(s=>(r.value=s,r));if(t instanceof Promise)throw new Vt;return r.value=t,r}});function Lp(n,e){return n.issues.length&&e===void 0?{issues:[],value:void 0}:n}var eu=w("$ZodOptional",(n,e)=>{G.init(n,e),n._zod.optin="optional",n._zod.optout="optional",ie(n._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),ie(n._zod,"pattern",()=>{let r=e.innerType._zod.pattern;return r?new RegExp(`^(${wi(r.source)})?$`):void 0}),n._zod.parse=(r,i)=>{if(e.innerType._zod.optin==="optional"){let t=e.innerType._zod.run(r,i);return t instanceof Promise?t.then(o=>Lp(o,r.value)):Lp(t,r.value)}return r.value===void 0?r:e.innerType._zod.run(r,i)}}),tu=w("$ZodNullable",(n,e)=>{G.init(n,e),ie(n._zod,"optin",()=>e.innerType._zod.optin),ie(n._zod,"optout",()=>e.innerType._zod.optout),ie(n._zod,"pattern",()=>{let r=e.innerType._zod.pattern;return r?new RegExp(`^(${wi(r.source)}|null)$`):void 0}),ie(n._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),n._zod.parse=(r,i)=>r.value===null?r:e.innerType._zod.run(r,i)}),ru=w("$ZodDefault",(n,e)=>{G.init(n,e),n._zod.optin="optional",ie(n._zod,"values",()=>e.innerType._zod.values),n._zod.parse=(r,i)=>{if(r.value===void 0)return r.value=e.defaultValue,r;let t=e.innerType._zod.run(r,i);return t instanceof Promise?t.then(o=>Bp(o,e)):Bp(t,e)}});function Bp(n,e){return n.value===void 0&&(n.value=e.defaultValue),n}var nu=w("$ZodPrefault",(n,e)=>{G.init(n,e),n._zod.optin="optional",ie(n._zod,"values",()=>e.innerType._zod.values),n._zod.parse=(r,i)=>(r.value===void 0&&(r.value=e.defaultValue),e.innerType._zod.run(r,i))}),iu=w("$ZodNonOptional",(n,e)=>{G.init(n,e),ie(n._zod,"values",()=>{let r=e.innerType._zod.values;return r?new Set([...r].filter(i=>i!==void 0)):void 0}),n._zod.parse=(r,i)=>{let t=e.innerType._zod.run(r,i);return t instanceof Promise?t.then(o=>Wp(o,n)):Wp(t,n)}});function Wp(n,e){return!n.issues.length&&n.value===void 0&&n.issues.push({code:"invalid_type",expected:"nonoptional",input:n.value,inst:e}),n}var ou=w("$ZodSuccess",(n,e)=>{G.init(n,e),n._zod.parse=(r,i)=>{let t=e.innerType._zod.run(r,i);return t instanceof Promise?t.then(o=>(r.value=o.issues.length===0,r)):(r.value=t.issues.length===0,r)}}),su=w("$ZodCatch",(n,e)=>{G.init(n,e),ie(n._zod,"optin",()=>e.innerType._zod.optin),ie(n._zod,"optout",()=>e.innerType._zod.optout),ie(n._zod,"values",()=>e.innerType._zod.values),n._zod.parse=(r,i)=>{let t=e.innerType._zod.run(r,i);return t instanceof Promise?t.then(o=>(r.value=o.value,o.issues.length&&(r.value=e.catchValue({...r,error:{issues:o.issues.map(s=>pt(s,i,Ce()))},input:r.value}),r.issues=[]),r)):(r.value=t.value,t.issues.length&&(r.value=e.catchValue({...r,error:{issues:t.issues.map(o=>pt(o,i,Ce()))},input:r.value}),r.issues=[]),r)}}),au=w("$ZodNaN",(n,e)=>{G.init(n,e),n._zod.parse=(r,i)=>((typeof r.value!="number"||!Number.isNaN(r.value))&&r.issues.push({input:r.value,inst:n,expected:"nan",code:"invalid_type"}),r)}),Ni=w("$ZodPipe",(n,e)=>{G.init(n,e),ie(n._zod,"values",()=>e.in._zod.values),ie(n._zod,"optin",()=>e.in._zod.optin),ie(n._zod,"optout",()=>e.out._zod.optout),ie(n._zod,"propValues",()=>e.in._zod.propValues),n._zod.parse=(r,i)=>{let t=e.in._zod.run(r,i);return t instanceof Promise?t.then(o=>Zp(o,e,i)):Zp(t,e,i)}});function Zp(n,e,r){return n.issues.length?n:e.out._zod.run({value:n.value,issues:n.issues},r)}var cu=w("$ZodReadonly",(n,e)=>{G.init(n,e),ie(n._zod,"propValues",()=>e.innerType._zod.propValues),ie(n._zod,"values",()=>e.innerType._zod.values),ie(n._zod,"optin",()=>e.innerType._zod.optin),ie(n._zod,"optout",()=>e.innerType._zod.optout),n._zod.parse=(r,i)=>{let t=e.innerType._zod.run(r,i);return t instanceof Promise?t.then(Vp):Vp(t)}});function Vp(n){return n.value=Object.freeze(n.value),n}var lu=w("$ZodTemplateLiteral",(n,e)=>{G.init(n,e);let r=[];for(let i of e.parts)if(i instanceof G){if(!i._zod.pattern)throw new Error(`Invalid template literal part, no pattern found: ${[...i._zod.traits].shift()}`);let t=i._zod.pattern instanceof RegExp?i._zod.pattern.source:i._zod.pattern;if(!t)throw new Error(`Invalid template literal part: ${i._zod.traits}`);let o=t.startsWith("^")?1:0,s=t.endsWith("$")?t.length-1:t.length;r.push(t.slice(o,s))}else if(i===null||cc.has(typeof i))r.push(Gt(`${i}`));else throw new Error(`Invalid template literal part: ${i}`);n._zod.pattern=new RegExp(`^${r.join("")}$`),n._zod.parse=(i,t)=>typeof i.value!="string"?(i.issues.push({input:i.value,inst:n,expected:"template_literal",code:"invalid_type"}),i):(n._zod.pattern.lastIndex=0,n._zod.pattern.test(i.value)||i.issues.push({input:i.value,inst:n,code:"invalid_format",format:e.format??"template_literal",pattern:n._zod.pattern.source}),i)}),uu=w("$ZodPromise",(n,e)=>{G.init(n,e),n._zod.parse=(r,i)=>Promise.resolve(r.value).then(t=>e.innerType._zod.run({value:t,issues:[]},i))}),du=w("$ZodLazy",(n,e)=>{G.init(n,e),ie(n._zod,"innerType",()=>e.getter()),ie(n._zod,"pattern",()=>n._zod.innerType._zod.pattern),ie(n._zod,"propValues",()=>n._zod.innerType._zod.propValues),ie(n._zod,"optin",()=>n._zod.innerType._zod.optin??void 0),ie(n._zod,"optout",()=>n._zod.innerType._zod.optout??void 0),n._zod.parse=(r,i)=>n._zod.innerType._zod.run(r,i)}),fu=w("$ZodCustom",(n,e)=>{ye.init(n,e),G.init(n,e),n._zod.parse=(r,i)=>r,n._zod.check=r=>{let i=r.value,t=e.fn(i);if(t instanceof Promise)return t.then(o=>Gp(o,r,i,n));Gp(t,r,i,n)}});function Gp(n,e,r,i){if(!n){let t={code:"custom",input:r,inst:i,path:[...i._zod.def.path??[]],continue:!i._zod.def.abort};i._zod.def.params&&(t.params=i._zod.def.params),e.issues.push(An(t))}}var ji={};Et(ji,{ar:()=>Kp,az:()=>Qp,be:()=>Xp,ca:()=>eg,cs:()=>tg,da:()=>rg,de:()=>ng,en:()=>Vo,eo:()=>ig,es:()=>og,fa:()=>sg,fi:()=>ag,fr:()=>cg,frCA:()=>lg,he:()=>ug,hu:()=>dg,id:()=>fg,is:()=>mg,it:()=>pg,ja:()=>gg,kh:()=>hg,ko:()=>vg,mk:()=>yg,ms:()=>bg,nl:()=>wg,no:()=>Sg,ota:()=>$g,pl:()=>kg,ps:()=>xg,pt:()=>_g,ru:()=>Tg,sl:()=>Ig,sv:()=>Eg,ta:()=>Cg,th:()=>Ng,tr:()=>jg,ua:()=>Ag,ur:()=>zg,vi:()=>Dg,yo:()=>Mg,zhCN:()=>Rg,zhTW:()=>Og});var _w=()=>{let n={string:{unit:"\u062D\u0631\u0641",verb:"\u0623\u0646 \u064A\u062D\u0648\u064A"},file:{unit:"\u0628\u0627\u064A\u062A",verb:"\u0623\u0646 \u064A\u062D\u0648\u064A"},array:{unit:"\u0639\u0646\u0635\u0631",verb:"\u0623\u0646 \u064A\u062D\u0648\u064A"},set:{unit:"\u0639\u0646\u0635\u0631",verb:"\u0623\u0646 \u064A\u062D\u0648\u064A"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"number";case"object":{if(Array.isArray(t))return"array";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"\u0645\u062F\u062E\u0644",email:"\u0628\u0631\u064A\u062F \u0625\u0644\u0643\u062A\u0631\u0648\u0646\u064A",url:"\u0631\u0627\u0628\u0637",emoji:"\u0625\u064A\u0645\u0648\u062C\u064A",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"\u062A\u0627\u0631\u064A\u062E \u0648\u0648\u0642\u062A \u0628\u0645\u0639\u064A\u0627\u0631 ISO",date:"\u062A\u0627\u0631\u064A\u062E \u0628\u0645\u0639\u064A\u0627\u0631 ISO",time:"\u0648\u0642\u062A \u0628\u0645\u0639\u064A\u0627\u0631 ISO",duration:"\u0645\u062F\u0629 \u0628\u0645\u0639\u064A\u0627\u0631 ISO",ipv4:"\u0639\u0646\u0648\u0627\u0646 IPv4",ipv6:"\u0639\u0646\u0648\u0627\u0646 IPv6",cidrv4:"\u0645\u062F\u0649 \u0639\u0646\u0627\u0648\u064A\u0646 \u0628\u0635\u064A\u063A\u0629 IPv4",cidrv6:"\u0645\u062F\u0649 \u0639\u0646\u0627\u0648\u064A\u0646 \u0628\u0635\u064A\u063A\u0629 IPv6",base64:"\u0646\u064E\u0635 \u0628\u062A\u0631\u0645\u064A\u0632 base64-encoded",base64url:"\u0646\u064E\u0635 \u0628\u062A\u0631\u0645\u064A\u0632 base64url-encoded",json_string:"\u0646\u064E\u0635 \u0639\u0644\u0649 \u0647\u064A\u0626\u0629 JSON",e164:"\u0631\u0642\u0645 \u0647\u0627\u062A\u0641 \u0628\u0645\u0639\u064A\u0627\u0631 E.164",jwt:"JWT",template_literal:"\u0645\u062F\u062E\u0644"};return t=>{switch(t.code){case"invalid_type":return`\u0645\u062F\u062E\u0644\u0627\u062A \u063A\u064A\u0631 \u0645\u0642\u0628\u0648\u0644\u0629: \u064A\u0641\u062A\u0631\u0636 \u0625\u062F\u062E\u0627\u0644 ${t.expected}\u060C \u0648\u0644\u0643\u0646 \u062A\u0645 \u0625\u062F\u062E\u0627\u0644 ${r(t.input)}`;case"invalid_value":return t.values.length===1?`\u0645\u062F\u062E\u0644\u0627\u062A \u063A\u064A\u0631 \u0645\u0642\u0628\u0648\u0644\u0629: \u064A\u0641\u062A\u0631\u0636 \u0625\u062F\u062E\u0627\u0644 ${A(t.values[0])}`:`\u0627\u062E\u062A\u064A\u0627\u0631 \u063A\u064A\u0631 \u0645\u0642\u0628\u0648\u0644: \u064A\u062A\u0648\u0642\u0639 \u0627\u0646\u062A\u0642\u0627\u0621 \u0623\u062D\u062F \u0647\u0630\u0647 \u0627\u0644\u062E\u064A\u0627\u0631\u0627\u062A: ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?` \u0623\u0643\u0628\u0631 \u0645\u0646 \u0627\u0644\u0644\u0627\u0632\u0645: \u064A\u0641\u062A\u0631\u0636 \u0623\u0646 \u062A\u0643\u0648\u0646 ${t.origin??"\u0627\u0644\u0642\u064A\u0645\u0629"} ${o} ${t.maximum.toString()} ${s.unit??"\u0639\u0646\u0635\u0631"}`:`\u0623\u0643\u0628\u0631 \u0645\u0646 \u0627\u0644\u0644\u0627\u0632\u0645: \u064A\u0641\u062A\u0631\u0636 \u0623\u0646 \u062A\u0643\u0648\u0646 ${t.origin??"\u0627\u0644\u0642\u064A\u0645\u0629"} ${o} ${t.maximum.toString()}`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`\u0623\u0635\u063A\u0631 \u0645\u0646 \u0627\u0644\u0644\u0627\u0632\u0645: \u064A\u0641\u062A\u0631\u0636 \u0644\u0640 ${t.origin} \u0623\u0646 \u064A\u0643\u0648\u0646 ${o} ${t.minimum.toString()} ${s.unit}`:`\u0623\u0635\u063A\u0631 \u0645\u0646 \u0627\u0644\u0644\u0627\u0632\u0645: \u064A\u0641\u062A\u0631\u0636 \u0644\u0640 ${t.origin} \u0623\u0646 \u064A\u0643\u0648\u0646 ${o} ${t.minimum.toString()}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`\u0646\u064E\u0635 \u063A\u064A\u0631 \u0645\u0642\u0628\u0648\u0644: \u064A\u062C\u0628 \u0623\u0646 \u064A\u0628\u062F\u0623 \u0628\u0640 "${t.prefix}"`:o.format==="ends_with"?`\u0646\u064E\u0635 \u063A\u064A\u0631 \u0645\u0642\u0628\u0648\u0644: \u064A\u062C\u0628 \u0623\u0646 \u064A\u0646\u062A\u0647\u064A \u0628\u0640 "${o.suffix}"`:o.format==="includes"?`\u0646\u064E\u0635 \u063A\u064A\u0631 \u0645\u0642\u0628\u0648\u0644: \u064A\u062C\u0628 \u0623\u0646 \u064A\u062A\u0636\u0645\u0651\u064E\u0646 "${o.includes}"`:o.format==="regex"?`\u0646\u064E\u0635 \u063A\u064A\u0631 \u0645\u0642\u0628\u0648\u0644: \u064A\u062C\u0628 \u0623\u0646 \u064A\u0637\u0627\u0628\u0642 \u0627\u0644\u0646\u0645\u0637 ${o.pattern}`:`${i[o.format]??t.format} \u063A\u064A\u0631 \u0645\u0642\u0628\u0648\u0644`}case"not_multiple_of":return`\u0631\u0642\u0645 \u063A\u064A\u0631 \u0645\u0642\u0628\u0648\u0644: \u064A\u062C\u0628 \u0623\u0646 \u064A\u0643\u0648\u0646 \u0645\u0646 \u0645\u0636\u0627\u0639\u0641\u0627\u062A ${t.divisor}`;case"unrecognized_keys":return`\u0645\u0639\u0631\u0641${t.keys.length>1?"\u0627\u062A":""} \u063A\u0631\u064A\u0628${t.keys.length>1?"\u0629":""}: ${_(t.keys,"\u060C ")}`;case"invalid_key":return`\u0645\u0639\u0631\u0641 \u063A\u064A\u0631 \u0645\u0642\u0628\u0648\u0644 \u0641\u064A ${t.origin}`;case"invalid_union":return"\u0645\u062F\u062E\u0644 \u063A\u064A\u0631 \u0645\u0642\u0628\u0648\u0644";case"invalid_element":return`\u0645\u062F\u062E\u0644 \u063A\u064A\u0631 \u0645\u0642\u0628\u0648\u0644 \u0641\u064A ${t.origin}`;default:return"\u0645\u062F\u062E\u0644 \u063A\u064A\u0631 \u0645\u0642\u0628\u0648\u0644"}}};function Kp(){return{localeError:_w()}}var Pw=()=>{let n={string:{unit:"simvol",verb:"olmal\u0131d\u0131r"},file:{unit:"bayt",verb:"olmal\u0131d\u0131r"},array:{unit:"element",verb:"olmal\u0131d\u0131r"},set:{unit:"element",verb:"olmal\u0131d\u0131r"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"number";case"object":{if(Array.isArray(t))return"array";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"};return t=>{switch(t.code){case"invalid_type":return`Yanl\u0131\u015F d\u0259y\u0259r: g\xF6zl\u0259nil\u0259n ${t.expected}, daxil olan ${r(t.input)}`;case"invalid_value":return t.values.length===1?`Yanl\u0131\u015F d\u0259y\u0259r: g\xF6zl\u0259nil\u0259n ${A(t.values[0])}`:`Yanl\u0131\u015F se\xE7im: a\u015Fa\u011F\u0131dak\u0131lardan biri olmal\u0131d\u0131r: ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`\xC7ox b\xF6y\xFCk: g\xF6zl\u0259nil\u0259n ${t.origin??"d\u0259y\u0259r"} ${o}${t.maximum.toString()} ${s.unit??"element"}`:`\xC7ox b\xF6y\xFCk: g\xF6zl\u0259nil\u0259n ${t.origin??"d\u0259y\u0259r"} ${o}${t.maximum.toString()}`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`\xC7ox ki\xE7ik: g\xF6zl\u0259nil\u0259n ${t.origin} ${o}${t.minimum.toString()} ${s.unit}`:`\xC7ox ki\xE7ik: g\xF6zl\u0259nil\u0259n ${t.origin} ${o}${t.minimum.toString()}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`Yanl\u0131\u015F m\u0259tn: "${o.prefix}" il\u0259 ba\u015Flamal\u0131d\u0131r`:o.format==="ends_with"?`Yanl\u0131\u015F m\u0259tn: "${o.suffix}" il\u0259 bitm\u0259lidir`:o.format==="includes"?`Yanl\u0131\u015F m\u0259tn: "${o.includes}" daxil olmal\u0131d\u0131r`:o.format==="regex"?`Yanl\u0131\u015F m\u0259tn: ${o.pattern} \u015Fablonuna uy\u011Fun olmal\u0131d\u0131r`:`Yanl\u0131\u015F ${i[o.format]??t.format}`}case"not_multiple_of":return`Yanl\u0131\u015F \u0259d\u0259d: ${t.divisor} il\u0259 b\xF6l\xFCn\u0259 bil\u0259n olmal\u0131d\u0131r`;case"unrecognized_keys":return`Tan\u0131nmayan a\xE7ar${t.keys.length>1?"lar":""}: ${_(t.keys,", ")}`;case"invalid_key":return`${t.origin} daxilind\u0259 yanl\u0131\u015F a\xE7ar`;case"invalid_union":return"Yanl\u0131\u015F d\u0259y\u0259r";case"invalid_element":return`${t.origin} daxilind\u0259 yanl\u0131\u015F d\u0259y\u0259r`;default:return"Yanl\u0131\u015F d\u0259y\u0259r"}}};function Qp(){return{localeError:Pw()}}function Yp(n,e,r,i){let t=Math.abs(n),o=t%10,s=t%100;return s>=11&&s<=19?i:o===1?e:o>=2&&o<=4?r:i}var Tw=()=>{let n={string:{unit:{one:"\u0441\u0456\u043C\u0432\u0430\u043B",few:"\u0441\u0456\u043C\u0432\u0430\u043B\u044B",many:"\u0441\u0456\u043C\u0432\u0430\u043B\u0430\u045E"},verb:"\u043C\u0435\u0446\u044C"},array:{unit:{one:"\u044D\u043B\u0435\u043C\u0435\u043D\u0442",few:"\u044D\u043B\u0435\u043C\u0435\u043D\u0442\u044B",many:"\u044D\u043B\u0435\u043C\u0435\u043D\u0442\u0430\u045E"},verb:"\u043C\u0435\u0446\u044C"},set:{unit:{one:"\u044D\u043B\u0435\u043C\u0435\u043D\u0442",few:"\u044D\u043B\u0435\u043C\u0435\u043D\u0442\u044B",many:"\u044D\u043B\u0435\u043C\u0435\u043D\u0442\u0430\u045E"},verb:"\u043C\u0435\u0446\u044C"},file:{unit:{one:"\u0431\u0430\u0439\u0442",few:"\u0431\u0430\u0439\u0442\u044B",many:"\u0431\u0430\u0439\u0442\u0430\u045E"},verb:"\u043C\u0435\u0446\u044C"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"\u043B\u0456\u043A";case"object":{if(Array.isArray(t))return"\u043C\u0430\u0441\u0456\u045E";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"\u0443\u0432\u043E\u0434",email:"email \u0430\u0434\u0440\u0430\u0441",url:"URL",emoji:"\u044D\u043C\u043E\u0434\u0437\u0456",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO \u0434\u0430\u0442\u0430 \u0456 \u0447\u0430\u0441",date:"ISO \u0434\u0430\u0442\u0430",time:"ISO \u0447\u0430\u0441",duration:"ISO \u043F\u0440\u0430\u0446\u044F\u0433\u043B\u0430\u0441\u0446\u044C",ipv4:"IPv4 \u0430\u0434\u0440\u0430\u0441",ipv6:"IPv6 \u0430\u0434\u0440\u0430\u0441",cidrv4:"IPv4 \u0434\u044B\u044F\u043F\u0430\u0437\u043E\u043D",cidrv6:"IPv6 \u0434\u044B\u044F\u043F\u0430\u0437\u043E\u043D",base64:"\u0440\u0430\u0434\u043E\u043A \u0443 \u0444\u0430\u0440\u043C\u0430\u0446\u0435 base64",base64url:"\u0440\u0430\u0434\u043E\u043A \u0443 \u0444\u0430\u0440\u043C\u0430\u0446\u0435 base64url",json_string:"JSON \u0440\u0430\u0434\u043E\u043A",e164:"\u043D\u0443\u043C\u0430\u0440 E.164",jwt:"JWT",template_literal:"\u0443\u0432\u043E\u0434"};return t=>{switch(t.code){case"invalid_type":return`\u041D\u044F\u043F\u0440\u0430\u0432\u0456\u043B\u044C\u043D\u044B \u045E\u0432\u043E\u0434: \u0447\u0430\u043A\u0430\u045E\u0441\u044F ${t.expected}, \u0430\u0442\u0440\u044B\u043C\u0430\u043D\u0430 ${r(t.input)}`;case"invalid_value":return t.values.length===1?`\u041D\u044F\u043F\u0440\u0430\u0432\u0456\u043B\u044C\u043D\u044B \u045E\u0432\u043E\u0434: \u0447\u0430\u043A\u0430\u043B\u0430\u0441\u044F ${A(t.values[0])}`:`\u041D\u044F\u043F\u0440\u0430\u0432\u0456\u043B\u044C\u043D\u044B \u0432\u0430\u0440\u044B\u044F\u043D\u0442: \u0447\u0430\u043A\u0430\u045E\u0441\u044F \u0430\u0434\u0437\u0456\u043D \u0437 ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);if(s){let a=Number(t.maximum),c=Yp(a,s.unit.one,s.unit.few,s.unit.many);return`\u0417\u0430\u043D\u0430\u0434\u0442\u0430 \u0432\u044F\u043B\u0456\u043A\u0456: \u0447\u0430\u043A\u0430\u043B\u0430\u0441\u044F, \u0448\u0442\u043E ${t.origin??"\u0437\u043D\u0430\u0447\u044D\u043D\u043D\u0435"} \u043F\u0430\u0432\u0456\u043D\u043D\u0430 ${s.verb} ${o}${t.maximum.toString()} ${c}`}return`\u0417\u0430\u043D\u0430\u0434\u0442\u0430 \u0432\u044F\u043B\u0456\u043A\u0456: \u0447\u0430\u043A\u0430\u043B\u0430\u0441\u044F, \u0448\u0442\u043E ${t.origin??"\u0437\u043D\u0430\u0447\u044D\u043D\u043D\u0435"} \u043F\u0430\u0432\u0456\u043D\u043D\u0430 \u0431\u044B\u0446\u044C ${o}${t.maximum.toString()}`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);if(s){let a=Number(t.minimum),c=Yp(a,s.unit.one,s.unit.few,s.unit.many);return`\u0417\u0430\u043D\u0430\u0434\u0442\u0430 \u043C\u0430\u043B\u044B: \u0447\u0430\u043A\u0430\u043B\u0430\u0441\u044F, \u0448\u0442\u043E ${t.origin} \u043F\u0430\u0432\u0456\u043D\u043D\u0430 ${s.verb} ${o}${t.minimum.toString()} ${c}`}return`\u0417\u0430\u043D\u0430\u0434\u0442\u0430 \u043C\u0430\u043B\u044B: \u0447\u0430\u043A\u0430\u043B\u0430\u0441\u044F, \u0448\u0442\u043E ${t.origin} \u043F\u0430\u0432\u0456\u043D\u043D\u0430 \u0431\u044B\u0446\u044C ${o}${t.minimum.toString()}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`\u041D\u044F\u043F\u0440\u0430\u0432\u0456\u043B\u044C\u043D\u044B \u0440\u0430\u0434\u043E\u043A: \u043F\u0430\u0432\u0456\u043D\u0435\u043D \u043F\u0430\u0447\u044B\u043D\u0430\u0446\u0446\u0430 \u0437 "${o.prefix}"`:o.format==="ends_with"?`\u041D\u044F\u043F\u0440\u0430\u0432\u0456\u043B\u044C\u043D\u044B \u0440\u0430\u0434\u043E\u043A: \u043F\u0430\u0432\u0456\u043D\u0435\u043D \u0437\u0430\u043A\u0430\u043D\u0447\u0432\u0430\u0446\u0446\u0430 \u043D\u0430 "${o.suffix}"`:o.format==="includes"?`\u041D\u044F\u043F\u0440\u0430\u0432\u0456\u043B\u044C\u043D\u044B \u0440\u0430\u0434\u043E\u043A: \u043F\u0430\u0432\u0456\u043D\u0435\u043D \u0437\u043C\u044F\u0448\u0447\u0430\u0446\u044C "${o.includes}"`:o.format==="regex"?`\u041D\u044F\u043F\u0440\u0430\u0432\u0456\u043B\u044C\u043D\u044B \u0440\u0430\u0434\u043E\u043A: \u043F\u0430\u0432\u0456\u043D\u0435\u043D \u0430\u0434\u043F\u0430\u0432\u044F\u0434\u0430\u0446\u044C \u0448\u0430\u0431\u043B\u043E\u043D\u0443 ${o.pattern}`:`\u041D\u044F\u043F\u0440\u0430\u0432\u0456\u043B\u044C\u043D\u044B ${i[o.format]??t.format}`}case"not_multiple_of":return`\u041D\u044F\u043F\u0440\u0430\u0432\u0456\u043B\u044C\u043D\u044B \u043B\u0456\u043A: \u043F\u0430\u0432\u0456\u043D\u0435\u043D \u0431\u044B\u0446\u044C \u043A\u0440\u0430\u0442\u043D\u044B\u043C ${t.divisor}`;case"unrecognized_keys":return`\u041D\u0435\u0440\u0430\u0441\u043F\u0430\u0437\u043D\u0430\u043D\u044B ${t.keys.length>1?"\u043A\u043B\u044E\u0447\u044B":"\u043A\u043B\u044E\u0447"}: ${_(t.keys,", ")}`;case"invalid_key":return`\u041D\u044F\u043F\u0440\u0430\u0432\u0456\u043B\u044C\u043D\u044B \u043A\u043B\u044E\u0447 \u0443 ${t.origin}`;case"invalid_union":return"\u041D\u044F\u043F\u0440\u0430\u0432\u0456\u043B\u044C\u043D\u044B \u045E\u0432\u043E\u0434";case"invalid_element":return`\u041D\u044F\u043F\u0440\u0430\u0432\u0456\u043B\u044C\u043D\u0430\u0435 \u0437\u043D\u0430\u0447\u044D\u043D\u043D\u0435 \u045E ${t.origin}`;default:return"\u041D\u044F\u043F\u0440\u0430\u0432\u0456\u043B\u044C\u043D\u044B \u045E\u0432\u043E\u0434"}}};function Xp(){return{localeError:Tw()}}var Iw=()=>{let n={string:{unit:"car\xE0cters",verb:"contenir"},file:{unit:"bytes",verb:"contenir"},array:{unit:"elements",verb:"contenir"},set:{unit:"elements",verb:"contenir"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"number";case"object":{if(Array.isArray(t))return"array";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"entrada",email:"adre\xE7a electr\xF2nica",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data i hora ISO",date:"data ISO",time:"hora ISO",duration:"durada ISO",ipv4:"adre\xE7a IPv4",ipv6:"adre\xE7a IPv6",cidrv4:"rang IPv4",cidrv6:"rang IPv6",base64:"cadena codificada en base64",base64url:"cadena codificada en base64url",json_string:"cadena JSON",e164:"n\xFAmero E.164",jwt:"JWT",template_literal:"entrada"};return t=>{switch(t.code){case"invalid_type":return`Tipus inv\xE0lid: s'esperava ${t.expected}, s'ha rebut ${r(t.input)}`;case"invalid_value":return t.values.length===1?`Valor inv\xE0lid: s'esperava ${A(t.values[0])}`:`Opci\xF3 inv\xE0lida: s'esperava una de ${_(t.values," o ")}`;case"too_big":{let o=t.inclusive?"com a m\xE0xim":"menys de",s=e(t.origin);return s?`Massa gran: s'esperava que ${t.origin??"el valor"} contingu\xE9s ${o} ${t.maximum.toString()} ${s.unit??"elements"}`:`Massa gran: s'esperava que ${t.origin??"el valor"} fos ${o} ${t.maximum.toString()}`}case"too_small":{let o=t.inclusive?"com a m\xEDnim":"m\xE9s de",s=e(t.origin);return s?`Massa petit: s'esperava que ${t.origin} contingu\xE9s ${o} ${t.minimum.toString()} ${s.unit}`:`Massa petit: s'esperava que ${t.origin} fos ${o} ${t.minimum.toString()}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`Format inv\xE0lid: ha de comen\xE7ar amb "${o.prefix}"`:o.format==="ends_with"?`Format inv\xE0lid: ha d'acabar amb "${o.suffix}"`:o.format==="includes"?`Format inv\xE0lid: ha d'incloure "${o.includes}"`:o.format==="regex"?`Format inv\xE0lid: ha de coincidir amb el patr\xF3 ${o.pattern}`:`Format inv\xE0lid per a ${i[o.format]??t.format}`}case"not_multiple_of":return`N\xFAmero inv\xE0lid: ha de ser m\xFAltiple de ${t.divisor}`;case"unrecognized_keys":return`Clau${t.keys.length>1?"s":""} no reconeguda${t.keys.length>1?"s":""}: ${_(t.keys,", ")}`;case"invalid_key":return`Clau inv\xE0lida a ${t.origin}`;case"invalid_union":return"Entrada inv\xE0lida";case"invalid_element":return`Element inv\xE0lid a ${t.origin}`;default:return"Entrada inv\xE0lida"}}};function eg(){return{localeError:Iw()}}var Ew=()=>{let n={string:{unit:"znak\u016F",verb:"m\xEDt"},file:{unit:"bajt\u016F",verb:"m\xEDt"},array:{unit:"prvk\u016F",verb:"m\xEDt"},set:{unit:"prvk\u016F",verb:"m\xEDt"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"\u010D\xEDslo";case"string":return"\u0159et\u011Bzec";case"boolean":return"boolean";case"bigint":return"bigint";case"function":return"funkce";case"symbol":return"symbol";case"undefined":return"undefined";case"object":{if(Array.isArray(t))return"pole";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"regul\xE1rn\xED v\xFDraz",email:"e-mailov\xE1 adresa",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"datum a \u010Das ve form\xE1tu ISO",date:"datum ve form\xE1tu ISO",time:"\u010Das ve form\xE1tu ISO",duration:"doba trv\xE1n\xED ISO",ipv4:"IPv4 adresa",ipv6:"IPv6 adresa",cidrv4:"rozsah IPv4",cidrv6:"rozsah IPv6",base64:"\u0159et\u011Bzec zak\xF3dovan\xFD ve form\xE1tu base64",base64url:"\u0159et\u011Bzec zak\xF3dovan\xFD ve form\xE1tu base64url",json_string:"\u0159et\u011Bzec ve form\xE1tu JSON",e164:"\u010D\xEDslo E.164",jwt:"JWT",template_literal:"vstup"};return t=>{switch(t.code){case"invalid_type":return`Neplatn\xFD vstup: o\u010Dek\xE1v\xE1no ${t.expected}, obdr\u017Eeno ${r(t.input)}`;case"invalid_value":return t.values.length===1?`Neplatn\xFD vstup: o\u010Dek\xE1v\xE1no ${A(t.values[0])}`:`Neplatn\xE1 mo\u017Enost: o\u010Dek\xE1v\xE1na jedna z hodnot ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`Hodnota je p\u0159\xEDli\u0161 velk\xE1: ${t.origin??"hodnota"} mus\xED m\xEDt ${o}${t.maximum.toString()} ${s.unit??"prvk\u016F"}`:`Hodnota je p\u0159\xEDli\u0161 velk\xE1: ${t.origin??"hodnota"} mus\xED b\xFDt ${o}${t.maximum.toString()}`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`Hodnota je p\u0159\xEDli\u0161 mal\xE1: ${t.origin??"hodnota"} mus\xED m\xEDt ${o}${t.minimum.toString()} ${s.unit??"prvk\u016F"}`:`Hodnota je p\u0159\xEDli\u0161 mal\xE1: ${t.origin??"hodnota"} mus\xED b\xFDt ${o}${t.minimum.toString()}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`Neplatn\xFD \u0159et\u011Bzec: mus\xED za\u010D\xEDnat na "${o.prefix}"`:o.format==="ends_with"?`Neplatn\xFD \u0159et\u011Bzec: mus\xED kon\u010Dit na "${o.suffix}"`:o.format==="includes"?`Neplatn\xFD \u0159et\u011Bzec: mus\xED obsahovat "${o.includes}"`:o.format==="regex"?`Neplatn\xFD \u0159et\u011Bzec: mus\xED odpov\xEDdat vzoru ${o.pattern}`:`Neplatn\xFD form\xE1t ${i[o.format]??t.format}`}case"not_multiple_of":return`Neplatn\xE9 \u010D\xEDslo: mus\xED b\xFDt n\xE1sobkem ${t.divisor}`;case"unrecognized_keys":return`Nezn\xE1m\xE9 kl\xED\u010De: ${_(t.keys,", ")}`;case"invalid_key":return`Neplatn\xFD kl\xED\u010D v ${t.origin}`;case"invalid_union":return"Neplatn\xFD vstup";case"invalid_element":return`Neplatn\xE1 hodnota v ${t.origin}`;default:return"Neplatn\xFD vstup"}}};function tg(){return{localeError:Ew()}}var Cw=()=>{let n={string:{unit:"tegn",verb:"havde"},file:{unit:"bytes",verb:"havde"},array:{unit:"elementer",verb:"indeholdt"},set:{unit:"elementer",verb:"indeholdt"}},e={string:"streng",number:"tal",boolean:"boolean",array:"liste",object:"objekt",set:"s\xE6t",file:"fil"};function r(s){return n[s]??null}function i(s){return e[s]??s}let t=s=>{let a=typeof s;switch(a){case"number":return Number.isNaN(s)?"NaN":"tal";case"object":return Array.isArray(s)?"liste":s===null?"null":Object.getPrototypeOf(s)!==Object.prototype&&s.constructor?s.constructor.name:"objekt"}return a},o={regex:"input",email:"e-mailadresse",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO dato- og klokkesl\xE6t",date:"ISO-dato",time:"ISO-klokkesl\xE6t",duration:"ISO-varighed",ipv4:"IPv4-omr\xE5de",ipv6:"IPv6-omr\xE5de",cidrv4:"IPv4-spektrum",cidrv6:"IPv6-spektrum",base64:"base64-kodet streng",base64url:"base64url-kodet streng",json_string:"JSON-streng",e164:"E.164-nummer",jwt:"JWT",template_literal:"input"};return s=>{switch(s.code){case"invalid_type":return`Ugyldigt input: forventede ${i(s.expected)}, fik ${i(t(s.input))}`;case"invalid_value":return s.values.length===1?`Ugyldig v\xE6rdi: forventede ${A(s.values[0])}`:`Ugyldigt valg: forventede en af f\xF8lgende ${_(s.values,"|")}`;case"too_big":{let a=s.inclusive?"<=":"<",c=r(s.origin),l=i(s.origin);return c?`For stor: forventede ${l??"value"} ${c.verb} ${a} ${s.maximum.toString()} ${c.unit??"elementer"}`:`For stor: forventede ${l??"value"} havde ${a} ${s.maximum.toString()}`}case"too_small":{let a=s.inclusive?">=":">",c=r(s.origin),l=i(s.origin);return c?`For lille: forventede ${l} ${c.verb} ${a} ${s.minimum.toString()} ${c.unit}`:`For lille: forventede ${l} havde ${a} ${s.minimum.toString()}`}case"invalid_format":{let a=s;return a.format==="starts_with"?`Ugyldig streng: skal starte med "${a.prefix}"`:a.format==="ends_with"?`Ugyldig streng: skal ende med "${a.suffix}"`:a.format==="includes"?`Ugyldig streng: skal indeholde "${a.includes}"`:a.format==="regex"?`Ugyldig streng: skal matche m\xF8nsteret ${a.pattern}`:`Ugyldig ${o[a.format]??s.format}`}case"not_multiple_of":return`Ugyldigt tal: skal v\xE6re deleligt med ${s.divisor}`;case"unrecognized_keys":return`${s.keys.length>1?"Ukendte n\xF8gler":"Ukendt n\xF8gle"}: ${_(s.keys,", ")}`;case"invalid_key":return`Ugyldig n\xF8gle i ${s.origin}`;case"invalid_union":return"Ugyldigt input: matcher ingen af de tilladte typer";case"invalid_element":return`Ugyldig v\xE6rdi i ${s.origin}`;default:return"Ugyldigt input"}}};function rg(){return{localeError:Cw()}}var Nw=()=>{let n={string:{unit:"Zeichen",verb:"zu haben"},file:{unit:"Bytes",verb:"zu haben"},array:{unit:"Elemente",verb:"zu haben"},set:{unit:"Elemente",verb:"zu haben"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"Zahl";case"object":{if(Array.isArray(t))return"Array";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"Eingabe",email:"E-Mail-Adresse",url:"URL",emoji:"Emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-Datum und -Uhrzeit",date:"ISO-Datum",time:"ISO-Uhrzeit",duration:"ISO-Dauer",ipv4:"IPv4-Adresse",ipv6:"IPv6-Adresse",cidrv4:"IPv4-Bereich",cidrv6:"IPv6-Bereich",base64:"Base64-codierter String",base64url:"Base64-URL-codierter String",json_string:"JSON-String",e164:"E.164-Nummer",jwt:"JWT",template_literal:"Eingabe"};return t=>{switch(t.code){case"invalid_type":return`Ung\xFCltige Eingabe: erwartet ${t.expected}, erhalten ${r(t.input)}`;case"invalid_value":return t.values.length===1?`Ung\xFCltige Eingabe: erwartet ${A(t.values[0])}`:`Ung\xFCltige Option: erwartet eine von ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`Zu gro\xDF: erwartet, dass ${t.origin??"Wert"} ${o}${t.maximum.toString()} ${s.unit??"Elemente"} hat`:`Zu gro\xDF: erwartet, dass ${t.origin??"Wert"} ${o}${t.maximum.toString()} ist`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`Zu klein: erwartet, dass ${t.origin} ${o}${t.minimum.toString()} ${s.unit} hat`:`Zu klein: erwartet, dass ${t.origin} ${o}${t.minimum.toString()} ist`}case"invalid_format":{let o=t;return o.format==="starts_with"?`Ung\xFCltiger String: muss mit "${o.prefix}" beginnen`:o.format==="ends_with"?`Ung\xFCltiger String: muss mit "${o.suffix}" enden`:o.format==="includes"?`Ung\xFCltiger String: muss "${o.includes}" enthalten`:o.format==="regex"?`Ung\xFCltiger String: muss dem Muster ${o.pattern} entsprechen`:`Ung\xFCltig: ${i[o.format]??t.format}`}case"not_multiple_of":return`Ung\xFCltige Zahl: muss ein Vielfaches von ${t.divisor} sein`;case"unrecognized_keys":return`${t.keys.length>1?"Unbekannte Schl\xFCssel":"Unbekannter Schl\xFCssel"}: ${_(t.keys,", ")}`;case"invalid_key":return`Ung\xFCltiger Schl\xFCssel in ${t.origin}`;case"invalid_union":return"Ung\xFCltige Eingabe";case"invalid_element":return`Ung\xFCltiger Wert in ${t.origin}`;default:return"Ung\xFCltige Eingabe"}}};function ng(){return{localeError:Nw()}}var jw=n=>{let e=typeof n;switch(e){case"number":return Number.isNaN(n)?"NaN":"number";case"object":{if(Array.isArray(n))return"array";if(n===null)return"null";if(Object.getPrototypeOf(n)!==Object.prototype&&n.constructor)return n.constructor.name}}return e},Aw=()=>{let n={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"}};function e(i){return n[i]??null}let r={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"};return i=>{switch(i.code){case"invalid_type":return`Invalid input: expected ${i.expected}, received ${jw(i.input)}`;case"invalid_value":return i.values.length===1?`Invalid input: expected ${A(i.values[0])}`:`Invalid option: expected one of ${_(i.values,"|")}`;case"too_big":{let t=i.inclusive?"<=":"<",o=e(i.origin);return o?`Too big: expected ${i.origin??"value"} to have ${t}${i.maximum.toString()} ${o.unit??"elements"}`:`Too big: expected ${i.origin??"value"} to be ${t}${i.maximum.toString()}`}case"too_small":{let t=i.inclusive?">=":">",o=e(i.origin);return o?`Too small: expected ${i.origin} to have ${t}${i.minimum.toString()} ${o.unit}`:`Too small: expected ${i.origin} to be ${t}${i.minimum.toString()}`}case"invalid_format":{let t=i;return t.format==="starts_with"?`Invalid string: must start with "${t.prefix}"`:t.format==="ends_with"?`Invalid string: must end with "${t.suffix}"`:t.format==="includes"?`Invalid string: must include "${t.includes}"`:t.format==="regex"?`Invalid string: must match pattern ${t.pattern}`:`Invalid ${r[t.format]??i.format}`}case"not_multiple_of":return`Invalid number: must be a multiple of ${i.divisor}`;case"unrecognized_keys":return`Unrecognized key${i.keys.length>1?"s":""}: ${_(i.keys,", ")}`;case"invalid_key":return`Invalid key in ${i.origin}`;case"invalid_union":return"Invalid input";case"invalid_element":return`Invalid value in ${i.origin}`;default:return"Invalid input"}}};function Vo(){return{localeError:Aw()}}var zw=n=>{let e=typeof n;switch(e){case"number":return Number.isNaN(n)?"NaN":"nombro";case"object":{if(Array.isArray(n))return"tabelo";if(n===null)return"senvalora";if(Object.getPrototypeOf(n)!==Object.prototype&&n.constructor)return n.constructor.name}}return e},Dw=()=>{let n={string:{unit:"karaktrojn",verb:"havi"},file:{unit:"bajtojn",verb:"havi"},array:{unit:"elementojn",verb:"havi"},set:{unit:"elementojn",verb:"havi"}};function e(i){return n[i]??null}let r={regex:"enigo",email:"retadreso",url:"URL",emoji:"emo\u011Dio",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-datotempo",date:"ISO-dato",time:"ISO-tempo",duration:"ISO-da\u016Dro",ipv4:"IPv4-adreso",ipv6:"IPv6-adreso",cidrv4:"IPv4-rango",cidrv6:"IPv6-rango",base64:"64-ume kodita karaktraro",base64url:"URL-64-ume kodita karaktraro",json_string:"JSON-karaktraro",e164:"E.164-nombro",jwt:"JWT",template_literal:"enigo"};return i=>{switch(i.code){case"invalid_type":return`Nevalida enigo: atendi\u011Dis ${i.expected}, ricevi\u011Dis ${zw(i.input)}`;case"invalid_value":return i.values.length===1?`Nevalida enigo: atendi\u011Dis ${A(i.values[0])}`:`Nevalida opcio: atendi\u011Dis unu el ${_(i.values,"|")}`;case"too_big":{let t=i.inclusive?"<=":"<",o=e(i.origin);return o?`Tro granda: atendi\u011Dis ke ${i.origin??"valoro"} havu ${t}${i.maximum.toString()} ${o.unit??"elementojn"}`:`Tro granda: atendi\u011Dis ke ${i.origin??"valoro"} havu ${t}${i.maximum.toString()}`}case"too_small":{let t=i.inclusive?">=":">",o=e(i.origin);return o?`Tro malgranda: atendi\u011Dis ke ${i.origin} havu ${t}${i.minimum.toString()} ${o.unit}`:`Tro malgranda: atendi\u011Dis ke ${i.origin} estu ${t}${i.minimum.toString()}`}case"invalid_format":{let t=i;return t.format==="starts_with"?`Nevalida karaktraro: devas komenci\u011Di per "${t.prefix}"`:t.format==="ends_with"?`Nevalida karaktraro: devas fini\u011Di per "${t.suffix}"`:t.format==="includes"?`Nevalida karaktraro: devas inkluzivi "${t.includes}"`:t.format==="regex"?`Nevalida karaktraro: devas kongrui kun la modelo ${t.pattern}`:`Nevalida ${r[t.format]??i.format}`}case"not_multiple_of":return`Nevalida nombro: devas esti oblo de ${i.divisor}`;case"unrecognized_keys":return`Nekonata${i.keys.length>1?"j":""} \u015Dlosilo${i.keys.length>1?"j":""}: ${_(i.keys,", ")}`;case"invalid_key":return`Nevalida \u015Dlosilo en ${i.origin}`;case"invalid_union":return"Nevalida enigo";case"invalid_element":return`Nevalida valoro en ${i.origin}`;default:return"Nevalida enigo"}}};function ig(){return{localeError:Dw()}}var Rw=()=>{let n={string:{unit:"caracteres",verb:"tener"},file:{unit:"bytes",verb:"tener"},array:{unit:"elementos",verb:"tener"},set:{unit:"elementos",verb:"tener"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"n\xFAmero";case"object":{if(Array.isArray(t))return"arreglo";if(t===null)return"nulo";if(Object.getPrototypeOf(t)!==Object.prototype)return t.constructor.name}}return o},i={regex:"entrada",email:"direcci\xF3n de correo electr\xF3nico",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"fecha y hora ISO",date:"fecha ISO",time:"hora ISO",duration:"duraci\xF3n ISO",ipv4:"direcci\xF3n IPv4",ipv6:"direcci\xF3n IPv6",cidrv4:"rango IPv4",cidrv6:"rango IPv6",base64:"cadena codificada en base64",base64url:"URL codificada en base64",json_string:"cadena JSON",e164:"n\xFAmero E.164",jwt:"JWT",template_literal:"entrada"};return t=>{switch(t.code){case"invalid_type":return`Entrada inv\xE1lida: se esperaba ${t.expected}, recibido ${r(t.input)}`;case"invalid_value":return t.values.length===1?`Entrada inv\xE1lida: se esperaba ${A(t.values[0])}`:`Opci\xF3n inv\xE1lida: se esperaba una de ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`Demasiado grande: se esperaba que ${t.origin??"valor"} tuviera ${o}${t.maximum.toString()} ${s.unit??"elementos"}`:`Demasiado grande: se esperaba que ${t.origin??"valor"} fuera ${o}${t.maximum.toString()}`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`Demasiado peque\xF1o: se esperaba que ${t.origin} tuviera ${o}${t.minimum.toString()} ${s.unit}`:`Demasiado peque\xF1o: se esperaba que ${t.origin} fuera ${o}${t.minimum.toString()}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`Cadena inv\xE1lida: debe comenzar con "${o.prefix}"`:o.format==="ends_with"?`Cadena inv\xE1lida: debe terminar en "${o.suffix}"`:o.format==="includes"?`Cadena inv\xE1lida: debe incluir "${o.includes}"`:o.format==="regex"?`Cadena inv\xE1lida: debe coincidir con el patr\xF3n ${o.pattern}`:`Inv\xE1lido ${i[o.format]??t.format}`}case"not_multiple_of":return`N\xFAmero inv\xE1lido: debe ser m\xFAltiplo de ${t.divisor}`;case"unrecognized_keys":return`Llave${t.keys.length>1?"s":""} desconocida${t.keys.length>1?"s":""}: ${_(t.keys,", ")}`;case"invalid_key":return`Llave inv\xE1lida en ${t.origin}`;case"invalid_union":return"Entrada inv\xE1lida";case"invalid_element":return`Valor inv\xE1lido en ${t.origin}`;default:return"Entrada inv\xE1lida"}}};function og(){return{localeError:Rw()}}var Ow=()=>{let n={string:{unit:"\u06A9\u0627\u0631\u0627\u06A9\u062A\u0631",verb:"\u062F\u0627\u0634\u062A\u0647 \u0628\u0627\u0634\u062F"},file:{unit:"\u0628\u0627\u06CC\u062A",verb:"\u062F\u0627\u0634\u062A\u0647 \u0628\u0627\u0634\u062F"},array:{unit:"\u0622\u06CC\u062A\u0645",verb:"\u062F\u0627\u0634\u062A\u0647 \u0628\u0627\u0634\u062F"},set:{unit:"\u0622\u06CC\u062A\u0645",verb:"\u062F\u0627\u0634\u062A\u0647 \u0628\u0627\u0634\u062F"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"\u0639\u062F\u062F";case"object":{if(Array.isArray(t))return"\u0622\u0631\u0627\u06CC\u0647";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"\u0648\u0631\u0648\u062F\u06CC",email:"\u0622\u062F\u0631\u0633 \u0627\u06CC\u0645\u06CC\u0644",url:"URL",emoji:"\u0627\u06CC\u0645\u0648\u062C\u06CC",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"\u062A\u0627\u0631\u06CC\u062E \u0648 \u0632\u0645\u0627\u0646 \u0627\u06CC\u0632\u0648",date:"\u062A\u0627\u0631\u06CC\u062E \u0627\u06CC\u0632\u0648",time:"\u0632\u0645\u0627\u0646 \u0627\u06CC\u0632\u0648",duration:"\u0645\u062F\u062A \u0632\u0645\u0627\u0646 \u0627\u06CC\u0632\u0648",ipv4:"IPv4 \u0622\u062F\u0631\u0633",ipv6:"IPv6 \u0622\u062F\u0631\u0633",cidrv4:"IPv4 \u062F\u0627\u0645\u0646\u0647",cidrv6:"IPv6 \u062F\u0627\u0645\u0646\u0647",base64:"base64-encoded \u0631\u0634\u062A\u0647",base64url:"base64url-encoded \u0631\u0634\u062A\u0647",json_string:"JSON \u0631\u0634\u062A\u0647",e164:"E.164 \u0639\u062F\u062F",jwt:"JWT",template_literal:"\u0648\u0631\u0648\u062F\u06CC"};return t=>{switch(t.code){case"invalid_type":return`\u0648\u0631\u0648\u062F\u06CC \u0646\u0627\u0645\u0639\u062A\u0628\u0631: \u0645\u06CC\u200C\u0628\u0627\u06CC\u0633\u062A ${t.expected} \u0645\u06CC\u200C\u0628\u0648\u062F\u060C ${r(t.input)} \u062F\u0631\u06CC\u0627\u0641\u062A \u0634\u062F`;case"invalid_value":return t.values.length===1?`\u0648\u0631\u0648\u062F\u06CC \u0646\u0627\u0645\u0639\u062A\u0628\u0631: \u0645\u06CC\u200C\u0628\u0627\u06CC\u0633\u062A ${A(t.values[0])} \u0645\u06CC\u200C\u0628\u0648\u062F`:`\u06AF\u0632\u06CC\u0646\u0647 \u0646\u0627\u0645\u0639\u062A\u0628\u0631: \u0645\u06CC\u200C\u0628\u0627\u06CC\u0633\u062A \u06CC\u06A9\u06CC \u0627\u0632 ${_(t.values,"|")} \u0645\u06CC\u200C\u0628\u0648\u062F`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`\u062E\u06CC\u0644\u06CC \u0628\u0632\u0631\u06AF: ${t.origin??"\u0645\u0642\u062F\u0627\u0631"} \u0628\u0627\u06CC\u062F ${o}${t.maximum.toString()} ${s.unit??"\u0639\u0646\u0635\u0631"} \u0628\u0627\u0634\u062F`:`\u062E\u06CC\u0644\u06CC \u0628\u0632\u0631\u06AF: ${t.origin??"\u0645\u0642\u062F\u0627\u0631"} \u0628\u0627\u06CC\u062F ${o}${t.maximum.toString()} \u0628\u0627\u0634\u062F`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`\u062E\u06CC\u0644\u06CC \u06A9\u0648\u0686\u06A9: ${t.origin} \u0628\u0627\u06CC\u062F ${o}${t.minimum.toString()} ${s.unit} \u0628\u0627\u0634\u062F`:`\u062E\u06CC\u0644\u06CC \u06A9\u0648\u0686\u06A9: ${t.origin} \u0628\u0627\u06CC\u062F ${o}${t.minimum.toString()} \u0628\u0627\u0634\u062F`}case"invalid_format":{let o=t;return o.format==="starts_with"?`\u0631\u0634\u062A\u0647 \u0646\u0627\u0645\u0639\u062A\u0628\u0631: \u0628\u0627\u06CC\u062F \u0628\u0627 "${o.prefix}" \u0634\u0631\u0648\u0639 \u0634\u0648\u062F`:o.format==="ends_with"?`\u0631\u0634\u062A\u0647 \u0646\u0627\u0645\u0639\u062A\u0628\u0631: \u0628\u0627\u06CC\u062F \u0628\u0627 "${o.suffix}" \u062A\u0645\u0627\u0645 \u0634\u0648\u062F`:o.format==="includes"?`\u0631\u0634\u062A\u0647 \u0646\u0627\u0645\u0639\u062A\u0628\u0631: \u0628\u0627\u06CC\u062F \u0634\u0627\u0645\u0644 "${o.includes}" \u0628\u0627\u0634\u062F`:o.format==="regex"?`\u0631\u0634\u062A\u0647 \u0646\u0627\u0645\u0639\u062A\u0628\u0631: \u0628\u0627\u06CC\u062F \u0628\u0627 \u0627\u0644\u06AF\u0648\u06CC ${o.pattern} \u0645\u0637\u0627\u0628\u0642\u062A \u062F\u0627\u0634\u062A\u0647 \u0628\u0627\u0634\u062F`:`${i[o.format]??t.format} \u0646\u0627\u0645\u0639\u062A\u0628\u0631`}case"not_multiple_of":return`\u0639\u062F\u062F \u0646\u0627\u0645\u0639\u062A\u0628\u0631: \u0628\u0627\u06CC\u062F \u0645\u0636\u0631\u0628 ${t.divisor} \u0628\u0627\u0634\u062F`;case"unrecognized_keys":return`\u06A9\u0644\u06CC\u062F${t.keys.length>1?"\u0647\u0627\u06CC":""} \u0646\u0627\u0634\u0646\u0627\u0633: ${_(t.keys,", ")}`;case"invalid_key":return`\u06A9\u0644\u06CC\u062F \u0646\u0627\u0634\u0646\u0627\u0633 \u062F\u0631 ${t.origin}`;case"invalid_union":return"\u0648\u0631\u0648\u062F\u06CC \u0646\u0627\u0645\u0639\u062A\u0628\u0631";case"invalid_element":return`\u0645\u0642\u062F\u0627\u0631 \u0646\u0627\u0645\u0639\u062A\u0628\u0631 \u062F\u0631 ${t.origin}`;default:return"\u0648\u0631\u0648\u062F\u06CC \u0646\u0627\u0645\u0639\u062A\u0628\u0631"}}};function sg(){return{localeError:Ow()}}var Mw=()=>{let n={string:{unit:"merkki\xE4",subject:"merkkijonon"},file:{unit:"tavua",subject:"tiedoston"},array:{unit:"alkiota",subject:"listan"},set:{unit:"alkiota",subject:"joukon"},number:{unit:"",subject:"luvun"},bigint:{unit:"",subject:"suuren kokonaisluvun"},int:{unit:"",subject:"kokonaisluvun"},date:{unit:"",subject:"p\xE4iv\xE4m\xE4\xE4r\xE4n"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"number";case"object":{if(Array.isArray(t))return"array";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"s\xE4\xE4nn\xF6llinen lauseke",email:"s\xE4hk\xF6postiosoite",url:"URL-osoite",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-aikaleima",date:"ISO-p\xE4iv\xE4m\xE4\xE4r\xE4",time:"ISO-aika",duration:"ISO-kesto",ipv4:"IPv4-osoite",ipv6:"IPv6-osoite",cidrv4:"IPv4-alue",cidrv6:"IPv6-alue",base64:"base64-koodattu merkkijono",base64url:"base64url-koodattu merkkijono",json_string:"JSON-merkkijono",e164:"E.164-luku",jwt:"JWT",template_literal:"templaattimerkkijono"};return t=>{switch(t.code){case"invalid_type":return`Virheellinen tyyppi: odotettiin ${t.expected}, oli ${r(t.input)}`;case"invalid_value":return t.values.length===1?`Virheellinen sy\xF6te: t\xE4ytyy olla ${A(t.values[0])}`:`Virheellinen valinta: t\xE4ytyy olla yksi seuraavista: ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`Liian suuri: ${s.subject} t\xE4ytyy olla ${o}${t.maximum.toString()} ${s.unit}`.trim():`Liian suuri: arvon t\xE4ytyy olla ${o}${t.maximum.toString()}`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`Liian pieni: ${s.subject} t\xE4ytyy olla ${o}${t.minimum.toString()} ${s.unit}`.trim():`Liian pieni: arvon t\xE4ytyy olla ${o}${t.minimum.toString()}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`Virheellinen sy\xF6te: t\xE4ytyy alkaa "${o.prefix}"`:o.format==="ends_with"?`Virheellinen sy\xF6te: t\xE4ytyy loppua "${o.suffix}"`:o.format==="includes"?`Virheellinen sy\xF6te: t\xE4ytyy sis\xE4lt\xE4\xE4 "${o.includes}"`:o.format==="regex"?`Virheellinen sy\xF6te: t\xE4ytyy vastata s\xE4\xE4nn\xF6llist\xE4 lauseketta ${o.pattern}`:`Virheellinen ${i[o.format]??t.format}`}case"not_multiple_of":return`Virheellinen luku: t\xE4ytyy olla luvun ${t.divisor} monikerta`;case"unrecognized_keys":return`${t.keys.length>1?"Tuntemattomat avaimet":"Tuntematon avain"}: ${_(t.keys,", ")}`;case"invalid_key":return"Virheellinen avain tietueessa";case"invalid_union":return"Virheellinen unioni";case"invalid_element":return"Virheellinen arvo joukossa";default:return"Virheellinen sy\xF6te"}}};function ag(){return{localeError:Mw()}}var Uw=()=>{let n={string:{unit:"caract\xE8res",verb:"avoir"},file:{unit:"octets",verb:"avoir"},array:{unit:"\xE9l\xE9ments",verb:"avoir"},set:{unit:"\xE9l\xE9ments",verb:"avoir"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"nombre";case"object":{if(Array.isArray(t))return"tableau";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"entr\xE9e",email:"adresse e-mail",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"date et heure ISO",date:"date ISO",time:"heure ISO",duration:"dur\xE9e ISO",ipv4:"adresse IPv4",ipv6:"adresse IPv6",cidrv4:"plage IPv4",cidrv6:"plage IPv6",base64:"cha\xEEne encod\xE9e en base64",base64url:"cha\xEEne encod\xE9e en base64url",json_string:"cha\xEEne JSON",e164:"num\xE9ro E.164",jwt:"JWT",template_literal:"entr\xE9e"};return t=>{switch(t.code){case"invalid_type":return`Entr\xE9e invalide : ${t.expected} attendu, ${r(t.input)} re\xE7u`;case"invalid_value":return t.values.length===1?`Entr\xE9e invalide : ${A(t.values[0])} attendu`:`Option invalide : une valeur parmi ${_(t.values,"|")} attendue`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`Trop grand : ${t.origin??"valeur"} doit ${s.verb} ${o}${t.maximum.toString()} ${s.unit??"\xE9l\xE9ment(s)"}`:`Trop grand : ${t.origin??"valeur"} doit \xEAtre ${o}${t.maximum.toString()}`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`Trop petit : ${t.origin} doit ${s.verb} ${o}${t.minimum.toString()} ${s.unit}`:`Trop petit : ${t.origin} doit \xEAtre ${o}${t.minimum.toString()}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`Cha\xEEne invalide : doit commencer par "${o.prefix}"`:o.format==="ends_with"?`Cha\xEEne invalide : doit se terminer par "${o.suffix}"`:o.format==="includes"?`Cha\xEEne invalide : doit inclure "${o.includes}"`:o.format==="regex"?`Cha\xEEne invalide : doit correspondre au mod\xE8le ${o.pattern}`:`${i[o.format]??t.format} invalide`}case"not_multiple_of":return`Nombre invalide : doit \xEAtre un multiple de ${t.divisor}`;case"unrecognized_keys":return`Cl\xE9${t.keys.length>1?"s":""} non reconnue${t.keys.length>1?"s":""} : ${_(t.keys,", ")}`;case"invalid_key":return`Cl\xE9 invalide dans ${t.origin}`;case"invalid_union":return"Entr\xE9e invalide";case"invalid_element":return`Valeur invalide dans ${t.origin}`;default:return"Entr\xE9e invalide"}}};function cg(){return{localeError:Uw()}}var Fw=()=>{let n={string:{unit:"caract\xE8res",verb:"avoir"},file:{unit:"octets",verb:"avoir"},array:{unit:"\xE9l\xE9ments",verb:"avoir"},set:{unit:"\xE9l\xE9ments",verb:"avoir"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"number";case"object":{if(Array.isArray(t))return"array";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"entr\xE9e",email:"adresse courriel",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"date-heure ISO",date:"date ISO",time:"heure ISO",duration:"dur\xE9e ISO",ipv4:"adresse IPv4",ipv6:"adresse IPv6",cidrv4:"plage IPv4",cidrv6:"plage IPv6",base64:"cha\xEEne encod\xE9e en base64",base64url:"cha\xEEne encod\xE9e en base64url",json_string:"cha\xEEne JSON",e164:"num\xE9ro E.164",jwt:"JWT",template_literal:"entr\xE9e"};return t=>{switch(t.code){case"invalid_type":return`Entr\xE9e invalide : attendu ${t.expected}, re\xE7u ${r(t.input)}`;case"invalid_value":return t.values.length===1?`Entr\xE9e invalide : attendu ${A(t.values[0])}`:`Option invalide : attendu l'une des valeurs suivantes ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"\u2264":"<",s=e(t.origin);return s?`Trop grand : attendu que ${t.origin??"la valeur"} ait ${o}${t.maximum.toString()} ${s.unit}`:`Trop grand : attendu que ${t.origin??"la valeur"} soit ${o}${t.maximum.toString()}`}case"too_small":{let o=t.inclusive?"\u2265":">",s=e(t.origin);return s?`Trop petit : attendu que ${t.origin} ait ${o}${t.minimum.toString()} ${s.unit}`:`Trop petit : attendu que ${t.origin} soit ${o}${t.minimum.toString()}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`Cha\xEEne invalide : doit commencer par "${o.prefix}"`:o.format==="ends_with"?`Cha\xEEne invalide : doit se terminer par "${o.suffix}"`:o.format==="includes"?`Cha\xEEne invalide : doit inclure "${o.includes}"`:o.format==="regex"?`Cha\xEEne invalide : doit correspondre au motif ${o.pattern}`:`${i[o.format]??t.format} invalide`}case"not_multiple_of":return`Nombre invalide : doit \xEAtre un multiple de ${t.divisor}`;case"unrecognized_keys":return`Cl\xE9${t.keys.length>1?"s":""} non reconnue${t.keys.length>1?"s":""} : ${_(t.keys,", ")}`;case"invalid_key":return`Cl\xE9 invalide dans ${t.origin}`;case"invalid_union":return"Entr\xE9e invalide";case"invalid_element":return`Valeur invalide dans ${t.origin}`;default:return"Entr\xE9e invalide"}}};function lg(){return{localeError:Fw()}}var Lw=()=>{let n={string:{unit:"\u05D0\u05D5\u05EA\u05D9\u05D5\u05EA",verb:"\u05DC\u05DB\u05DC\u05D5\u05DC"},file:{unit:"\u05D1\u05D9\u05D9\u05D8\u05D9\u05DD",verb:"\u05DC\u05DB\u05DC\u05D5\u05DC"},array:{unit:"\u05E4\u05E8\u05D9\u05D8\u05D9\u05DD",verb:"\u05DC\u05DB\u05DC\u05D5\u05DC"},set:{unit:"\u05E4\u05E8\u05D9\u05D8\u05D9\u05DD",verb:"\u05DC\u05DB\u05DC\u05D5\u05DC"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"number";case"object":{if(Array.isArray(t))return"array";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"\u05E7\u05DC\u05D8",email:"\u05DB\u05EA\u05D5\u05D1\u05EA \u05D0\u05D9\u05DE\u05D9\u05D9\u05DC",url:"\u05DB\u05EA\u05D5\u05D1\u05EA \u05E8\u05E9\u05EA",emoji:"\u05D0\u05D9\u05DE\u05D5\u05D2'\u05D9",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"\u05EA\u05D0\u05E8\u05D9\u05DA \u05D5\u05D6\u05DE\u05DF ISO",date:"\u05EA\u05D0\u05E8\u05D9\u05DA ISO",time:"\u05D6\u05DE\u05DF ISO",duration:"\u05DE\u05E9\u05DA \u05D6\u05DE\u05DF ISO",ipv4:"\u05DB\u05EA\u05D5\u05D1\u05EA IPv4",ipv6:"\u05DB\u05EA\u05D5\u05D1\u05EA IPv6",cidrv4:"\u05D8\u05D5\u05D5\u05D7 IPv4",cidrv6:"\u05D8\u05D5\u05D5\u05D7 IPv6",base64:"\u05DE\u05D7\u05E8\u05D5\u05D6\u05EA \u05D1\u05D1\u05E1\u05D9\u05E1 64",base64url:"\u05DE\u05D7\u05E8\u05D5\u05D6\u05EA \u05D1\u05D1\u05E1\u05D9\u05E1 64 \u05DC\u05DB\u05EA\u05D5\u05D1\u05D5\u05EA \u05E8\u05E9\u05EA",json_string:"\u05DE\u05D7\u05E8\u05D5\u05D6\u05EA JSON",e164:"\u05DE\u05E1\u05E4\u05E8 E.164",jwt:"JWT",template_literal:"\u05E7\u05DC\u05D8"};return t=>{switch(t.code){case"invalid_type":return`\u05E7\u05DC\u05D8 \u05DC\u05D0 \u05EA\u05E7\u05D9\u05DF: \u05E6\u05E8\u05D9\u05DA ${t.expected}, \u05D4\u05EA\u05E7\u05D1\u05DC ${r(t.input)}`;case"invalid_value":return t.values.length===1?`\u05E7\u05DC\u05D8 \u05DC\u05D0 \u05EA\u05E7\u05D9\u05DF: \u05E6\u05E8\u05D9\u05DA ${A(t.values[0])}`:`\u05E7\u05DC\u05D8 \u05DC\u05D0 \u05EA\u05E7\u05D9\u05DF: \u05E6\u05E8\u05D9\u05DA \u05D0\u05D7\u05EA \u05DE\u05D4\u05D0\u05E4\u05E9\u05E8\u05D5\u05D9\u05D5\u05EA  ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`\u05D2\u05D3\u05D5\u05DC \u05DE\u05D3\u05D9: ${t.origin??"value"} \u05E6\u05E8\u05D9\u05DA \u05DC\u05D4\u05D9\u05D5\u05EA ${o}${t.maximum.toString()} ${s.unit??"elements"}`:`\u05D2\u05D3\u05D5\u05DC \u05DE\u05D3\u05D9: ${t.origin??"value"} \u05E6\u05E8\u05D9\u05DA \u05DC\u05D4\u05D9\u05D5\u05EA ${o}${t.maximum.toString()}`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`\u05E7\u05D8\u05DF \u05DE\u05D3\u05D9: ${t.origin} \u05E6\u05E8\u05D9\u05DA \u05DC\u05D4\u05D9\u05D5\u05EA ${o}${t.minimum.toString()} ${s.unit}`:`\u05E7\u05D8\u05DF \u05DE\u05D3\u05D9: ${t.origin} \u05E6\u05E8\u05D9\u05DA \u05DC\u05D4\u05D9\u05D5\u05EA ${o}${t.minimum.toString()}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`\u05DE\u05D7\u05E8\u05D5\u05D6\u05EA \u05DC\u05D0 \u05EA\u05E7\u05D9\u05E0\u05D4: \u05D7\u05D9\u05D9\u05D1\u05EA \u05DC\u05D4\u05EA\u05D7\u05D9\u05DC \u05D1"${o.prefix}"`:o.format==="ends_with"?`\u05DE\u05D7\u05E8\u05D5\u05D6\u05EA \u05DC\u05D0 \u05EA\u05E7\u05D9\u05E0\u05D4: \u05D7\u05D9\u05D9\u05D1\u05EA \u05DC\u05D4\u05E1\u05EA\u05D9\u05D9\u05DD \u05D1 "${o.suffix}"`:o.format==="includes"?`\u05DE\u05D7\u05E8\u05D5\u05D6\u05EA \u05DC\u05D0 \u05EA\u05E7\u05D9\u05E0\u05D4: \u05D7\u05D9\u05D9\u05D1\u05EA \u05DC\u05DB\u05DC\u05D5\u05DC "${o.includes}"`:o.format==="regex"?`\u05DE\u05D7\u05E8\u05D5\u05D6\u05EA \u05DC\u05D0 \u05EA\u05E7\u05D9\u05E0\u05D4: \u05D7\u05D9\u05D9\u05D1\u05EA \u05DC\u05D4\u05EA\u05D0\u05D9\u05DD \u05DC\u05EA\u05D1\u05E0\u05D9\u05EA ${o.pattern}`:`${i[o.format]??t.format} \u05DC\u05D0 \u05EA\u05E7\u05D9\u05DF`}case"not_multiple_of":return`\u05DE\u05E1\u05E4\u05E8 \u05DC\u05D0 \u05EA\u05E7\u05D9\u05DF: \u05D7\u05D9\u05D9\u05D1 \u05DC\u05D4\u05D9\u05D5\u05EA \u05DE\u05DB\u05E4\u05DC\u05D4 \u05E9\u05DC ${t.divisor}`;case"unrecognized_keys":return`\u05DE\u05E4\u05EA\u05D7${t.keys.length>1?"\u05D5\u05EA":""} \u05DC\u05D0 \u05DE\u05D6\u05D5\u05D4${t.keys.length>1?"\u05D9\u05DD":"\u05D4"}: ${_(t.keys,", ")}`;case"invalid_key":return`\u05DE\u05E4\u05EA\u05D7 \u05DC\u05D0 \u05EA\u05E7\u05D9\u05DF \u05D1${t.origin}`;case"invalid_union":return"\u05E7\u05DC\u05D8 \u05DC\u05D0 \u05EA\u05E7\u05D9\u05DF";case"invalid_element":return`\u05E2\u05E8\u05DA \u05DC\u05D0 \u05EA\u05E7\u05D9\u05DF \u05D1${t.origin}`;default:return"\u05E7\u05DC\u05D8 \u05DC\u05D0 \u05EA\u05E7\u05D9\u05DF"}}};function ug(){return{localeError:Lw()}}var Bw=()=>{let n={string:{unit:"karakter",verb:"legyen"},file:{unit:"byte",verb:"legyen"},array:{unit:"elem",verb:"legyen"},set:{unit:"elem",verb:"legyen"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"sz\xE1m";case"object":{if(Array.isArray(t))return"t\xF6mb";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"bemenet",email:"email c\xEDm",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO id\u0151b\xE9lyeg",date:"ISO d\xE1tum",time:"ISO id\u0151",duration:"ISO id\u0151intervallum",ipv4:"IPv4 c\xEDm",ipv6:"IPv6 c\xEDm",cidrv4:"IPv4 tartom\xE1ny",cidrv6:"IPv6 tartom\xE1ny",base64:"base64-k\xF3dolt string",base64url:"base64url-k\xF3dolt string",json_string:"JSON string",e164:"E.164 sz\xE1m",jwt:"JWT",template_literal:"bemenet"};return t=>{switch(t.code){case"invalid_type":return`\xC9rv\xE9nytelen bemenet: a v\xE1rt \xE9rt\xE9k ${t.expected}, a kapott \xE9rt\xE9k ${r(t.input)}`;case"invalid_value":return t.values.length===1?`\xC9rv\xE9nytelen bemenet: a v\xE1rt \xE9rt\xE9k ${A(t.values[0])}`:`\xC9rv\xE9nytelen opci\xF3: valamelyik \xE9rt\xE9k v\xE1rt ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`T\xFAl nagy: ${t.origin??"\xE9rt\xE9k"} m\xE9rete t\xFAl nagy ${o}${t.maximum.toString()} ${s.unit??"elem"}`:`T\xFAl nagy: a bemeneti \xE9rt\xE9k ${t.origin??"\xE9rt\xE9k"} t\xFAl nagy: ${o}${t.maximum.toString()}`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`T\xFAl kicsi: a bemeneti \xE9rt\xE9k ${t.origin} m\xE9rete t\xFAl kicsi ${o}${t.minimum.toString()} ${s.unit}`:`T\xFAl kicsi: a bemeneti \xE9rt\xE9k ${t.origin} t\xFAl kicsi ${o}${t.minimum.toString()}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`\xC9rv\xE9nytelen string: "${o.prefix}" \xE9rt\xE9kkel kell kezd\u0151dnie`:o.format==="ends_with"?`\xC9rv\xE9nytelen string: "${o.suffix}" \xE9rt\xE9kkel kell v\xE9gz\u0151dnie`:o.format==="includes"?`\xC9rv\xE9nytelen string: "${o.includes}" \xE9rt\xE9ket kell tartalmaznia`:o.format==="regex"?`\xC9rv\xE9nytelen string: ${o.pattern} mint\xE1nak kell megfelelnie`:`\xC9rv\xE9nytelen ${i[o.format]??t.format}`}case"not_multiple_of":return`\xC9rv\xE9nytelen sz\xE1m: ${t.divisor} t\xF6bbsz\xF6r\xF6s\xE9nek kell lennie`;case"unrecognized_keys":return`Ismeretlen kulcs${t.keys.length>1?"s":""}: ${_(t.keys,", ")}`;case"invalid_key":return`\xC9rv\xE9nytelen kulcs ${t.origin}`;case"invalid_union":return"\xC9rv\xE9nytelen bemenet";case"invalid_element":return`\xC9rv\xE9nytelen \xE9rt\xE9k: ${t.origin}`;default:return"\xC9rv\xE9nytelen bemenet"}}};function dg(){return{localeError:Bw()}}var Ww=()=>{let n={string:{unit:"karakter",verb:"memiliki"},file:{unit:"byte",verb:"memiliki"},array:{unit:"item",verb:"memiliki"},set:{unit:"item",verb:"memiliki"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"number";case"object":{if(Array.isArray(t))return"array";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"input",email:"alamat email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"tanggal dan waktu format ISO",date:"tanggal format ISO",time:"jam format ISO",duration:"durasi format ISO",ipv4:"alamat IPv4",ipv6:"alamat IPv6",cidrv4:"rentang alamat IPv4",cidrv6:"rentang alamat IPv6",base64:"string dengan enkode base64",base64url:"string dengan enkode base64url",json_string:"string JSON",e164:"angka E.164",jwt:"JWT",template_literal:"input"};return t=>{switch(t.code){case"invalid_type":return`Input tidak valid: diharapkan ${t.expected}, diterima ${r(t.input)}`;case"invalid_value":return t.values.length===1?`Input tidak valid: diharapkan ${A(t.values[0])}`:`Pilihan tidak valid: diharapkan salah satu dari ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`Terlalu besar: diharapkan ${t.origin??"value"} memiliki ${o}${t.maximum.toString()} ${s.unit??"elemen"}`:`Terlalu besar: diharapkan ${t.origin??"value"} menjadi ${o}${t.maximum.toString()}`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`Terlalu kecil: diharapkan ${t.origin} memiliki ${o}${t.minimum.toString()} ${s.unit}`:`Terlalu kecil: diharapkan ${t.origin} menjadi ${o}${t.minimum.toString()}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`String tidak valid: harus dimulai dengan "${o.prefix}"`:o.format==="ends_with"?`String tidak valid: harus berakhir dengan "${o.suffix}"`:o.format==="includes"?`String tidak valid: harus menyertakan "${o.includes}"`:o.format==="regex"?`String tidak valid: harus sesuai pola ${o.pattern}`:`${i[o.format]??t.format} tidak valid`}case"not_multiple_of":return`Angka tidak valid: harus kelipatan dari ${t.divisor}`;case"unrecognized_keys":return`Kunci tidak dikenali ${t.keys.length>1?"s":""}: ${_(t.keys,", ")}`;case"invalid_key":return`Kunci tidak valid di ${t.origin}`;case"invalid_union":return"Input tidak valid";case"invalid_element":return`Nilai tidak valid di ${t.origin}`;default:return"Input tidak valid"}}};function fg(){return{localeError:Ww()}}var Zw=n=>{let e=typeof n;switch(e){case"number":return Number.isNaN(n)?"NaN":"n\xFAmer";case"object":{if(Array.isArray(n))return"fylki";if(n===null)return"null";if(Object.getPrototypeOf(n)!==Object.prototype&&n.constructor)return n.constructor.name}}return e},Vw=()=>{let n={string:{unit:"stafi",verb:"a\xF0 hafa"},file:{unit:"b\xE6ti",verb:"a\xF0 hafa"},array:{unit:"hluti",verb:"a\xF0 hafa"},set:{unit:"hluti",verb:"a\xF0 hafa"}};function e(i){return n[i]??null}let r={regex:"gildi",email:"netfang",url:"vefsl\xF3\xF0",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO dagsetning og t\xEDmi",date:"ISO dagsetning",time:"ISO t\xEDmi",duration:"ISO t\xEDmalengd",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded strengur",base64url:"base64url-encoded strengur",json_string:"JSON strengur",e164:"E.164 t\xF6lugildi",jwt:"JWT",template_literal:"gildi"};return i=>{switch(i.code){case"invalid_type":return`Rangt gildi: \xDE\xFA sl\xF3st inn ${Zw(i.input)} \xFEar sem \xE1 a\xF0 vera ${i.expected}`;case"invalid_value":return i.values.length===1?`Rangt gildi: gert r\xE1\xF0 fyrir ${A(i.values[0])}`:`\xD3gilt val: m\xE1 vera eitt af eftirfarandi ${_(i.values,"|")}`;case"too_big":{let t=i.inclusive?"<=":"<",o=e(i.origin);return o?`Of st\xF3rt: gert er r\xE1\xF0 fyrir a\xF0 ${i.origin??"gildi"} hafi ${t}${i.maximum.toString()} ${o.unit??"hluti"}`:`Of st\xF3rt: gert er r\xE1\xF0 fyrir a\xF0 ${i.origin??"gildi"} s\xE9 ${t}${i.maximum.toString()}`}case"too_small":{let t=i.inclusive?">=":">",o=e(i.origin);return o?`Of l\xEDti\xF0: gert er r\xE1\xF0 fyrir a\xF0 ${i.origin} hafi ${t}${i.minimum.toString()} ${o.unit}`:`Of l\xEDti\xF0: gert er r\xE1\xF0 fyrir a\xF0 ${i.origin} s\xE9 ${t}${i.minimum.toString()}`}case"invalid_format":{let t=i;return t.format==="starts_with"?`\xD3gildur strengur: ver\xF0ur a\xF0 byrja \xE1 "${t.prefix}"`:t.format==="ends_with"?`\xD3gildur strengur: ver\xF0ur a\xF0 enda \xE1 "${t.suffix}"`:t.format==="includes"?`\xD3gildur strengur: ver\xF0ur a\xF0 innihalda "${t.includes}"`:t.format==="regex"?`\xD3gildur strengur: ver\xF0ur a\xF0 fylgja mynstri ${t.pattern}`:`Rangt ${r[t.format]??i.format}`}case"not_multiple_of":return`R\xF6ng tala: ver\xF0ur a\xF0 vera margfeldi af ${i.divisor}`;case"unrecognized_keys":return`\xD3\xFEekkt ${i.keys.length>1?"ir lyklar":"ur lykill"}: ${_(i.keys,", ")}`;case"invalid_key":return`Rangur lykill \xED ${i.origin}`;case"invalid_union":return"Rangt gildi";case"invalid_element":return`Rangt gildi \xED ${i.origin}`;default:return"Rangt gildi"}}};function mg(){return{localeError:Vw()}}var Gw=()=>{let n={string:{unit:"caratteri",verb:"avere"},file:{unit:"byte",verb:"avere"},array:{unit:"elementi",verb:"avere"},set:{unit:"elementi",verb:"avere"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"numero";case"object":{if(Array.isArray(t))return"vettore";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"input",email:"indirizzo email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data e ora ISO",date:"data ISO",time:"ora ISO",duration:"durata ISO",ipv4:"indirizzo IPv4",ipv6:"indirizzo IPv6",cidrv4:"intervallo IPv4",cidrv6:"intervallo IPv6",base64:"stringa codificata in base64",base64url:"URL codificata in base64",json_string:"stringa JSON",e164:"numero E.164",jwt:"JWT",template_literal:"input"};return t=>{switch(t.code){case"invalid_type":return`Input non valido: atteso ${t.expected}, ricevuto ${r(t.input)}`;case"invalid_value":return t.values.length===1?`Input non valido: atteso ${A(t.values[0])}`:`Opzione non valida: atteso uno tra ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`Troppo grande: ${t.origin??"valore"} deve avere ${o}${t.maximum.toString()} ${s.unit??"elementi"}`:`Troppo grande: ${t.origin??"valore"} deve essere ${o}${t.maximum.toString()}`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`Troppo piccolo: ${t.origin} deve avere ${o}${t.minimum.toString()} ${s.unit}`:`Troppo piccolo: ${t.origin} deve essere ${o}${t.minimum.toString()}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`Stringa non valida: deve iniziare con "${o.prefix}"`:o.format==="ends_with"?`Stringa non valida: deve terminare con "${o.suffix}"`:o.format==="includes"?`Stringa non valida: deve includere "${o.includes}"`:o.format==="regex"?`Stringa non valida: deve corrispondere al pattern ${o.pattern}`:`Invalid ${i[o.format]??t.format}`}case"not_multiple_of":return`Numero non valido: deve essere un multiplo di ${t.divisor}`;case"unrecognized_keys":return`Chiav${t.keys.length>1?"i":"e"} non riconosciut${t.keys.length>1?"e":"a"}: ${_(t.keys,", ")}`;case"invalid_key":return`Chiave non valida in ${t.origin}`;case"invalid_union":return"Input non valido";case"invalid_element":return`Valore non valido in ${t.origin}`;default:return"Input non valido"}}};function pg(){return{localeError:Gw()}}var Hw=()=>{let n={string:{unit:"\u6587\u5B57",verb:"\u3067\u3042\u308B"},file:{unit:"\u30D0\u30A4\u30C8",verb:"\u3067\u3042\u308B"},array:{unit:"\u8981\u7D20",verb:"\u3067\u3042\u308B"},set:{unit:"\u8981\u7D20",verb:"\u3067\u3042\u308B"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"\u6570\u5024";case"object":{if(Array.isArray(t))return"\u914D\u5217";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"\u5165\u529B\u5024",email:"\u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9",url:"URL",emoji:"\u7D75\u6587\u5B57",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO\u65E5\u6642",date:"ISO\u65E5\u4ED8",time:"ISO\u6642\u523B",duration:"ISO\u671F\u9593",ipv4:"IPv4\u30A2\u30C9\u30EC\u30B9",ipv6:"IPv6\u30A2\u30C9\u30EC\u30B9",cidrv4:"IPv4\u7BC4\u56F2",cidrv6:"IPv6\u7BC4\u56F2",base64:"base64\u30A8\u30F3\u30B3\u30FC\u30C9\u6587\u5B57\u5217",base64url:"base64url\u30A8\u30F3\u30B3\u30FC\u30C9\u6587\u5B57\u5217",json_string:"JSON\u6587\u5B57\u5217",e164:"E.164\u756A\u53F7",jwt:"JWT",template_literal:"\u5165\u529B\u5024"};return t=>{switch(t.code){case"invalid_type":return`\u7121\u52B9\u306A\u5165\u529B: ${t.expected}\u304C\u671F\u5F85\u3055\u308C\u307E\u3057\u305F\u304C\u3001${r(t.input)}\u304C\u5165\u529B\u3055\u308C\u307E\u3057\u305F`;case"invalid_value":return t.values.length===1?`\u7121\u52B9\u306A\u5165\u529B: ${A(t.values[0])}\u304C\u671F\u5F85\u3055\u308C\u307E\u3057\u305F`:`\u7121\u52B9\u306A\u9078\u629E: ${_(t.values,"\u3001")}\u306E\u3044\u305A\u308C\u304B\u3067\u3042\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059`;case"too_big":{let o=t.inclusive?"\u4EE5\u4E0B\u3067\u3042\u308B":"\u3088\u308A\u5C0F\u3055\u3044",s=e(t.origin);return s?`\u5927\u304D\u3059\u304E\u308B\u5024: ${t.origin??"\u5024"}\u306F${t.maximum.toString()}${s.unit??"\u8981\u7D20"}${o}\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059`:`\u5927\u304D\u3059\u304E\u308B\u5024: ${t.origin??"\u5024"}\u306F${t.maximum.toString()}${o}\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059`}case"too_small":{let o=t.inclusive?"\u4EE5\u4E0A\u3067\u3042\u308B":"\u3088\u308A\u5927\u304D\u3044",s=e(t.origin);return s?`\u5C0F\u3055\u3059\u304E\u308B\u5024: ${t.origin}\u306F${t.minimum.toString()}${s.unit}${o}\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059`:`\u5C0F\u3055\u3059\u304E\u308B\u5024: ${t.origin}\u306F${t.minimum.toString()}${o}\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059`}case"invalid_format":{let o=t;return o.format==="starts_with"?`\u7121\u52B9\u306A\u6587\u5B57\u5217: "${o.prefix}"\u3067\u59CB\u307E\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059`:o.format==="ends_with"?`\u7121\u52B9\u306A\u6587\u5B57\u5217: "${o.suffix}"\u3067\u7D42\u308F\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059`:o.format==="includes"?`\u7121\u52B9\u306A\u6587\u5B57\u5217: "${o.includes}"\u3092\u542B\u3080\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059`:o.format==="regex"?`\u7121\u52B9\u306A\u6587\u5B57\u5217: \u30D1\u30BF\u30FC\u30F3${o.pattern}\u306B\u4E00\u81F4\u3059\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059`:`\u7121\u52B9\u306A${i[o.format]??t.format}`}case"not_multiple_of":return`\u7121\u52B9\u306A\u6570\u5024: ${t.divisor}\u306E\u500D\u6570\u3067\u3042\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059`;case"unrecognized_keys":return`\u8A8D\u8B58\u3055\u308C\u3066\u3044\u306A\u3044\u30AD\u30FC${t.keys.length>1?"\u7FA4":""}: ${_(t.keys,"\u3001")}`;case"invalid_key":return`${t.origin}\u5185\u306E\u7121\u52B9\u306A\u30AD\u30FC`;case"invalid_union":return"\u7121\u52B9\u306A\u5165\u529B";case"invalid_element":return`${t.origin}\u5185\u306E\u7121\u52B9\u306A\u5024`;default:return"\u7121\u52B9\u306A\u5165\u529B"}}};function gg(){return{localeError:Hw()}}var qw=()=>{let n={string:{unit:"\u178F\u17BD\u17A2\u1780\u17D2\u179F\u179A",verb:"\u1782\u17BD\u179A\u1798\u17B6\u1793"},file:{unit:"\u1794\u17C3",verb:"\u1782\u17BD\u179A\u1798\u17B6\u1793"},array:{unit:"\u1792\u17B6\u178F\u17BB",verb:"\u1782\u17BD\u179A\u1798\u17B6\u1793"},set:{unit:"\u1792\u17B6\u178F\u17BB",verb:"\u1782\u17BD\u179A\u1798\u17B6\u1793"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"\u1798\u17B7\u1793\u1798\u17C2\u1793\u1787\u17B6\u179B\u17C1\u1781 (NaN)":"\u179B\u17C1\u1781";case"object":{if(Array.isArray(t))return"\u17A2\u17B6\u179A\u17C1 (Array)";if(t===null)return"\u1782\u17D2\u1798\u17B6\u1793\u178F\u1798\u17D2\u179B\u17C3 (null)";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"\u1791\u17B7\u1793\u17D2\u1793\u1793\u17D0\u1799\u1794\u1789\u17D2\u1785\u17BC\u179B",email:"\u17A2\u17B6\u179F\u1799\u178A\u17D2\u178B\u17B6\u1793\u17A2\u17CA\u17B8\u1798\u17C2\u179B",url:"URL",emoji:"\u179F\u1789\u17D2\u1789\u17B6\u17A2\u17B6\u179A\u1798\u17D2\u1798\u178E\u17CD",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"\u1780\u17B6\u179B\u1794\u179A\u17B7\u1785\u17D2\u1786\u17C1\u1791 \u1793\u17B7\u1784\u1798\u17C9\u17C4\u1784 ISO",date:"\u1780\u17B6\u179B\u1794\u179A\u17B7\u1785\u17D2\u1786\u17C1\u1791 ISO",time:"\u1798\u17C9\u17C4\u1784 ISO",duration:"\u179A\u1799\u17C8\u1796\u17C1\u179B ISO",ipv4:"\u17A2\u17B6\u179F\u1799\u178A\u17D2\u178B\u17B6\u1793 IPv4",ipv6:"\u17A2\u17B6\u179F\u1799\u178A\u17D2\u178B\u17B6\u1793 IPv6",cidrv4:"\u178A\u17C2\u1793\u17A2\u17B6\u179F\u1799\u178A\u17D2\u178B\u17B6\u1793 IPv4",cidrv6:"\u178A\u17C2\u1793\u17A2\u17B6\u179F\u1799\u178A\u17D2\u178B\u17B6\u1793 IPv6",base64:"\u1781\u17D2\u179F\u17C2\u17A2\u1780\u17D2\u179F\u179A\u17A2\u17CA\u17B7\u1780\u17BC\u178A base64",base64url:"\u1781\u17D2\u179F\u17C2\u17A2\u1780\u17D2\u179F\u179A\u17A2\u17CA\u17B7\u1780\u17BC\u178A base64url",json_string:"\u1781\u17D2\u179F\u17C2\u17A2\u1780\u17D2\u179F\u179A JSON",e164:"\u179B\u17C1\u1781 E.164",jwt:"JWT",template_literal:"\u1791\u17B7\u1793\u17D2\u1793\u1793\u17D0\u1799\u1794\u1789\u17D2\u1785\u17BC\u179B"};return t=>{switch(t.code){case"invalid_type":return`\u1791\u17B7\u1793\u17D2\u1793\u1793\u17D0\u1799\u1794\u1789\u17D2\u1785\u17BC\u179B\u1798\u17B7\u1793\u178F\u17D2\u179A\u17B9\u1798\u178F\u17D2\u179A\u17BC\u179C\u17D6 \u178F\u17D2\u179A\u17BC\u179C\u1780\u17B6\u179A ${t.expected} \u1794\u17C9\u17BB\u1793\u17D2\u178F\u17C2\u1791\u1791\u17BD\u179B\u1794\u17B6\u1793 ${r(t.input)}`;case"invalid_value":return t.values.length===1?`\u1791\u17B7\u1793\u17D2\u1793\u1793\u17D0\u1799\u1794\u1789\u17D2\u1785\u17BC\u179B\u1798\u17B7\u1793\u178F\u17D2\u179A\u17B9\u1798\u178F\u17D2\u179A\u17BC\u179C\u17D6 \u178F\u17D2\u179A\u17BC\u179C\u1780\u17B6\u179A ${A(t.values[0])}`:`\u1787\u1798\u17D2\u179A\u17BE\u179F\u1798\u17B7\u1793\u178F\u17D2\u179A\u17B9\u1798\u178F\u17D2\u179A\u17BC\u179C\u17D6 \u178F\u17D2\u179A\u17BC\u179C\u1787\u17B6\u1798\u17BD\u1799\u1780\u17D2\u1793\u17BB\u1784\u1785\u17C6\u178E\u17C4\u1798 ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`\u1792\u17C6\u1796\u17C1\u1780\u17D6 \u178F\u17D2\u179A\u17BC\u179C\u1780\u17B6\u179A ${t.origin??"\u178F\u1798\u17D2\u179B\u17C3"} ${o} ${t.maximum.toString()} ${s.unit??"\u1792\u17B6\u178F\u17BB"}`:`\u1792\u17C6\u1796\u17C1\u1780\u17D6 \u178F\u17D2\u179A\u17BC\u179C\u1780\u17B6\u179A ${t.origin??"\u178F\u1798\u17D2\u179B\u17C3"} ${o} ${t.maximum.toString()}`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`\u178F\u17BC\u1785\u1796\u17C1\u1780\u17D6 \u178F\u17D2\u179A\u17BC\u179C\u1780\u17B6\u179A ${t.origin} ${o} ${t.minimum.toString()} ${s.unit}`:`\u178F\u17BC\u1785\u1796\u17C1\u1780\u17D6 \u178F\u17D2\u179A\u17BC\u179C\u1780\u17B6\u179A ${t.origin} ${o} ${t.minimum.toString()}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`\u1781\u17D2\u179F\u17C2\u17A2\u1780\u17D2\u179F\u179A\u1798\u17B7\u1793\u178F\u17D2\u179A\u17B9\u1798\u178F\u17D2\u179A\u17BC\u179C\u17D6 \u178F\u17D2\u179A\u17BC\u179C\u1785\u17B6\u1794\u17CB\u1795\u17D2\u178F\u17BE\u1798\u178A\u17C4\u1799 "${o.prefix}"`:o.format==="ends_with"?`\u1781\u17D2\u179F\u17C2\u17A2\u1780\u17D2\u179F\u179A\u1798\u17B7\u1793\u178F\u17D2\u179A\u17B9\u1798\u178F\u17D2\u179A\u17BC\u179C\u17D6 \u178F\u17D2\u179A\u17BC\u179C\u1794\u1789\u17D2\u1785\u1794\u17CB\u178A\u17C4\u1799 "${o.suffix}"`:o.format==="includes"?`\u1781\u17D2\u179F\u17C2\u17A2\u1780\u17D2\u179F\u179A\u1798\u17B7\u1793\u178F\u17D2\u179A\u17B9\u1798\u178F\u17D2\u179A\u17BC\u179C\u17D6 \u178F\u17D2\u179A\u17BC\u179C\u1798\u17B6\u1793 "${o.includes}"`:o.format==="regex"?`\u1781\u17D2\u179F\u17C2\u17A2\u1780\u17D2\u179F\u179A\u1798\u17B7\u1793\u178F\u17D2\u179A\u17B9\u1798\u178F\u17D2\u179A\u17BC\u179C\u17D6 \u178F\u17D2\u179A\u17BC\u179C\u178F\u17C2\u1795\u17D2\u1782\u17BC\u1795\u17D2\u1782\u1784\u1793\u17B9\u1784\u1791\u1798\u17D2\u179A\u1784\u17CB\u178A\u17C2\u179B\u1794\u17B6\u1793\u1780\u17C6\u178E\u178F\u17CB ${o.pattern}`:`\u1798\u17B7\u1793\u178F\u17D2\u179A\u17B9\u1798\u178F\u17D2\u179A\u17BC\u179C\u17D6 ${i[o.format]??t.format}`}case"not_multiple_of":return`\u179B\u17C1\u1781\u1798\u17B7\u1793\u178F\u17D2\u179A\u17B9\u1798\u178F\u17D2\u179A\u17BC\u179C\u17D6 \u178F\u17D2\u179A\u17BC\u179C\u178F\u17C2\u1787\u17B6\u1796\u17A0\u17BB\u1782\u17BB\u178E\u1793\u17C3 ${t.divisor}`;case"unrecognized_keys":return`\u179A\u1780\u1783\u17BE\u1789\u179F\u17C4\u1798\u17B7\u1793\u179F\u17D2\u1782\u17B6\u179B\u17CB\u17D6 ${_(t.keys,", ")}`;case"invalid_key":return`\u179F\u17C4\u1798\u17B7\u1793\u178F\u17D2\u179A\u17B9\u1798\u178F\u17D2\u179A\u17BC\u179C\u1793\u17C5\u1780\u17D2\u1793\u17BB\u1784 ${t.origin}`;case"invalid_union":return"\u1791\u17B7\u1793\u17D2\u1793\u1793\u17D0\u1799\u1798\u17B7\u1793\u178F\u17D2\u179A\u17B9\u1798\u178F\u17D2\u179A\u17BC\u179C";case"invalid_element":return`\u1791\u17B7\u1793\u17D2\u1793\u1793\u17D0\u1799\u1798\u17B7\u1793\u178F\u17D2\u179A\u17B9\u1798\u178F\u17D2\u179A\u17BC\u179C\u1793\u17C5\u1780\u17D2\u1793\u17BB\u1784 ${t.origin}`;default:return"\u1791\u17B7\u1793\u17D2\u1793\u1793\u17D0\u1799\u1798\u17B7\u1793\u178F\u17D2\u179A\u17B9\u1798\u178F\u17D2\u179A\u17BC\u179C"}}};function hg(){return{localeError:qw()}}var Jw=()=>{let n={string:{unit:"\uBB38\uC790",verb:"to have"},file:{unit:"\uBC14\uC774\uD2B8",verb:"to have"},array:{unit:"\uAC1C",verb:"to have"},set:{unit:"\uAC1C",verb:"to have"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"number";case"object":{if(Array.isArray(t))return"array";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"\uC785\uB825",email:"\uC774\uBA54\uC77C \uC8FC\uC18C",url:"URL",emoji:"\uC774\uBAA8\uC9C0",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO \uB0A0\uC9DC\uC2DC\uAC04",date:"ISO \uB0A0\uC9DC",time:"ISO \uC2DC\uAC04",duration:"ISO \uAE30\uAC04",ipv4:"IPv4 \uC8FC\uC18C",ipv6:"IPv6 \uC8FC\uC18C",cidrv4:"IPv4 \uBC94\uC704",cidrv6:"IPv6 \uBC94\uC704",base64:"base64 \uC778\uCF54\uB529 \uBB38\uC790\uC5F4",base64url:"base64url \uC778\uCF54\uB529 \uBB38\uC790\uC5F4",json_string:"JSON \uBB38\uC790\uC5F4",e164:"E.164 \uBC88\uD638",jwt:"JWT",template_literal:"\uC785\uB825"};return t=>{switch(t.code){case"invalid_type":return`\uC798\uBABB\uB41C \uC785\uB825: \uC608\uC0C1 \uD0C0\uC785\uC740 ${t.expected}, \uBC1B\uC740 \uD0C0\uC785\uC740 ${r(t.input)}\uC785\uB2C8\uB2E4`;case"invalid_value":return t.values.length===1?`\uC798\uBABB\uB41C \uC785\uB825: \uAC12\uC740 ${A(t.values[0])} \uC774\uC5B4\uC57C \uD569\uB2C8\uB2E4`:`\uC798\uBABB\uB41C \uC635\uC158: ${_(t.values,"\uB610\uB294 ")} \uC911 \uD558\uB098\uC5EC\uC57C \uD569\uB2C8\uB2E4`;case"too_big":{let o=t.inclusive?"\uC774\uD558":"\uBBF8\uB9CC",s=o==="\uBBF8\uB9CC"?"\uC774\uC5B4\uC57C \uD569\uB2C8\uB2E4":"\uC5EC\uC57C \uD569\uB2C8\uB2E4",a=e(t.origin),c=a?.unit??"\uC694\uC18C";return a?`${t.origin??"\uAC12"}\uC774 \uB108\uBB34 \uD07D\uB2C8\uB2E4: ${t.maximum.toString()}${c} ${o}${s}`:`${t.origin??"\uAC12"}\uC774 \uB108\uBB34 \uD07D\uB2C8\uB2E4: ${t.maximum.toString()} ${o}${s}`}case"too_small":{let o=t.inclusive?"\uC774\uC0C1":"\uCD08\uACFC",s=o==="\uC774\uC0C1"?"\uC774\uC5B4\uC57C \uD569\uB2C8\uB2E4":"\uC5EC\uC57C \uD569\uB2C8\uB2E4",a=e(t.origin),c=a?.unit??"\uC694\uC18C";return a?`${t.origin??"\uAC12"}\uC774 \uB108\uBB34 \uC791\uC2B5\uB2C8\uB2E4: ${t.minimum.toString()}${c} ${o}${s}`:`${t.origin??"\uAC12"}\uC774 \uB108\uBB34 \uC791\uC2B5\uB2C8\uB2E4: ${t.minimum.toString()} ${o}${s}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`\uC798\uBABB\uB41C \uBB38\uC790\uC5F4: "${o.prefix}"(\uC73C)\uB85C \uC2DC\uC791\uD574\uC57C \uD569\uB2C8\uB2E4`:o.format==="ends_with"?`\uC798\uBABB\uB41C \uBB38\uC790\uC5F4: "${o.suffix}"(\uC73C)\uB85C \uB05D\uB098\uC57C \uD569\uB2C8\uB2E4`:o.format==="includes"?`\uC798\uBABB\uB41C \uBB38\uC790\uC5F4: "${o.includes}"\uC744(\uB97C) \uD3EC\uD568\uD574\uC57C \uD569\uB2C8\uB2E4`:o.format==="regex"?`\uC798\uBABB\uB41C \uBB38\uC790\uC5F4: \uC815\uADDC\uC2DD ${o.pattern} \uD328\uD134\uACFC \uC77C\uCE58\uD574\uC57C \uD569\uB2C8\uB2E4`:`\uC798\uBABB\uB41C ${i[o.format]??t.format}`}case"not_multiple_of":return`\uC798\uBABB\uB41C \uC22B\uC790: ${t.divisor}\uC758 \uBC30\uC218\uC5EC\uC57C \uD569\uB2C8\uB2E4`;case"unrecognized_keys":return`\uC778\uC2DD\uD560 \uC218 \uC5C6\uB294 \uD0A4: ${_(t.keys,", ")}`;case"invalid_key":return`\uC798\uBABB\uB41C \uD0A4: ${t.origin}`;case"invalid_union":return"\uC798\uBABB\uB41C \uC785\uB825";case"invalid_element":return`\uC798\uBABB\uB41C \uAC12: ${t.origin}`;default:return"\uC798\uBABB\uB41C \uC785\uB825"}}};function vg(){return{localeError:Jw()}}var Kw=()=>{let n={string:{unit:"\u0437\u043D\u0430\u0446\u0438",verb:"\u0434\u0430 \u0438\u043C\u0430\u0430\u0442"},file:{unit:"\u0431\u0430\u0458\u0442\u0438",verb:"\u0434\u0430 \u0438\u043C\u0430\u0430\u0442"},array:{unit:"\u0441\u0442\u0430\u0432\u043A\u0438",verb:"\u0434\u0430 \u0438\u043C\u0430\u0430\u0442"},set:{unit:"\u0441\u0442\u0430\u0432\u043A\u0438",verb:"\u0434\u0430 \u0438\u043C\u0430\u0430\u0442"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"\u0431\u0440\u043E\u0458";case"object":{if(Array.isArray(t))return"\u043D\u0438\u0437\u0430";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"\u0432\u043D\u0435\u0441",email:"\u0430\u0434\u0440\u0435\u0441\u0430 \u043D\u0430 \u0435-\u043F\u043E\u0448\u0442\u0430",url:"URL",emoji:"\u0435\u043C\u043E\u045F\u0438",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO \u0434\u0430\u0442\u0443\u043C \u0438 \u0432\u0440\u0435\u043C\u0435",date:"ISO \u0434\u0430\u0442\u0443\u043C",time:"ISO \u0432\u0440\u0435\u043C\u0435",duration:"ISO \u0432\u0440\u0435\u043C\u0435\u0442\u0440\u0430\u0435\u045A\u0435",ipv4:"IPv4 \u0430\u0434\u0440\u0435\u0441\u0430",ipv6:"IPv6 \u0430\u0434\u0440\u0435\u0441\u0430",cidrv4:"IPv4 \u043E\u043F\u0441\u0435\u0433",cidrv6:"IPv6 \u043E\u043F\u0441\u0435\u0433",base64:"base64-\u0435\u043D\u043A\u043E\u0434\u0438\u0440\u0430\u043D\u0430 \u043D\u0438\u0437\u0430",base64url:"base64url-\u0435\u043D\u043A\u043E\u0434\u0438\u0440\u0430\u043D\u0430 \u043D\u0438\u0437\u0430",json_string:"JSON \u043D\u0438\u0437\u0430",e164:"E.164 \u0431\u0440\u043E\u0458",jwt:"JWT",template_literal:"\u0432\u043D\u0435\u0441"};return t=>{switch(t.code){case"invalid_type":return`\u0413\u0440\u0435\u0448\u0435\u043D \u0432\u043D\u0435\u0441: \u0441\u0435 \u043E\u0447\u0435\u043A\u0443\u0432\u0430 ${t.expected}, \u043F\u0440\u0438\u043C\u0435\u043D\u043E ${r(t.input)}`;case"invalid_value":return t.values.length===1?`Invalid input: expected ${A(t.values[0])}`:`\u0413\u0440\u0435\u0448\u0430\u043D\u0430 \u043E\u043F\u0446\u0438\u0458\u0430: \u0441\u0435 \u043E\u0447\u0435\u043A\u0443\u0432\u0430 \u0435\u0434\u043D\u0430 ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`\u041F\u0440\u0435\u043C\u043D\u043E\u0433\u0443 \u0433\u043E\u043B\u0435\u043C: \u0441\u0435 \u043E\u0447\u0435\u043A\u0443\u0432\u0430 ${t.origin??"\u0432\u0440\u0435\u0434\u043D\u043E\u0441\u0442\u0430"} \u0434\u0430 \u0438\u043C\u0430 ${o}${t.maximum.toString()} ${s.unit??"\u0435\u043B\u0435\u043C\u0435\u043D\u0442\u0438"}`:`\u041F\u0440\u0435\u043C\u043D\u043E\u0433\u0443 \u0433\u043E\u043B\u0435\u043C: \u0441\u0435 \u043E\u0447\u0435\u043A\u0443\u0432\u0430 ${t.origin??"\u0432\u0440\u0435\u0434\u043D\u043E\u0441\u0442\u0430"} \u0434\u0430 \u0431\u0438\u0434\u0435 ${o}${t.maximum.toString()}`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`\u041F\u0440\u0435\u043C\u043D\u043E\u0433\u0443 \u043C\u0430\u043B: \u0441\u0435 \u043E\u0447\u0435\u043A\u0443\u0432\u0430 ${t.origin} \u0434\u0430 \u0438\u043C\u0430 ${o}${t.minimum.toString()} ${s.unit}`:`\u041F\u0440\u0435\u043C\u043D\u043E\u0433\u0443 \u043C\u0430\u043B: \u0441\u0435 \u043E\u0447\u0435\u043A\u0443\u0432\u0430 ${t.origin} \u0434\u0430 \u0431\u0438\u0434\u0435 ${o}${t.minimum.toString()}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`\u041D\u0435\u0432\u0430\u0436\u0435\u0447\u043A\u0430 \u043D\u0438\u0437\u0430: \u043C\u043E\u0440\u0430 \u0434\u0430 \u0437\u0430\u043F\u043E\u0447\u043D\u0443\u0432\u0430 \u0441\u043E "${o.prefix}"`:o.format==="ends_with"?`\u041D\u0435\u0432\u0430\u0436\u0435\u0447\u043A\u0430 \u043D\u0438\u0437\u0430: \u043C\u043E\u0440\u0430 \u0434\u0430 \u0437\u0430\u0432\u0440\u0448\u0443\u0432\u0430 \u0441\u043E "${o.suffix}"`:o.format==="includes"?`\u041D\u0435\u0432\u0430\u0436\u0435\u0447\u043A\u0430 \u043D\u0438\u0437\u0430: \u043C\u043E\u0440\u0430 \u0434\u0430 \u0432\u043A\u043B\u0443\u0447\u0443\u0432\u0430 "${o.includes}"`:o.format==="regex"?`\u041D\u0435\u0432\u0430\u0436\u0435\u0447\u043A\u0430 \u043D\u0438\u0437\u0430: \u043C\u043E\u0440\u0430 \u0434\u0430 \u043E\u0434\u0433\u043E\u0430\u0440\u0430 \u043D\u0430 \u043F\u0430\u0442\u0435\u0440\u043D\u043E\u0442 ${o.pattern}`:`Invalid ${i[o.format]??t.format}`}case"not_multiple_of":return`\u0413\u0440\u0435\u0448\u0435\u043D \u0431\u0440\u043E\u0458: \u043C\u043E\u0440\u0430 \u0434\u0430 \u0431\u0438\u0434\u0435 \u0434\u0435\u043B\u0438\u0432 \u0441\u043E ${t.divisor}`;case"unrecognized_keys":return`${t.keys.length>1?"\u041D\u0435\u043F\u0440\u0435\u043F\u043E\u0437\u043D\u0430\u0435\u043D\u0438 \u043A\u043B\u0443\u0447\u0435\u0432\u0438":"\u041D\u0435\u043F\u0440\u0435\u043F\u043E\u0437\u043D\u0430\u0435\u043D \u043A\u043B\u0443\u0447"}: ${_(t.keys,", ")}`;case"invalid_key":return`\u0413\u0440\u0435\u0448\u0435\u043D \u043A\u043B\u0443\u0447 \u0432\u043E ${t.origin}`;case"invalid_union":return"\u0413\u0440\u0435\u0448\u0435\u043D \u0432\u043D\u0435\u0441";case"invalid_element":return`\u0413\u0440\u0435\u0448\u043D\u0430 \u0432\u0440\u0435\u0434\u043D\u043E\u0441\u0442 \u0432\u043E ${t.origin}`;default:return"\u0413\u0440\u0435\u0448\u0435\u043D \u0432\u043D\u0435\u0441"}}};function yg(){return{localeError:Kw()}}var Qw=()=>{let n={string:{unit:"aksara",verb:"mempunyai"},file:{unit:"bait",verb:"mempunyai"},array:{unit:"elemen",verb:"mempunyai"},set:{unit:"elemen",verb:"mempunyai"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"nombor";case"object":{if(Array.isArray(t))return"array";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"input",email:"alamat e-mel",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"tarikh masa ISO",date:"tarikh ISO",time:"masa ISO",duration:"tempoh ISO",ipv4:"alamat IPv4",ipv6:"alamat IPv6",cidrv4:"julat IPv4",cidrv6:"julat IPv6",base64:"string dikodkan base64",base64url:"string dikodkan base64url",json_string:"string JSON",e164:"nombor E.164",jwt:"JWT",template_literal:"input"};return t=>{switch(t.code){case"invalid_type":return`Input tidak sah: dijangka ${t.expected}, diterima ${r(t.input)}`;case"invalid_value":return t.values.length===1?`Input tidak sah: dijangka ${A(t.values[0])}`:`Pilihan tidak sah: dijangka salah satu daripada ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`Terlalu besar: dijangka ${t.origin??"nilai"} ${s.verb} ${o}${t.maximum.toString()} ${s.unit??"elemen"}`:`Terlalu besar: dijangka ${t.origin??"nilai"} adalah ${o}${t.maximum.toString()}`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`Terlalu kecil: dijangka ${t.origin} ${s.verb} ${o}${t.minimum.toString()} ${s.unit}`:`Terlalu kecil: dijangka ${t.origin} adalah ${o}${t.minimum.toString()}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`String tidak sah: mesti bermula dengan "${o.prefix}"`:o.format==="ends_with"?`String tidak sah: mesti berakhir dengan "${o.suffix}"`:o.format==="includes"?`String tidak sah: mesti mengandungi "${o.includes}"`:o.format==="regex"?`String tidak sah: mesti sepadan dengan corak ${o.pattern}`:`${i[o.format]??t.format} tidak sah`}case"not_multiple_of":return`Nombor tidak sah: perlu gandaan ${t.divisor}`;case"unrecognized_keys":return`Kunci tidak dikenali: ${_(t.keys,", ")}`;case"invalid_key":return`Kunci tidak sah dalam ${t.origin}`;case"invalid_union":return"Input tidak sah";case"invalid_element":return`Nilai tidak sah dalam ${t.origin}`;default:return"Input tidak sah"}}};function bg(){return{localeError:Qw()}}var Yw=()=>{let n={string:{unit:"tekens"},file:{unit:"bytes"},array:{unit:"elementen"},set:{unit:"elementen"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"getal";case"object":{if(Array.isArray(t))return"array";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"invoer",email:"emailadres",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datum en tijd",date:"ISO datum",time:"ISO tijd",duration:"ISO duur",ipv4:"IPv4-adres",ipv6:"IPv6-adres",cidrv4:"IPv4-bereik",cidrv6:"IPv6-bereik",base64:"base64-gecodeerde tekst",base64url:"base64 URL-gecodeerde tekst",json_string:"JSON string",e164:"E.164-nummer",jwt:"JWT",template_literal:"invoer"};return t=>{switch(t.code){case"invalid_type":return`Ongeldige invoer: verwacht ${t.expected}, ontving ${r(t.input)}`;case"invalid_value":return t.values.length===1?`Ongeldige invoer: verwacht ${A(t.values[0])}`:`Ongeldige optie: verwacht \xE9\xE9n van ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`Te lang: verwacht dat ${t.origin??"waarde"} ${o}${t.maximum.toString()} ${s.unit??"elementen"} bevat`:`Te lang: verwacht dat ${t.origin??"waarde"} ${o}${t.maximum.toString()} is`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`Te kort: verwacht dat ${t.origin} ${o}${t.minimum.toString()} ${s.unit} bevat`:`Te kort: verwacht dat ${t.origin} ${o}${t.minimum.toString()} is`}case"invalid_format":{let o=t;return o.format==="starts_with"?`Ongeldige tekst: moet met "${o.prefix}" beginnen`:o.format==="ends_with"?`Ongeldige tekst: moet op "${o.suffix}" eindigen`:o.format==="includes"?`Ongeldige tekst: moet "${o.includes}" bevatten`:o.format==="regex"?`Ongeldige tekst: moet overeenkomen met patroon ${o.pattern}`:`Ongeldig: ${i[o.format]??t.format}`}case"not_multiple_of":return`Ongeldig getal: moet een veelvoud van ${t.divisor} zijn`;case"unrecognized_keys":return`Onbekende key${t.keys.length>1?"s":""}: ${_(t.keys,", ")}`;case"invalid_key":return`Ongeldige key in ${t.origin}`;case"invalid_union":return"Ongeldige invoer";case"invalid_element":return`Ongeldige waarde in ${t.origin}`;default:return"Ongeldige invoer"}}};function wg(){return{localeError:Yw()}}var Xw=()=>{let n={string:{unit:"tegn",verb:"\xE5 ha"},file:{unit:"bytes",verb:"\xE5 ha"},array:{unit:"elementer",verb:"\xE5 inneholde"},set:{unit:"elementer",verb:"\xE5 inneholde"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"tall";case"object":{if(Array.isArray(t))return"liste";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"input",email:"e-postadresse",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO dato- og klokkeslett",date:"ISO-dato",time:"ISO-klokkeslett",duration:"ISO-varighet",ipv4:"IPv4-omr\xE5de",ipv6:"IPv6-omr\xE5de",cidrv4:"IPv4-spekter",cidrv6:"IPv6-spekter",base64:"base64-enkodet streng",base64url:"base64url-enkodet streng",json_string:"JSON-streng",e164:"E.164-nummer",jwt:"JWT",template_literal:"input"};return t=>{switch(t.code){case"invalid_type":return`Ugyldig input: forventet ${t.expected}, fikk ${r(t.input)}`;case"invalid_value":return t.values.length===1?`Ugyldig verdi: forventet ${A(t.values[0])}`:`Ugyldig valg: forventet en av ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`For stor(t): forventet ${t.origin??"value"} til \xE5 ha ${o}${t.maximum.toString()} ${s.unit??"elementer"}`:`For stor(t): forventet ${t.origin??"value"} til \xE5 ha ${o}${t.maximum.toString()}`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`For lite(n): forventet ${t.origin} til \xE5 ha ${o}${t.minimum.toString()} ${s.unit}`:`For lite(n): forventet ${t.origin} til \xE5 ha ${o}${t.minimum.toString()}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`Ugyldig streng: m\xE5 starte med "${o.prefix}"`:o.format==="ends_with"?`Ugyldig streng: m\xE5 ende med "${o.suffix}"`:o.format==="includes"?`Ugyldig streng: m\xE5 inneholde "${o.includes}"`:o.format==="regex"?`Ugyldig streng: m\xE5 matche m\xF8nsteret ${o.pattern}`:`Ugyldig ${i[o.format]??t.format}`}case"not_multiple_of":return`Ugyldig tall: m\xE5 v\xE6re et multiplum av ${t.divisor}`;case"unrecognized_keys":return`${t.keys.length>1?"Ukjente n\xF8kler":"Ukjent n\xF8kkel"}: ${_(t.keys,", ")}`;case"invalid_key":return`Ugyldig n\xF8kkel i ${t.origin}`;case"invalid_union":return"Ugyldig input";case"invalid_element":return`Ugyldig verdi i ${t.origin}`;default:return"Ugyldig input"}}};function Sg(){return{localeError:Xw()}}var eS=()=>{let n={string:{unit:"harf",verb:"olmal\u0131d\u0131r"},file:{unit:"bayt",verb:"olmal\u0131d\u0131r"},array:{unit:"unsur",verb:"olmal\u0131d\u0131r"},set:{unit:"unsur",verb:"olmal\u0131d\u0131r"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"numara";case"object":{if(Array.isArray(t))return"saf";if(t===null)return"gayb";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"giren",email:"epostag\xE2h",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO heng\xE2m\u0131",date:"ISO tarihi",time:"ISO zaman\u0131",duration:"ISO m\xFCddeti",ipv4:"IPv4 ni\u015F\xE2n\u0131",ipv6:"IPv6 ni\u015F\xE2n\u0131",cidrv4:"IPv4 menzili",cidrv6:"IPv6 menzili",base64:"base64-\u015Fifreli metin",base64url:"base64url-\u015Fifreli metin",json_string:"JSON metin",e164:"E.164 say\u0131s\u0131",jwt:"JWT",template_literal:"giren"};return t=>{switch(t.code){case"invalid_type":return`F\xE2sit giren: umulan ${t.expected}, al\u0131nan ${r(t.input)}`;case"invalid_value":return t.values.length===1?`F\xE2sit giren: umulan ${A(t.values[0])}`:`F\xE2sit tercih: m\xFBteberler ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`Fazla b\xFCy\xFCk: ${t.origin??"value"}, ${o}${t.maximum.toString()} ${s.unit??"elements"} sahip olmal\u0131yd\u0131.`:`Fazla b\xFCy\xFCk: ${t.origin??"value"}, ${o}${t.maximum.toString()} olmal\u0131yd\u0131.`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`Fazla k\xFC\xE7\xFCk: ${t.origin}, ${o}${t.minimum.toString()} ${s.unit} sahip olmal\u0131yd\u0131.`:`Fazla k\xFC\xE7\xFCk: ${t.origin}, ${o}${t.minimum.toString()} olmal\u0131yd\u0131.`}case"invalid_format":{let o=t;return o.format==="starts_with"?`F\xE2sit metin: "${o.prefix}" ile ba\u015Flamal\u0131.`:o.format==="ends_with"?`F\xE2sit metin: "${o.suffix}" ile bitmeli.`:o.format==="includes"?`F\xE2sit metin: "${o.includes}" ihtiv\xE2 etmeli.`:o.format==="regex"?`F\xE2sit metin: ${o.pattern} nak\u015F\u0131na uymal\u0131.`:`F\xE2sit ${i[o.format]??t.format}`}case"not_multiple_of":return`F\xE2sit say\u0131: ${t.divisor} kat\u0131 olmal\u0131yd\u0131.`;case"unrecognized_keys":return`Tan\u0131nmayan anahtar ${t.keys.length>1?"s":""}: ${_(t.keys,", ")}`;case"invalid_key":return`${t.origin} i\xE7in tan\u0131nmayan anahtar var.`;case"invalid_union":return"Giren tan\u0131namad\u0131.";case"invalid_element":return`${t.origin} i\xE7in tan\u0131nmayan k\u0131ymet var.`;default:return"K\u0131ymet tan\u0131namad\u0131."}}};function $g(){return{localeError:eS()}}var tS=()=>{let n={string:{unit:"\u062A\u0648\u06A9\u064A",verb:"\u0648\u0644\u0631\u064A"},file:{unit:"\u0628\u0627\u06CC\u067C\u0633",verb:"\u0648\u0644\u0631\u064A"},array:{unit:"\u062A\u0648\u06A9\u064A",verb:"\u0648\u0644\u0631\u064A"},set:{unit:"\u062A\u0648\u06A9\u064A",verb:"\u0648\u0644\u0631\u064A"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"\u0639\u062F\u062F";case"object":{if(Array.isArray(t))return"\u0627\u0631\u06D0";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"\u0648\u0631\u0648\u062F\u064A",email:"\u0628\u0631\u06CC\u069A\u0646\u0627\u0644\u06CC\u06A9",url:"\u06CC\u0648 \u0622\u0631 \u0627\u0644",emoji:"\u0627\u06CC\u0645\u0648\u062C\u064A",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"\u0646\u06CC\u067C\u0647 \u0627\u0648 \u0648\u062E\u062A",date:"\u0646\u06D0\u067C\u0647",time:"\u0648\u062E\u062A",duration:"\u0645\u0648\u062F\u0647",ipv4:"\u062F IPv4 \u067E\u062A\u0647",ipv6:"\u062F IPv6 \u067E\u062A\u0647",cidrv4:"\u062F IPv4 \u0633\u0627\u062D\u0647",cidrv6:"\u062F IPv6 \u0633\u0627\u062D\u0647",base64:"base64-encoded \u0645\u062A\u0646",base64url:"base64url-encoded \u0645\u062A\u0646",json_string:"JSON \u0645\u062A\u0646",e164:"\u062F E.164 \u0634\u0645\u06D0\u0631\u0647",jwt:"JWT",template_literal:"\u0648\u0631\u0648\u062F\u064A"};return t=>{switch(t.code){case"invalid_type":return`\u0646\u0627\u0633\u0645 \u0648\u0631\u0648\u062F\u064A: \u0628\u0627\u06CC\u062F ${t.expected} \u0648\u0627\u06CC, \u0645\u06AB\u0631 ${r(t.input)} \u062A\u0631\u0644\u0627\u0633\u0647 \u0634\u0648`;case"invalid_value":return t.values.length===1?`\u0646\u0627\u0633\u0645 \u0648\u0631\u0648\u062F\u064A: \u0628\u0627\u06CC\u062F ${A(t.values[0])} \u0648\u0627\u06CC`:`\u0646\u0627\u0633\u0645 \u0627\u0646\u062A\u062E\u0627\u0628: \u0628\u0627\u06CC\u062F \u06CC\u0648 \u0644\u0647 ${_(t.values,"|")} \u0685\u062E\u0647 \u0648\u0627\u06CC`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`\u0689\u06CC\u0631 \u0644\u0648\u06CC: ${t.origin??"\u0627\u0631\u0632\u069A\u062A"} \u0628\u0627\u06CC\u062F ${o}${t.maximum.toString()} ${s.unit??"\u0639\u0646\u0635\u0631\u0648\u0646\u0647"} \u0648\u0644\u0631\u064A`:`\u0689\u06CC\u0631 \u0644\u0648\u06CC: ${t.origin??"\u0627\u0631\u0632\u069A\u062A"} \u0628\u0627\u06CC\u062F ${o}${t.maximum.toString()} \u0648\u064A`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`\u0689\u06CC\u0631 \u06A9\u0648\u0686\u0646\u06CC: ${t.origin} \u0628\u0627\u06CC\u062F ${o}${t.minimum.toString()} ${s.unit} \u0648\u0644\u0631\u064A`:`\u0689\u06CC\u0631 \u06A9\u0648\u0686\u0646\u06CC: ${t.origin} \u0628\u0627\u06CC\u062F ${o}${t.minimum.toString()} \u0648\u064A`}case"invalid_format":{let o=t;return o.format==="starts_with"?`\u0646\u0627\u0633\u0645 \u0645\u062A\u0646: \u0628\u0627\u06CC\u062F \u062F "${o.prefix}" \u0633\u0631\u0647 \u067E\u06CC\u0644 \u0634\u064A`:o.format==="ends_with"?`\u0646\u0627\u0633\u0645 \u0645\u062A\u0646: \u0628\u0627\u06CC\u062F \u062F "${o.suffix}" \u0633\u0631\u0647 \u067E\u0627\u06CC \u062A\u0647 \u0648\u0631\u0633\u064A\u0696\u064A`:o.format==="includes"?`\u0646\u0627\u0633\u0645 \u0645\u062A\u0646: \u0628\u0627\u06CC\u062F "${o.includes}" \u0648\u0644\u0631\u064A`:o.format==="regex"?`\u0646\u0627\u0633\u0645 \u0645\u062A\u0646: \u0628\u0627\u06CC\u062F \u062F ${o.pattern} \u0633\u0631\u0647 \u0645\u0637\u0627\u0628\u0642\u062A \u0648\u0644\u0631\u064A`:`${i[o.format]??t.format} \u0646\u0627\u0633\u0645 \u062F\u06CC`}case"not_multiple_of":return`\u0646\u0627\u0633\u0645 \u0639\u062F\u062F: \u0628\u0627\u06CC\u062F \u062F ${t.divisor} \u0645\u0636\u0631\u0628 \u0648\u064A`;case"unrecognized_keys":return`\u0646\u0627\u0633\u0645 ${t.keys.length>1?"\u06A9\u0644\u06CC\u0689\u0648\u0646\u0647":"\u06A9\u0644\u06CC\u0689"}: ${_(t.keys,", ")}`;case"invalid_key":return`\u0646\u0627\u0633\u0645 \u06A9\u0644\u06CC\u0689 \u067E\u0647 ${t.origin} \u06A9\u06D0`;case"invalid_union":return"\u0646\u0627\u0633\u0645\u0647 \u0648\u0631\u0648\u062F\u064A";case"invalid_element":return`\u0646\u0627\u0633\u0645 \u0639\u0646\u0635\u0631 \u067E\u0647 ${t.origin} \u06A9\u06D0`;default:return"\u0646\u0627\u0633\u0645\u0647 \u0648\u0631\u0648\u062F\u064A"}}};function xg(){return{localeError:tS()}}var rS=()=>{let n={string:{unit:"znak\xF3w",verb:"mie\u0107"},file:{unit:"bajt\xF3w",verb:"mie\u0107"},array:{unit:"element\xF3w",verb:"mie\u0107"},set:{unit:"element\xF3w",verb:"mie\u0107"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"liczba";case"object":{if(Array.isArray(t))return"tablica";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"wyra\u017Cenie",email:"adres email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data i godzina w formacie ISO",date:"data w formacie ISO",time:"godzina w formacie ISO",duration:"czas trwania ISO",ipv4:"adres IPv4",ipv6:"adres IPv6",cidrv4:"zakres IPv4",cidrv6:"zakres IPv6",base64:"ci\u0105g znak\xF3w zakodowany w formacie base64",base64url:"ci\u0105g znak\xF3w zakodowany w formacie base64url",json_string:"ci\u0105g znak\xF3w w formacie JSON",e164:"liczba E.164",jwt:"JWT",template_literal:"wej\u015Bcie"};return t=>{switch(t.code){case"invalid_type":return`Nieprawid\u0142owe dane wej\u015Bciowe: oczekiwano ${t.expected}, otrzymano ${r(t.input)}`;case"invalid_value":return t.values.length===1?`Nieprawid\u0142owe dane wej\u015Bciowe: oczekiwano ${A(t.values[0])}`:`Nieprawid\u0142owa opcja: oczekiwano jednej z warto\u015Bci ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`Za du\u017Ca warto\u015B\u0107: oczekiwano, \u017Ce ${t.origin??"warto\u015B\u0107"} b\u0119dzie mie\u0107 ${o}${t.maximum.toString()} ${s.unit??"element\xF3w"}`:`Zbyt du\u017C(y/a/e): oczekiwano, \u017Ce ${t.origin??"warto\u015B\u0107"} b\u0119dzie wynosi\u0107 ${o}${t.maximum.toString()}`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`Za ma\u0142a warto\u015B\u0107: oczekiwano, \u017Ce ${t.origin??"warto\u015B\u0107"} b\u0119dzie mie\u0107 ${o}${t.minimum.toString()} ${s.unit??"element\xF3w"}`:`Zbyt ma\u0142(y/a/e): oczekiwano, \u017Ce ${t.origin??"warto\u015B\u0107"} b\u0119dzie wynosi\u0107 ${o}${t.minimum.toString()}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`Nieprawid\u0142owy ci\u0105g znak\xF3w: musi zaczyna\u0107 si\u0119 od "${o.prefix}"`:o.format==="ends_with"?`Nieprawid\u0142owy ci\u0105g znak\xF3w: musi ko\u0144czy\u0107 si\u0119 na "${o.suffix}"`:o.format==="includes"?`Nieprawid\u0142owy ci\u0105g znak\xF3w: musi zawiera\u0107 "${o.includes}"`:o.format==="regex"?`Nieprawid\u0142owy ci\u0105g znak\xF3w: musi odpowiada\u0107 wzorcowi ${o.pattern}`:`Nieprawid\u0142ow(y/a/e) ${i[o.format]??t.format}`}case"not_multiple_of":return`Nieprawid\u0142owa liczba: musi by\u0107 wielokrotno\u015Bci\u0105 ${t.divisor}`;case"unrecognized_keys":return`Nierozpoznane klucze${t.keys.length>1?"s":""}: ${_(t.keys,", ")}`;case"invalid_key":return`Nieprawid\u0142owy klucz w ${t.origin}`;case"invalid_union":return"Nieprawid\u0142owe dane wej\u015Bciowe";case"invalid_element":return`Nieprawid\u0142owa warto\u015B\u0107 w ${t.origin}`;default:return"Nieprawid\u0142owe dane wej\u015Bciowe"}}};function kg(){return{localeError:rS()}}var nS=()=>{let n={string:{unit:"caracteres",verb:"ter"},file:{unit:"bytes",verb:"ter"},array:{unit:"itens",verb:"ter"},set:{unit:"itens",verb:"ter"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"n\xFAmero";case"object":{if(Array.isArray(t))return"array";if(t===null)return"nulo";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"padr\xE3o",email:"endere\xE7o de e-mail",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data e hora ISO",date:"data ISO",time:"hora ISO",duration:"dura\xE7\xE3o ISO",ipv4:"endere\xE7o IPv4",ipv6:"endere\xE7o IPv6",cidrv4:"faixa de IPv4",cidrv6:"faixa de IPv6",base64:"texto codificado em base64",base64url:"URL codificada em base64",json_string:"texto JSON",e164:"n\xFAmero E.164",jwt:"JWT",template_literal:"entrada"};return t=>{switch(t.code){case"invalid_type":return`Tipo inv\xE1lido: esperado ${t.expected}, recebido ${r(t.input)}`;case"invalid_value":return t.values.length===1?`Entrada inv\xE1lida: esperado ${A(t.values[0])}`:`Op\xE7\xE3o inv\xE1lida: esperada uma das ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`Muito grande: esperado que ${t.origin??"valor"} tivesse ${o}${t.maximum.toString()} ${s.unit??"elementos"}`:`Muito grande: esperado que ${t.origin??"valor"} fosse ${o}${t.maximum.toString()}`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`Muito pequeno: esperado que ${t.origin} tivesse ${o}${t.minimum.toString()} ${s.unit}`:`Muito pequeno: esperado que ${t.origin} fosse ${o}${t.minimum.toString()}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`Texto inv\xE1lido: deve come\xE7ar com "${o.prefix}"`:o.format==="ends_with"?`Texto inv\xE1lido: deve terminar com "${o.suffix}"`:o.format==="includes"?`Texto inv\xE1lido: deve incluir "${o.includes}"`:o.format==="regex"?`Texto inv\xE1lido: deve corresponder ao padr\xE3o ${o.pattern}`:`${i[o.format]??t.format} inv\xE1lido`}case"not_multiple_of":return`N\xFAmero inv\xE1lido: deve ser m\xFAltiplo de ${t.divisor}`;case"unrecognized_keys":return`Chave${t.keys.length>1?"s":""} desconhecida${t.keys.length>1?"s":""}: ${_(t.keys,", ")}`;case"invalid_key":return`Chave inv\xE1lida em ${t.origin}`;case"invalid_union":return"Entrada inv\xE1lida";case"invalid_element":return`Valor inv\xE1lido em ${t.origin}`;default:return"Campo inv\xE1lido"}}};function _g(){return{localeError:nS()}}function Pg(n,e,r,i){let t=Math.abs(n),o=t%10,s=t%100;return s>=11&&s<=19?i:o===1?e:o>=2&&o<=4?r:i}var iS=()=>{let n={string:{unit:{one:"\u0441\u0438\u043C\u0432\u043E\u043B",few:"\u0441\u0438\u043C\u0432\u043E\u043B\u0430",many:"\u0441\u0438\u043C\u0432\u043E\u043B\u043E\u0432"},verb:"\u0438\u043C\u0435\u0442\u044C"},file:{unit:{one:"\u0431\u0430\u0439\u0442",few:"\u0431\u0430\u0439\u0442\u0430",many:"\u0431\u0430\u0439\u0442"},verb:"\u0438\u043C\u0435\u0442\u044C"},array:{unit:{one:"\u044D\u043B\u0435\u043C\u0435\u043D\u0442",few:"\u044D\u043B\u0435\u043C\u0435\u043D\u0442\u0430",many:"\u044D\u043B\u0435\u043C\u0435\u043D\u0442\u043E\u0432"},verb:"\u0438\u043C\u0435\u0442\u044C"},set:{unit:{one:"\u044D\u043B\u0435\u043C\u0435\u043D\u0442",few:"\u044D\u043B\u0435\u043C\u0435\u043D\u0442\u0430",many:"\u044D\u043B\u0435\u043C\u0435\u043D\u0442\u043E\u0432"},verb:"\u0438\u043C\u0435\u0442\u044C"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"\u0447\u0438\u0441\u043B\u043E";case"object":{if(Array.isArray(t))return"\u043C\u0430\u0441\u0441\u0438\u0432";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"\u0432\u0432\u043E\u0434",email:"email \u0430\u0434\u0440\u0435\u0441",url:"URL",emoji:"\u044D\u043C\u043E\u0434\u0437\u0438",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO \u0434\u0430\u0442\u0430 \u0438 \u0432\u0440\u0435\u043C\u044F",date:"ISO \u0434\u0430\u0442\u0430",time:"ISO \u0432\u0440\u0435\u043C\u044F",duration:"ISO \u0434\u043B\u0438\u0442\u0435\u043B\u044C\u043D\u043E\u0441\u0442\u044C",ipv4:"IPv4 \u0430\u0434\u0440\u0435\u0441",ipv6:"IPv6 \u0430\u0434\u0440\u0435\u0441",cidrv4:"IPv4 \u0434\u0438\u0430\u043F\u0430\u0437\u043E\u043D",cidrv6:"IPv6 \u0434\u0438\u0430\u043F\u0430\u0437\u043E\u043D",base64:"\u0441\u0442\u0440\u043E\u043A\u0430 \u0432 \u0444\u043E\u0440\u043C\u0430\u0442\u0435 base64",base64url:"\u0441\u0442\u0440\u043E\u043A\u0430 \u0432 \u0444\u043E\u0440\u043C\u0430\u0442\u0435 base64url",json_string:"JSON \u0441\u0442\u0440\u043E\u043A\u0430",e164:"\u043D\u043E\u043C\u0435\u0440 E.164",jwt:"JWT",template_literal:"\u0432\u0432\u043E\u0434"};return t=>{switch(t.code){case"invalid_type":return`\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u0432\u0432\u043E\u0434: \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C ${t.expected}, \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u043E ${r(t.input)}`;case"invalid_value":return t.values.length===1?`\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u0432\u0432\u043E\u0434: \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C ${A(t.values[0])}`:`\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u0432\u0430\u0440\u0438\u0430\u043D\u0442: \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0434\u043D\u043E \u0438\u0437 ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);if(s){let a=Number(t.maximum),c=Pg(a,s.unit.one,s.unit.few,s.unit.many);return`\u0421\u043B\u0438\u0448\u043A\u043E\u043C \u0431\u043E\u043B\u044C\u0448\u043E\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435: \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C, \u0447\u0442\u043E ${t.origin??"\u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435"} \u0431\u0443\u0434\u0435\u0442 \u0438\u043C\u0435\u0442\u044C ${o}${t.maximum.toString()} ${c}`}return`\u0421\u043B\u0438\u0448\u043A\u043E\u043C \u0431\u043E\u043B\u044C\u0448\u043E\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435: \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C, \u0447\u0442\u043E ${t.origin??"\u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435"} \u0431\u0443\u0434\u0435\u0442 ${o}${t.maximum.toString()}`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);if(s){let a=Number(t.minimum),c=Pg(a,s.unit.one,s.unit.few,s.unit.many);return`\u0421\u043B\u0438\u0448\u043A\u043E\u043C \u043C\u0430\u043B\u0435\u043D\u044C\u043A\u043E\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435: \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C, \u0447\u0442\u043E ${t.origin} \u0431\u0443\u0434\u0435\u0442 \u0438\u043C\u0435\u0442\u044C ${o}${t.minimum.toString()} ${c}`}return`\u0421\u043B\u0438\u0448\u043A\u043E\u043C \u043C\u0430\u043B\u0435\u043D\u044C\u043A\u043E\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435: \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C, \u0447\u0442\u043E ${t.origin} \u0431\u0443\u0434\u0435\u0442 ${o}${t.minimum.toString()}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`\u041D\u0435\u0432\u0435\u0440\u043D\u0430\u044F \u0441\u0442\u0440\u043E\u043A\u0430: \u0434\u043E\u043B\u0436\u043D\u0430 \u043D\u0430\u0447\u0438\u043D\u0430\u0442\u044C\u0441\u044F \u0441 "${o.prefix}"`:o.format==="ends_with"?`\u041D\u0435\u0432\u0435\u0440\u043D\u0430\u044F \u0441\u0442\u0440\u043E\u043A\u0430: \u0434\u043E\u043B\u0436\u043D\u0430 \u0437\u0430\u043A\u0430\u043D\u0447\u0438\u0432\u0430\u0442\u044C\u0441\u044F \u043D\u0430 "${o.suffix}"`:o.format==="includes"?`\u041D\u0435\u0432\u0435\u0440\u043D\u0430\u044F \u0441\u0442\u0440\u043E\u043A\u0430: \u0434\u043E\u043B\u0436\u043D\u0430 \u0441\u043E\u0434\u0435\u0440\u0436\u0430\u0442\u044C "${o.includes}"`:o.format==="regex"?`\u041D\u0435\u0432\u0435\u0440\u043D\u0430\u044F \u0441\u0442\u0440\u043E\u043A\u0430: \u0434\u043E\u043B\u0436\u043D\u0430 \u0441\u043E\u043E\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u043E\u0432\u0430\u0442\u044C \u0448\u0430\u0431\u043B\u043E\u043D\u0443 ${o.pattern}`:`\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 ${i[o.format]??t.format}`}case"not_multiple_of":return`\u041D\u0435\u0432\u0435\u0440\u043D\u043E\u0435 \u0447\u0438\u0441\u043B\u043E: \u0434\u043E\u043B\u0436\u043D\u043E \u0431\u044B\u0442\u044C \u043A\u0440\u0430\u0442\u043D\u044B\u043C ${t.divisor}`;case"unrecognized_keys":return`\u041D\u0435\u0440\u0430\u0441\u043F\u043E\u0437\u043D\u0430\u043D\u043D${t.keys.length>1?"\u044B\u0435":"\u044B\u0439"} \u043A\u043B\u044E\u0447${t.keys.length>1?"\u0438":""}: ${_(t.keys,", ")}`;case"invalid_key":return`\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u043A\u043B\u044E\u0447 \u0432 ${t.origin}`;case"invalid_union":return"\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0435 \u0432\u0445\u043E\u0434\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435";case"invalid_element":return`\u041D\u0435\u0432\u0435\u0440\u043D\u043E\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435 \u0432 ${t.origin}`;default:return"\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0435 \u0432\u0445\u043E\u0434\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435"}}};function Tg(){return{localeError:iS()}}var oS=()=>{let n={string:{unit:"znakov",verb:"imeti"},file:{unit:"bajtov",verb:"imeti"},array:{unit:"elementov",verb:"imeti"},set:{unit:"elementov",verb:"imeti"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"\u0161tevilo";case"object":{if(Array.isArray(t))return"tabela";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"vnos",email:"e-po\u0161tni naslov",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datum in \u010Das",date:"ISO datum",time:"ISO \u010Das",duration:"ISO trajanje",ipv4:"IPv4 naslov",ipv6:"IPv6 naslov",cidrv4:"obseg IPv4",cidrv6:"obseg IPv6",base64:"base64 kodiran niz",base64url:"base64url kodiran niz",json_string:"JSON niz",e164:"E.164 \u0161tevilka",jwt:"JWT",template_literal:"vnos"};return t=>{switch(t.code){case"invalid_type":return`Neveljaven vnos: pri\u010Dakovano ${t.expected}, prejeto ${r(t.input)}`;case"invalid_value":return t.values.length===1?`Neveljaven vnos: pri\u010Dakovano ${A(t.values[0])}`:`Neveljavna mo\u017Enost: pri\u010Dakovano eno izmed ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`Preveliko: pri\u010Dakovano, da bo ${t.origin??"vrednost"} imelo ${o}${t.maximum.toString()} ${s.unit??"elementov"}`:`Preveliko: pri\u010Dakovano, da bo ${t.origin??"vrednost"} ${o}${t.maximum.toString()}`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`Premajhno: pri\u010Dakovano, da bo ${t.origin} imelo ${o}${t.minimum.toString()} ${s.unit}`:`Premajhno: pri\u010Dakovano, da bo ${t.origin} ${o}${t.minimum.toString()}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`Neveljaven niz: mora se za\u010Deti z "${o.prefix}"`:o.format==="ends_with"?`Neveljaven niz: mora se kon\u010Dati z "${o.suffix}"`:o.format==="includes"?`Neveljaven niz: mora vsebovati "${o.includes}"`:o.format==="regex"?`Neveljaven niz: mora ustrezati vzorcu ${o.pattern}`:`Neveljaven ${i[o.format]??t.format}`}case"not_multiple_of":return`Neveljavno \u0161tevilo: mora biti ve\u010Dkratnik ${t.divisor}`;case"unrecognized_keys":return`Neprepoznan${t.keys.length>1?"i klju\u010Di":" klju\u010D"}: ${_(t.keys,", ")}`;case"invalid_key":return`Neveljaven klju\u010D v ${t.origin}`;case"invalid_union":return"Neveljaven vnos";case"invalid_element":return`Neveljavna vrednost v ${t.origin}`;default:return"Neveljaven vnos"}}};function Ig(){return{localeError:oS()}}var sS=()=>{let n={string:{unit:"tecken",verb:"att ha"},file:{unit:"bytes",verb:"att ha"},array:{unit:"objekt",verb:"att inneh\xE5lla"},set:{unit:"objekt",verb:"att inneh\xE5lla"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"antal";case"object":{if(Array.isArray(t))return"lista";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"regulj\xE4rt uttryck",email:"e-postadress",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-datum och tid",date:"ISO-datum",time:"ISO-tid",duration:"ISO-varaktighet",ipv4:"IPv4-intervall",ipv6:"IPv6-intervall",cidrv4:"IPv4-spektrum",cidrv6:"IPv6-spektrum",base64:"base64-kodad str\xE4ng",base64url:"base64url-kodad str\xE4ng",json_string:"JSON-str\xE4ng",e164:"E.164-nummer",jwt:"JWT",template_literal:"mall-literal"};return t=>{switch(t.code){case"invalid_type":return`Ogiltig inmatning: f\xF6rv\xE4ntat ${t.expected}, fick ${r(t.input)}`;case"invalid_value":return t.values.length===1?`Ogiltig inmatning: f\xF6rv\xE4ntat ${A(t.values[0])}`:`Ogiltigt val: f\xF6rv\xE4ntade en av ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`F\xF6r stor(t): f\xF6rv\xE4ntade ${t.origin??"v\xE4rdet"} att ha ${o}${t.maximum.toString()} ${s.unit??"element"}`:`F\xF6r stor(t): f\xF6rv\xE4ntat ${t.origin??"v\xE4rdet"} att ha ${o}${t.maximum.toString()}`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`F\xF6r lite(t): f\xF6rv\xE4ntade ${t.origin??"v\xE4rdet"} att ha ${o}${t.minimum.toString()} ${s.unit}`:`F\xF6r lite(t): f\xF6rv\xE4ntade ${t.origin??"v\xE4rdet"} att ha ${o}${t.minimum.toString()}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`Ogiltig str\xE4ng: m\xE5ste b\xF6rja med "${o.prefix}"`:o.format==="ends_with"?`Ogiltig str\xE4ng: m\xE5ste sluta med "${o.suffix}"`:o.format==="includes"?`Ogiltig str\xE4ng: m\xE5ste inneh\xE5lla "${o.includes}"`:o.format==="regex"?`Ogiltig str\xE4ng: m\xE5ste matcha m\xF6nstret "${o.pattern}"`:`Ogiltig(t) ${i[o.format]??t.format}`}case"not_multiple_of":return`Ogiltigt tal: m\xE5ste vara en multipel av ${t.divisor}`;case"unrecognized_keys":return`${t.keys.length>1?"Ok\xE4nda nycklar":"Ok\xE4nd nyckel"}: ${_(t.keys,", ")}`;case"invalid_key":return`Ogiltig nyckel i ${t.origin??"v\xE4rdet"}`;case"invalid_union":return"Ogiltig input";case"invalid_element":return`Ogiltigt v\xE4rde i ${t.origin??"v\xE4rdet"}`;default:return"Ogiltig input"}}};function Eg(){return{localeError:sS()}}var aS=()=>{let n={string:{unit:"\u0B8E\u0BB4\u0BC1\u0BA4\u0BCD\u0BA4\u0BC1\u0B95\u0BCD\u0B95\u0BB3\u0BCD",verb:"\u0B95\u0BCA\u0BA3\u0BCD\u0B9F\u0BBF\u0BB0\u0BC1\u0B95\u0BCD\u0B95 \u0BB5\u0BC7\u0BA3\u0BCD\u0B9F\u0BC1\u0BAE\u0BCD"},file:{unit:"\u0BAA\u0BC8\u0B9F\u0BCD\u0B9F\u0BC1\u0B95\u0BB3\u0BCD",verb:"\u0B95\u0BCA\u0BA3\u0BCD\u0B9F\u0BBF\u0BB0\u0BC1\u0B95\u0BCD\u0B95 \u0BB5\u0BC7\u0BA3\u0BCD\u0B9F\u0BC1\u0BAE\u0BCD"},array:{unit:"\u0B89\u0BB1\u0BC1\u0BAA\u0BCD\u0BAA\u0BC1\u0B95\u0BB3\u0BCD",verb:"\u0B95\u0BCA\u0BA3\u0BCD\u0B9F\u0BBF\u0BB0\u0BC1\u0B95\u0BCD\u0B95 \u0BB5\u0BC7\u0BA3\u0BCD\u0B9F\u0BC1\u0BAE\u0BCD"},set:{unit:"\u0B89\u0BB1\u0BC1\u0BAA\u0BCD\u0BAA\u0BC1\u0B95\u0BB3\u0BCD",verb:"\u0B95\u0BCA\u0BA3\u0BCD\u0B9F\u0BBF\u0BB0\u0BC1\u0B95\u0BCD\u0B95 \u0BB5\u0BC7\u0BA3\u0BCD\u0B9F\u0BC1\u0BAE\u0BCD"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"\u0B8E\u0BA3\u0BCD \u0B85\u0BB2\u0BCD\u0BB2\u0BBE\u0BA4\u0BA4\u0BC1":"\u0B8E\u0BA3\u0BCD";case"object":{if(Array.isArray(t))return"\u0B85\u0BA3\u0BBF";if(t===null)return"\u0BB5\u0BC6\u0BB1\u0BC1\u0BAE\u0BC8";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"\u0B89\u0BB3\u0BCD\u0BB3\u0BC0\u0B9F\u0BC1",email:"\u0BAE\u0BBF\u0BA9\u0BCD\u0BA9\u0B9E\u0BCD\u0B9A\u0BB2\u0BCD \u0BAE\u0BC1\u0B95\u0BB5\u0BB0\u0BBF",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO \u0BA4\u0BC7\u0BA4\u0BBF \u0BA8\u0BC7\u0BB0\u0BAE\u0BCD",date:"ISO \u0BA4\u0BC7\u0BA4\u0BBF",time:"ISO \u0BA8\u0BC7\u0BB0\u0BAE\u0BCD",duration:"ISO \u0B95\u0BBE\u0BB2 \u0B85\u0BB3\u0BB5\u0BC1",ipv4:"IPv4 \u0BAE\u0BC1\u0B95\u0BB5\u0BB0\u0BBF",ipv6:"IPv6 \u0BAE\u0BC1\u0B95\u0BB5\u0BB0\u0BBF",cidrv4:"IPv4 \u0BB5\u0BB0\u0BAE\u0BCD\u0BAA\u0BC1",cidrv6:"IPv6 \u0BB5\u0BB0\u0BAE\u0BCD\u0BAA\u0BC1",base64:"base64-encoded \u0B9A\u0BB0\u0BAE\u0BCD",base64url:"base64url-encoded \u0B9A\u0BB0\u0BAE\u0BCD",json_string:"JSON \u0B9A\u0BB0\u0BAE\u0BCD",e164:"E.164 \u0B8E\u0BA3\u0BCD",jwt:"JWT",template_literal:"input"};return t=>{switch(t.code){case"invalid_type":return`\u0BA4\u0BB5\u0BB1\u0BBE\u0BA9 \u0B89\u0BB3\u0BCD\u0BB3\u0BC0\u0B9F\u0BC1: \u0B8E\u0BA4\u0BBF\u0BB0\u0BCD\u0BAA\u0BBE\u0BB0\u0BCD\u0B95\u0BCD\u0B95\u0BAA\u0BCD\u0BAA\u0B9F\u0BCD\u0B9F\u0BA4\u0BC1 ${t.expected}, \u0BAA\u0BC6\u0BB1\u0BAA\u0BCD\u0BAA\u0B9F\u0BCD\u0B9F\u0BA4\u0BC1 ${r(t.input)}`;case"invalid_value":return t.values.length===1?`\u0BA4\u0BB5\u0BB1\u0BBE\u0BA9 \u0B89\u0BB3\u0BCD\u0BB3\u0BC0\u0B9F\u0BC1: \u0B8E\u0BA4\u0BBF\u0BB0\u0BCD\u0BAA\u0BBE\u0BB0\u0BCD\u0B95\u0BCD\u0B95\u0BAA\u0BCD\u0BAA\u0B9F\u0BCD\u0B9F\u0BA4\u0BC1 ${A(t.values[0])}`:`\u0BA4\u0BB5\u0BB1\u0BBE\u0BA9 \u0BB5\u0BBF\u0BB0\u0BC1\u0BAA\u0BCD\u0BAA\u0BAE\u0BCD: \u0B8E\u0BA4\u0BBF\u0BB0\u0BCD\u0BAA\u0BBE\u0BB0\u0BCD\u0B95\u0BCD\u0B95\u0BAA\u0BCD\u0BAA\u0B9F\u0BCD\u0B9F\u0BA4\u0BC1 ${_(t.values,"|")} \u0B87\u0BB2\u0BCD \u0B92\u0BA9\u0BCD\u0BB1\u0BC1`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`\u0BAE\u0BBF\u0B95 \u0BAA\u0BC6\u0BB0\u0BBF\u0BAF\u0BA4\u0BC1: \u0B8E\u0BA4\u0BBF\u0BB0\u0BCD\u0BAA\u0BBE\u0BB0\u0BCD\u0B95\u0BCD\u0B95\u0BAA\u0BCD\u0BAA\u0B9F\u0BCD\u0B9F\u0BA4\u0BC1 ${t.origin??"\u0BAE\u0BA4\u0BBF\u0BAA\u0BCD\u0BAA\u0BC1"} ${o}${t.maximum.toString()} ${s.unit??"\u0B89\u0BB1\u0BC1\u0BAA\u0BCD\u0BAA\u0BC1\u0B95\u0BB3\u0BCD"} \u0B86\u0B95 \u0B87\u0BB0\u0BC1\u0B95\u0BCD\u0B95 \u0BB5\u0BC7\u0BA3\u0BCD\u0B9F\u0BC1\u0BAE\u0BCD`:`\u0BAE\u0BBF\u0B95 \u0BAA\u0BC6\u0BB0\u0BBF\u0BAF\u0BA4\u0BC1: \u0B8E\u0BA4\u0BBF\u0BB0\u0BCD\u0BAA\u0BBE\u0BB0\u0BCD\u0B95\u0BCD\u0B95\u0BAA\u0BCD\u0BAA\u0B9F\u0BCD\u0B9F\u0BA4\u0BC1 ${t.origin??"\u0BAE\u0BA4\u0BBF\u0BAA\u0BCD\u0BAA\u0BC1"} ${o}${t.maximum.toString()} \u0B86\u0B95 \u0B87\u0BB0\u0BC1\u0B95\u0BCD\u0B95 \u0BB5\u0BC7\u0BA3\u0BCD\u0B9F\u0BC1\u0BAE\u0BCD`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`\u0BAE\u0BBF\u0B95\u0B9A\u0BCD \u0B9A\u0BBF\u0BB1\u0BBF\u0BAF\u0BA4\u0BC1: \u0B8E\u0BA4\u0BBF\u0BB0\u0BCD\u0BAA\u0BBE\u0BB0\u0BCD\u0B95\u0BCD\u0B95\u0BAA\u0BCD\u0BAA\u0B9F\u0BCD\u0B9F\u0BA4\u0BC1 ${t.origin} ${o}${t.minimum.toString()} ${s.unit} \u0B86\u0B95 \u0B87\u0BB0\u0BC1\u0B95\u0BCD\u0B95 \u0BB5\u0BC7\u0BA3\u0BCD\u0B9F\u0BC1\u0BAE\u0BCD`:`\u0BAE\u0BBF\u0B95\u0B9A\u0BCD \u0B9A\u0BBF\u0BB1\u0BBF\u0BAF\u0BA4\u0BC1: \u0B8E\u0BA4\u0BBF\u0BB0\u0BCD\u0BAA\u0BBE\u0BB0\u0BCD\u0B95\u0BCD\u0B95\u0BAA\u0BCD\u0BAA\u0B9F\u0BCD\u0B9F\u0BA4\u0BC1 ${t.origin} ${o}${t.minimum.toString()} \u0B86\u0B95 \u0B87\u0BB0\u0BC1\u0B95\u0BCD\u0B95 \u0BB5\u0BC7\u0BA3\u0BCD\u0B9F\u0BC1\u0BAE\u0BCD`}case"invalid_format":{let o=t;return o.format==="starts_with"?`\u0BA4\u0BB5\u0BB1\u0BBE\u0BA9 \u0B9A\u0BB0\u0BAE\u0BCD: "${o.prefix}" \u0B87\u0BB2\u0BCD \u0BA4\u0BCA\u0B9F\u0B99\u0BCD\u0B95 \u0BB5\u0BC7\u0BA3\u0BCD\u0B9F\u0BC1\u0BAE\u0BCD`:o.format==="ends_with"?`\u0BA4\u0BB5\u0BB1\u0BBE\u0BA9 \u0B9A\u0BB0\u0BAE\u0BCD: "${o.suffix}" \u0B87\u0BB2\u0BCD \u0BAE\u0BC1\u0B9F\u0BBF\u0BB5\u0B9F\u0BC8\u0BAF \u0BB5\u0BC7\u0BA3\u0BCD\u0B9F\u0BC1\u0BAE\u0BCD`:o.format==="includes"?`\u0BA4\u0BB5\u0BB1\u0BBE\u0BA9 \u0B9A\u0BB0\u0BAE\u0BCD: "${o.includes}" \u0B90 \u0B89\u0BB3\u0BCD\u0BB3\u0B9F\u0B95\u0BCD\u0B95 \u0BB5\u0BC7\u0BA3\u0BCD\u0B9F\u0BC1\u0BAE\u0BCD`:o.format==="regex"?`\u0BA4\u0BB5\u0BB1\u0BBE\u0BA9 \u0B9A\u0BB0\u0BAE\u0BCD: ${o.pattern} \u0BAE\u0BC1\u0BB1\u0BC8\u0BAA\u0BBE\u0B9F\u0BCD\u0B9F\u0BC1\u0B9F\u0BA9\u0BCD \u0BAA\u0BCA\u0BB0\u0BC1\u0BA8\u0BCD\u0BA4 \u0BB5\u0BC7\u0BA3\u0BCD\u0B9F\u0BC1\u0BAE\u0BCD`:`\u0BA4\u0BB5\u0BB1\u0BBE\u0BA9 ${i[o.format]??t.format}`}case"not_multiple_of":return`\u0BA4\u0BB5\u0BB1\u0BBE\u0BA9 \u0B8E\u0BA3\u0BCD: ${t.divisor} \u0B87\u0BA9\u0BCD \u0BAA\u0BB2\u0BAE\u0BBE\u0B95 \u0B87\u0BB0\u0BC1\u0B95\u0BCD\u0B95 \u0BB5\u0BC7\u0BA3\u0BCD\u0B9F\u0BC1\u0BAE\u0BCD`;case"unrecognized_keys":return`\u0B85\u0B9F\u0BC8\u0BAF\u0BBE\u0BB3\u0BAE\u0BCD \u0BA4\u0BC6\u0BB0\u0BBF\u0BAF\u0BBE\u0BA4 \u0BB5\u0BBF\u0B9A\u0BC8${t.keys.length>1?"\u0B95\u0BB3\u0BCD":""}: ${_(t.keys,", ")}`;case"invalid_key":return`${t.origin} \u0B87\u0BB2\u0BCD \u0BA4\u0BB5\u0BB1\u0BBE\u0BA9 \u0BB5\u0BBF\u0B9A\u0BC8`;case"invalid_union":return"\u0BA4\u0BB5\u0BB1\u0BBE\u0BA9 \u0B89\u0BB3\u0BCD\u0BB3\u0BC0\u0B9F\u0BC1";case"invalid_element":return`${t.origin} \u0B87\u0BB2\u0BCD \u0BA4\u0BB5\u0BB1\u0BBE\u0BA9 \u0BAE\u0BA4\u0BBF\u0BAA\u0BCD\u0BAA\u0BC1`;default:return"\u0BA4\u0BB5\u0BB1\u0BBE\u0BA9 \u0B89\u0BB3\u0BCD\u0BB3\u0BC0\u0B9F\u0BC1"}}};function Cg(){return{localeError:aS()}}var cS=()=>{let n={string:{unit:"\u0E15\u0E31\u0E27\u0E2D\u0E31\u0E01\u0E29\u0E23",verb:"\u0E04\u0E27\u0E23\u0E21\u0E35"},file:{unit:"\u0E44\u0E1A\u0E15\u0E4C",verb:"\u0E04\u0E27\u0E23\u0E21\u0E35"},array:{unit:"\u0E23\u0E32\u0E22\u0E01\u0E32\u0E23",verb:"\u0E04\u0E27\u0E23\u0E21\u0E35"},set:{unit:"\u0E23\u0E32\u0E22\u0E01\u0E32\u0E23",verb:"\u0E04\u0E27\u0E23\u0E21\u0E35"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"\u0E44\u0E21\u0E48\u0E43\u0E0A\u0E48\u0E15\u0E31\u0E27\u0E40\u0E25\u0E02 (NaN)":"\u0E15\u0E31\u0E27\u0E40\u0E25\u0E02";case"object":{if(Array.isArray(t))return"\u0E2D\u0E32\u0E23\u0E4C\u0E40\u0E23\u0E22\u0E4C (Array)";if(t===null)return"\u0E44\u0E21\u0E48\u0E21\u0E35\u0E04\u0E48\u0E32 (null)";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"\u0E02\u0E49\u0E2D\u0E21\u0E39\u0E25\u0E17\u0E35\u0E48\u0E1B\u0E49\u0E2D\u0E19",email:"\u0E17\u0E35\u0E48\u0E2D\u0E22\u0E39\u0E48\u0E2D\u0E35\u0E40\u0E21\u0E25",url:"URL",emoji:"\u0E2D\u0E34\u0E42\u0E21\u0E08\u0E34",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"\u0E27\u0E31\u0E19\u0E17\u0E35\u0E48\u0E40\u0E27\u0E25\u0E32\u0E41\u0E1A\u0E1A ISO",date:"\u0E27\u0E31\u0E19\u0E17\u0E35\u0E48\u0E41\u0E1A\u0E1A ISO",time:"\u0E40\u0E27\u0E25\u0E32\u0E41\u0E1A\u0E1A ISO",duration:"\u0E0A\u0E48\u0E27\u0E07\u0E40\u0E27\u0E25\u0E32\u0E41\u0E1A\u0E1A ISO",ipv4:"\u0E17\u0E35\u0E48\u0E2D\u0E22\u0E39\u0E48 IPv4",ipv6:"\u0E17\u0E35\u0E48\u0E2D\u0E22\u0E39\u0E48 IPv6",cidrv4:"\u0E0A\u0E48\u0E27\u0E07 IP \u0E41\u0E1A\u0E1A IPv4",cidrv6:"\u0E0A\u0E48\u0E27\u0E07 IP \u0E41\u0E1A\u0E1A IPv6",base64:"\u0E02\u0E49\u0E2D\u0E04\u0E27\u0E32\u0E21\u0E41\u0E1A\u0E1A Base64",base64url:"\u0E02\u0E49\u0E2D\u0E04\u0E27\u0E32\u0E21\u0E41\u0E1A\u0E1A Base64 \u0E2A\u0E33\u0E2B\u0E23\u0E31\u0E1A URL",json_string:"\u0E02\u0E49\u0E2D\u0E04\u0E27\u0E32\u0E21\u0E41\u0E1A\u0E1A JSON",e164:"\u0E40\u0E1A\u0E2D\u0E23\u0E4C\u0E42\u0E17\u0E23\u0E28\u0E31\u0E1E\u0E17\u0E4C\u0E23\u0E30\u0E2B\u0E27\u0E48\u0E32\u0E07\u0E1B\u0E23\u0E30\u0E40\u0E17\u0E28 (E.164)",jwt:"\u0E42\u0E17\u0E40\u0E04\u0E19 JWT",template_literal:"\u0E02\u0E49\u0E2D\u0E21\u0E39\u0E25\u0E17\u0E35\u0E48\u0E1B\u0E49\u0E2D\u0E19"};return t=>{switch(t.code){case"invalid_type":return`\u0E1B\u0E23\u0E30\u0E40\u0E20\u0E17\u0E02\u0E49\u0E2D\u0E21\u0E39\u0E25\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07: \u0E04\u0E27\u0E23\u0E40\u0E1B\u0E47\u0E19 ${t.expected} \u0E41\u0E15\u0E48\u0E44\u0E14\u0E49\u0E23\u0E31\u0E1A ${r(t.input)}`;case"invalid_value":return t.values.length===1?`\u0E04\u0E48\u0E32\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07: \u0E04\u0E27\u0E23\u0E40\u0E1B\u0E47\u0E19 ${A(t.values[0])}`:`\u0E15\u0E31\u0E27\u0E40\u0E25\u0E37\u0E2D\u0E01\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07: \u0E04\u0E27\u0E23\u0E40\u0E1B\u0E47\u0E19\u0E2B\u0E19\u0E36\u0E48\u0E07\u0E43\u0E19 ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"\u0E44\u0E21\u0E48\u0E40\u0E01\u0E34\u0E19":"\u0E19\u0E49\u0E2D\u0E22\u0E01\u0E27\u0E48\u0E32",s=e(t.origin);return s?`\u0E40\u0E01\u0E34\u0E19\u0E01\u0E33\u0E2B\u0E19\u0E14: ${t.origin??"\u0E04\u0E48\u0E32"} \u0E04\u0E27\u0E23\u0E21\u0E35${o} ${t.maximum.toString()} ${s.unit??"\u0E23\u0E32\u0E22\u0E01\u0E32\u0E23"}`:`\u0E40\u0E01\u0E34\u0E19\u0E01\u0E33\u0E2B\u0E19\u0E14: ${t.origin??"\u0E04\u0E48\u0E32"} \u0E04\u0E27\u0E23\u0E21\u0E35${o} ${t.maximum.toString()}`}case"too_small":{let o=t.inclusive?"\u0E2D\u0E22\u0E48\u0E32\u0E07\u0E19\u0E49\u0E2D\u0E22":"\u0E21\u0E32\u0E01\u0E01\u0E27\u0E48\u0E32",s=e(t.origin);return s?`\u0E19\u0E49\u0E2D\u0E22\u0E01\u0E27\u0E48\u0E32\u0E01\u0E33\u0E2B\u0E19\u0E14: ${t.origin} \u0E04\u0E27\u0E23\u0E21\u0E35${o} ${t.minimum.toString()} ${s.unit}`:`\u0E19\u0E49\u0E2D\u0E22\u0E01\u0E27\u0E48\u0E32\u0E01\u0E33\u0E2B\u0E19\u0E14: ${t.origin} \u0E04\u0E27\u0E23\u0E21\u0E35${o} ${t.minimum.toString()}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`\u0E23\u0E39\u0E1B\u0E41\u0E1A\u0E1A\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07: \u0E02\u0E49\u0E2D\u0E04\u0E27\u0E32\u0E21\u0E15\u0E49\u0E2D\u0E07\u0E02\u0E36\u0E49\u0E19\u0E15\u0E49\u0E19\u0E14\u0E49\u0E27\u0E22 "${o.prefix}"`:o.format==="ends_with"?`\u0E23\u0E39\u0E1B\u0E41\u0E1A\u0E1A\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07: \u0E02\u0E49\u0E2D\u0E04\u0E27\u0E32\u0E21\u0E15\u0E49\u0E2D\u0E07\u0E25\u0E07\u0E17\u0E49\u0E32\u0E22\u0E14\u0E49\u0E27\u0E22 "${o.suffix}"`:o.format==="includes"?`\u0E23\u0E39\u0E1B\u0E41\u0E1A\u0E1A\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07: \u0E02\u0E49\u0E2D\u0E04\u0E27\u0E32\u0E21\u0E15\u0E49\u0E2D\u0E07\u0E21\u0E35 "${o.includes}" \u0E2D\u0E22\u0E39\u0E48\u0E43\u0E19\u0E02\u0E49\u0E2D\u0E04\u0E27\u0E32\u0E21`:o.format==="regex"?`\u0E23\u0E39\u0E1B\u0E41\u0E1A\u0E1A\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07: \u0E15\u0E49\u0E2D\u0E07\u0E15\u0E23\u0E07\u0E01\u0E31\u0E1A\u0E23\u0E39\u0E1B\u0E41\u0E1A\u0E1A\u0E17\u0E35\u0E48\u0E01\u0E33\u0E2B\u0E19\u0E14 ${o.pattern}`:`\u0E23\u0E39\u0E1B\u0E41\u0E1A\u0E1A\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07: ${i[o.format]??t.format}`}case"not_multiple_of":return`\u0E15\u0E31\u0E27\u0E40\u0E25\u0E02\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07: \u0E15\u0E49\u0E2D\u0E07\u0E40\u0E1B\u0E47\u0E19\u0E08\u0E33\u0E19\u0E27\u0E19\u0E17\u0E35\u0E48\u0E2B\u0E32\u0E23\u0E14\u0E49\u0E27\u0E22 ${t.divisor} \u0E44\u0E14\u0E49\u0E25\u0E07\u0E15\u0E31\u0E27`;case"unrecognized_keys":return`\u0E1E\u0E1A\u0E04\u0E35\u0E22\u0E4C\u0E17\u0E35\u0E48\u0E44\u0E21\u0E48\u0E23\u0E39\u0E49\u0E08\u0E31\u0E01: ${_(t.keys,", ")}`;case"invalid_key":return`\u0E04\u0E35\u0E22\u0E4C\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07\u0E43\u0E19 ${t.origin}`;case"invalid_union":return"\u0E02\u0E49\u0E2D\u0E21\u0E39\u0E25\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07: \u0E44\u0E21\u0E48\u0E15\u0E23\u0E07\u0E01\u0E31\u0E1A\u0E23\u0E39\u0E1B\u0E41\u0E1A\u0E1A\u0E22\u0E39\u0E40\u0E19\u0E35\u0E22\u0E19\u0E17\u0E35\u0E48\u0E01\u0E33\u0E2B\u0E19\u0E14\u0E44\u0E27\u0E49";case"invalid_element":return`\u0E02\u0E49\u0E2D\u0E21\u0E39\u0E25\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07\u0E43\u0E19 ${t.origin}`;default:return"\u0E02\u0E49\u0E2D\u0E21\u0E39\u0E25\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07"}}};function Ng(){return{localeError:cS()}}var lS=n=>{let e=typeof n;switch(e){case"number":return Number.isNaN(n)?"NaN":"number";case"object":{if(Array.isArray(n))return"array";if(n===null)return"null";if(Object.getPrototypeOf(n)!==Object.prototype&&n.constructor)return n.constructor.name}}return e},uS=()=>{let n={string:{unit:"karakter",verb:"olmal\u0131"},file:{unit:"bayt",verb:"olmal\u0131"},array:{unit:"\xF6\u011Fe",verb:"olmal\u0131"},set:{unit:"\xF6\u011Fe",verb:"olmal\u0131"}};function e(i){return n[i]??null}let r={regex:"girdi",email:"e-posta adresi",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO tarih ve saat",date:"ISO tarih",time:"ISO saat",duration:"ISO s\xFCre",ipv4:"IPv4 adresi",ipv6:"IPv6 adresi",cidrv4:"IPv4 aral\u0131\u011F\u0131",cidrv6:"IPv6 aral\u0131\u011F\u0131",base64:"base64 ile \u015Fifrelenmi\u015F metin",base64url:"base64url ile \u015Fifrelenmi\u015F metin",json_string:"JSON dizesi",e164:"E.164 say\u0131s\u0131",jwt:"JWT",template_literal:"\u015Eablon dizesi"};return i=>{switch(i.code){case"invalid_type":return`Ge\xE7ersiz de\u011Fer: beklenen ${i.expected}, al\u0131nan ${lS(i.input)}`;case"invalid_value":return i.values.length===1?`Ge\xE7ersiz de\u011Fer: beklenen ${A(i.values[0])}`:`Ge\xE7ersiz se\xE7enek: a\u015Fa\u011F\u0131dakilerden biri olmal\u0131: ${_(i.values,"|")}`;case"too_big":{let t=i.inclusive?"<=":"<",o=e(i.origin);return o?`\xC7ok b\xFCy\xFCk: beklenen ${i.origin??"de\u011Fer"} ${t}${i.maximum.toString()} ${o.unit??"\xF6\u011Fe"}`:`\xC7ok b\xFCy\xFCk: beklenen ${i.origin??"de\u011Fer"} ${t}${i.maximum.toString()}`}case"too_small":{let t=i.inclusive?">=":">",o=e(i.origin);return o?`\xC7ok k\xFC\xE7\xFCk: beklenen ${i.origin} ${t}${i.minimum.toString()} ${o.unit}`:`\xC7ok k\xFC\xE7\xFCk: beklenen ${i.origin} ${t}${i.minimum.toString()}`}case"invalid_format":{let t=i;return t.format==="starts_with"?`Ge\xE7ersiz metin: "${t.prefix}" ile ba\u015Flamal\u0131`:t.format==="ends_with"?`Ge\xE7ersiz metin: "${t.suffix}" ile bitmeli`:t.format==="includes"?`Ge\xE7ersiz metin: "${t.includes}" i\xE7ermeli`:t.format==="regex"?`Ge\xE7ersiz metin: ${t.pattern} desenine uymal\u0131`:`Ge\xE7ersiz ${r[t.format]??i.format}`}case"not_multiple_of":return`Ge\xE7ersiz say\u0131: ${i.divisor} ile tam b\xF6l\xFCnebilmeli`;case"unrecognized_keys":return`Tan\u0131nmayan anahtar${i.keys.length>1?"lar":""}: ${_(i.keys,", ")}`;case"invalid_key":return`${i.origin} i\xE7inde ge\xE7ersiz anahtar`;case"invalid_union":return"Ge\xE7ersiz de\u011Fer";case"invalid_element":return`${i.origin} i\xE7inde ge\xE7ersiz de\u011Fer`;default:return"Ge\xE7ersiz de\u011Fer"}}};function jg(){return{localeError:uS()}}var dS=()=>{let n={string:{unit:"\u0441\u0438\u043C\u0432\u043E\u043B\u0456\u0432",verb:"\u043C\u0430\u0442\u0438\u043C\u0435"},file:{unit:"\u0431\u0430\u0439\u0442\u0456\u0432",verb:"\u043C\u0430\u0442\u0438\u043C\u0435"},array:{unit:"\u0435\u043B\u0435\u043C\u0435\u043D\u0442\u0456\u0432",verb:"\u043C\u0430\u0442\u0438\u043C\u0435"},set:{unit:"\u0435\u043B\u0435\u043C\u0435\u043D\u0442\u0456\u0432",verb:"\u043C\u0430\u0442\u0438\u043C\u0435"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"\u0447\u0438\u0441\u043B\u043E";case"object":{if(Array.isArray(t))return"\u043C\u0430\u0441\u0438\u0432";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"\u0432\u0445\u0456\u0434\u043D\u0456 \u0434\u0430\u043D\u0456",email:"\u0430\u0434\u0440\u0435\u0441\u0430 \u0435\u043B\u0435\u043A\u0442\u0440\u043E\u043D\u043D\u043E\u0457 \u043F\u043E\u0448\u0442\u0438",url:"URL",emoji:"\u0435\u043C\u043E\u0434\u0437\u0456",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"\u0434\u0430\u0442\u0430 \u0442\u0430 \u0447\u0430\u0441 ISO",date:"\u0434\u0430\u0442\u0430 ISO",time:"\u0447\u0430\u0441 ISO",duration:"\u0442\u0440\u0438\u0432\u0430\u043B\u0456\u0441\u0442\u044C ISO",ipv4:"\u0430\u0434\u0440\u0435\u0441\u0430 IPv4",ipv6:"\u0430\u0434\u0440\u0435\u0441\u0430 IPv6",cidrv4:"\u0434\u0456\u0430\u043F\u0430\u0437\u043E\u043D IPv4",cidrv6:"\u0434\u0456\u0430\u043F\u0430\u0437\u043E\u043D IPv6",base64:"\u0440\u044F\u0434\u043E\u043A \u0443 \u043A\u043E\u0434\u0443\u0432\u0430\u043D\u043D\u0456 base64",base64url:"\u0440\u044F\u0434\u043E\u043A \u0443 \u043A\u043E\u0434\u0443\u0432\u0430\u043D\u043D\u0456 base64url",json_string:"\u0440\u044F\u0434\u043E\u043A JSON",e164:"\u043D\u043E\u043C\u0435\u0440 E.164",jwt:"JWT",template_literal:"\u0432\u0445\u0456\u0434\u043D\u0456 \u0434\u0430\u043D\u0456"};return t=>{switch(t.code){case"invalid_type":return`\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u0456 \u0432\u0445\u0456\u0434\u043D\u0456 \u0434\u0430\u043D\u0456: \u043E\u0447\u0456\u043A\u0443\u0454\u0442\u044C\u0441\u044F ${t.expected}, \u043E\u0442\u0440\u0438\u043C\u0430\u043D\u043E ${r(t.input)}`;case"invalid_value":return t.values.length===1?`\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u0456 \u0432\u0445\u0456\u0434\u043D\u0456 \u0434\u0430\u043D\u0456: \u043E\u0447\u0456\u043A\u0443\u0454\u0442\u044C\u0441\u044F ${A(t.values[0])}`:`\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u0430 \u043E\u043F\u0446\u0456\u044F: \u043E\u0447\u0456\u043A\u0443\u0454\u0442\u044C\u0441\u044F \u043E\u0434\u043D\u0435 \u0437 ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`\u0417\u0430\u043D\u0430\u0434\u0442\u043E \u0432\u0435\u043B\u0438\u043A\u0435: \u043E\u0447\u0456\u043A\u0443\u0454\u0442\u044C\u0441\u044F, \u0449\u043E ${t.origin??"\u0437\u043D\u0430\u0447\u0435\u043D\u043D\u044F"} ${s.verb} ${o}${t.maximum.toString()} ${s.unit??"\u0435\u043B\u0435\u043C\u0435\u043D\u0442\u0456\u0432"}`:`\u0417\u0430\u043D\u0430\u0434\u0442\u043E \u0432\u0435\u043B\u0438\u043A\u0435: \u043E\u0447\u0456\u043A\u0443\u0454\u0442\u044C\u0441\u044F, \u0449\u043E ${t.origin??"\u0437\u043D\u0430\u0447\u0435\u043D\u043D\u044F"} \u0431\u0443\u0434\u0435 ${o}${t.maximum.toString()}`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`\u0417\u0430\u043D\u0430\u0434\u0442\u043E \u043C\u0430\u043B\u0435: \u043E\u0447\u0456\u043A\u0443\u0454\u0442\u044C\u0441\u044F, \u0449\u043E ${t.origin} ${s.verb} ${o}${t.minimum.toString()} ${s.unit}`:`\u0417\u0430\u043D\u0430\u0434\u0442\u043E \u043C\u0430\u043B\u0435: \u043E\u0447\u0456\u043A\u0443\u0454\u0442\u044C\u0441\u044F, \u0449\u043E ${t.origin} \u0431\u0443\u0434\u0435 ${o}${t.minimum.toString()}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u0438\u0439 \u0440\u044F\u0434\u043E\u043A: \u043F\u043E\u0432\u0438\u043D\u0435\u043D \u043F\u043E\u0447\u0438\u043D\u0430\u0442\u0438\u0441\u044F \u0437 "${o.prefix}"`:o.format==="ends_with"?`\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u0438\u0439 \u0440\u044F\u0434\u043E\u043A: \u043F\u043E\u0432\u0438\u043D\u0435\u043D \u0437\u0430\u043A\u0456\u043D\u0447\u0443\u0432\u0430\u0442\u0438\u0441\u044F \u043D\u0430 "${o.suffix}"`:o.format==="includes"?`\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u0438\u0439 \u0440\u044F\u0434\u043E\u043A: \u043F\u043E\u0432\u0438\u043D\u0435\u043D \u043C\u0456\u0441\u0442\u0438\u0442\u0438 "${o.includes}"`:o.format==="regex"?`\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u0438\u0439 \u0440\u044F\u0434\u043E\u043A: \u043F\u043E\u0432\u0438\u043D\u0435\u043D \u0432\u0456\u0434\u043F\u043E\u0432\u0456\u0434\u0430\u0442\u0438 \u0448\u0430\u0431\u043B\u043E\u043D\u0443 ${o.pattern}`:`\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u0438\u0439 ${i[o.format]??t.format}`}case"not_multiple_of":return`\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u0435 \u0447\u0438\u0441\u043B\u043E: \u043F\u043E\u0432\u0438\u043D\u043D\u043E \u0431\u0443\u0442\u0438 \u043A\u0440\u0430\u0442\u043D\u0438\u043C ${t.divisor}`;case"unrecognized_keys":return`\u041D\u0435\u0440\u043E\u0437\u043F\u0456\u0437\u043D\u0430\u043D\u0438\u0439 \u043A\u043B\u044E\u0447${t.keys.length>1?"\u0456":""}: ${_(t.keys,", ")}`;case"invalid_key":return`\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u0438\u0439 \u043A\u043B\u044E\u0447 \u0443 ${t.origin}`;case"invalid_union":return"\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u0456 \u0432\u0445\u0456\u0434\u043D\u0456 \u0434\u0430\u043D\u0456";case"invalid_element":return`\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u043D\u044F \u0443 ${t.origin}`;default:return"\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u0456 \u0432\u0445\u0456\u0434\u043D\u0456 \u0434\u0430\u043D\u0456"}}};function Ag(){return{localeError:dS()}}var fS=()=>{let n={string:{unit:"\u062D\u0631\u0648\u0641",verb:"\u06C1\u0648\u0646\u0627"},file:{unit:"\u0628\u0627\u0626\u0679\u0633",verb:"\u06C1\u0648\u0646\u0627"},array:{unit:"\u0622\u0626\u0679\u0645\u0632",verb:"\u06C1\u0648\u0646\u0627"},set:{unit:"\u0622\u0626\u0679\u0645\u0632",verb:"\u06C1\u0648\u0646\u0627"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"\u0646\u0645\u0628\u0631";case"object":{if(Array.isArray(t))return"\u0622\u0631\u06D2";if(t===null)return"\u0646\u0644";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"\u0627\u0646 \u067E\u0679",email:"\u0627\u06CC \u0645\u06CC\u0644 \u0627\u06CC\u0688\u0631\u06CC\u0633",url:"\u06CC\u0648 \u0622\u0631 \u0627\u06CC\u0644",emoji:"\u0627\u06CC\u0645\u0648\u062C\u06CC",uuid:"\u06CC\u0648 \u06CC\u0648 \u0622\u0626\u06CC \u0688\u06CC",uuidv4:"\u06CC\u0648 \u06CC\u0648 \u0622\u0626\u06CC \u0688\u06CC \u0648\u06CC 4",uuidv6:"\u06CC\u0648 \u06CC\u0648 \u0622\u0626\u06CC \u0688\u06CC \u0648\u06CC 6",nanoid:"\u0646\u06CC\u0646\u0648 \u0622\u0626\u06CC \u0688\u06CC",guid:"\u062C\u06CC \u06CC\u0648 \u0622\u0626\u06CC \u0688\u06CC",cuid:"\u0633\u06CC \u06CC\u0648 \u0622\u0626\u06CC \u0688\u06CC",cuid2:"\u0633\u06CC \u06CC\u0648 \u0622\u0626\u06CC \u0688\u06CC 2",ulid:"\u06CC\u0648 \u0627\u06CC\u0644 \u0622\u0626\u06CC \u0688\u06CC",xid:"\u0627\u06CC\u06A9\u0633 \u0622\u0626\u06CC \u0688\u06CC",ksuid:"\u06A9\u06D2 \u0627\u06CC\u0633 \u06CC\u0648 \u0622\u0626\u06CC \u0688\u06CC",datetime:"\u0622\u0626\u06CC \u0627\u06CC\u0633 \u0627\u0648 \u0688\u06CC\u0679 \u0679\u0627\u0626\u0645",date:"\u0622\u0626\u06CC \u0627\u06CC\u0633 \u0627\u0648 \u062A\u0627\u0631\u06CC\u062E",time:"\u0622\u0626\u06CC \u0627\u06CC\u0633 \u0627\u0648 \u0648\u0642\u062A",duration:"\u0622\u0626\u06CC \u0627\u06CC\u0633 \u0627\u0648 \u0645\u062F\u062A",ipv4:"\u0622\u0626\u06CC \u067E\u06CC \u0648\u06CC 4 \u0627\u06CC\u0688\u0631\u06CC\u0633",ipv6:"\u0622\u0626\u06CC \u067E\u06CC \u0648\u06CC 6 \u0627\u06CC\u0688\u0631\u06CC\u0633",cidrv4:"\u0622\u0626\u06CC \u067E\u06CC \u0648\u06CC 4 \u0631\u06CC\u0646\u062C",cidrv6:"\u0622\u0626\u06CC \u067E\u06CC \u0648\u06CC 6 \u0631\u06CC\u0646\u062C",base64:"\u0628\u06CC\u0633 64 \u0627\u0646 \u06A9\u0648\u0688\u0688 \u0633\u0679\u0631\u0646\u06AF",base64url:"\u0628\u06CC\u0633 64 \u06CC\u0648 \u0622\u0631 \u0627\u06CC\u0644 \u0627\u0646 \u06A9\u0648\u0688\u0688 \u0633\u0679\u0631\u0646\u06AF",json_string:"\u062C\u06D2 \u0627\u06CC\u0633 \u0627\u0648 \u0627\u06CC\u0646 \u0633\u0679\u0631\u0646\u06AF",e164:"\u0627\u06CC 164 \u0646\u0645\u0628\u0631",jwt:"\u062C\u06D2 \u0688\u0628\u0644\u06CC\u0648 \u0679\u06CC",template_literal:"\u0627\u0646 \u067E\u0679"};return t=>{switch(t.code){case"invalid_type":return`\u063A\u0644\u0637 \u0627\u0646 \u067E\u0679: ${t.expected} \u0645\u062A\u0648\u0642\u0639 \u062A\u06BE\u0627\u060C ${r(t.input)} \u0645\u0648\u0635\u0648\u0644 \u06C1\u0648\u0627`;case"invalid_value":return t.values.length===1?`\u063A\u0644\u0637 \u0627\u0646 \u067E\u0679: ${A(t.values[0])} \u0645\u062A\u0648\u0642\u0639 \u062A\u06BE\u0627`:`\u063A\u0644\u0637 \u0622\u067E\u0634\u0646: ${_(t.values,"|")} \u0645\u06CC\u06BA \u0633\u06D2 \u0627\u06CC\u06A9 \u0645\u062A\u0648\u0642\u0639 \u062A\u06BE\u0627`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`\u0628\u06C1\u062A \u0628\u0691\u0627: ${t.origin??"\u0648\u06CC\u0644\u06CC\u0648"} \u06A9\u06D2 ${o}${t.maximum.toString()} ${s.unit??"\u0639\u0646\u0627\u0635\u0631"} \u06C1\u0648\u0646\u06D2 \u0645\u062A\u0648\u0642\u0639 \u062A\u06BE\u06D2`:`\u0628\u06C1\u062A \u0628\u0691\u0627: ${t.origin??"\u0648\u06CC\u0644\u06CC\u0648"} \u06A9\u0627 ${o}${t.maximum.toString()} \u06C1\u0648\u0646\u0627 \u0645\u062A\u0648\u0642\u0639 \u062A\u06BE\u0627`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`\u0628\u06C1\u062A \u0686\u06BE\u0648\u0679\u0627: ${t.origin} \u06A9\u06D2 ${o}${t.minimum.toString()} ${s.unit} \u06C1\u0648\u0646\u06D2 \u0645\u062A\u0648\u0642\u0639 \u062A\u06BE\u06D2`:`\u0628\u06C1\u062A \u0686\u06BE\u0648\u0679\u0627: ${t.origin} \u06A9\u0627 ${o}${t.minimum.toString()} \u06C1\u0648\u0646\u0627 \u0645\u062A\u0648\u0642\u0639 \u062A\u06BE\u0627`}case"invalid_format":{let o=t;return o.format==="starts_with"?`\u063A\u0644\u0637 \u0633\u0679\u0631\u0646\u06AF: "${o.prefix}" \u0633\u06D2 \u0634\u0631\u0648\u0639 \u06C1\u0648\u0646\u0627 \u0686\u0627\u06C1\u06CC\u06D2`:o.format==="ends_with"?`\u063A\u0644\u0637 \u0633\u0679\u0631\u0646\u06AF: "${o.suffix}" \u067E\u0631 \u062E\u062A\u0645 \u06C1\u0648\u0646\u0627 \u0686\u0627\u06C1\u06CC\u06D2`:o.format==="includes"?`\u063A\u0644\u0637 \u0633\u0679\u0631\u0646\u06AF: "${o.includes}" \u0634\u0627\u0645\u0644 \u06C1\u0648\u0646\u0627 \u0686\u0627\u06C1\u06CC\u06D2`:o.format==="regex"?`\u063A\u0644\u0637 \u0633\u0679\u0631\u0646\u06AF: \u067E\u06CC\u0679\u0631\u0646 ${o.pattern} \u0633\u06D2 \u0645\u06CC\u0686 \u06C1\u0648\u0646\u0627 \u0686\u0627\u06C1\u06CC\u06D2`:`\u063A\u0644\u0637 ${i[o.format]??t.format}`}case"not_multiple_of":return`\u063A\u0644\u0637 \u0646\u0645\u0628\u0631: ${t.divisor} \u06A9\u0627 \u0645\u0636\u0627\u0639\u0641 \u06C1\u0648\u0646\u0627 \u0686\u0627\u06C1\u06CC\u06D2`;case"unrecognized_keys":return`\u063A\u06CC\u0631 \u062A\u0633\u0644\u06CC\u0645 \u0634\u062F\u06C1 \u06A9\u06CC${t.keys.length>1?"\u0632":""}: ${_(t.keys,"\u060C ")}`;case"invalid_key":return`${t.origin} \u0645\u06CC\u06BA \u063A\u0644\u0637 \u06A9\u06CC`;case"invalid_union":return"\u063A\u0644\u0637 \u0627\u0646 \u067E\u0679";case"invalid_element":return`${t.origin} \u0645\u06CC\u06BA \u063A\u0644\u0637 \u0648\u06CC\u0644\u06CC\u0648`;default:return"\u063A\u0644\u0637 \u0627\u0646 \u067E\u0679"}}};function zg(){return{localeError:fS()}}var mS=()=>{let n={string:{unit:"k\xFD t\u1EF1",verb:"c\xF3"},file:{unit:"byte",verb:"c\xF3"},array:{unit:"ph\u1EA7n t\u1EED",verb:"c\xF3"},set:{unit:"ph\u1EA7n t\u1EED",verb:"c\xF3"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"s\u1ED1";case"object":{if(Array.isArray(t))return"m\u1EA3ng";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"\u0111\u1EA7u v\xE0o",email:"\u0111\u1ECBa ch\u1EC9 email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ng\xE0y gi\u1EDD ISO",date:"ng\xE0y ISO",time:"gi\u1EDD ISO",duration:"kho\u1EA3ng th\u1EDDi gian ISO",ipv4:"\u0111\u1ECBa ch\u1EC9 IPv4",ipv6:"\u0111\u1ECBa ch\u1EC9 IPv6",cidrv4:"d\u1EA3i IPv4",cidrv6:"d\u1EA3i IPv6",base64:"chu\u1ED7i m\xE3 h\xF3a base64",base64url:"chu\u1ED7i m\xE3 h\xF3a base64url",json_string:"chu\u1ED7i JSON",e164:"s\u1ED1 E.164",jwt:"JWT",template_literal:"\u0111\u1EA7u v\xE0o"};return t=>{switch(t.code){case"invalid_type":return`\u0110\u1EA7u v\xE0o kh\xF4ng h\u1EE3p l\u1EC7: mong \u0111\u1EE3i ${t.expected}, nh\u1EADn \u0111\u01B0\u1EE3c ${r(t.input)}`;case"invalid_value":return t.values.length===1?`\u0110\u1EA7u v\xE0o kh\xF4ng h\u1EE3p l\u1EC7: mong \u0111\u1EE3i ${A(t.values[0])}`:`T\xF9y ch\u1ECDn kh\xF4ng h\u1EE3p l\u1EC7: mong \u0111\u1EE3i m\u1ED9t trong c\xE1c gi\xE1 tr\u1ECB ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`Qu\xE1 l\u1EDBn: mong \u0111\u1EE3i ${t.origin??"gi\xE1 tr\u1ECB"} ${s.verb} ${o}${t.maximum.toString()} ${s.unit??"ph\u1EA7n t\u1EED"}`:`Qu\xE1 l\u1EDBn: mong \u0111\u1EE3i ${t.origin??"gi\xE1 tr\u1ECB"} ${o}${t.maximum.toString()}`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`Qu\xE1 nh\u1ECF: mong \u0111\u1EE3i ${t.origin} ${s.verb} ${o}${t.minimum.toString()} ${s.unit}`:`Qu\xE1 nh\u1ECF: mong \u0111\u1EE3i ${t.origin} ${o}${t.minimum.toString()}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`Chu\u1ED7i kh\xF4ng h\u1EE3p l\u1EC7: ph\u1EA3i b\u1EAFt \u0111\u1EA7u b\u1EB1ng "${o.prefix}"`:o.format==="ends_with"?`Chu\u1ED7i kh\xF4ng h\u1EE3p l\u1EC7: ph\u1EA3i k\u1EBFt th\xFAc b\u1EB1ng "${o.suffix}"`:o.format==="includes"?`Chu\u1ED7i kh\xF4ng h\u1EE3p l\u1EC7: ph\u1EA3i bao g\u1ED3m "${o.includes}"`:o.format==="regex"?`Chu\u1ED7i kh\xF4ng h\u1EE3p l\u1EC7: ph\u1EA3i kh\u1EDBp v\u1EDBi m\u1EABu ${o.pattern}`:`${i[o.format]??t.format} kh\xF4ng h\u1EE3p l\u1EC7`}case"not_multiple_of":return`S\u1ED1 kh\xF4ng h\u1EE3p l\u1EC7: ph\u1EA3i l\xE0 b\u1ED9i s\u1ED1 c\u1EE7a ${t.divisor}`;case"unrecognized_keys":return`Kh\xF3a kh\xF4ng \u0111\u01B0\u1EE3c nh\u1EADn d\u1EA1ng: ${_(t.keys,", ")}`;case"invalid_key":return`Kh\xF3a kh\xF4ng h\u1EE3p l\u1EC7 trong ${t.origin}`;case"invalid_union":return"\u0110\u1EA7u v\xE0o kh\xF4ng h\u1EE3p l\u1EC7";case"invalid_element":return`Gi\xE1 tr\u1ECB kh\xF4ng h\u1EE3p l\u1EC7 trong ${t.origin}`;default:return"\u0110\u1EA7u v\xE0o kh\xF4ng h\u1EE3p l\u1EC7"}}};function Dg(){return{localeError:mS()}}var pS=()=>{let n={string:{unit:"\u5B57\u7B26",verb:"\u5305\u542B"},file:{unit:"\u5B57\u8282",verb:"\u5305\u542B"},array:{unit:"\u9879",verb:"\u5305\u542B"},set:{unit:"\u9879",verb:"\u5305\u542B"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"\u975E\u6570\u5B57(NaN)":"\u6570\u5B57";case"object":{if(Array.isArray(t))return"\u6570\u7EC4";if(t===null)return"\u7A7A\u503C(null)";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"\u8F93\u5165",email:"\u7535\u5B50\u90AE\u4EF6",url:"URL",emoji:"\u8868\u60C5\u7B26\u53F7",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO\u65E5\u671F\u65F6\u95F4",date:"ISO\u65E5\u671F",time:"ISO\u65F6\u95F4",duration:"ISO\u65F6\u957F",ipv4:"IPv4\u5730\u5740",ipv6:"IPv6\u5730\u5740",cidrv4:"IPv4\u7F51\u6BB5",cidrv6:"IPv6\u7F51\u6BB5",base64:"base64\u7F16\u7801\u5B57\u7B26\u4E32",base64url:"base64url\u7F16\u7801\u5B57\u7B26\u4E32",json_string:"JSON\u5B57\u7B26\u4E32",e164:"E.164\u53F7\u7801",jwt:"JWT",template_literal:"\u8F93\u5165"};return t=>{switch(t.code){case"invalid_type":return`\u65E0\u6548\u8F93\u5165\uFF1A\u671F\u671B ${t.expected}\uFF0C\u5B9E\u9645\u63A5\u6536 ${r(t.input)}`;case"invalid_value":return t.values.length===1?`\u65E0\u6548\u8F93\u5165\uFF1A\u671F\u671B ${A(t.values[0])}`:`\u65E0\u6548\u9009\u9879\uFF1A\u671F\u671B\u4EE5\u4E0B\u4E4B\u4E00 ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`\u6570\u503C\u8FC7\u5927\uFF1A\u671F\u671B ${t.origin??"\u503C"} ${o}${t.maximum.toString()} ${s.unit??"\u4E2A\u5143\u7D20"}`:`\u6570\u503C\u8FC7\u5927\uFF1A\u671F\u671B ${t.origin??"\u503C"} ${o}${t.maximum.toString()}`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`\u6570\u503C\u8FC7\u5C0F\uFF1A\u671F\u671B ${t.origin} ${o}${t.minimum.toString()} ${s.unit}`:`\u6570\u503C\u8FC7\u5C0F\uFF1A\u671F\u671B ${t.origin} ${o}${t.minimum.toString()}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`\u65E0\u6548\u5B57\u7B26\u4E32\uFF1A\u5FC5\u987B\u4EE5 "${o.prefix}" \u5F00\u5934`:o.format==="ends_with"?`\u65E0\u6548\u5B57\u7B26\u4E32\uFF1A\u5FC5\u987B\u4EE5 "${o.suffix}" \u7ED3\u5C3E`:o.format==="includes"?`\u65E0\u6548\u5B57\u7B26\u4E32\uFF1A\u5FC5\u987B\u5305\u542B "${o.includes}"`:o.format==="regex"?`\u65E0\u6548\u5B57\u7B26\u4E32\uFF1A\u5FC5\u987B\u6EE1\u8DB3\u6B63\u5219\u8868\u8FBE\u5F0F ${o.pattern}`:`\u65E0\u6548${i[o.format]??t.format}`}case"not_multiple_of":return`\u65E0\u6548\u6570\u5B57\uFF1A\u5FC5\u987B\u662F ${t.divisor} \u7684\u500D\u6570`;case"unrecognized_keys":return`\u51FA\u73B0\u672A\u77E5\u7684\u952E(key): ${_(t.keys,", ")}`;case"invalid_key":return`${t.origin} \u4E2D\u7684\u952E(key)\u65E0\u6548`;case"invalid_union":return"\u65E0\u6548\u8F93\u5165";case"invalid_element":return`${t.origin} \u4E2D\u5305\u542B\u65E0\u6548\u503C(value)`;default:return"\u65E0\u6548\u8F93\u5165"}}};function Rg(){return{localeError:pS()}}var gS=()=>{let n={string:{unit:"\u5B57\u5143",verb:"\u64C1\u6709"},file:{unit:"\u4F4D\u5143\u7D44",verb:"\u64C1\u6709"},array:{unit:"\u9805\u76EE",verb:"\u64C1\u6709"},set:{unit:"\u9805\u76EE",verb:"\u64C1\u6709"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"number";case"object":{if(Array.isArray(t))return"array";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"\u8F38\u5165",email:"\u90F5\u4EF6\u5730\u5740",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO \u65E5\u671F\u6642\u9593",date:"ISO \u65E5\u671F",time:"ISO \u6642\u9593",duration:"ISO \u671F\u9593",ipv4:"IPv4 \u4F4D\u5740",ipv6:"IPv6 \u4F4D\u5740",cidrv4:"IPv4 \u7BC4\u570D",cidrv6:"IPv6 \u7BC4\u570D",base64:"base64 \u7DE8\u78BC\u5B57\u4E32",base64url:"base64url \u7DE8\u78BC\u5B57\u4E32",json_string:"JSON \u5B57\u4E32",e164:"E.164 \u6578\u503C",jwt:"JWT",template_literal:"\u8F38\u5165"};return t=>{switch(t.code){case"invalid_type":return`\u7121\u6548\u7684\u8F38\u5165\u503C\uFF1A\u9810\u671F\u70BA ${t.expected}\uFF0C\u4F46\u6536\u5230 ${r(t.input)}`;case"invalid_value":return t.values.length===1?`\u7121\u6548\u7684\u8F38\u5165\u503C\uFF1A\u9810\u671F\u70BA ${A(t.values[0])}`:`\u7121\u6548\u7684\u9078\u9805\uFF1A\u9810\u671F\u70BA\u4EE5\u4E0B\u5176\u4E2D\u4E4B\u4E00 ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`\u6578\u503C\u904E\u5927\uFF1A\u9810\u671F ${t.origin??"\u503C"} \u61C9\u70BA ${o}${t.maximum.toString()} ${s.unit??"\u500B\u5143\u7D20"}`:`\u6578\u503C\u904E\u5927\uFF1A\u9810\u671F ${t.origin??"\u503C"} \u61C9\u70BA ${o}${t.maximum.toString()}`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`\u6578\u503C\u904E\u5C0F\uFF1A\u9810\u671F ${t.origin} \u61C9\u70BA ${o}${t.minimum.toString()} ${s.unit}`:`\u6578\u503C\u904E\u5C0F\uFF1A\u9810\u671F ${t.origin} \u61C9\u70BA ${o}${t.minimum.toString()}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`\u7121\u6548\u7684\u5B57\u4E32\uFF1A\u5FC5\u9808\u4EE5 "${o.prefix}" \u958B\u982D`:o.format==="ends_with"?`\u7121\u6548\u7684\u5B57\u4E32\uFF1A\u5FC5\u9808\u4EE5 "${o.suffix}" \u7D50\u5C3E`:o.format==="includes"?`\u7121\u6548\u7684\u5B57\u4E32\uFF1A\u5FC5\u9808\u5305\u542B "${o.includes}"`:o.format==="regex"?`\u7121\u6548\u7684\u5B57\u4E32\uFF1A\u5FC5\u9808\u7B26\u5408\u683C\u5F0F ${o.pattern}`:`\u7121\u6548\u7684 ${i[o.format]??t.format}`}case"not_multiple_of":return`\u7121\u6548\u7684\u6578\u5B57\uFF1A\u5FC5\u9808\u70BA ${t.divisor} \u7684\u500D\u6578`;case"unrecognized_keys":return`\u7121\u6CD5\u8B58\u5225\u7684\u9375\u503C${t.keys.length>1?"\u5011":""}\uFF1A${_(t.keys,"\u3001")}`;case"invalid_key":return`${t.origin} \u4E2D\u6709\u7121\u6548\u7684\u9375\u503C`;case"invalid_union":return"\u7121\u6548\u7684\u8F38\u5165\u503C";case"invalid_element":return`${t.origin} \u4E2D\u6709\u7121\u6548\u7684\u503C`;default:return"\u7121\u6548\u7684\u8F38\u5165\u503C"}}};function Og(){return{localeError:gS()}}var hS=()=>{let n={string:{unit:"\xE0mi",verb:"n\xED"},file:{unit:"bytes",verb:"n\xED"},array:{unit:"nkan",verb:"n\xED"},set:{unit:"nkan",verb:"n\xED"}};function e(t){return n[t]??null}let r=t=>{let o=typeof t;switch(o){case"number":return Number.isNaN(t)?"NaN":"n\u1ECD\u0301mb\xE0";case"object":{if(Array.isArray(t))return"akop\u1ECD";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return o},i={regex:"\u1EB9\u0300r\u1ECD \xECb\xE1w\u1ECDl\xE9",email:"\xE0d\xEDr\u1EB9\u0301s\xEC \xECm\u1EB9\u0301l\xEC",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"\xE0k\xF3k\xF2 ISO",date:"\u1ECDj\u1ECD\u0301 ISO",time:"\xE0k\xF3k\xF2 ISO",duration:"\xE0k\xF3k\xF2 t\xF3 p\xE9 ISO",ipv4:"\xE0d\xEDr\u1EB9\u0301s\xEC IPv4",ipv6:"\xE0d\xEDr\u1EB9\u0301s\xEC IPv6",cidrv4:"\xE0gb\xE8gb\xE8 IPv4",cidrv6:"\xE0gb\xE8gb\xE8 IPv6",base64:"\u1ECD\u0300r\u1ECD\u0300 t\xED a k\u1ECD\u0301 n\xED base64",base64url:"\u1ECD\u0300r\u1ECD\u0300 base64url",json_string:"\u1ECD\u0300r\u1ECD\u0300 JSON",e164:"n\u1ECD\u0301mb\xE0 E.164",jwt:"JWT",template_literal:"\u1EB9\u0300r\u1ECD \xECb\xE1w\u1ECDl\xE9"};return t=>{switch(t.code){case"invalid_type":return`\xCCb\xE1w\u1ECDl\xE9 a\u1E63\xEC\u1E63e: a n\xED l\xE1ti fi ${t.expected}, \xE0m\u1ECD\u0300 a r\xED ${r(t.input)}`;case"invalid_value":return t.values.length===1?`\xCCb\xE1w\u1ECDl\xE9 a\u1E63\xEC\u1E63e: a n\xED l\xE1ti fi ${A(t.values[0])}`:`\xC0\u1E63\xE0y\xE0n a\u1E63\xEC\u1E63e: yan \u1ECD\u0300kan l\xE1ra ${_(t.values,"|")}`;case"too_big":{let o=t.inclusive?"<=":"<",s=e(t.origin);return s?`T\xF3 p\u1ECD\u0300 j\xF9: a n\xED l\xE1ti j\u1EB9\u0301 p\xE9 ${t.origin??"iye"} ${s.verb} ${o}${t.maximum} ${s.unit}`:`T\xF3 p\u1ECD\u0300 j\xF9: a n\xED l\xE1ti j\u1EB9\u0301 ${o}${t.maximum}`}case"too_small":{let o=t.inclusive?">=":">",s=e(t.origin);return s?`K\xE9r\xE9 ju: a n\xED l\xE1ti j\u1EB9\u0301 p\xE9 ${t.origin} ${s.verb} ${o}${t.minimum} ${s.unit}`:`K\xE9r\xE9 ju: a n\xED l\xE1ti j\u1EB9\u0301 ${o}${t.minimum}`}case"invalid_format":{let o=t;return o.format==="starts_with"?`\u1ECC\u0300r\u1ECD\u0300 a\u1E63\xEC\u1E63e: gb\u1ECD\u0301d\u1ECD\u0300 b\u1EB9\u0300r\u1EB9\u0300 p\u1EB9\u0300l\xFA "${o.prefix}"`:o.format==="ends_with"?`\u1ECC\u0300r\u1ECD\u0300 a\u1E63\xEC\u1E63e: gb\u1ECD\u0301d\u1ECD\u0300 par\xED p\u1EB9\u0300l\xFA "${o.suffix}"`:o.format==="includes"?`\u1ECC\u0300r\u1ECD\u0300 a\u1E63\xEC\u1E63e: gb\u1ECD\u0301d\u1ECD\u0300 n\xED "${o.includes}"`:o.format==="regex"?`\u1ECC\u0300r\u1ECD\u0300 a\u1E63\xEC\u1E63e: gb\u1ECD\u0301d\u1ECD\u0300 b\xE1 \xE0p\u1EB9\u1EB9r\u1EB9 mu ${o.pattern}`:`A\u1E63\xEC\u1E63e: ${i[o.format]??t.format}`}case"not_multiple_of":return`N\u1ECD\u0301mb\xE0 a\u1E63\xEC\u1E63e: gb\u1ECD\u0301d\u1ECD\u0300 j\u1EB9\u0301 \xE8y\xE0 p\xEDp\xEDn ti ${t.divisor}`;case"unrecognized_keys":return`B\u1ECDt\xECn\xEC \xE0\xECm\u1ECD\u0300: ${_(t.keys,", ")}`;case"invalid_key":return`B\u1ECDt\xECn\xEC a\u1E63\xEC\u1E63e n\xEDn\xFA ${t.origin}`;case"invalid_union":return"\xCCb\xE1w\u1ECDl\xE9 a\u1E63\xEC\u1E63e";case"invalid_element":return`Iye a\u1E63\xEC\u1E63e n\xEDn\xFA ${t.origin}`;default:return"\xCCb\xE1w\u1ECDl\xE9 a\u1E63\xEC\u1E63e"}}};function Mg(){return{localeError:hS()}}var mu=Symbol("ZodOutput"),pu=Symbol("ZodInput"),On=class{constructor(){this._map=new Map,this._idmap=new Map}add(e,...r){let i=r[0];if(this._map.set(e,i),i&&typeof i=="object"&&"id"in i){if(this._idmap.has(i.id))throw new Error(`ID ${i.id} already exists in the registry`);this._idmap.set(i.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){let r=this._map.get(e);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(e),this}get(e){let r=e._zod.parent;if(r){let i={...this.get(r)??{}};delete i.id;let t={...i,...this._map.get(e)};return Object.keys(t).length?t:void 0}return this._map.get(e)}has(e){return this._map.has(e)}};function Go(){return new On}var Ht=Go();function gu(n,e){return new n({type:"string",...j(e)})}function hu(n,e){return new n({type:"string",coerce:!0,...j(e)})}function Ho(n,e){return new n({type:"string",format:"email",check:"string_format",abort:!1,...j(e)})}function Ai(n,e){return new n({type:"string",format:"guid",check:"string_format",abort:!1,...j(e)})}function qo(n,e){return new n({type:"string",format:"uuid",check:"string_format",abort:!1,...j(e)})}function Jo(n,e){return new n({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...j(e)})}function Ko(n,e){return new n({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...j(e)})}function Qo(n,e){return new n({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...j(e)})}function Yo(n,e){return new n({type:"string",format:"url",check:"string_format",abort:!1,...j(e)})}function Xo(n,e){return new n({type:"string",format:"emoji",check:"string_format",abort:!1,...j(e)})}function es(n,e){return new n({type:"string",format:"nanoid",check:"string_format",abort:!1,...j(e)})}function ts(n,e){return new n({type:"string",format:"cuid",check:"string_format",abort:!1,...j(e)})}function rs(n,e){return new n({type:"string",format:"cuid2",check:"string_format",abort:!1,...j(e)})}function ns(n,e){return new n({type:"string",format:"ulid",check:"string_format",abort:!1,...j(e)})}function is(n,e){return new n({type:"string",format:"xid",check:"string_format",abort:!1,...j(e)})}function os(n,e){return new n({type:"string",format:"ksuid",check:"string_format",abort:!1,...j(e)})}function ss(n,e){return new n({type:"string",format:"ipv4",check:"string_format",abort:!1,...j(e)})}function as(n,e){return new n({type:"string",format:"ipv6",check:"string_format",abort:!1,...j(e)})}function cs(n,e){return new n({type:"string",format:"cidrv4",check:"string_format",abort:!1,...j(e)})}function ls(n,e){return new n({type:"string",format:"cidrv6",check:"string_format",abort:!1,...j(e)})}function us(n,e){return new n({type:"string",format:"base64",check:"string_format",abort:!1,...j(e)})}function ds(n,e){return new n({type:"string",format:"base64url",check:"string_format",abort:!1,...j(e)})}function fs(n,e){return new n({type:"string",format:"e164",check:"string_format",abort:!1,...j(e)})}function ms(n,e){return new n({type:"string",format:"jwt",check:"string_format",abort:!1,...j(e)})}var vu={Any:null,Minute:-1,Second:0,Millisecond:3,Microsecond:6};function yu(n,e){return new n({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...j(e)})}function bu(n,e){return new n({type:"string",format:"date",check:"string_format",...j(e)})}function wu(n,e){return new n({type:"string",format:"time",check:"string_format",precision:null,...j(e)})}function Su(n,e){return new n({type:"string",format:"duration",check:"string_format",...j(e)})}function $u(n,e){return new n({type:"number",checks:[],...j(e)})}function xu(n,e){return new n({type:"number",coerce:!0,checks:[],...j(e)})}function ku(n,e){return new n({type:"number",check:"number_format",abort:!1,format:"safeint",...j(e)})}function _u(n,e){return new n({type:"number",check:"number_format",abort:!1,format:"float32",...j(e)})}function Pu(n,e){return new n({type:"number",check:"number_format",abort:!1,format:"float64",...j(e)})}function Tu(n,e){return new n({type:"number",check:"number_format",abort:!1,format:"int32",...j(e)})}function Iu(n,e){return new n({type:"number",check:"number_format",abort:!1,format:"uint32",...j(e)})}function Eu(n,e){return new n({type:"boolean",...j(e)})}function Cu(n,e){return new n({type:"boolean",coerce:!0,...j(e)})}function Nu(n,e){return new n({type:"bigint",...j(e)})}function ju(n,e){return new n({type:"bigint",coerce:!0,...j(e)})}function Au(n,e){return new n({type:"bigint",check:"bigint_format",abort:!1,format:"int64",...j(e)})}function zu(n,e){return new n({type:"bigint",check:"bigint_format",abort:!1,format:"uint64",...j(e)})}function Du(n,e){return new n({type:"symbol",...j(e)})}function Ru(n,e){return new n({type:"undefined",...j(e)})}function Ou(n,e){return new n({type:"null",...j(e)})}function Mu(n){return new n({type:"any"})}function Mn(n){return new n({type:"unknown"})}function Uu(n,e){return new n({type:"never",...j(e)})}function Fu(n,e){return new n({type:"void",...j(e)})}function Lu(n,e){return new n({type:"date",...j(e)})}function Bu(n,e){return new n({type:"date",coerce:!0,...j(e)})}function Wu(n,e){return new n({type:"nan",...j(e)})}function cr(n,e){return new Mo({check:"less_than",...j(e),value:n,inclusive:!1})}function _t(n,e){return new Mo({check:"less_than",...j(e),value:n,inclusive:!0})}function lr(n,e){return new Uo({check:"greater_than",...j(e),value:n,inclusive:!1})}function ct(n,e){return new Uo({check:"greater_than",...j(e),value:n,inclusive:!0})}function Zu(n){return lr(0,n)}function Vu(n){return cr(0,n)}function Gu(n){return _t(0,n)}function Hu(n){return ct(0,n)}function Yr(n,e){return new Vc({check:"multiple_of",...j(e),value:n})}function Un(n,e){return new qc({check:"max_size",...j(e),maximum:n})}function Xr(n,e){return new Jc({check:"min_size",...j(e),minimum:n})}function zi(n,e){return new Kc({check:"size_equals",...j(e),size:n})}function Fn(n,e){return new Qc({check:"max_length",...j(e),maximum:n})}function zr(n,e){return new Yc({check:"min_length",...j(e),minimum:n})}function Ln(n,e){return new Xc({check:"length_equals",...j(e),length:n})}function Di(n,e){return new el({check:"string_format",format:"regex",...j(e),pattern:n})}function Ri(n){return new tl({check:"string_format",format:"lowercase",...j(n)})}function Oi(n){return new rl({check:"string_format",format:"uppercase",...j(n)})}function Mi(n,e){return new nl({check:"string_format",format:"includes",...j(e),includes:n})}function Ui(n,e){return new il({check:"string_format",format:"starts_with",...j(e),prefix:n})}function Fi(n,e){return new ol({check:"string_format",format:"ends_with",...j(e),suffix:n})}function qu(n,e,r){return new sl({check:"property",property:n,schema:e,...j(r)})}function Li(n,e){return new al({check:"mime_type",mime:n,...j(e)})}function ur(n){return new cl({check:"overwrite",tx:n})}function Bi(n){return ur(e=>e.normalize(n))}function Wi(){return ur(n=>n.trim())}function Zi(){return ur(n=>n.toLowerCase())}function Vi(){return ur(n=>n.toUpperCase())}function Gi(n,e,r){return new n({type:"array",element:e,...j(r)})}function vS(n,e,r){return new n({type:"union",options:e,...j(r)})}function yS(n,e,r,i){return new n({type:"union",options:r,discriminator:e,...j(i)})}function bS(n,e,r){return new n({type:"intersection",left:e,right:r})}function Ju(n,e,r,i){let t=r instanceof G,o=t?i:r,s=t?r:null;return new n({type:"tuple",items:e,rest:s,...j(o)})}function wS(n,e,r,i){return new n({type:"record",keyType:e,valueType:r,...j(i)})}function SS(n,e,r,i){return new n({type:"map",keyType:e,valueType:r,...j(i)})}function $S(n,e,r){return new n({type:"set",valueType:e,...j(r)})}function xS(n,e,r){let i=Array.isArray(e)?Object.fromEntries(e.map(t=>[t,t])):e;return new n({type:"enum",entries:i,...j(r)})}function kS(n,e,r){return new n({type:"enum",entries:e,...j(r)})}function _S(n,e,r){return new n({type:"literal",values:Array.isArray(e)?e:[e],...j(r)})}function Ku(n,e){return new n({type:"file",...j(e)})}function PS(n,e){return new n({type:"transform",transform:e})}function TS(n,e){return new n({type:"optional",innerType:e})}function IS(n,e){return new n({type:"nullable",innerType:e})}function ES(n,e,r){return new n({type:"default",innerType:e,get defaultValue(){return typeof r=="function"?r():r}})}function CS(n,e,r){return new n({type:"nonoptional",innerType:e,...j(r)})}function NS(n,e){return new n({type:"success",innerType:e})}function jS(n,e,r){return new n({type:"catch",innerType:e,catchValue:typeof r=="function"?r:()=>r})}function AS(n,e,r){return new n({type:"pipe",in:e,out:r})}function zS(n,e){return new n({type:"readonly",innerType:e})}function DS(n,e,r){return new n({type:"template_literal",parts:e,...j(r)})}function RS(n,e){return new n({type:"lazy",getter:e})}function OS(n,e){return new n({type:"promise",innerType:e})}function Qu(n,e,r){let i=j(r);return i.abort??(i.abort=!0),new n({type:"custom",check:"custom",fn:e,...i})}function Yu(n,e,r){return new n({type:"custom",check:"custom",fn:e,...j(r)})}function Xu(n){let e=Ug(r=>(r.addIssue=i=>{if(typeof i=="string")r.issues.push(An(i,r.value,e._zod.def));else{let t=i;t.fatal&&(t.continue=!1),t.code??(t.code="custom"),t.input??(t.input=r.value),t.inst??(t.inst=e),t.continue??(t.continue=!e._zod.def.abort),r.issues.push(An(t))}},n(r.value,r)));return e}function Ug(n,e){let r=new ye({check:"custom",...j(e)});return r._zod.check=n,r}function ed(n,e){let r=j(e),i=r.truthy??["true","1","yes","on","y","enabled"],t=r.falsy??["false","0","no","off","n","disabled"];r.case!=="sensitive"&&(i=i.map(m=>typeof m=="string"?m.toLowerCase():m),t=t.map(m=>typeof m=="string"?m.toLowerCase():m));let o=new Set(i),s=new Set(t),a=n.Pipe??Ni,c=n.Boolean??Ii,l=n.String??Kr,u=n.Transform??Ci,d=new u({type:"transform",transform:(m,g)=>{let h=m;return r.case!=="sensitive"&&(h=h.toLowerCase()),o.has(h)?!0:s.has(h)?!1:(g.issues.push({code:"invalid_value",expected:"stringbool",values:[...o,...s],input:g.value,inst:d,continue:!1}),{})},error:r.error}),f=new a({type:"pipe",in:new l({type:"string",error:r.error}),out:d,error:r.error});return new a({type:"pipe",in:f,out:new c({type:"boolean",error:r.error}),error:r.error})}function ps(n,e,r,i={}){let t=j(i),o={...j(i),check:"string_format",type:"string",format:e,fn:typeof r=="function"?r:a=>r.test(a),...t};return r instanceof RegExp&&(o.pattern=r),new n(o)}var gs=class{constructor(e){this._def=e,this.def=e}implement(e){if(typeof e!="function")throw new Error("implement() must be called with a function");let r=(...i)=>{let t=this._def.input?jo(this._def.input,i,void 0,{callee:r}):i;if(!Array.isArray(t))throw new Error("Invalid arguments schema: not an array or tuple schema.");let o=e(...t);return this._def.output?jo(this._def.output,o,void 0,{callee:r}):o};return r}implementAsync(e){if(typeof e!="function")throw new Error("implement() must be called with a function");let r=async(...i)=>{let t=this._def.input?await zo(this._def.input,i,void 0,{callee:r}):i;if(!Array.isArray(t))throw new Error("Invalid arguments schema: not an array or tuple schema.");let o=await e(...t);return this._def.output?zo(this._def.output,o,void 0,{callee:r}):o};return r}input(...e){let r=this.constructor;return Array.isArray(e[0])?new r({type:"function",input:new Qr({type:"tuple",items:e[0],rest:e[1]}),output:this._def.output}):new r({type:"function",input:e[0],output:this._def.output})}output(e){let r=this.constructor;return new r({type:"function",input:this._def.input,output:e})}};function td(n){return new gs({type:"function",input:Array.isArray(n?.input)?Ju(Qr,n?.input):n?.input??Gi(Ei,Mn(Rn)),output:n?.output??Mn(Rn)})}var Hi=class{constructor(e){this.counter=0,this.metadataRegistry=e?.metadata??Ht,this.target=e?.target??"draft-2020-12",this.unrepresentable=e?.unrepresentable??"throw",this.override=e?.override??(()=>{}),this.io=e?.io??"output",this.seen=new Map}process(e,r={path:[],schemaPath:[]}){var i;let t=e._zod.def,o={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},s=this.seen.get(e);if(s)return s.count++,r.schemaPath.includes(e)&&(s.cycle=r.path),s.schema;let a={schema:{},count:1,cycle:void 0,path:r.path};this.seen.set(e,a);let c=e._zod.toJSONSchema?.();if(c)a.schema=c;else{let d={...r,schemaPath:[...r.schemaPath,e],path:r.path},f=e._zod.parent;if(f)a.ref=f,this.process(f,d),this.seen.get(f).isParent=!0;else{let p=a.schema;switch(t.type){case"string":{let m=p;m.type="string";let{minimum:g,maximum:h,format:S,patterns:y,contentEncoding:k}=e._zod.bag;if(typeof g=="number"&&(m.minLength=g),typeof h=="number"&&(m.maxLength=h),S&&(m.format=o[S]??S,m.format===""&&delete m.format),k&&(m.contentEncoding=k),y&&y.size>0){let b=[...y];b.length===1?m.pattern=b[0].source:b.length>1&&(a.schema.allOf=[...b.map(R=>({...this.target==="draft-7"||this.target==="draft-4"?{type:"string"}:{},pattern:R.source}))])}break}case"number":{let m=p,{minimum:g,maximum:h,format:S,multipleOf:y,exclusiveMaximum:k,exclusiveMinimum:b}=e._zod.bag;typeof S=="string"&&S.includes("int")?m.type="integer":m.type="number",typeof b=="number"&&(this.target==="draft-4"?(m.minimum=b,m.exclusiveMinimum=!0):m.exclusiveMinimum=b),typeof g=="number"&&(m.minimum=g,typeof b=="number"&&this.target!=="draft-4"&&(b>=g?delete m.minimum:delete m.exclusiveMinimum)),typeof k=="number"&&(this.target==="draft-4"?(m.maximum=k,m.exclusiveMaximum=!0):m.exclusiveMaximum=k),typeof h=="number"&&(m.maximum=h,typeof k=="number"&&this.target!=="draft-4"&&(k<=h?delete m.maximum:delete m.exclusiveMaximum)),typeof y=="number"&&(m.multipleOf=y);break}case"boolean":{let m=p;m.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{p.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{p.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{let m=p,{minimum:g,maximum:h}=e._zod.bag;typeof g=="number"&&(m.minItems=g),typeof h=="number"&&(m.maxItems=h),m.type="array",m.items=this.process(t.element,{...d,path:[...d.path,"items"]});break}case"object":{let m=p;m.type="object",m.properties={};let g=t.shape;for(let y in g)m.properties[y]=this.process(g[y],{...d,path:[...d.path,"properties",y]});let h=new Set(Object.keys(g)),S=new Set([...h].filter(y=>{let k=t.shape[y]._zod;return this.io==="input"?k.optin===void 0:k.optout===void 0}));S.size>0&&(m.required=Array.from(S)),t.catchall?._zod.def.type==="never"?m.additionalProperties=!1:t.catchall?t.catchall&&(m.additionalProperties=this.process(t.catchall,{...d,path:[...d.path,"additionalProperties"]})):this.io==="output"&&(m.additionalProperties=!1);break}case"union":{let m=p;m.anyOf=t.options.map((g,h)=>this.process(g,{...d,path:[...d.path,"anyOf",h]}));break}case"intersection":{let m=p,g=this.process(t.left,{...d,path:[...d.path,"allOf",0]}),h=this.process(t.right,{...d,path:[...d.path,"allOf",1]}),S=k=>"allOf"in k&&Object.keys(k).length===1,y=[...S(g)?g.allOf:[g],...S(h)?h.allOf:[h]];m.allOf=y;break}case"tuple":{let m=p;m.type="array";let g=t.items.map((y,k)=>this.process(y,{...d,path:[...d.path,"prefixItems",k]}));if(this.target==="draft-2020-12"?m.prefixItems=g:m.items=g,t.rest){let y=this.process(t.rest,{...d,path:[...d.path,"items"]});this.target==="draft-2020-12"?m.items=y:m.additionalItems=y}t.rest&&(m.items=this.process(t.rest,{...d,path:[...d.path,"items"]}));let{minimum:h,maximum:S}=e._zod.bag;typeof h=="number"&&(m.minItems=h),typeof S=="number"&&(m.maxItems=S);break}case"record":{let m=p;m.type="object",this.target!=="draft-4"&&(m.propertyNames=this.process(t.keyType,{...d,path:[...d.path,"propertyNames"]})),m.additionalProperties=this.process(t.valueType,{...d,path:[...d.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{let m=p,g=yi(t.entries);g.every(h=>typeof h=="number")&&(m.type="number"),g.every(h=>typeof h=="string")&&(m.type="string"),m.enum=g;break}case"literal":{let m=p,g=[];for(let h of t.values)if(h===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof h=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");g.push(Number(h))}else g.push(h);if(g.length!==0)if(g.length===1){let h=g[0];m.type=h===null?"null":typeof h,this.target==="draft-4"?m.enum=[h]:m.const=h}else g.every(h=>typeof h=="number")&&(m.type="number"),g.every(h=>typeof h=="string")&&(m.type="string"),g.every(h=>typeof h=="boolean")&&(m.type="string"),g.every(h=>h===null)&&(m.type="null"),m.enum=g;break}case"file":{let m=p,g={type:"string",format:"binary",contentEncoding:"binary"},{minimum:h,maximum:S,mime:y}=e._zod.bag;h!==void 0&&(g.minLength=h),S!==void 0&&(g.maxLength=S),y?y.length===1?(g.contentMediaType=y[0],Object.assign(m,g)):m.anyOf=y.map(k=>({...g,contentMediaType:k})):Object.assign(m,g);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{let m=this.process(t.innerType,d);p.anyOf=[m,{type:"null"}];break}case"nonoptional":{this.process(t.innerType,d),a.ref=t.innerType;break}case"success":{let m=p;m.type="boolean";break}case"default":{this.process(t.innerType,d),a.ref=t.innerType,p.default=JSON.parse(JSON.stringify(t.defaultValue));break}case"prefault":{this.process(t.innerType,d),a.ref=t.innerType,this.io==="input"&&(p._prefault=JSON.parse(JSON.stringify(t.defaultValue)));break}case"catch":{this.process(t.innerType,d),a.ref=t.innerType;let m;try{m=t.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}p.default=m;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{let m=p,g=e._zod.pattern;if(!g)throw new Error("Pattern not found in template literal");m.type="string",m.pattern=g.source;break}case"pipe":{let m=this.io==="input"?t.in._zod.def.type==="transform"?t.out:t.in:t.out;this.process(m,d),a.ref=m;break}case"readonly":{this.process(t.innerType,d),a.ref=t.innerType,p.readOnly=!0;break}case"promise":{this.process(t.innerType,d),a.ref=t.innerType;break}case"optional":{this.process(t.innerType,d),a.ref=t.innerType;break}case"lazy":{let m=e._zod.innerType;this.process(m,d),a.ref=m;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}default:}}}let l=this.metadataRegistry.get(e);return l&&Object.assign(a.schema,l),this.io==="input"&&De(e)&&(delete a.schema.examples,delete a.schema.default),this.io==="input"&&a.schema._prefault&&((i=a.schema).default??(i.default=a.schema._prefault)),delete a.schema._prefault,this.seen.get(e).schema}emit(e,r){let i={cycles:r?.cycles??"ref",reused:r?.reused??"inline",external:r?.external??void 0},t=this.seen.get(e);if(!t)throw new Error("Unprocessed schema. This is a bug in Zod.");let o=u=>{let d=this.target==="draft-2020-12"?"$defs":"definitions";if(i.external){let g=i.external.registry.get(u[0])?.id,h=i.external.uri??(y=>y);if(g)return{ref:h(g)};let S=u[1].defId??u[1].schema.id??`schema${this.counter++}`;return u[1].defId=S,{defId:S,ref:`${h("__shared")}#/${d}/${S}`}}if(u[1]===t)return{ref:"#"};let p=`#/${d}/`,m=u[1].schema.id??`__schema${this.counter++}`;return{defId:m,ref:p+m}},s=u=>{if(u[1].schema.$ref)return;let d=u[1],{ref:f,defId:p}=o(u);d.def={...d.schema},p&&(d.defId=p);let m=d.schema;for(let g in m)delete m[g];m.$ref=f};if(i.cycles==="throw")for(let u of this.seen.entries()){let d=u[1];if(d.cycle)throw new Error(`Cycle detected: #/${d.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let u of this.seen.entries()){let d=u[1];if(e===u[0]){s(u);continue}if(i.external){let p=i.external.registry.get(u[0])?.id;if(e!==u[0]&&p){s(u);continue}}if(this.metadataRegistry.get(u[0])?.id){s(u);continue}if(d.cycle){s(u);continue}if(d.count>1&&i.reused==="ref"){s(u);continue}}let a=(u,d)=>{let f=this.seen.get(u),p=f.def??f.schema,m={...p};if(f.ref===null)return;let g=f.ref;if(f.ref=null,g){a(g,d);let h=this.seen.get(g).schema;h.$ref&&(d.target==="draft-7"||d.target==="draft-4")?(p.allOf=p.allOf??[],p.allOf.push(h)):(Object.assign(p,h),Object.assign(p,m))}f.isParent||this.override({zodSchema:u,jsonSchema:p,path:f.path??[]})};for(let u of[...this.seen.entries()].reverse())a(u[0],{target:this.target});let c={};if(this.target==="draft-2020-12"?c.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?c.$schema="http://json-schema.org/draft-07/schema#":this.target==="draft-4"?c.$schema="http://json-schema.org/draft-04/schema#":console.warn(`Invalid target: ${this.target}`),i.external?.uri){let u=i.external.registry.get(e)?.id;if(!u)throw new Error("Schema is missing an `id` property");c.$id=i.external.uri(u)}Object.assign(c,t.def);let l=i.external?.defs??{};for(let u of this.seen.entries()){let d=u[1];d.def&&d.defId&&(l[d.defId]=d.def)}i.external||Object.keys(l).length>0&&(this.target==="draft-2020-12"?c.$defs=l:c.definitions=l);try{return JSON.parse(JSON.stringify(c))}catch{throw new Error("Error converting schema to JSON.")}}};function rd(n,e){if(n instanceof On){let i=new Hi(e),t={};for(let a of n._idmap.entries()){let[c,l]=a;i.process(l)}let o={},s={registry:n,uri:e?.uri,defs:t};for(let a of n._idmap.entries()){let[c,l]=a;o[c]=i.emit(l,{...e,external:s})}if(Object.keys(t).length>0){let a=i.target==="draft-2020-12"?"$defs":"definitions";o.__shared={[a]:t}}return{schemas:o}}let r=new Hi(e);return r.process(n),r.emit(n,e)}function De(n,e){let r=e??{seen:new Set};if(r.seen.has(n))return!1;r.seen.add(n);let t=n._zod.def;switch(t.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return De(t.element,r);case"object":{for(let o in t.shape)if(De(t.shape[o],r))return!0;return!1}case"union":{for(let o of t.options)if(De(o,r))return!0;return!1}case"intersection":return De(t.left,r)||De(t.right,r);case"tuple":{for(let o of t.items)if(De(o,r))return!0;return!!(t.rest&&De(t.rest,r))}case"record":return De(t.keyType,r)||De(t.valueType,r);case"map":return De(t.keyType,r)||De(t.valueType,r);case"set":return De(t.valueType,r);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return De(t.innerType,r);case"lazy":return De(t.getter(),r);case"default":return De(t.innerType,r);case"prefault":return De(t.innerType,r);case"custom":return!1;case"transform":return!0;case"pipe":return De(t.in,r)||De(t.out,r);case"success":return!1;case"catch":return!1;default:}throw new Error(`Unknown schema type: ${t.type}`)}var Fg={};var ws={};Et(ws,{ZodISODate:()=>vs,ZodISODateTime:()=>hs,ZodISODuration:()=>bs,ZodISOTime:()=>ys,date:()=>id,datetime:()=>nd,duration:()=>sd,time:()=>od});var hs=w("ZodISODateTime",(n,e)=>{$l.init(n,e),pe.init(n,e)});function nd(n){return yu(hs,n)}var vs=w("ZodISODate",(n,e)=>{xl.init(n,e),pe.init(n,e)});function id(n){return bu(vs,n)}var ys=w("ZodISOTime",(n,e)=>{kl.init(n,e),pe.init(n,e)});function od(n){return wu(ys,n)}var bs=w("ZodISODuration",(n,e)=>{_l.init(n,e),pe.init(n,e)});function sd(n){return Su(bs,n)}var Bg=(n,e)=>{ki.init(n,e),n.name="ZodError",Object.defineProperties(n,{format:{value:r=>Pi(n,r)},flatten:{value:r=>_i(n,r)},addIssue:{value:r=>{n.issues.push(r),n.message=JSON.stringify(n.issues,Nn,2)}},addIssues:{value:r=>{n.issues.push(...r),n.message=JSON.stringify(n.issues,Nn,2)}},isEmpty:{get(){return n.issues.length===0}}})},US=w("ZodError",Bg),Bn=w("ZodError",Bg,{Parent:Error});var ad=No(Bn),cd=Ao(Bn),ld=Do(Bn),ud=Ro(Bn);var Y=w("ZodType",(n,e)=>(G.init(n,e),n.def=e,Object.defineProperty(n,"_def",{value:e}),n.check=(...r)=>n.clone({...e,checks:[...e.checks??[],...r.map(i=>typeof i=="function"?{_zod:{check:i,def:{check:"custom"},onattach:[]}}:i)]}),n.clone=(r,i)=>at(n,r,i),n.brand=()=>n,n.register=(r,i)=>(r.add(n,i),n),n.parse=(r,i)=>ad(n,r,i,{callee:n.parse}),n.safeParse=(r,i)=>ld(n,r,i),n.parseAsync=async(r,i)=>cd(n,r,i,{callee:n.parseAsync}),n.safeParseAsync=async(r,i)=>ud(n,r,i),n.spa=n.safeParseAsync,n.refine=(r,i)=>n.check(Th(r,i)),n.superRefine=r=>n.check(Ih(r)),n.overwrite=r=>n.check(ur(r)),n.optional=()=>xs(n),n.nullable=()=>ks(n),n.nullish=()=>xs(ks(n)),n.nonoptional=r=>hh(n,r),n.array=()=>zd(n),n.or=r=>Rd([n,r]),n.and=r=>rh(n,r),n.transform=r=>_s(n,Ud(r)),n.default=r=>mh(n,r),n.prefault=r=>gh(n,r),n.catch=r=>bh(n,r),n.pipe=r=>_s(n,r),n.readonly=()=>$h(n),n.describe=r=>{let i=n.clone();return Ht.add(i,{description:r}),i},Object.defineProperty(n,"description",{get(){return Ht.get(n)?.description},configurable:!0}),n.meta=(...r)=>{if(r.length===0)return Ht.get(n);let i=n.clone();return Ht.add(i,r[0]),i},n.isOptional=()=>n.safeParse(void 0).success,n.isNullable=()=>n.safeParse(null).success,n)),md=w("_ZodString",(n,e)=>{Kr.init(n,e),Y.init(n,e);let r=n._zod.bag;n.format=r.format??null,n.minLength=r.minimum??null,n.maxLength=r.maximum??null,n.regex=(...i)=>n.check(Di(...i)),n.includes=(...i)=>n.check(Mi(...i)),n.startsWith=(...i)=>n.check(Ui(...i)),n.endsWith=(...i)=>n.check(Fi(...i)),n.min=(...i)=>n.check(zr(...i)),n.max=(...i)=>n.check(Fn(...i)),n.length=(...i)=>n.check(Ln(...i)),n.nonempty=(...i)=>n.check(zr(1,...i)),n.lowercase=i=>n.check(Ri(i)),n.uppercase=i=>n.check(Oi(i)),n.trim=()=>n.check(Wi()),n.normalize=(...i)=>n.check(Bi(...i)),n.toLowerCase=()=>n.check(Zi()),n.toUpperCase=()=>n.check(Vi())}),Ji=w("ZodString",(n,e)=>{Kr.init(n,e),md.init(n,e),n.email=r=>n.check(Ho(pd,r)),n.url=r=>n.check(Yo(gd,r)),n.jwt=r=>n.check(ms(Cd,r)),n.emoji=r=>n.check(Xo(hd,r)),n.guid=r=>n.check(Ai(Ss,r)),n.uuid=r=>n.check(qo(fr,r)),n.uuidv4=r=>n.check(Jo(fr,r)),n.uuidv6=r=>n.check(Ko(fr,r)),n.uuidv7=r=>n.check(Qo(fr,r)),n.nanoid=r=>n.check(es(vd,r)),n.guid=r=>n.check(Ai(Ss,r)),n.cuid=r=>n.check(ts(yd,r)),n.cuid2=r=>n.check(rs(bd,r)),n.ulid=r=>n.check(ns(wd,r)),n.base64=r=>n.check(us(Td,r)),n.base64url=r=>n.check(ds(Id,r)),n.xid=r=>n.check(is(Sd,r)),n.ksuid=r=>n.check(os($d,r)),n.ipv4=r=>n.check(ss(xd,r)),n.ipv6=r=>n.check(as(kd,r)),n.cidrv4=r=>n.check(cs(_d,r)),n.cidrv6=r=>n.check(ls(Pd,r)),n.e164=r=>n.check(fs(Ed,r)),n.datetime=r=>n.check(nd(r)),n.date=r=>n.check(id(r)),n.time=r=>n.check(od(r)),n.duration=r=>n.check(sd(r))});function dd(n){return gu(Ji,n)}var pe=w("ZodStringFormat",(n,e)=>{fe.init(n,e),md.init(n,e)}),pd=w("ZodEmail",(n,e)=>{ml.init(n,e),pe.init(n,e)});function LS(n){return Ho(pd,n)}var Ss=w("ZodGUID",(n,e)=>{dl.init(n,e),pe.init(n,e)});function BS(n){return Ai(Ss,n)}var fr=w("ZodUUID",(n,e)=>{fl.init(n,e),pe.init(n,e)});function WS(n){return qo(fr,n)}function ZS(n){return Jo(fr,n)}function VS(n){return Ko(fr,n)}function GS(n){return Qo(fr,n)}var gd=w("ZodURL",(n,e)=>{pl.init(n,e),pe.init(n,e)});function HS(n){return Yo(gd,n)}var hd=w("ZodEmoji",(n,e)=>{gl.init(n,e),pe.init(n,e)});function qS(n){return Xo(hd,n)}var vd=w("ZodNanoID",(n,e)=>{hl.init(n,e),pe.init(n,e)});function JS(n){return es(vd,n)}var yd=w("ZodCUID",(n,e)=>{vl.init(n,e),pe.init(n,e)});function KS(n){return ts(yd,n)}var bd=w("ZodCUID2",(n,e)=>{yl.init(n,e),pe.init(n,e)});function QS(n){return rs(bd,n)}var wd=w("ZodULID",(n,e)=>{bl.init(n,e),pe.init(n,e)});function YS(n){return ns(wd,n)}var Sd=w("ZodXID",(n,e)=>{wl.init(n,e),pe.init(n,e)});function XS(n){return is(Sd,n)}var $d=w("ZodKSUID",(n,e)=>{Sl.init(n,e),pe.init(n,e)});function e$(n){return os($d,n)}var xd=w("ZodIPv4",(n,e)=>{Pl.init(n,e),pe.init(n,e)});function t$(n){return ss(xd,n)}var kd=w("ZodIPv6",(n,e)=>{Tl.init(n,e),pe.init(n,e)});function r$(n){return as(kd,n)}var _d=w("ZodCIDRv4",(n,e)=>{Il.init(n,e),pe.init(n,e)});function n$(n){return cs(_d,n)}var Pd=w("ZodCIDRv6",(n,e)=>{El.init(n,e),pe.init(n,e)});function i$(n){return ls(Pd,n)}var Td=w("ZodBase64",(n,e)=>{Nl.init(n,e),pe.init(n,e)});function o$(n){return us(Td,n)}var Id=w("ZodBase64URL",(n,e)=>{jl.init(n,e),pe.init(n,e)});function s$(n){return ds(Id,n)}var Ed=w("ZodE164",(n,e)=>{Al.init(n,e),pe.init(n,e)});function a$(n){return fs(Ed,n)}var Cd=w("ZodJWT",(n,e)=>{zl.init(n,e),pe.init(n,e)});function c$(n){return ms(Cd,n)}var Nd=w("ZodCustomStringFormat",(n,e)=>{Dl.init(n,e),pe.init(n,e)});function l$(n,e,r={}){return ps(Nd,n,e,r)}function u$(n){return ps(Nd,"hostname",ar.hostname,n)}var Ki=w("ZodNumber",(n,e)=>{Bo.init(n,e),Y.init(n,e),n.gt=(i,t)=>n.check(lr(i,t)),n.gte=(i,t)=>n.check(ct(i,t)),n.min=(i,t)=>n.check(ct(i,t)),n.lt=(i,t)=>n.check(cr(i,t)),n.lte=(i,t)=>n.check(_t(i,t)),n.max=(i,t)=>n.check(_t(i,t)),n.int=i=>n.check(fd(i)),n.safe=i=>n.check(fd(i)),n.positive=i=>n.check(lr(0,i)),n.nonnegative=i=>n.check(ct(0,i)),n.negative=i=>n.check(cr(0,i)),n.nonpositive=i=>n.check(_t(0,i)),n.multipleOf=(i,t)=>n.check(Yr(i,t)),n.step=(i,t)=>n.check(Yr(i,t)),n.finite=()=>n;let r=n._zod.bag;n.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,n.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,n.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),n.isFinite=!0,n.format=r.format??null});function Wg(n){return $u(Ki,n)}var Wn=w("ZodNumberFormat",(n,e)=>{Rl.init(n,e),Ki.init(n,e)});function fd(n){return ku(Wn,n)}function d$(n){return _u(Wn,n)}function f$(n){return Pu(Wn,n)}function m$(n){return Tu(Wn,n)}function p$(n){return Iu(Wn,n)}var Qi=w("ZodBoolean",(n,e)=>{Ii.init(n,e),Y.init(n,e)});function Zg(n){return Eu(Qi,n)}var Yi=w("ZodBigInt",(n,e)=>{Wo.init(n,e),Y.init(n,e),n.gte=(i,t)=>n.check(ct(i,t)),n.min=(i,t)=>n.check(ct(i,t)),n.gt=(i,t)=>n.check(lr(i,t)),n.gte=(i,t)=>n.check(ct(i,t)),n.min=(i,t)=>n.check(ct(i,t)),n.lt=(i,t)=>n.check(cr(i,t)),n.lte=(i,t)=>n.check(_t(i,t)),n.max=(i,t)=>n.check(_t(i,t)),n.positive=i=>n.check(lr(BigInt(0),i)),n.negative=i=>n.check(cr(BigInt(0),i)),n.nonpositive=i=>n.check(_t(BigInt(0),i)),n.nonnegative=i=>n.check(ct(BigInt(0),i)),n.multipleOf=(i,t)=>n.check(Yr(i,t));let r=n._zod.bag;n.minValue=r.minimum??null,n.maxValue=r.maximum??null,n.format=r.format??null});function g$(n){return Nu(Yi,n)}var jd=w("ZodBigIntFormat",(n,e)=>{Ol.init(n,e),Yi.init(n,e)});function h$(n){return Au(jd,n)}function v$(n){return zu(jd,n)}var Vg=w("ZodSymbol",(n,e)=>{Ml.init(n,e),Y.init(n,e)});function y$(n){return Du(Vg,n)}var Gg=w("ZodUndefined",(n,e)=>{Ul.init(n,e),Y.init(n,e)});function b$(n){return Ru(Gg,n)}var Hg=w("ZodNull",(n,e)=>{Fl.init(n,e),Y.init(n,e)});function qg(n){return Ou(Hg,n)}var Jg=w("ZodAny",(n,e)=>{Ll.init(n,e),Y.init(n,e)});function w$(){return Mu(Jg)}var Kg=w("ZodUnknown",(n,e)=>{Rn.init(n,e),Y.init(n,e)});function $s(){return Mn(Kg)}var Qg=w("ZodNever",(n,e)=>{Bl.init(n,e),Y.init(n,e)});function Ad(n){return Uu(Qg,n)}var Yg=w("ZodVoid",(n,e)=>{Wl.init(n,e),Y.init(n,e)});function S$(n){return Fu(Yg,n)}var Ps=w("ZodDate",(n,e)=>{Zl.init(n,e),Y.init(n,e),n.min=(i,t)=>n.check(ct(i,t)),n.max=(i,t)=>n.check(_t(i,t));let r=n._zod.bag;n.minDate=r.minimum?new Date(r.minimum):null,n.maxDate=r.maximum?new Date(r.maximum):null});function $$(n){return Lu(Ps,n)}var Xg=w("ZodArray",(n,e)=>{Ei.init(n,e),Y.init(n,e),n.element=e.element,n.min=(r,i)=>n.check(zr(r,i)),n.nonempty=r=>n.check(zr(1,r)),n.max=(r,i)=>n.check(Fn(r,i)),n.length=(r,i)=>n.check(Ln(r,i)),n.unwrap=()=>n.element});function zd(n,e){return Gi(Xg,n,e)}function x$(n){let e=n._zod.def.shape;return lh(Object.keys(e))}var Ts=w("ZodObject",(n,e)=>{Vl.init(n,e),Y.init(n,e),D.defineLazy(n,"shape",()=>e.shape),n.keyof=()=>ah(Object.keys(n._zod.def.shape)),n.catchall=r=>n.clone({...n._zod.def,catchall:r}),n.passthrough=()=>n.clone({...n._zod.def,catchall:$s()}),n.loose=()=>n.clone({...n._zod.def,catchall:$s()}),n.strict=()=>n.clone({...n._zod.def,catchall:Ad()}),n.strip=()=>n.clone({...n._zod.def,catchall:void 0}),n.extend=r=>D.extend(n,r),n.merge=r=>D.merge(n,r),n.pick=r=>D.pick(n,r),n.omit=r=>D.omit(n,r),n.partial=(...r)=>D.partial(Fd,n,r[0]),n.required=(...r)=>D.required(Ld,n,r[0])});function k$(n,e){let r={type:"object",get shape(){return D.assignProp(this,"shape",{...n}),this.shape},...D.normalizeParams(e)};return new Ts(r)}function _$(n,e){return new Ts({type:"object",get shape(){return D.assignProp(this,"shape",{...n}),this.shape},catchall:Ad(),...D.normalizeParams(e)})}function P$(n,e){return new Ts({type:"object",get shape(){return D.assignProp(this,"shape",{...n}),this.shape},catchall:$s(),...D.normalizeParams(e)})}var Dd=w("ZodUnion",(n,e)=>{Zo.init(n,e),Y.init(n,e),n.options=e.options});function Rd(n,e){return new Dd({type:"union",options:n,...D.normalizeParams(e)})}var eh=w("ZodDiscriminatedUnion",(n,e)=>{Dd.init(n,e),Gl.init(n,e)});function T$(n,e,r){return new eh({type:"union",options:e,discriminator:n,...D.normalizeParams(r)})}var th=w("ZodIntersection",(n,e)=>{Hl.init(n,e),Y.init(n,e)});function rh(n,e){return new th({type:"intersection",left:n,right:e})}var nh=w("ZodTuple",(n,e)=>{Qr.init(n,e),Y.init(n,e),n.rest=r=>n.clone({...n._zod.def,rest:r})});function I$(n,e,r){let i=e instanceof G,t=i?r:e,o=i?e:null;return new nh({type:"tuple",items:n,rest:o,...D.normalizeParams(t)})}var Od=w("ZodRecord",(n,e)=>{ql.init(n,e),Y.init(n,e),n.keyType=e.keyType,n.valueType=e.valueType});function ih(n,e,r){return new Od({type:"record",keyType:n,valueType:e,...D.normalizeParams(r)})}function E$(n,e,r){let i=at(n);return i._zod.values=void 0,new Od({type:"record",keyType:i,valueType:e,...D.normalizeParams(r)})}var oh=w("ZodMap",(n,e)=>{Jl.init(n,e),Y.init(n,e),n.keyType=e.keyType,n.valueType=e.valueType});function C$(n,e,r){return new oh({type:"map",keyType:n,valueType:e,...D.normalizeParams(r)})}var sh=w("ZodSet",(n,e)=>{Kl.init(n,e),Y.init(n,e),n.min=(...r)=>n.check(Xr(...r)),n.nonempty=r=>n.check(Xr(1,r)),n.max=(...r)=>n.check(Un(...r)),n.size=(...r)=>n.check(zi(...r))});function N$(n,e){return new sh({type:"set",valueType:n,...D.normalizeParams(e)})}var qi=w("ZodEnum",(n,e)=>{Ql.init(n,e),Y.init(n,e),n.enum=e.entries,n.options=Object.values(e.entries);let r=new Set(Object.keys(e.entries));n.extract=(i,t)=>{let o={};for(let s of i)if(r.has(s))o[s]=e.entries[s];else throw new Error(`Key ${s} not found in enum`);return new qi({...e,checks:[],...D.normalizeParams(t),entries:o})},n.exclude=(i,t)=>{let o={...e.entries};for(let s of i)if(r.has(s))delete o[s];else throw new Error(`Key ${s} not found in enum`);return new qi({...e,checks:[],...D.normalizeParams(t),entries:o})}});function ah(n,e){let r=Array.isArray(n)?Object.fromEntries(n.map(i=>[i,i])):n;return new qi({type:"enum",entries:r,...D.normalizeParams(e)})}function j$(n,e){return new qi({type:"enum",entries:n,...D.normalizeParams(e)})}var ch=w("ZodLiteral",(n,e)=>{Yl.init(n,e),Y.init(n,e),n.values=new Set(e.values),Object.defineProperty(n,"value",{get(){if(e.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return e.values[0]}})});function lh(n,e){return new ch({type:"literal",values:Array.isArray(n)?n:[n],...D.normalizeParams(e)})}var uh=w("ZodFile",(n,e)=>{Xl.init(n,e),Y.init(n,e),n.min=(r,i)=>n.check(Xr(r,i)),n.max=(r,i)=>n.check(Un(r,i)),n.mime=(r,i)=>n.check(Li(Array.isArray(r)?r:[r],i))});function A$(n){return Ku(uh,n)}var Md=w("ZodTransform",(n,e)=>{Ci.init(n,e),Y.init(n,e),n._zod.parse=(r,i)=>{r.addIssue=o=>{if(typeof o=="string")r.issues.push(D.issue(o,r.value,e));else{let s=o;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=r.value),s.inst??(s.inst=n),r.issues.push(D.issue(s))}};let t=e.transform(r.value,r);return t instanceof Promise?t.then(o=>(r.value=o,r)):(r.value=t,r)}});function Ud(n){return new Md({type:"transform",transform:n})}var Fd=w("ZodOptional",(n,e)=>{eu.init(n,e),Y.init(n,e),n.unwrap=()=>n._zod.def.innerType});function xs(n){return new Fd({type:"optional",innerType:n})}var dh=w("ZodNullable",(n,e)=>{tu.init(n,e),Y.init(n,e),n.unwrap=()=>n._zod.def.innerType});function ks(n){return new dh({type:"nullable",innerType:n})}function z$(n){return xs(ks(n))}var fh=w("ZodDefault",(n,e)=>{ru.init(n,e),Y.init(n,e),n.unwrap=()=>n._zod.def.innerType,n.removeDefault=n.unwrap});function mh(n,e){return new fh({type:"default",innerType:n,get defaultValue(){return typeof e=="function"?e():e}})}var ph=w("ZodPrefault",(n,e)=>{nu.init(n,e),Y.init(n,e),n.unwrap=()=>n._zod.def.innerType});function gh(n,e){return new ph({type:"prefault",innerType:n,get defaultValue(){return typeof e=="function"?e():e}})}var Ld=w("ZodNonOptional",(n,e)=>{iu.init(n,e),Y.init(n,e),n.unwrap=()=>n._zod.def.innerType});function hh(n,e){return new Ld({type:"nonoptional",innerType:n,...D.normalizeParams(e)})}var vh=w("ZodSuccess",(n,e)=>{ou.init(n,e),Y.init(n,e),n.unwrap=()=>n._zod.def.innerType});function D$(n){return new vh({type:"success",innerType:n})}var yh=w("ZodCatch",(n,e)=>{su.init(n,e),Y.init(n,e),n.unwrap=()=>n._zod.def.innerType,n.removeCatch=n.unwrap});function bh(n,e){return new yh({type:"catch",innerType:n,catchValue:typeof e=="function"?e:()=>e})}var wh=w("ZodNaN",(n,e)=>{au.init(n,e),Y.init(n,e)});function R$(n){return Wu(wh,n)}var Bd=w("ZodPipe",(n,e)=>{Ni.init(n,e),Y.init(n,e),n.in=e.in,n.out=e.out});function _s(n,e){return new Bd({type:"pipe",in:n,out:e})}var Sh=w("ZodReadonly",(n,e)=>{cu.init(n,e),Y.init(n,e),n.unwrap=()=>n._zod.def.innerType});function $h(n){return new Sh({type:"readonly",innerType:n})}var xh=w("ZodTemplateLiteral",(n,e)=>{lu.init(n,e),Y.init(n,e)});function O$(n,e){return new xh({type:"template_literal",parts:n,...D.normalizeParams(e)})}var kh=w("ZodLazy",(n,e)=>{du.init(n,e),Y.init(n,e),n.unwrap=()=>n._zod.def.getter()});function _h(n){return new kh({type:"lazy",getter:n})}var Ph=w("ZodPromise",(n,e)=>{uu.init(n,e),Y.init(n,e),n.unwrap=()=>n._zod.def.innerType});function M$(n){return new Ph({type:"promise",innerType:n})}var Is=w("ZodCustom",(n,e)=>{fu.init(n,e),Y.init(n,e)});function U$(n){let e=new ye({check:"custom"});return e._zod.check=n,e}function F$(n,e){return Qu(Is,n??(()=>!0),e)}function Th(n,e={}){return Yu(Is,n,e)}function Ih(n){return Xu(n)}function L$(n,e={error:`Input not instance of ${n.name}`}){let r=new Is({type:"custom",check:"custom",fn:i=>i instanceof n,abort:!0,...D.normalizeParams(e)});return r._zod.bag.Class=n,r}var B$=(...n)=>ed({Pipe:Bd,Boolean:Qi,String:Ji,Transform:Md},...n);function W$(n){let e=_h(()=>Rd([dd(n),Wg(),Zg(),qg(),zd(e),ih(dd(),e)]));return e}function Z$(n,e){return _s(Ud(n),e)}var V$={invalid_type:"invalid_type",too_big:"too_big",too_small:"too_small",invalid_format:"invalid_format",not_multiple_of:"not_multiple_of",unrecognized_keys:"unrecognized_keys",invalid_union:"invalid_union",invalid_key:"invalid_key",invalid_element:"invalid_element",invalid_value:"invalid_value",custom:"custom"};function G$(n){Ce({customError:n})}function H$(){return Ce().customError}var Wd;Wd||(Wd={});var Zd={};Et(Zd,{bigint:()=>Q$,boolean:()=>K$,date:()=>Y$,number:()=>J$,string:()=>q$});function q$(n){return hu(Ji,n)}function J$(n){return xu(Ki,n)}function K$(n){return Cu(Qi,n)}function Q$(n){return ju(Yi,n)}function Y$(n){return Bu(Ps,n)}Ce(Vo());var Zn="~/Documents";W();var mr=T("config"),X$=M.object({enabled:M.boolean(),sessionStart:M.boolean(),sessionExit:M.boolean(),commandCompletion:M.boolean(),commandError:M.boolean(),bell:M.boolean(),claudeTurn:M.boolean(),soundEnabled:M.boolean(),vibrationEnabled:M.boolean()}).partial(),ex=M.object({name:M.string().optional(),command:M.string().min(1).trim()});function Ch(n){let e=(0,Eh.Router)(),{configService:r}=n;return e.get("/config",(i,t)=>{try{let o=r.getConfig(),a={repositoryBasePath:o.repositoryBasePath||Zn,serverConfigured:!0,quickStartCommands:o.quickStartCommands,notificationPreferences:r.getNotificationPreferences()};mr.debug("[GET /api/config] Returning app config:",a),t.json(a)}catch(o){mr.error("[GET /api/config] Error getting app config:",o),t.status(500).json({error:"Failed to get app config"})}}),e.put("/config",(i,t)=>{try{let{quickStartCommands:o,repositoryBasePath:s,notificationPreferences:a}=i.body,c={};if(o!==void 0)if(!Array.isArray(o))mr.error("[PUT /api/config] Invalid quick start commands: not an array");else{let l=[];for(let u of o)try{if(u==null)continue;let d=ex.parse(u);d.command.trim()&&l.push(d)}catch{}r.updateQuickStartCommands(l),c.quickStartCommands=l,mr.debug("[PUT /api/config] Updated quick start commands:",l)}if(s!==void 0)try{let l=M.string().min(1).parse(s);r.updateRepositoryBasePath(l),c.repositoryBasePath=l,mr.debug("[PUT /api/config] Updated repository base path:",l)}catch(l){mr.error("[PUT /api/config] Invalid repository base path:",l)}if(a!==void 0)try{let l=X$.parse(a);r.updateNotificationPreferences(l),c.notificationPreferences=l,mr.debug("[PUT /api/config] Updated notification preferences:",l)}catch(l){mr.error("[PUT /api/config] Invalid notification preferences:",l)}Object.keys(c).length>0?t.json({success:!0,...c}):t.status(400).json({error:"No valid updates provided"})}catch(o){mr.error("[PUT /api/config] Error updating config:",o),t.status(500).json({error:"Failed to update config"})}}),e}var jh=require("events"),Ah=require("express");W();var Vd=T("control-stream"),Nh=new jh.EventEmitter;function zh(){let n=(0,Ah.Router)();return n.get("/control/stream",(e,r)=>{r.writeHead(200,{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive","X-Accel-Buffering":"no"}),r.write(`:ok

`),Vd.debug("Control event stream connected");let i=o=>{try{r.write(`data: ${JSON.stringify(o)}

`)}catch(s){Vd.error("Failed to send control event:",s)}};Nh.on("event",i);let t=setInterval(()=>{r.write(`:heartbeat

`)},3e4);e.on("close",()=>{Vd.debug("Control event stream disconnected"),Nh.off("event",i),clearInterval(t)})}),n}var Dh=require("express");W();var pr=T("events");function Rh(n){let e=(0,Dh.Router)();return e.get("/events",(r,i)=>{pr.info("\u{1F4E1} SSE connection attempt received"),pr.debug("Client connected to event stream"),i.setHeader("Content-Type","text/event-stream"),i.setHeader("Cache-Control","no-cache"),i.setHeader("Connection","keep-alive"),i.setHeader("Access-Control-Allow-Origin","*"),i.setHeader("X-Accel-Buffering","no");let t=0,o,s,a=()=>{o&&clearInterval(o),n&&n.off("notification",s)};try{i.write(`event: connected
data: {"type": "connected"}

`)}catch(c){pr.debug("Failed to send initial connection event:",c);return}o=setInterval(()=>{try{i.write(`:heartbeat

`)}catch(c){pr.debug("Failed to send heartbeat:",c),a()}},3e4),n&&(s=c=>{pr.info(`\u{1F4E2} SessionMonitor notification: ${c.type} for session ${c.sessionId}`),c.type==="test-notification"&&pr.info("\u{1F9EA} Forwarding test notification through SSE:",c);try{let l=`id: ${++t}
event: ${c.type}
data: ${JSON.stringify(c)}

`;i.write(l),pr.debug(`\u2705 SSE event written: ${c.type}`)}catch(l){pr.error("Failed to write SSE event:",l)}},n.on("notification",s)),r.on("close",()=>{pr.debug("Client disconnected from event stream"),a()})}),e}var Oh=require("express"),Vn=C(require("fs")),gr=require("fs/promises"),Mh=C(require("mime-types")),Gd=C(require("multer")),Uh=C(require("os")),Re=C(require("path"));vn();W();var en=T("files"),tx=process.env.VIBETUNNEL_CONTROL_DIR||Re.join(Uh.homedir(),".vibetunnel/control"),qt=Re.join(tx,"uploads");Vn.existsSync(qt)||(Vn.mkdirSync(qt,{recursive:!0}),en.log(`Created uploads directory: ${qt}`));var rx=Gd.default.diskStorage({destination:(n,e,r)=>{r(null,qt)},filename:(n,e,r)=>{let i=`${Nt()}${Re.extname(e.originalname)}`;r(null,i)}}),nx=(n,e,r)=>{r(null,!0)},ix=(0,Gd.default)({storage:rx,fileFilter:nx,limits:{fileSize:100*1024*1024}});function Fh(){let n=(0,Oh.Router)();return n.post("/files/upload",ix.single("file"),(e,r)=>{try{if(!e.file)return r.status(400).json({error:"No file provided"});let i=Re.relative(process.cwd(),e.file.path),t=e.file.path;en.log(`File uploaded by user ${e.userId}: ${e.file.filename} (${e.file.size} bytes)`),r.json({success:!0,filename:e.file.filename,originalName:e.file.originalname,size:e.file.size,mimetype:e.file.mimetype,path:t,relativePath:i})}catch(i){en.error("File upload error:",i),r.status(500).json({error:"Failed to upload file"})}}),n.get("/files/:filename",async(e,r)=>{try{let i=e.params.filename,t=Re.join(qt,i);if(i.includes("..")||i.includes("/")||i.includes("\\")||i.includes("\0")||!/^[a-zA-Z0-9._-]+$/.test(i)||i.startsWith(".")||i.length>255)return r.status(400).json({error:"Invalid filename"});let o=Re.resolve(t),s=Re.resolve(qt);if(!o.startsWith(s+Re.sep)&&o!==s)return r.status(400).json({error:"Invalid file path"});try{await(0,gr.access)(t)}catch{return r.status(404).json({error:"File not found"})}let a=await(0,gr.stat)(t),c=Mh.lookup(i)||"application/octet-stream";r.setHeader("Content-Type",c),r.setHeader("Content-Length",a.size),r.setHeader("Cache-Control","public, max-age=86400"),Vn.createReadStream(t).pipe(r)}catch(i){en.error("File serve error:",i),r.status(500).json({error:"Failed to serve file"})}}),n.get("/files",async(e,r)=>{try{let i=await(0,gr.readdir)(qt),t=await Promise.all(i.map(async o=>{let s=Re.join(qt,o),a=await(0,gr.stat)(s);return{filename:o,size:a.size,createdAt:a.birthtime,modifiedAt:a.mtime,url:`/api/files/${o}`,extension:Re.extname(o).toLowerCase()}}));t.sort((o,s)=>s.createdAt.getTime()-o.createdAt.getTime()),r.json({files:t,count:t.length})}catch(i){en.error("File list error:",i),r.status(500).json({error:"Failed to list files"})}}),n.delete("/files/:filename",async(e,r)=>{try{let i=e.params.filename;if(i.includes("..")||i.includes("/")||i.includes("\\")||i.includes("\0")||!/^[a-zA-Z0-9._-]+$/.test(i)||i.startsWith(".")||i.length>255)return r.status(400).json({error:"Invalid filename"});let t=Re.join(qt,i),o=Re.resolve(t),s=Re.resolve(qt);if(!o.startsWith(s+Re.sep)&&o!==s)return r.status(400).json({error:"Invalid file path"});try{await(0,gr.unlink)(t),en.log(`File deleted by user ${e.userId}: ${i}`),r.json({success:!0,message:"File deleted successfully"})}catch{r.status(404).json({error:"File not found"})}}catch(i){en.error("File deletion error:",i),r.status(500).json({error:"Failed to delete file"})}}),n}Fe();var Lh=require("child_process"),Bh=require("express"),As=require("fs"),Xe=C(require("fs/promises")),qd=C(require("mime-types")),re=C(require("path")),Wh=require("util");W();var Cs=C(require("path"));function Ns(n){if(!n||typeof n!="string")return n;if(n==="~"||n.startsWith("~/")){let e=process.env.HOME||process.env.USERPROFILE;return e?n==="~"?e:Cs.join(e,n.slice(2)):n}return n}function Jt(n){let e=Ns(n);return Cs.resolve(e)}var Z=T("filesystem"),tn=(0,Wh.promisify)(Lh.exec);function Zh(){let n=(0,Bh.Router)();function e(t,o){try{let s=re.resolve(t),a=re.resolve(o),c=process.env.HOME||process.env.USERPROFILE;if(c){let u=re.resolve(c);if(s.startsWith(u))return!0}let l=["/tmp","/var/tmp","/usr/local","/opt",process.cwd()];for(let u of l){let d=re.resolve(u);if(s.startsWith(d))return!0}return s.startsWith(a)}catch(s){return Z.warn(`Path safety check failed for ${t}:`,s),!1}}async function r(t){try{let{stdout:o}=await tn("git rev-parse --show-toplevel",{cwd:t}),s=o.trim(),{stdout:a}=await tn("git branch --show-current",{cwd:t}),{stdout:c}=await tn("git status --porcelain",{cwd:s}),l={isGitRepo:!0,branch:a.trim(),modified:[],added:[],deleted:[],untracked:[]};return c.split(`
`).forEach(u=>{if(!u)return;let d=u.substring(0,2),f=u.substring(3);d===" M"||d==="M "||d==="MM"?l.modified.push(f):d==="A "||d==="AM"?l.added.push(f):d===" D"||d==="D "?l.deleted.push(f):d==="??"&&l.untracked.push(f)}),{status:l,repoRoot:s}}catch{return null}}function i(t,o,s){if(!o)return;let a=re.relative(s,t);return o.modified.includes(a)?"modified":o.added.includes(a)?"added":o.deleted.includes(a)?"deleted":o.untracked.includes(a)?"untracked":"unchanged"}return n.get("/fs/browse",async(t,o)=>{try{let s=t.query.path||".",a=t.query.showHidden==="true",c=t.query.gitFilter;if(s=Ns(s),Z.debug(`browsing directory: ${s}, showHidden: ${a}, gitFilter: ${c}`),!e(s,process.cwd()))return Z.warn(`access denied for path: ${s}`),o.status(403).json({error:"Access denied"});let l=re.resolve(s),u;try{u=await Xe.stat(l)}catch(S){if(S instanceof Error&&"code"in S&&S.code==="ENOENT")return Z.warn(`directory not found: ${s}`),o.status(404).json({error:"Directory not found"});throw S}if(!u.isDirectory())return Z.warn(`path is not a directory: ${s}`),o.status(400).json({error:"Path is not a directory"});let d=Date.now(),f=c!=="none"?await r(l):null,p=f?.status||null,m=f?.repoRoot||"";c!=="none"&&Z.debug(`git status check took ${Date.now()-d}ms for ${s}`);let g=[];if(c==="changed"&&p){let S=[...p.modified.map(b=>({path:b,status:"modified"})),...p.added.map(b=>({path:b,status:"added"})),...p.deleted.map(b=>({path:b,status:"deleted"})),...p.untracked.map(b=>({path:b,status:"untracked"}))],y=re.relative(m,l),k=S.filter(b=>l===m?!0:b.path.startsWith(`${y}/`));g=await Promise.all(k.map(async b=>{let R=re.join(m,b.path),z=null,L="file";try{z=await Xe.stat(R),L=z.isDirectory()?"directory":"file"}catch{z=null}return{name:re.relative(l,R),path:re.relative(process.cwd(),R),type:L,size:z?.size||0,modified:z?.mtime.toISOString()||new Date().toISOString(),permissions:z?.mode?.toString(8).slice(-3)||"000",isGitTracked:!0,gitStatus:b.status}}))}else{let S=await Xe.readdir(l,{withFileTypes:!0});g=await Promise.all(S.filter(y=>a||!y.name.startsWith(".")).map(async y=>{let k=re.join(l,y.name);try{let b=await Xe.stat(k),R=re.relative(process.cwd(),k),z=y.isSymbolicLink();return{name:y.name,path:R,type:b.isDirectory()?"directory":"file",size:b.size,modified:b.mtime.toISOString(),permissions:b.mode.toString(8).slice(-3),isGitTracked:p?.isGitRepo||!1,gitStatus:i(k,p,m),isSymlink:z}}catch(b){return Z.warn(`failed to stat ${k}:`,b),{name:y.name,path:re.relative(process.cwd(),k),type:"file",size:0,modified:new Date().toISOString(),permissions:"000",isGitTracked:!1,gitStatus:void 0}}}))}let h=g;h.sort((S,y)=>S.type!==y.type?S.type==="directory"?-1:1:S.name.localeCompare(y.name)),Z.debug(`directory browsed successfully: ${s} (${h.length} items)`),o.json({path:s,fullPath:l,gitStatus:p,files:h})}catch(s){Z.error(`failed to browse directory ${t.query.path}:`,s),o.status(500).json({error:s instanceof Error?s.message:String(s)})}}),n.get("/fs/preview",async(t,o)=>{try{let s=t.query.path;if(!s)return o.status(400).json({error:"Path is required"});if(Z.debug(`previewing file: ${s}`),!e(s,process.cwd()))return Z.warn(`access denied for file preview: ${s}`),o.status(403).json({error:"Access denied"});let a=re.resolve(process.cwd(),s),c=await Xe.stat(a);if(c.isDirectory())return Z.warn(`cannot preview directory: ${s}`),o.status(400).json({error:"Cannot preview directories"});let l=qd.default.lookup(a)||"application/octet-stream",u=l.startsWith("text/")||l==="application/json"||l==="application/javascript"||l==="application/typescript"||l==="application/xml";if(l.startsWith("image/"))Z.log(v.green(`image preview generated: ${s} (${js(c.size)})`)),o.json({type:"image",mimeType:l,url:`/api/fs/raw?path=${encodeURIComponent(s)}`,size:c.size});else if(u||c.size<1024*1024){let f=await Xe.readFile(a,"utf-8"),p=Hd(a);Z.log(v.green(`text file preview generated: ${s} (${js(c.size)}, ${p})`)),o.json({type:"text",content:f,language:p,mimeType:l,size:c.size})}else Z.log(`binary file preview metadata returned: ${s} (${js(c.size)})`),o.json({type:"binary",mimeType:l,size:c.size,humanSize:js(c.size)})}catch(s){Z.error(`failed to preview file ${t.query.path}:`,s),o.status(500).json({error:s instanceof Error?s.message:String(s)})}}),n.get("/fs/raw",(t,o)=>{try{let s=t.query.path;if(!s)return o.status(400).json({error:"Path is required"});if(Z.debug(`serving raw file: ${s}`),!e(s,process.cwd()))return Z.warn(`access denied for raw file: ${s}`),o.status(403).json({error:"Access denied"});let a=re.resolve(process.cwd(),s);if(!(0,As.statSync)(a).isFile())return Z.warn(`file not found for raw access: ${s}`),o.status(404).json({error:"File not found"});let c=qd.default.lookup(a)||"application/octet-stream";o.setHeader("Content-Type",c);let l=(0,As.createReadStream)(a);l.pipe(o),l.on("end",()=>{Z.log(v.green(`raw file served: ${s}`))})}catch(s){Z.error(`failed to serve raw file ${t.query.path}:`,s),o.status(500).json({error:s instanceof Error?s.message:String(s)})}}),n.get("/fs/content",async(t,o)=>{try{let s=t.query.path;if(!s)return o.status(400).json({error:"Path is required"});if(Z.debug(`getting file content: ${s}`),!e(s,process.cwd()))return Z.warn(`access denied for file content: ${s}`),o.status(403).json({error:"Access denied"});let a=re.resolve(process.cwd(),s),c=await Xe.readFile(a,"utf-8");Z.log(v.green(`file content retrieved: ${s}`)),o.json({path:s,content:c,language:Hd(a)})}catch(s){Z.error(`failed to get file content ${t.query.path}:`,s),o.status(500).json({error:s instanceof Error?s.message:String(s)})}}),n.get("/fs/diff",async(t,o)=>{try{let s=t.query.path;if(!s)return o.status(400).json({error:"Path is required"});if(Z.debug(`getting git diff: ${s}`),!e(s,process.cwd()))return Z.warn(`access denied for git diff: ${s}`),o.status(403).json({error:"Access denied"});let a=re.resolve(process.cwd(),s),c=re.relative(process.cwd(),a),l=Date.now(),{stdout:u}=await tn(`git diff HEAD -- "${c}"`,{cwd:process.cwd()}),d=Date.now()-l;d>1e3&&Z.warn(`slow git diff operation: ${s} took ${d}ms`),Z.log(v.green(`git diff retrieved: ${s} (${u.length>0?"has changes":"no changes"})`)),o.json({path:s,diff:u,hasDiff:u.length>0})}catch(s){Z.error(`failed to get git diff for ${t.query.path}:`,s),o.status(500).json({error:s instanceof Error?s.message:String(s)})}}),n.get("/fs/diff-content",async(t,o)=>{try{let s=t.query.path;if(!s)return o.status(400).json({error:"Path is required"});if(Z.debug(`getting diff content: ${s}`),!e(s,process.cwd()))return Z.warn(`access denied for diff content: ${s}`),o.status(403).json({error:"Access denied"});let a=re.resolve(process.cwd(),s),c=re.relative(process.cwd(),a);Z.debug(`Getting diff content for: ${s}`),Z.debug(`Full path: ${a}`),Z.debug(`CWD: ${process.cwd()}`);let l=await Xe.readFile(a,"utf-8");Z.debug(`Current content length: ${l.length}`);let u="";try{let d=`./${c}`;Z.debug(`Getting HEAD version: git show HEAD:"${d}"`);let{stdout:f}=await tn(`git show HEAD:"${d}"`,{cwd:process.cwd()});u=f,Z.debug(`Got HEAD version for ${d}, length: ${u.length}`)}catch(d){if(d instanceof Error&&d.message.includes("does not exist"))u="",Z.debug(`File ${s} does not exist in HEAD (new file)`);else{if(Z.error(`Failed to get HEAD version of ./${c}:`,d),d instanceof Error&&"stderr"in d){let f=d;f.stderr&&Z.error(`Git stderr: ${f.stderr}`)}u=l}}Z.log(v.green(`diff content retrieved: ${s}`)),o.json({path:s,originalContent:u,modifiedContent:l,language:Hd(a)})}catch(s){Z.error(`failed to get diff content for ${t.query.path}:`,s),o.status(500).json({error:s instanceof Error?s.message:String(s)})}}),n.post("/fs/mkdir",async(t,o)=>{try{let{path:s,name:a}=t.body;if(!s||!a)return o.status(400).json({error:"Path and name are required"});if(Z.log(`creating directory: ${a} in ${s}`),a.includes("/")||a.includes("\\")||a.startsWith("."))return Z.warn(`invalid directory name attempted: ${a}`),o.status(400).json({error:"Invalid directory name"});if(!e(s,process.cwd()))return Z.warn(`access denied for mkdir: ${s}/${a}`),o.status(403).json({error:"Access denied"});let c=re.resolve(process.cwd(),s,a);await Xe.mkdir(c,{recursive:!0}),Z.log(v.green(`directory created: ${re.relative(process.cwd(),c)}`)),o.json({success:!0,path:re.relative(process.cwd(),c)})}catch(s){Z.error(`failed to create directory ${t.body.path}/${t.body.name}:`,s),o.status(500).json({error:s instanceof Error?s.message:String(s)})}}),n.get("/fs/completions",async(t,o)=>{try{let s=t.query.path||"",a=s;a=Ns(a);let c,l;a.endsWith("/")?(c=a,l=""):(c=re.dirname(a),l=re.basename(a));let u=re.resolve(c);if(!e(u,"/"))return Z.warn(`access denied for path completions: ${u}`),o.status(403).json({error:"Access denied"});let d;try{if(d=await Xe.stat(u),!d.isDirectory())return o.json({completions:[]})}catch{return o.json({completions:[]})}let f=await Xe.readdir(u,{withFileTypes:!0}),m=(await Promise.all(f.filter(g=>!(l&&!g.name.toLowerCase().startsWith(l.toLowerCase())||!l.startsWith(".")&&g.name.startsWith("."))).map(async g=>{let h=g.isDirectory(),S=re.join(u,g.name),y;if(s.endsWith("/"))y=s+g.name;else{let K=s.lastIndexOf("/");K>=0?y=s.substring(0,K+1)+g.name:y=g.name}let k=!1,b,R=0,z=0,L=0,F=0,X=!1;if(h)try{let K=re.join(S,".git"),ge=await Xe.stat(K);k=!0,ge.isFile()&&(X=!0);try{let{stdout:dt}=await tn("git branch --show-current",{cwd:S});b=dt.trim()}catch{}try{let{stdout:dt}=await tn("git status --porcelain",{cwd:S}),P=dt.split(`
`).filter(N=>N.trim()!=="");for(let N of P){let E=N.substring(0,2);E==="??"||E==="A "||E==="AM"?z++:E===" D"||E==="D "?F++:(E===" M"||E==="M "||E==="MM")&&L++}R=z+L+F}catch{}}catch{}return{name:g.name,path:y,type:h?"directory":"file",suggestion:h?`${y}/`:y,isRepository:k,gitBranch:b,gitStatusCount:R,gitAddedCount:z,gitModifiedCount:L,gitDeletedCount:F,isWorktree:X}}))).sort((g,h)=>g.type!==h.type?g.type==="directory"?-1:1:g.name.localeCompare(h.name)).slice(0,20);Z.debug(`path completions for "${s}": ${m.length} results`),o.json({completions:m,partialPath:s})}catch(s){Z.error(`failed to get path completions for ${t.query.path}:`,s),o.status(500).json({error:s instanceof Error?s.message:String(s)})}}),n}function Hd(n){let e=re.extname(n).toLowerCase();return{".js":"javascript",".jsx":"javascript",".ts":"typescript",".tsx":"typescript",".py":"python",".java":"java",".c":"c",".cpp":"cpp",".cs":"csharp",".php":"php",".rb":"ruby",".go":"go",".rs":"rust",".swift":"swift",".kt":"kotlin",".scala":"scala",".r":"r",".m":"objective-c",".mm":"objective-c",".h":"c",".hpp":"cpp",".sh":"shell",".bash":"shell",".zsh":"shell",".fish":"shell",".ps1":"powershell",".html":"html",".htm":"html",".xml":"xml",".css":"css",".scss":"scss",".sass":"sass",".less":"less",".json":"json",".yaml":"yaml",".yml":"yaml",".toml":"toml",".ini":"ini",".cfg":"ini",".conf":"ini",".sql":"sql",".md":"markdown",".markdown":"markdown",".tex":"latex",".dockerfile":"dockerfile",".makefile":"makefile",".cmake":"cmake",".gradle":"gradle",".vue":"vue",".svelte":"svelte",".elm":"elm",".clj":"clojure",".cljs":"clojure",".ex":"elixir",".exs":"elixir",".erl":"erlang",".hrl":"erlang",".fs":"fsharp",".fsx":"fsharp",".fsi":"fsharp",".ml":"ocaml",".mli":"ocaml",".pas":"pascal",".pp":"pascal",".pl":"perl",".pm":"perl",".t":"perl",".lua":"lua",".dart":"dart",".nim":"nim",".nims":"nim",".zig":"zig",".jl":"julia"}[e]||"plaintext"}function js(n,e=2){if(n===0)return"0 Bytes";let r=1024,i=e<0?0:e,t=["Bytes","KB","MB","GB","TB"],o=Math.floor(Math.log(n)/Math.log(r));return`${Number.parseFloat((n/r**o).toFixed(i))} ${t[o]}`}var Gh=require("express"),rn=C(require("path")),Hh=require("util");var zs=C(require("fs")),Jd=C(require("path")),Ds=require("util");W();var ox=T("git-utils"),KI=(0,Ds.promisify)(zs.readFile),sx=(0,Ds.promisify)(zs.stat),QI=(0,Ds.promisify)(require("child_process").execFile);async function Vh(n){try{let e=Jd.join(n,".git"),r=await sx(e).catch(()=>null);return r?!r.isDirectory():!1}catch(e){return ox.error(`Error checking if path is worktree: ${n}`,e),!1}}W();$n();Ir();var ne=T("git-routes"),ax=(0,Hh.promisify)(require("child_process").execFile),gt=[],Kd=new Map;async function cx(n){return new Promise(e=>{let r=Kd.get(n);r||(r={isLocked:!1,queue:[]},Kd.set(n,r)),r.isLocked?r.queue.push(e):(r.isLocked=!0,e())})}function lx(n){let e=Kd.get(n);if(e)if(e.queue.length>0){let r=e.queue.shift();r&&r()}else e.isLocked=!1}async function $e(n,e={}){try{let{stdout:r,stderr:i}=await ax("git",n,{cwd:e.cwd||process.cwd(),timeout:e.timeout||5e3,maxBuffer:1048576,env:{...process.env,GIT_TERMINAL_PROMPT:"0"}});return{stdout:r.toString(),stderr:i.toString()}}catch(r){throw Nr(r,"Git command failed")}}function qh(){let n=(0,Gh.Router)();return n.get("/git/repo-info",async(e,r)=>{try{let{path:i}=e.query;if(ne.info(`\u{1F50D} [git/repo-info] Received request for path: ${i}`),!i||typeof i!="string")return ne.warn("\u274C Missing or invalid path parameter"),r.status(400).json({error:"Missing or invalid path parameter"});let t=Jt(i);ne.info(`\u{1F50D} [git/repo-info] Resolved ${i} to absolute path: ${t}`);try{let{stdout:o}=await $e(["rev-parse","--show-toplevel"],{cwd:t}),s=o.trim(),a={isGitRepo:!0,repoPath:s};return ne.info(`\u2705 [git/repo-info] Path is in git repo: ${s}`),r.json(a)}catch(o){if(pp(o))return ne.debug("Git command not found"),r.json({isGitRepo:!1});if(pi(o))return ne.info(`\u274C [git/repo-info] Path is not in a git repository: ${t}`),r.json({isGitRepo:!1});throw o}}catch(i){return ne.error("Error checking git repo info:",i),r.status(500).json({error:"Failed to check git repository info"})}}),n.post("/git/event",async(e,r)=>{let i=!1,t;try{let{repoPath:o,branch:s,event:a}=e.body;if(!o||typeof o!="string")return r.status(400).json({error:"Missing or invalid repoPath parameter"});t=rn.resolve(o),ne.debug(`Processing git event for repo: ${t}, branch: ${s}, event: ${a}`),await cx(t),i=!0;let c=new ir,u=c.listSessions().filter(b=>!b.workingDir||!t?!1:rn.resolve(b.workingDir).startsWith(t));ne.debug(`Found ${u.length} sessions in repository ${t}`);let d=[],f,p,m=!1,g=!1,h=!1;try{let{stdout:b}=await $e(["rev-parse","--git-dir"],{cwd:t}),R=b.trim();h=R.includes("/.git/worktrees/");let z=t;h?(z=R.replace(/\/\.git\/worktrees\/.*$/,""),ne.debug(`Worktree detected, main repo: ${z}`)):g=!0;let{stdout:L}=await $e(["config","vibetunnel.followWorktree"],{cwd:z});f=L.trim(),m=!!f;let{stdout:F}=await $e(["branch","--show-current"],{cwd:t});p=F.trim()}catch(b){ne.debug("Follow worktree check failed or not configured:",b)}let S=rn.basename(t);for(let b of u)try{let R=p;try{let{stdout:F}=await $e(["branch","--show-current"],{cwd:b.workingDir});F.trim()&&(R=F.trim())}catch{ne.debug(`Could not get branch for session ${b.id}, using repo branch`)}let z=b.name?.replace(/\s*\[(checkout|branch|merge|rebase|commit|push|pull|fetch|stash|reset|cherry-pick):[^\]]+\]\s*$/,"")||"Terminal",L=z;a&&s&&(L=`${z} [${a}: ${s}]`),c.updateSessionName(b.id,L),d.push(b.id),ne.debug(`Updated session ${b.id} title to: ${L}`)}catch(R){ne.error(`Failed to update session ${b.id}:`,R)}if(m&&f){if(ne.info(`Follow mode active: processing event from ${t}`),t===f&&h){ne.info("Syncing from worktree to main repo");try{let{stdout:b}=await $e(["rev-parse","--git-dir"],{cwd:t}),z=b.trim().replace(/\/\.git\/worktrees\/.*$/,""),{stdout:L}=await $e(["branch","--show-current"],{cwd:t}),F=L.trim();if(F){ne.info(`Syncing main repo to branch: ${F}`),await $e(["checkout",F],{cwd:z}),await $e(["pull","--ff-only"],{cwd:z});let X={level:"info",title:"Main Repository Synced",message:`Main repository synced to branch '${F}'`};if(ee.isMacAppConnected()){let K=Je("system","notification",X);ee.sendToMac(K)}else gt.push({timestamp:Date.now(),notification:X})}}catch(b){ne.error("Failed to sync from worktree to main:",b);let R={level:"error",title:"Sync Failed",message:`Failed to sync main repository: ${b instanceof Error?b.message:"Unknown error"}`};if(ee.isMacAppConnected()){let z=Je("system","notification",R);ee.sendToMac(z)}else gt.push({timestamp:Date.now(),notification:R})}}else if(g&&a==="commit"){ne.info("Syncing commit from main repo to worktree");try{await $e(["pull","--ff-only"],{cwd:f});let b={level:"info",title:"Worktree Synced",message:"Worktree synced with latest commits"};if(ee.isMacAppConnected()){let R=Je("system","notification",b);ee.sendToMac(R)}else gt.push({timestamp:Date.now(),notification:b})}catch(b){ne.error("Failed to sync commit to worktree:",b)}}else if(g&&a==="checkout"){ne.info("Branch switched in main repo, disabling follow mode");try{await $e(["config","--local","--unset","vibetunnel.followWorktree"],{cwd:t}),m=!1,f=void 0;let b={level:"info",title:"Follow Mode Disabled",message:"Follow mode disabled due to branch switch in main repository"};if(ee.isMacAppConnected()){let R=Je("system","notification",b);ee.sendToMac(R)}else gt.push({timestamp:Date.now(),notification:b})}catch(b){ne.error("Failed to disable follow mode:",b)}}}let y={type:"git-event",repoPath:t,branch:s||p,event:a,followMode:m,sessionsUpdated:d},k=[];if(m&&f){let b=rn.basename(f);k.push({level:"info",title:"Follow Mode Active",message:`Following worktree '${b}' in ${rn.basename(t)}`})}if(ee.isMacAppConnected()){let b=Je("git","repository-changed",y);ee.sendToMac(b),ne.debug("Sent git event notification to Mac app");for(let R of k){let z=Je("system","notification",R);ee.sendToMac(z)}}else{let b=Date.now();for(let z of k)gt.push({timestamp:b,notification:z});let R=b-300*1e3;for(;gt.length>0&&gt[0].timestamp<R;)gt.shift();ne.debug(`Stored ${k.length} notifications for web UI`)}r.json({success:!0,repoPath:t,sessionsUpdated:d.length,followMode:m,notification:y})}catch(o){return ne.error("Error handling git event:",o),r.status(500).json({error:"Failed to process git event",message:o instanceof Error?o.message:String(o)})}finally{i&&t&&lx(t)}}),n.get("/git/notifications",async(e,r)=>{try{let t=Date.now()-300*1e3;for(;gt.length>0&&gt[0].timestamp<t;)gt.shift();let o=gt.map(s=>s.notification);gt.length=0,ne.debug(`Returning ${o.length} pending notifications`),r.json({notifications:o})}catch(i){return ne.error("Error fetching notifications:",i),r.status(500).json({error:"Failed to fetch notifications"})}}),n.get("/git/status",async(e,r)=>{try{let{path:i}=e.query;if(!i||typeof i!="string")return r.status(400).json({error:"Missing or invalid path parameter"});let t=Jt(i);ne.debug(`Getting git status for path: ${t}`);try{let{stdout:o}=await $e(["rev-parse","--show-toplevel"],{cwd:t}),s=o.trim(),{stdout:a}=await $e(["branch","--show-current"],{cwd:s}),c=a.trim(),{stdout:l}=await $e(["status","--porcelain=v1"],{cwd:s}),u=l.trim().split(`
`).filter(k=>k.length>0),d=0,f=0,p=0,m=0,g=0;for(let k of u){if(k.length<2)continue;let b=k[0],R=k[1];b!==" "&&b!=="?"&&(p++,b==="A"?m++:b==="D"&&g++),R==="M"?d++:R==="D"&&b===" "&&g++,b==="?"&&R==="?"&&f++}let h=0,S=0,y=!1;try{let{stdout:k}=await $e(["rev-parse","--abbrev-ref","--symbolic-full-name","@{u}"],{cwd:s});if(k.trim()){y=!0;let{stdout:b}=await $e(["rev-list","--left-right","--count","HEAD...@{u}"],{cwd:s}),[R,z]=b.trim().split("	").map(L=>Number.parseInt(L,10));h=R||0,S=z||0}}catch{ne.debug("No upstream branch configured")}return r.json({isGitRepo:!0,repoPath:s,currentBranch:c,hasChanges:u.length>0,modifiedCount:d,untrackedCount:f,stagedCount:p,addedCount:m,deletedCount:g,aheadCount:h,behindCount:S,hasUpstream:y})}catch(o){if(pi(o))return r.json({isGitRepo:!1});throw o}}catch(i){return ne.error("Error getting git status:",i),r.status(500).json({error:"Failed to get git status",message:i instanceof Error?i.message:String(i)})}}),n.get("/git/remote",async(e,r)=>{try{let{path:i}=e.query;if(!i||typeof i!="string")return r.status(400).json({error:"Missing or invalid path parameter"});let t=Jt(i);ne.debug(`Getting git remote for path: ${t}`);try{let{stdout:o}=await $e(["rev-parse","--show-toplevel"],{cwd:t}),s=o.trim(),{stdout:a}=await $e(["remote","get-url","origin"],{cwd:s}),c=a.trim(),l=null;if(c){if(c.startsWith("https://github.com/"))l=c.endsWith(".git")?c.slice(0,-4):c;else if(c.startsWith("git@github.com:")){let u=c.substring(15);l=`https://github.com/${u.endsWith(".git")?u.slice(0,-4):u}`}}return r.json({isGitRepo:!0,repoPath:s,remoteUrl:c,githubUrl:l})}catch(o){if(pi(o))return r.json({isGitRepo:!1});if((o instanceof Error?o.message:String(o)).includes("No such remote"))return r.json({isGitRepo:!0,remoteUrl:null,githubUrl:null});throw o}}catch(i){return ne.error("Error getting git remote:",i),r.status(500).json({error:"Failed to get git remote",message:i instanceof Error?i.message:String(i)})}}),n.get("/git/repository-info",async(e,r)=>{try{let{path:i}=e.query;if(!i||typeof i!="string")return r.status(400).json({error:"Missing or invalid path parameter"});let t=Jt(i);ne.debug(`Getting comprehensive git info for path: ${t}`);try{let{stdout:o}=await $e(["rev-parse","--show-toplevel"],{cwd:t}),s=o.trim(),a=await Vh(s),[c,l,u,d]=await Promise.allSettled([$e(["branch","--show-current"],{cwd:s}),$e(["status","--porcelain=v1"],{cwd:s}),$e(["remote","get-url","origin"],{cwd:s}),$e(["rev-list","--left-right","--count","HEAD...@{u}"],{cwd:s})]),f=c.status==="fulfilled"?c.value.stdout.trim():null,p=0,m=0,g=0,h=0,S=0,y=!1;if(l.status==="fulfilled"){let L=l.value.stdout.trim().split(`
`).filter(F=>F.length>0);y=L.length>0;for(let F of L){if(F.length<2)continue;let X=F[0],K=F[1];X!==" "&&X!=="?"&&(g++,X==="A"?h++:X==="D"&&S++),K==="M"?p++:K==="D"&&X===" "&&S++,X==="?"&&K==="?"&&m++}}let k=u.status==="fulfilled"?u.value.stdout.trim():null,b=0,R=0,z=!1;if(d.status==="fulfilled"){z=!0;let[L,F]=d.value.stdout.trim().split("	").map(X=>Number.parseInt(X,10));b=L||0,R=F||0}return r.json({isGitRepo:!0,repoPath:s,currentBranch:f,remoteUrl:k,hasChanges:y,modifiedCount:p,untrackedCount:m,stagedCount:g,addedCount:h,deletedCount:S,aheadCount:b,behindCount:R,hasUpstream:z,isWorktree:a})}catch(o){if(pi(o))return r.json({isGitRepo:!1});throw o}}catch(i){return ne.error("Error getting repository info:",i),r.status(500).json({error:"Failed to get repository info",message:i instanceof Error?i.message:String(i)})}}),n}var Jh=require("express"),Kt=C(require("fs")),Rs=C(require("os")),Os=C(require("path"));W();var Gn=T("logs");function Kh(n){let e=(0,Jh.Router)();return e.post("/logs/client",(r,i)=>{try{let{level:t,module:o,args:s}=r.body;if(!t||!o||!Array.isArray(s))return i.status(400).json({error:"Invalid log request. Required: level, module, args[]"});if(!["log","warn","error","debug"].includes(t))return i.status(400).json({error:"Invalid log level. Must be: log, warn, error, or debug"});let a=`[FE] ${o}`,c=t.toUpperCase();Qf(c==="LOG"?"LOG":c,a,s),i.status(204).send()}catch(t){Gn.error("Failed to process client log:",t),i.status(500).json({error:"Failed to process log"})}}),e.get("/logs/raw",(r,i)=>{try{let t=Os.join(Rs.homedir(),".vibetunnel","log.txt");if(!Kt.existsSync(t))return i.setHeader("Content-Type","text/plain; charset=utf-8"),i.send("");i.setHeader("Content-Type","text/plain; charset=utf-8"),Kt.createReadStream(t).pipe(i)}catch(t){Gn.error("Failed to read log file:",t),i.status(500).json({error:"Failed to read log file"})}}),e.get("/logs/info",(r,i)=>{try{let t=Os.join(Rs.homedir(),".vibetunnel","log.txt");if(!Kt.existsSync(t))return i.json({exists:!1,size:0,lastModified:null,path:t});let o=Kt.statSync(t);i.json({exists:!0,size:o.size,sizeHuman:ux(o.size),lastModified:o.mtime,path:t})}catch(t){Gn.error("Failed to get log info:",t),i.status(500).json({error:"Failed to get log info"})}}),e.delete("/logs/clear",(r,i)=>{try{let t=Os.join(Rs.homedir(),".vibetunnel","log.txt");Kt.existsSync(t)&&(Kt.truncateSync(t,0),Gn.log("Log file cleared")),i.status(204).send()}catch(t){Gn.error("Failed to clear log file:",t),i.status(500).json({error:"Failed to clear log file"})}}),e.post("/logs/flush",async(r,i)=>{try{await Kf(),i.status(204).send()}catch(t){Gn.error("Failed to flush log buffer:",t),i.status(500).json({error:"Failed to flush log buffer"})}}),e}function ux(n){if(n===0)return"0 Bytes";let e=1024,r=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(n)/Math.log(e));return`${Number.parseFloat((n/e**i).toFixed(2))} ${r[i]}`}var rv=require("express");W();var Qh=require("child_process"),Yh=require("util");W();var nn=(0,Yh.promisify)(Qh.execFile),Pt=T("screen-manager"),Ms=class n{static instance;static getInstance(){return n.instance||(n.instance=new n),n.instance}validateSessionName(e){if(!e||typeof e!="string")throw new Error("Session name must be a non-empty string");if(!/^[a-zA-Z0-9._-]+$/.test(e))throw new Error("Session name can only contain letters, numbers, dots, dashes, and underscores");if(e.length>100)throw new Error("Session name too long (max 100 characters)")}validateWindowIndex(e){if(!Number.isInteger(e)||e<0||e>999)throw new Error("Window index must be an integer between 0 and 999")}async isAvailable(){try{return await nn("which",["screen"]),!0}catch{return!1}}async listSessions(){try{let{stdout:e}=await nn("screen",["-ls"]).catch(t=>{if(t.stdout&&!t.stdout.includes("No Sockets found"))return{stdout:t.stdout,stderr:t.stderr};throw t}),r=e.split(`
`),i=[];for(let t of r){let o=t.match(/^\s*(\d+)\.([^\t]+)\s*\t\s*\(([^)]+)\)/);if(o){let[,s,a,c]=o;i.push({name:`${s}.${a}`,type:"screen",attached:c.toLowerCase().includes("attached"),exited:c.toLowerCase().includes("dead")})}}return i}catch(e){if(e instanceof Error&&"stdout"in e&&typeof e.stdout=="string"&&e.stdout.includes("No Sockets found"))return[];throw Pt.error("Failed to list screen sessions",{error:e}),e}}async createSession(e,r){this.validateSessionName(e);try{let i=e.includes(".")?e.split(".").slice(1).join("."):e,t=["screen","-dmS",i];if(r){if(typeof r!="string")throw new Error("Command must be a string");t.push(r)}await nn(t[0],t.slice(1)),Pt.info("Created screen session",{sessionName:i})}catch(i){throw Pt.error("Failed to create screen session",{sessionName:e,error:i}),i}}async attachToSession(e,r){try{if(!/^\d+\./.test(e)){let o=(await this.listSessions()).find(s=>s.name.split(".").slice(1).join(".")===e);if(o)e=o.name;else return["screen","-R",e]}if(r){if(typeof r!="string")throw new Error("Command must be a string");await nn("screen",["-S",e,"-X","screen",r])}return["screen","-r",e]}catch(i){throw Pt.error("Failed to attach to screen session",{sessionName:e,error:i}),i}}async killSession(e){this.validateSessionName(e);try{await nn("screen",["-S",e,"-X","quit"]),Pt.info("Killed screen session",{sessionName:e})}catch(r){throw Pt.error("Failed to kill screen session",{sessionName:e,error:r}),r}}isInsideScreen(){return!!process.env.STY}getCurrentSession(){let e=process.env.STY;if(!e)return null;let r=e.split(".");return r.length>=2?r.slice(1).join("."):null}async listWindows(e){try{return Pt.warn("Window listing not fully implemented for screen"),[]}catch(r){return Pt.error("Failed to list screen windows",{sessionName:e,error:r}),[]}}async createWindow(e,r,i){this.validateSessionName(e);try{let t=["screen","-S",e,"-X","screen"];if(r){if(typeof r!="string"||r.length>50)throw new Error("Window name must be a string (max 50 characters)");t.push("-t",r)}if(i){if(typeof i!="string")throw new Error("Command must be a string");t.push(i)}await nn(t[0],t.slice(1)),Pt.info("Created window in screen session",{sessionName:e,windowName:r})}catch(t){throw Pt.error("Failed to create window",{sessionName:e,windowName:r,error:t}),t}}async killWindow(e,r){this.validateSessionName(e),this.validateWindowIndex(r);try{await nn("screen",["-S",e,"-p",String(r),"-X","kill"]),Pt.info("Killed window in screen session",{sessionName:e,windowIndex:r})}catch(i){throw Pt.error("Failed to kill window",{sessionName:e,windowIndex:r,error:i}),i}}};var Us=require("child_process"),Xh=require("util");W();var hr=(0,Xh.promisify)(Us.execFile),Tt=T("TmuxManager"),Hn=class n{static instance;ptyManager;constructor(e){this.ptyManager=e}validateSessionName(e){if(!e||typeof e!="string")throw new Error("Session name must be a non-empty string");if(!/^[a-zA-Z0-9._-]+$/.test(e))throw new Error("Session name can only contain letters, numbers, dots, dashes, and underscores");if(e.length>100)throw new Error("Session name too long (max 100 characters)")}validateWindowIndex(e){if(!Number.isInteger(e)||e<0||e>999)throw new Error("Window index must be an integer between 0 and 999")}validatePaneIndex(e){if(!Number.isInteger(e)||e<0||e>999)throw new Error("Pane index must be an integer between 0 and 999")}static getInstance(e){return n.instance||(n.instance=new n(e)),n.instance}async isAvailable(){try{return await hr("which",["tmux"]),!0}catch{return!1}}async listSessions(){try{let{stdout:e}=await hr("tmux",["list-sessions","-F","#{session_name}|#{session_windows}|#{session_created}|#{?session_attached,attached,detached}|#{session_activity}|#{?session_active,active,}"]);return e.trim().split(`
`).filter(r=>r?.includes("|")).map(r=>{let[i,t,o,s,a,c]=r.split("|");return{name:i,windows:Number.parseInt(t,10),created:o,attached:s==="attached",activity:a,current:c==="active"}})}catch(e){if(e instanceof Error&&e.message.includes("no server running"))return[];throw e}}async listWindows(e){this.validateSessionName(e);try{let{stdout:r}=await hr("tmux",["list-windows","-t",e,"-F","#{session_name}|#{window_index}|#{window_name}|#{?window_active,active,}|#{window_panes}"]);return r.trim().split(`
`).filter(i=>i).map(i=>{let[t,o,s,a,c]=i.split("|");return{session:t,index:Number.parseInt(o,10),name:s,active:a==="active",panes:Number.parseInt(c,10)}})}catch(r){throw Tt.error("Failed to list windows",{sessionName:e,error:r}),r}}async listPanes(e,r){this.validateSessionName(e),r!==void 0&&this.validateWindowIndex(r);try{let i=r!==void 0?[e,String(r)].join(":"):e,{stdout:t}=await hr("tmux",["list-panes","-t",i,"-F","#{session_name}|#{window_index}|#{pane_index}|#{?pane_active,active,}|#{pane_title}|#{pane_pid}|#{pane_current_command}|#{pane_width}|#{pane_height}|#{pane_current_path}"]);return t.trim().split(`
`).filter(o=>o).map(o=>{let[s,a,c,l,u,d,f,p,m,g]=o.split("|");return{session:s,window:Number.parseInt(a,10),index:Number.parseInt(c,10),active:l==="active",title:u||void 0,pid:d?Number.parseInt(d,10):void 0,command:f||void 0,width:Number.parseInt(p,10),height:Number.parseInt(m,10),currentPath:g||void 0}})}catch(i){throw Tt.error("Failed to list panes",{sessionName:e,windowIndex:r,error:i}),i}}async createSession(e,r){this.validateSessionName(e);try{let i=["new-session","-d","-s",e];if(r&&r.length>0){for(let t of r)if(typeof t!="string")throw new Error("Command arguments must be strings");i.push(...r)}await hr("tmux",i),Tt.info("Created tmux session",{name:e,command:r})}catch(i){throw Tt.error("Failed to create tmux session",{name:e,error:i}),i}}async attachToTmux(e,r,i,t){let o=e;r!==void 0&&(o=`${e}:${r}`,i!==void 0&&(o=`${o}.${i}`));let a=["tmux","attach-session","-t",r!==void 0?`${e}:${r}`:e],c={name:`tmux: ${o}`,workingDir:t?.workingDir||process.env.HOME||"/",cols:t?.cols||80,rows:t?.rows||24,titleMode:t?.titleMode||"dynamic"};return(await this.ptyManager.createSession(a,c)).sessionId}async sendToPane(e,r,i,t){if(this.validateSessionName(e),i!==void 0&&this.validateWindowIndex(i),t!==void 0&&this.validatePaneIndex(t),typeof r!="string")throw new Error("Command must be a string");let o=e;i!==void 0&&(o=`${e}:${i}`,t!==void 0&&(o=`${o}.${t}`));try{await hr("tmux",["send-keys","-t",o,r,"Enter"]),Tt.info("Sent command to tmux pane",{target:o,command:r})}catch(s){throw Tt.error("Failed to send command to tmux pane",{target:o,command:r,error:s}),s}}async killSession(e){this.validateSessionName(e);try{await hr("tmux",["kill-session","-t",e]),Tt.info("Killed tmux session",{sessionName:e})}catch(r){throw Tt.error("Failed to kill tmux session",{sessionName:e,error:r}),r}}async killWindow(e,r){this.validateSessionName(e),this.validateWindowIndex(r);try{let i=`${e}:${r}`;await hr("tmux",["kill-window","-t",i]),Tt.info("Killed tmux window",{sessionName:e,windowIndex:r})}catch(i){throw Tt.error("Failed to kill tmux window",{sessionName:e,windowIndex:r,error:i}),i}}async killPane(e,r){if(!r||typeof r!="string")throw new Error("Pane ID must be a non-empty string");if(!/^[a-zA-Z0-9._:-]+$/.test(r))throw new Error("Invalid pane ID format");try{await hr("tmux",["kill-pane","-t",r]),Tt.info("Killed tmux pane",{sessionName:e,paneId:r})}catch(i){throw Tt.error("Failed to kill tmux pane",{sessionName:e,paneId:r,error:i}),i}}isInsideTmux(){return!!process.env.TMUX}getCurrentSession(){if(!this.isInsideTmux())return null;try{return(0,Us.execFileSync)("tmux",["display-message","-p","#{session_name}"],{encoding:"utf8"}).trim()}catch{return null}}};var ev=require("child_process"),tv=require("util");W();var Fs=(0,tv.promisify)(ev.execFile),Dr=T("ZellijManager"),Ls=class n{static instance;ptyManager;constructor(e){this.ptyManager=e}validateSessionName(e){if(!e||typeof e!="string")throw new Error("Session name must be a non-empty string");if(!/^[a-zA-Z0-9._-]+$/.test(e))throw new Error("Session name can only contain letters, numbers, dots, dashes, and underscores");if(e.length>100)throw new Error("Session name too long (max 100 characters)")}stripAnsiCodes(e){return e.replace(/\x1b\[[0-9;]*m/g,"")}static getInstance(e){return n.instance||(n.instance=new n(e)),n.instance}async isAvailable(){try{return await Fs("which",["zellij"]),!0}catch{return!1}}async listSessions(){try{let{stdout:e}=await Fs("zellij",["list-sessions"]);if(e.includes("No active zellij sessions found"))return[];let r=[],i=e.trim().split(`
`).filter(t=>t.trim());for(let t of i){let o=this.stripAnsiCodes(t).trim();if(!o)continue;let s=o.includes("[EXITED]"),a=o.match(/^([^[]+)/);if(!a)continue;let c=a[1].trim(),l=o.match(/\[Created ([^\]]+)\]/),u=l?l[1]:"unknown";c&&r.push({name:c,created:u,exited:s})}return r}catch(e){if(e instanceof Error&&e.message.includes("No active zellij sessions found"))return[];throw Dr.error("Failed to list zellij sessions",{error:e}),e}}async getSessionTabs(e){return Dr.warn("Cannot query tabs for zellij session from outside",{sessionName:e}),[]}async createSession(e,r){Dr.info("Zellij session will be created on first attach",{name:e,layout:r}),r&&Dr.info("Layout preference noted for session",{name:e,layout:r})}async attachToZellij(e,r){let i=["zellij","attach","-c",e];r?.layout&&((await this.listSessions()).some(c=>c.name===e&&!c.exited)||i.push("-l",r.layout));let t={name:`zellij: ${e}`,workingDir:r?.workingDir||process.env.HOME||"/",cols:r?.cols||80,rows:r?.rows||24,titleMode:r?.titleMode||"dynamic"};return(await this.ptyManager.createSession(i,t)).sessionId}async killSession(e){this.validateSessionName(e);try{await Fs("zellij",["delete-session","--force",e]),Dr.info("Killed zellij session",{sessionName:e})}catch(r){throw Dr.error("Failed to kill zellij session",{sessionName:e,error:r}),r}}async deleteSession(e){this.validateSessionName(e);try{await Fs("zellij",["delete-session",e]),Dr.info("Deleted zellij session",{sessionName:e})}catch(r){throw Dr.error("Failed to delete zellij session",{sessionName:e,error:r}),r}}isInsideZellij(){return!!process.env.ZELLIJ}getCurrentSession(){return this.isInsideZellij()&&process.env.ZELLIJ_SESSION_NAME||null}};var Qd=T("MultiplexerManager"),Bs=class n{static instance;tmuxManager;zellijManager;screenManager;ptyManager;constructor(e){this.ptyManager=e,this.tmuxManager=Hn.getInstance(e),this.zellijManager=Ls.getInstance(e),this.screenManager=Ms.getInstance()}static getInstance(e){return n.instance||(n.instance=new n(e)),n.instance}async getAvailableMultiplexers(){let[e,r,i]=await Promise.all([this.tmuxManager.isAvailable(),this.zellijManager.isAvailable(),this.screenManager.isAvailable()]),t={tmux:{available:e,type:"tmux",sessions:[]},zellij:{available:r,type:"zellij",sessions:[]},screen:{available:i,type:"screen",sessions:[]}};if(e)try{let o=await this.tmuxManager.listSessions();t.tmux.sessions=o.map(s=>({...s,type:"tmux"}))}catch(o){Qd.error("Failed to list tmux sessions",{error:o})}if(r)try{let o=await this.zellijManager.listSessions();t.zellij.sessions=o.map(s=>({...s,type:"zellij"}))}catch(o){Qd.error("Failed to list zellij sessions",{error:o})}if(i)try{let o=await this.screenManager.listSessions();t.screen.sessions=o.map(s=>({...s,type:"screen"}))}catch(o){Qd.error("Failed to list screen sessions",{error:o})}return t}async getTmuxWindows(e){return this.tmuxManager.listWindows(e)}async getTmuxPanes(e,r){return this.tmuxManager.listPanes(e,r)}async createSession(e,r,i){if(e==="tmux")await this.tmuxManager.createSession(r,i?.command);else if(e==="zellij")await this.zellijManager.createSession(r,i?.layout);else if(e==="screen"){let t=i?.command?i.command.join(" "):void 0;await this.screenManager.createSession(r,t)}else throw new Error(`Unknown multiplexer type: ${e}`)}async attachToSession(e,r,i){if(e==="tmux")return this.tmuxManager.attachToTmux(r,i?.windowIndex,i?.paneIndex,i);if(e==="zellij")return this.zellijManager.attachToZellij(r,i);if(e==="screen"){let t=await this.screenManager.attachToSession(r);return(await this.ptyManager.createSession(t,{...i,titleMode:"dynamic"})).sessionId}else throw new Error(`Unknown multiplexer type: ${e}`)}async killSession(e,r){if(e==="tmux")await this.tmuxManager.killSession(r);else if(e==="zellij")await this.zellijManager.killSession(r);else if(e==="screen")await this.screenManager.killSession(r);else throw new Error(`Unknown multiplexer type: ${e}`)}async killTmuxWindow(e,r){await this.tmuxManager.killWindow(e,r)}async killTmuxPane(e,r){await this.tmuxManager.killPane(e,r)}getCurrentMultiplexer(){if(this.tmuxManager.isInsideTmux()){let e=this.tmuxManager.getCurrentSession();if(e)return{type:"tmux",session:e}}if(this.zellijManager.isInsideZellij()){let e=this.zellijManager.getCurrentSession();if(e)return{type:"zellij",session:e}}if(this.screenManager.isInsideScreen()){let e=this.screenManager.getCurrentSession();if(e)return{type:"screen",session:e}}return null}};W();var Rr=T("multiplexer-routes");function nv(n){let{ptyManager:e}=n,r=(0,rv.Router)(),i=Bs.getInstance(e);return r.get("/status",async(t,o)=>{try{let s=await i.getAvailableMultiplexers();o.json(s)}catch(s){Rr.error("Failed to get multiplexer status",{error:s}),o.status(500).json({error:"Failed to get multiplexer status"})}}),r.get("/tmux/sessions/:sessionName/windows",async(t,o)=>{try{let{sessionName:s}=t.params,a=await i.getTmuxWindows(s);o.json({windows:a})}catch(s){Rr.error("Failed to list tmux windows",{error:s}),o.status(500).json({error:"Failed to list tmux windows"})}}),r.get("/tmux/sessions/:sessionName/panes",async(t,o)=>{try{let{sessionName:s}=t.params,a=t.query.window?Number.parseInt(t.query.window,10):void 0,c=await i.getTmuxPanes(s,a);o.json({panes:c})}catch(s){Rr.error("Failed to list tmux panes",{error:s}),o.status(500).json({error:"Failed to list tmux panes"})}}),r.post("/sessions",async(t,o)=>{try{let{type:s,name:a,options:c}=t.body;if(!s||!a)return o.status(400).json({error:"Type and name are required"});await i.createSession(s,a,c),o.json({success:!0,type:s,name:a})}catch(s){Rr.error("Failed to create session",{error:s}),o.status(500).json({error:"Failed to create session"})}}),r.post("/attach",async(t,o)=>{try{let{type:s,sessionName:a,windowIndex:c,paneIndex:l,cols:u,rows:d,workingDir:f,titleMode:p}=t.body;if(!s||!a)return o.status(400).json({error:"Type and session name are required"});let m={cols:u,rows:d,workingDir:f,titleMode:p,windowIndex:c,paneIndex:l},g=await i.attachToSession(s,a,m);o.json({success:!0,sessionId:g,target:{type:s,session:a,window:c,pane:l}})}catch(s){Rr.error("Failed to attach to session",{error:s}),o.status(500).json({error:"Failed to attach to session"})}}),r.delete("/:type/sessions/:sessionName",async(t,o)=>{try{let{type:s,sessionName:a}=t.params;await i.killSession(s,a),o.json({success:!0})}catch(s){Rr.error("Failed to kill session",{error:s}),o.status(500).json({error:"Failed to kill session"})}}),r.delete("/tmux/sessions/:sessionName/windows/:windowIndex",async(t,o)=>{try{let{sessionName:s,windowIndex:a}=t.params;await i.killTmuxWindow(s,Number.parseInt(a,10)),o.json({success:!0})}catch(s){Rr.error("Failed to kill window",{error:s}),o.status(500).json({error:"Failed to kill window"})}}),r.delete("/tmux/sessions/:sessionName/panes/:paneId",async(t,o)=>{try{let{sessionName:s,paneId:a}=t.params;await i.killTmuxPane(s,a),o.json({success:!0})}catch(s){Rr.error("Failed to kill pane",{error:s}),o.status(500).json({error:"Failed to kill pane"})}}),r.get("/context",(t,o)=>{let s=i.getCurrentMultiplexer();o.json({context:s})}),r}var iv=require("express");var Ws=class{constructor(e,r){this.vapidManager=e;this.pushNotificationService=r}getStatus(){if(!this.pushNotificationService)return{enabled:!1,configured:!1,subscriptions:0,error:"Push notification service not initialized"};let e=this.pushNotificationService.getSubscriptions();return{enabled:this.vapidManager.isEnabled(),configured:!!this.vapidManager.getPublicKey(),subscriptions:e.length}}};W();var vr=T("push-routes");function ov(n){let{vapidManager:e,pushNotificationService:r,sessionMonitor:i}=n,t=(0,iv.Router)();return t.get("/push/vapid-public-key",(o,s)=>{try{if(!e.isEnabled())return s.status(503).json({error:"Push notifications not configured",message:"VAPID keys not available or service not initialized"});let a=e.getPublicKey();if(!a)return s.status(503).json({error:"Push notifications not configured",message:"VAPID keys not available"});s.json({publicKey:a,enabled:!0})}catch(a){vr.error("Failed to get VAPID public key:",a),s.status(500).json({error:"Internal server error",message:"Failed to retrieve VAPID public key"})}}),t.post("/push/subscribe",async(o,s)=>{if(!r)return s.status(503).json({error:"Push notifications not initialized",message:"Push notification service is not available"});try{let{endpoint:a,keys:c}=o.body;if(!a||!c||!c.p256dh||!c.auth)return s.status(400).json({error:"Invalid subscription data",message:"Missing required subscription fields"});let l=await r.addSubscription(a,c);s.json({success:!0,subscriptionId:l,message:"Successfully subscribed to push notifications"}),vr.log(`Push subscription created: ${l}`)}catch(a){vr.error("Failed to create push subscription:",a),s.status(500).json({error:"Subscription failed",message:"Failed to create push subscription"})}}),t.post("/push/unsubscribe",async(o,s)=>{if(!r)return s.status(503).json({error:"Push notifications not initialized",message:"Push notification service is not available"});try{let{endpoint:a}=o.body;if(!a)return s.status(400).json({error:"Missing endpoint",message:"Endpoint is required for unsubscription"});let l=r.getSubscriptions().find(u=>u.endpoint===a);l&&(await r.removeSubscription(l.id),vr.log(`Push subscription removed: ${l.id}`)),s.json({success:!0,message:"Successfully unsubscribed from push notifications"})}catch(a){vr.error("Failed to remove push subscription:",a),s.status(500).json({error:"Unsubscription failed",message:"Failed to remove push subscription"})}}),t.post("/push/test",async(o,s)=>{if(!r)return s.status(503).json({error:"Push notifications not initialized",message:"Push notification service is not available"});try{let{message:a}=o.body,c=await r.sendNotification({type:"test",title:"\u{1F514} Test Notification",body:a||"This is a test notification from VibeTunnel",icon:"/apple-touch-icon.png",badge:"/favicon-32.png",tag:"vibetunnel-test",requireInteraction:!1,actions:[{action:"dismiss",title:"Dismiss"}]});if(i){let l={type:"test-notification",sessionId:"test-session",sessionName:"Test Notification",timestamp:new Date().toISOString(),message:a||"This is a test notification from VibeTunnel",title:"\u{1F514} Test Notification",body:a||"This is a test notification from VibeTunnel"};i.emit("notification",l),vr.info("\u2705 Test notification also emitted through SSE")}s.json({success:c.success,sent:c.sent,failed:c.failed,errors:c.errors,message:`Test notification sent to ${c.sent} push subscribers${i?" and SSE listeners":""}`}),vr.log(`Test notification sent: ${c.sent} successful, ${c.failed} failed`)}catch(a){vr.error("Failed to send test notification:",a),s.status(500).json({error:"Test notification failed",message:"Failed to send test notification"})}}),t.get("/push/status",(o,s)=>{try{if(!r||!e.isEnabled())return s.json({enabled:!1,configured:!1,hasVapidKeys:!1,totalSubscriptions:0,activeSubscriptions:0,errors:["Push notification service not initialized or VAPID not configured"]});let a=r.getSubscriptions();s.json({enabled:e.isEnabled(),configured:!0,hasVapidKeys:!!e.getPublicKey(),totalSubscriptions:a.length,activeSubscriptions:a.filter(c=>c.isActive).length,status:new Ws(e,r).getStatus()})}catch(a){vr.error("Failed to get push status:",a),s.status(500).json({error:"Status check failed",message:"Failed to retrieve push notification status"})}}),t}Fe();var sv=require("express");W();var Oe=T("remotes");function av(n){let e=(0,sv.Router)(),{remoteRegistry:r,isHQMode:i}=n;return e.get("/remotes",(t,o)=>{if(!i||!r)return Oe.debug("remotes list requested but not in HQ mode"),o.status(404).json({error:"Not running in HQ mode"});let s=r.getRemotes();Oe.debug(`listing ${s.length} registered remotes`);let a=s.map(c=>({...c,sessionIds:Array.from(c.sessionIds)}));o.json(a)}),e.post("/remotes/register",(t,o)=>{if(!i||!r)return Oe.debug("remote registration attempted but not in HQ mode"),o.status(404).json({error:"Not running in HQ mode"});let{id:s,name:a,url:c,token:l}=t.body;if(!s||!a||!c||!l)return Oe.warn(`remote registration missing required fields: got id=${!!s}, name=${!!a}, url=${!!c}, token=${!!l}`),o.status(400).json({error:"Missing required fields: id, name, url, token"});Oe.debug(`attempting to register remote ${a} (${s}) from ${c}`);try{let u=r.register({id:s,name:a,url:c,token:l});Oe.log(v.green(`remote registered: ${a} (${s}) from ${c}`)),o.json({success:!0,remote:u})}catch(u){if(u instanceof Error&&u.message.includes("already registered"))return o.status(409).json({error:u.message});Oe.error("failed to register remote:",u),o.status(500).json({error:"Failed to register remote"})}}),e.delete("/remotes/:remoteId",(t,o)=>{if(!i||!r)return Oe.debug("remote unregistration attempted but not in HQ mode"),o.status(404).json({error:"Not running in HQ mode"});let s=t.params.remoteId;Oe.debug(`attempting to unregister remote ${s}`),r.unregister(s)?(Oe.log(v.yellow(`remote unregistered: ${s}`)),o.json({success:!0})):(Oe.warn(`attempted to unregister non-existent remote: ${s}`),o.status(404).json({error:"Remote not found"}))}),e.post("/remotes/:remoteName/refresh-sessions",async(t,o)=>{if(!i||!r)return Oe.debug("session refresh attempted but not in HQ mode"),o.status(404).json({error:"Not running in HQ mode"});if(ht())return Oe.debug("session refresh rejected during shutdown"),o.status(503).json({error:"Server is shutting down"});let s=t.params.remoteName,{action:a,sessionId:c}=t.body;Oe.debug(`refreshing sessions for remote ${s} (action: ${a}, sessionId: ${c})`);let u=r.getRemotes().find(d=>d.name===s);if(!u)return Oe.warn(`remote not found for session refresh: ${s}`),o.status(404).json({error:"Remote not found"});try{let d=Date.now(),f=await fetch(`${u.url}/api/sessions`,{headers:{Authorization:`Bearer ${u.token}`},signal:AbortSignal.timeout(5e3)});if(f.ok){let m=(await f.json()).map(h=>h.id),g=Date.now()-d;r.updateRemoteSessions(u.id,m),Oe.log(v.green(`updated sessions for remote ${u.name}: ${m.length} sessions`)),Oe.debug(`session refresh completed in ${g}ms (action: ${a}, sessionId: ${c})`),o.json({success:!0,sessionCount:m.length})}else throw new Error(`Failed to fetch sessions: ${f.status}`)}catch(d){if(ht())return Oe.log(v.yellow(`remote ${u.name} refresh failed during shutdown (expected)`)),o.status(503).json({error:"Server is shutting down"});Oe.error(`failed to refresh sessions for remote ${u.name}:`,d),o.status(500).json({error:"Failed to refresh sessions"})}}),e}var lv=require("child_process"),uv=require("express"),lt=C(require("fs/promises")),dv=C(require("os")),qn=C(require("path")),fv=require("util");W();var Ve=T("repositories"),Xi=(0,fv.promisify)(lv.exec);function mv(){let n=(0,uv.Router)();return n.get("/repositories/branches",async(e,r)=>{try{let i=e.query.path;if(!i||typeof i!="string")return r.status(400).json({error:"Missing or invalid path parameter"});let t=Jt(i);Ve.debug(`[GET /repositories/branches] Listing branches for: ${t}`);let o=await fx(t);r.json(o)}catch(i){Ve.error("[GET /repositories/branches] Error listing branches:",i),r.status(500).json({error:"Failed to list branches"})}}),n.get("/repositories/discover",async(e,r)=>{try{let i=e.query.path||Zn,t=Number.parseInt(e.query.maxDepth)||3;Ve.debug(`[GET /repositories/discover] Discovering repositories in: ${i}`);let o=Jt(i);Ve.debug(`[GET /repositories/discover] Expanded path: ${o}`);try{await lt.access(o,lt.constants.R_OK),Ve.debug(`[GET /repositories/discover] Path exists and is readable: ${o}`)}catch(a){Ve.error(`[GET /repositories/discover] Cannot access path: ${o}`,a)}let s=await dx({basePath:o,maxDepth:t});Ve.debug(`[GET /repositories/discover] Found ${s.length} repositories`),r.json(s)}catch(i){Ve.error("[GET /repositories/discover] Error discovering repositories:",i),r.status(500).json({error:"Failed to discover repositories"})}}),n}async function dx(n){let{basePath:e,maxDepth:r=3}=n,i=[];Ve.debug(`Starting repository discovery in ${e} with maxDepth=${r}`);async function t(o,s){if(!(s>r))try{if(await lt.access(o,lt.constants.R_OK),s===0){let c=qn.join(o,".git");try{await lt.access(c,lt.constants.F_OK);let l=await cv(o);i.push(l),Ve.debug(`Found git repository at base path: ${o}`);return}catch{}}let a=await lt.readdir(o,{withFileTypes:!0});for(let c of a){if(!c.isDirectory()||c.name.startsWith(".")&&c.name!==".git")continue;let l=qn.join(o,c.name),u=qn.join(l,".git");try{await lt.access(u,lt.constants.F_OK);let d=await cv(l);i.push(d),Ve.debug(`Found git repository: ${l}`)}catch{await t(l,s+1)}}}catch(a){Ve.debug(`Cannot access directory ${o}:`,a)}}return await t(e,0),i.sort((o,s)=>o.folderName.localeCompare(s.folderName)),i}async function fx(n){let e=[];try{let r;try{let{stdout:o}=await Xi("git branch --show-current",{cwd:n});r=o.trim()}catch{Ve.debug("Failed to get current branch, repository might be in detached HEAD state")}let{stdout:i}=await Xi("git branch",{cwd:n}),t=i.split(`
`).map(o=>o.trim()).filter(o=>o.length>0).map(o=>{let s=o.startsWith("*"),a=o.replace(/^\*?\s+/,"");return{name:a,current:s||a===r,remote:!1}});e.push(...t);try{let{stdout:o}=await Xi("git branch -r",{cwd:n}),s=o.split(`
`).map(a=>a.trim()).filter(a=>a.length>0&&!a.includes("->")).map(a=>({name:a.replace(/^\s+/,""),current:!1,remote:!0}));e.push(...s)}catch{Ve.debug("No remote branches found")}try{let{stdout:o}=await Xi("git worktree list --porcelain",{cwd:n}),s=mx(o);for(let a of s){let c=e.find(l=>l.name===a.branch||l.name===`refs/heads/${a.branch}`||l.name.replace(/^origin\//,"")===a.branch);c&&(c.worktree=a.path)}}catch{Ve.debug("Failed to get worktree information")}return e.sort((o,s)=>o.current&&!s.current?-1:!o.current&&s.current?1:!o.remote&&s.remote?-1:o.remote&&!s.remote?1:o.name.localeCompare(s.name)),e}catch(r){throw Ve.error("Error listing branches:",r),r}}function mx(n){let e=[],r=n.trim().split(`
`),i={};for(let t of r){if(t===""){i.path&&i.branch&&e.push({path:i.path,branch:i.branch}),i={};continue}let[o,...s]=t.split(" "),a=s.join(" ");o==="worktree"?i.path=a:o==="branch"&&(i.branch=a.replace(/^refs\/heads\//,""))}return i.path&&i.branch&&e.push({path:i.path,branch:i.branch}),e}async function cv(n){let e=qn.basename(n),r=await lt.stat(n),i=r.mtime.toISOString(),t=dv.homedir(),o=n.startsWith(t)?`~${n.slice(t.length)}`:n,s;try{let{stdout:a}=await Xi("git branch --show-current",{cwd:n});s=a.trim()}catch{Ve.debug(`Failed to get git branch for ${n}`)}return{id:`${e}-${r.ino}`,path:n,folderName:e,lastModified:i,relativePath:o,gitBranch:s}}Fe();var bv=require("express"),Xd=C(require("fs")),wv=C(require("path")),Sv=require("util");function px(n){let e=[];if(n.fg!==void 0)if(n.fg>=0&&n.fg<=255)e.push(`fg="${n.fg}"`);else{let r=n.fg>>16&255,i=n.fg>>8&255,t=n.fg&255;e.push(`fg="${r},${i},${t}"`)}if(n.bg!==void 0)if(n.bg>=0&&n.bg<=255)e.push(`bg="${n.bg}"`);else{let r=n.bg>>16&255,i=n.bg>>8&255,t=n.bg&255;e.push(`bg="${r},${i},${t}"`)}return n.attributes&&(n.attributes&1&&e.push("bold"),n.attributes&2&&e.push("dim"),n.attributes&4&&e.push("italic"),n.attributes&8&&e.push("underline"),n.attributes&16&&e.push("inverse"),n.attributes&32&&e.push("invisible"),n.attributes&64&&e.push("strikethrough")),e.join(" ")}function pv(n,e=!0){let r=[];for(let i of n){let t="";if(e){let o="",s="",a=()=>{s&&(o?t+=`[style ${o}]${s}[/style]`:t+=s,s="")};for(let c of i){let l=px(c);l!==o&&(a(),o=l),s+=c.char}a()}else for(let o of i)t+=o.char;r.push(t.trimEnd())}return r.join(`
`)}var eo=require("child_process");W();var Ne=T("tailscale-serve"),Yd=class{serveProcess=null;currentPort=null;isStarting=!1;tailscaleExecutable="tailscale";lastError;startTime;async start(e){if(this.isStarting)throw new Error("Tailscale Serve is already starting");this.serveProcess&&(Ne.info("Tailscale Serve is already running, stopping first..."),await this.stop()),this.isStarting=!0,this.lastError=void 0;try{await this.checkTailscaleAvailable();try{Ne.debug("Resetting Tailscale Serve configuration...");let i=(0,eo.spawn)(this.tailscaleExecutable,["serve","reset"],{stdio:["ignore","pipe","pipe"]});await new Promise(t=>{i.on("exit",()=>t()),i.on("error",()=>t()),setTimeout(t,1e3)})}catch{Ne.debug("Failed to reset serve config (this is normal if none exists)")}let r=["serve",e.toString()];Ne.info(`Starting Tailscale Serve on port ${e}`),Ne.debug(`Command: ${this.tailscaleExecutable} ${r.join(" ")}`),this.currentPort=e,this.serveProcess=(0,eo.spawn)(this.tailscaleExecutable,r,{stdio:["ignore","pipe","pipe"],detached:!1}),this.serveProcess.on("error",i=>{Ne.error(`Tailscale Serve process error: ${i.message}`),this.lastError=i.message,this.cleanup()}),this.serveProcess.on("exit",(i,t)=>{Ne.info(`Tailscale Serve process exited with code ${i}, signal ${t}`),i!==0&&(this.lastError=`Process exited with code ${i}`),this.cleanup()}),this.serveProcess.stdout&&this.serveProcess.stdout.on("data",i=>{Ne.debug(`Tailscale Serve stdout: ${i.toString().trim()}`)}),this.serveProcess.stderr&&this.serveProcess.stderr.on("data",i=>{let t=i.toString().trim();Ne.debug(`Tailscale Serve stderr: ${t}`),(t.includes("error")||t.includes("failed"))&&(this.lastError=t)}),await new Promise((i,t)=>{let o=!1,s=(c,l)=>{if(!o)if(o=!0,clearTimeout(a),c)Ne.info("Tailscale Serve started successfully"),this.startTime=new Date,i();else{let u=l instanceof Error?l.message:l||"Tailscale Serve failed to start";this.lastError=u,t(new Error(u))}},a=setTimeout(()=>{this.serveProcess&&!this.serveProcess.killed?s(!0):s(!1,this.lastError)},3e3);this.serveProcess&&(this.serveProcess.once("error",c=>{s(!1,c)}),this.serveProcess.once("exit",c=>{c===0?s(!1,"Tailscale Serve exited immediately with code 0 - likely already configured or invalid state"):s(!1,`Tailscale Serve exited unexpectedly with code ${c}`)}))})}catch(r){throw this.lastError=r instanceof Error?r.message:String(r),this.cleanup(),r}finally{this.isStarting=!1}}async stop(){try{Ne.debug("Removing Tailscale Serve configuration...");let e=(0,eo.spawn)(this.tailscaleExecutable,["serve","reset"],{stdio:["ignore","pipe","pipe"]});await new Promise(r=>{e.on("exit",i=>{i===0&&Ne.debug("Tailscale Serve configuration reset successfully"),r()}),e.on("error",()=>r()),setTimeout(r,2e3)})}catch{Ne.debug("Failed to reset serve config during stop")}if(!this.serveProcess){Ne.debug("No Tailscale Serve process to stop");return}return Ne.info("Stopping Tailscale Serve process..."),new Promise(e=>{if(!this.serveProcess){e();return}let r=()=>{this.cleanup(),e()},i=setTimeout(()=>{this.serveProcess&&!this.serveProcess.killed&&(Ne.warn("Force killing Tailscale Serve process"),this.serveProcess.kill("SIGKILL")),r()},5e3);this.serveProcess.once("exit",()=>{clearTimeout(i),r()}),this.serveProcess.kill("SIGTERM")})}isRunning(){return this.serveProcess!==null&&!this.serveProcess.killed}async getStatus(){let e=this.isRunning();return process.env.VIBETUNNEL_TAILSCALE_ERROR?{isRunning:!1,lastError:process.env.VIBETUNNEL_TAILSCALE_ERROR}:{isRunning:e,port:e?this.currentPort??void 0:void 0,lastError:this.lastError,startTime:this.startTime}}cleanup(){if(this.serveProcess&&!this.serveProcess.killed){Ne.debug("Terminating orphaned Tailscale Serve process");try{this.serveProcess.kill("SIGTERM"),setTimeout(()=>{this.serveProcess&&!this.serveProcess.killed&&(Ne.warn("Force killing Tailscale Serve process"),this.serveProcess.kill("SIGKILL"))},1e3)}catch(e){Ne.error("Failed to kill Tailscale Serve process:",e)}}this.serveProcess=null,this.currentPort=null,this.isStarting=!1,this.startTime=void 0}async checkTailscaleAvailable(){let e=await import("fs/promises"),r=[];process.platform==="darwin"?r=["/Applications/Tailscale.app/Contents/MacOS/Tailscale","/usr/local/bin/tailscale","/opt/homebrew/bin/tailscale"]:process.platform==="linux"&&(r=["/usr/bin/tailscale","/usr/local/bin/tailscale","/opt/tailscale/bin/tailscale","/snap/bin/tailscale"]);for(let i of r)try{await e.access(i,e.constants.X_OK),this.tailscaleExecutable=i,Ne.debug(`Found Tailscale at: ${i}`);return}catch{}return new Promise((i,t)=>{let o=(0,eo.spawn)("which",["tailscale"],{stdio:["ignore","pipe","pipe"]});o.on("exit",s=>{s===0?i():t(new Error("Tailscale command not found. Please install Tailscale first."))}),o.on("error",s=>{t(new Error(`Failed to check Tailscale availability: ${s.message}`))})})}},Jn=new Yd;var gv=require("child_process"),hv=require("util"),gx=(0,hv.promisify)(gv.execFile);async function Zs(n){try{let{stdout:e}=await gx("git",["status","--porcelain=v1","--branch"],{cwd:n,timeout:5e3,env:{...process.env,GIT_TERMINAL_PROMPT:"0"}}),r=e.trim().split(`
`),i=r[0],t=0,o=0,s=0,a=0,c=0,l=0;if(i?.startsWith("##")){let u=i.match(/\[ahead (\d+)/),d=i.match(/behind (\d+)/);u&&(t=Number.parseInt(u[1],10)),d&&(o=Number.parseInt(d[1],10))}for(let u=1;u<r.length;u++){let d=r[u];if(!d||d.length<2)continue;let f=d[0],p=d[1];f!==" "&&f!=="?"&&c++,p==="M"?s++:p==="D"&&f===" "&&l++,f==="?"&&p==="?"&&a++}return{modified:s,added:a,staged:c,deleted:l,ahead:t,behind:o}}catch{return{modified:0,added:0,staged:0,deleted:0,ahead:0,behind:0}}}W();$n();Ir();var I=T("sessions"),tC=(0,Sv.promisify)(require("child_process").execFile);function vv(n,e){if(!n||n.trim()==="")return e;let r=Jt(n);return!n.startsWith("/")&&!n.startsWith("~")?wv.join(e,n):r}function $v(n){let e=(0,bv.Router)(),{ptyManager:r,terminalManager:i,streamWatcher:t,remoteRegistry:o,isHQMode:s,activityMonitor:a}=n;return e.get("/server/status",async(c,l)=>{I.debug("[GET /server/status] Getting server status");try{let u={macAppConnected:ee.isMacAppConnected(),isHQMode:s,version:process.env.VERSION||"unknown"};l.json(u)}catch(u){I.error("Failed to get server status:",u),l.status(500).json({error:"Failed to get server status"})}}),e.get("/sessions/tailscale/status",async(c,l)=>{I.debug("[GET /sessions/tailscale/status] Getting Tailscale Serve status");try{let u=await Jn.getStatus();l.json(u)}catch(u){I.error("Failed to get Tailscale Serve status:",u),l.status(500).json({error:"Failed to get Tailscale Serve status"})}}),e.get("/sessions",async(c,l)=>{I.debug("[GET /sessions] Listing all sessions");try{let u=[],d=r.listSessions();if(I.debug(`[GET /sessions] Found ${d.length} local sessions`),u=[...await Promise.all(d.map(async p=>{if(!p.gitRepoPath&&p.workingDir)try{let m=await Zr(p.workingDir);return{...p,...m,source:"local"}}catch(m){I.debug(`[GET /sessions] Could not detect Git info for session ${p.id}: ${m}`)}return{...p,source:"local"}}))],s&&o){let p=o.getRemotes();I.debug(`checking ${p.length} remote servers for sessions`);let m=p.map(async S=>{try{let y=await fetch(`${S.url}/api/sessions`,{headers:{Authorization:`Bearer ${S.token}`},signal:AbortSignal.timeout(5e3)});if(y.ok){let k=await y.json();I.debug(`got ${k.length} sessions from remote ${S.name}`);let b=k.map(R=>R.id);return o.updateRemoteSessions(S.id,b),k.map(R=>({...R,source:"remote",remoteId:S.id,remoteName:S.name,remoteUrl:S.url}))}else return I.warn(`failed to get sessions from remote ${S.name}: HTTP ${y.status}`),[]}catch(y){return I.error(`failed to get sessions from remote ${S.name}:`,y),[]}}),h=(await Promise.all(m)).flat();I.debug(`total remote sessions: ${h.length}`),u=[...u,...h]}I.debug(`returning ${u.length} total sessions`),l.json(u)}catch(u){I.error("error listing sessions:",u),l.status(500).json({error:"Failed to list sessions"})}}),e.post("/sessions",async(c,l)=>{let{command:u,workingDir:d,name:f,remoteId:p,spawn_terminal:m,cols:g,rows:h,titleMode:S}=c.body;if(I.debug(`creating new session: command=${JSON.stringify(u)}, remoteId=${p||"local"}, spawn_terminal=${m}, cols=${g}, rows=${h}`),!u||!Array.isArray(u)||u.length===0)return I.warn("session creation failed: invalid command array"),l.status(400).json({error:"Command array is required"});try{for(let b of u){if(typeof b!="string")throw new Error("All command arguments must be strings");if(b.length>1e3)throw new Error("Command argument exceeds maximum length");if(b.includes("\0"))throw new Error("Command arguments cannot contain null bytes")}let y=u[0];if(y.includes("/")&&!y.startsWith("/")&&y.includes("../"))throw new Error("Command cannot contain directory traversal sequences");let k=[/[;&|`$()]/,/\$\{/,/\$\(/,/>\s*\/dev/,/2>&1/];for(let b of k)if(b.test(y))throw new Error("Command contains potentially dangerous patterns")}catch(y){return I.warn(`session creation failed: command validation error: ${y instanceof Error?y.message:String(y)}`),l.status(400).json({error:"Invalid command",details:y instanceof Error?y.message:String(y)})}try{if(p&&s&&o){let F=o.getRemote(p);if(!F)return I.warn(`session creation failed: remote ${p} not found`),l.status(404).json({error:"Remote server not found"});I.log(v.blue(`forwarding session creation to remote ${F.name}`));let X=Date.now(),K=await fetch(`${F.url}/api/sessions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${F.token}`},body:JSON.stringify({command:u,workingDir:d,name:f,spawn_terminal:m,cols:g,rows:h,titleMode:S}),signal:AbortSignal.timeout(1e4)});if(!K.ok){let dt=await K.json().catch(()=>({error:"Unknown error"}));return l.status(K.status).json(dt)}let ge=await K.json();I.debug(`remote session creation took ${Date.now()-X}ms`),ge.sessionId&&o.addSessionToRemote(F.id,ge.sessionId),l.json(ge);return}if(m)try{let F=hx(),X=vv(d,process.cwd()),K=f||mi(u,X),ge=await Zr(X);I.log(v.blue(`requesting terminal spawn with command: ${JSON.stringify(u)}`));let dt=await vx({sessionId:F,sessionName:K,command:u,workingDir:X,titleMode:S,gitRepoPath:ge.gitRepoPath,gitBranch:ge.gitBranch,gitAheadCount:ge.gitAheadCount,gitBehindCount:ge.gitBehindCount,gitHasChanges:ge.gitHasChanges,gitIsWorktree:ge.gitIsWorktree,gitMainRepoPath:ge.gitMainRepoPath});if(!dt.success)I.warn("terminal spawn failed:",dt.error||"Unknown error"),I.debug("falling back to normal web session");else{await new Promise(P=>setTimeout(P,500)),I.log(v.green(`terminal spawn requested for session ${F}`)),l.json({sessionId:F,message:"Terminal spawn requested"});return}}catch(F){I.error("error spawning terminal:",F),I.debug("falling back to normal web session")}let y=vv(d,process.cwd());Xd.existsSync(y)||(I.warn(`Working directory '${y}' does not exist, using current directory as fallback`),y=process.cwd());let k=f||mi(u,y),b=await Zr(y);I.log(v.blue(`creating WEB session: ${u.join(" ")} in ${y} (spawn_terminal=${m})`));let R=await r.createSession(u,{name:k,workingDir:y,cols:g,rows:h,titleMode:S,gitRepoPath:b.gitRepoPath,gitBranch:b.gitBranch,gitAheadCount:b.gitAheadCount,gitBehindCount:b.gitBehindCount,gitHasChanges:b.gitHasChanges,gitIsWorktree:b.gitIsWorktree,gitMainRepoPath:b.gitMainRepoPath}),{sessionId:z,sessionInfo:L}=R;I.log(v.green(`WEB session ${z} created (PID: ${L.pid})`)),l.json({sessionId:z})}catch(y){I.error("error creating session:",y),y instanceof J?l.status(500).json({error:"Failed to create session",details:y.message}):l.status(500).json({error:"Failed to create session"})}}),e.get("/sessions/activity",async(c,l)=>{I.debug("getting activity status for all sessions");try{let u={},d=a.getActivityStatus();if(Object.assign(u,d),s&&o){let p=o.getRemotes().map(async g=>{try{let h=await fetch(`${g.url}/api/sessions/activity`,{headers:{Authorization:`Bearer ${g.token}`},signal:AbortSignal.timeout(5e3)});if(h.ok){let S=await h.json();return{remote:{id:g.id,name:g.name,url:g.url},activity:S}}}catch(h){I.error(`failed to get activity from remote ${g.name}:`,h)}return null}),m=await Promise.all(p);for(let g of m)g?.activity&&Object.assign(u,g.activity)}l.json(u)}catch(u){I.error("error getting activity status:",u),l.status(500).json({error:"Failed to get activity status"})}}),e.get("/sessions/:sessionId/activity",async(c,l)=>{let u=c.params.sessionId;try{if(s&&o){let f=o.getRemoteBySessionId(u);if(f)try{let p=await fetch(`${f.url}/api/sessions/${u}/activity`,{headers:{Authorization:`Bearer ${f.token}`},signal:AbortSignal.timeout(5e3)});return p.ok?l.json(await p.json()):l.status(p.status).json(await p.json())}catch(p){return I.error(`failed to get activity from remote ${f.name}:`,p),l.status(503).json({error:"Failed to reach remote server"})}}let d=a.getSessionActivityStatus(u);if(!d)return l.status(404).json({error:"Session not found"});l.json(d)}catch(d){I.error(`error getting activity status for session ${u}:`,d),l.status(500).json({error:"Failed to get activity status"})}}),e.get("/sessions/:sessionId/git-status",async(c,l)=>{let u=c.params.sessionId;try{if(s&&o){let p=o.getRemoteBySessionId(u);if(p)try{let m=await fetch(`${p.url}/api/sessions/${u}/git-status`,{headers:{Authorization:`Bearer ${p.token}`},signal:AbortSignal.timeout(5e3)});return m.ok?l.json(await m.json()):l.status(m.status).json(await m.json())}catch(m){return I.error(`failed to get git status from remote ${p.name}:`,m),l.status(503).json({error:"Failed to reach remote server"})}}let d=r.getSession(u);if(!d)return l.status(404).json({error:"Session not found"});let f=await Zs(d.workingDir);l.json(f)}catch(d){I.error(`error getting git status for session ${u}:`,d),l.status(500).json({error:"Failed to get git status"})}}),e.get("/sessions/:sessionId",async(c,l)=>{let u=c.params.sessionId;I.debug(`getting info for session ${u}`);try{if(s&&o){let f=o.getRemoteBySessionId(u);if(f)try{let p=await fetch(`${f.url}/api/sessions/${u}`,{headers:{Authorization:`Bearer ${f.token}`},signal:AbortSignal.timeout(5e3)});return p.ok?l.json(await p.json()):l.status(p.status).json(await p.json())}catch(p){return I.error(`failed to get session info from remote ${f.name}:`,p),l.status(503).json({error:"Failed to reach remote server"})}}let d=r.getSession(u);if(!d)return l.status(404).json({error:"Session not found"});if(!d.gitRepoPath&&d.workingDir)try{let f=await Zr(d.workingDir);l.json({...d,...f});return}catch(f){I.debug(`[GET /sessions/:id] Could not detect Git info for session ${d.id}: ${f}`)}l.json(d)}catch(d){I.error("error getting session info:",d),l.status(500).json({error:"Failed to get session info"})}}),e.delete("/sessions/:sessionId",async(c,l)=>{let u=c.params.sessionId;I.debug(`killing session ${u}`);try{if(s&&o){let f=o.getRemoteBySessionId(u);if(f)try{let p=await fetch(`${f.url}/api/sessions/${u}`,{method:"DELETE",headers:{Authorization:`Bearer ${f.token}`},signal:AbortSignal.timeout(1e4)});return p.ok?(o.removeSessionFromRemote(u),I.log(v.yellow(`remote session ${u} killed on ${f.name}`)),l.json(await p.json())):l.status(p.status).json(await p.json())}catch(p){return I.error(`failed to kill session on remote ${f.name}:`,p),l.status(503).json({error:"Failed to reach remote server"})}}let d=r.getSession(u);if(!d)return l.status(404).json({error:"Session not found"});if(d.status==="exited")r.cleanupSession(u),I.log(v.yellow(`local session ${u} cleaned up`)),l.json({success:!0,message:"Session cleaned up"});else{let f=d.name?.startsWith("tmux:")||d.command?.includes("tmux attach");await r.killSession(u,"SIGTERM"),f?(I.log(v.yellow(`local session ${u} detached from tmux`)),l.json({success:!0,message:"Detached from tmux session"})):(I.log(v.yellow(`local session ${u} killed`)),l.json({success:!0,message:"Session killed"}))}}catch(d){I.error("error killing session:",d),d instanceof J?l.status(500).json({error:"Failed to kill session",details:d.message}):l.status(500).json({error:"Failed to kill session"})}}),e.delete("/sessions/:sessionId/cleanup",async(c,l)=>{let u=c.params.sessionId;I.debug(`cleaning up session ${u} files`);try{if(s&&o){let d=o.getRemoteBySessionId(u);if(d)try{let f=await fetch(`${d.url}/api/sessions/${u}/cleanup`,{method:"DELETE",headers:{Authorization:`Bearer ${d.token}`},signal:AbortSignal.timeout(1e4)});return f.ok?(o.removeSessionFromRemote(u),I.log(v.yellow(`remote session ${u} cleaned up on ${d.name}`)),l.json(await f.json())):l.status(f.status).json(await f.json())}catch(f){return I.error(`failed to cleanup session on remote ${d.name}:`,f),l.status(503).json({error:"Failed to reach remote server"})}}r.cleanupSession(u),I.log(v.yellow(`local session ${u} cleaned up`)),l.json({success:!0,message:"Session cleaned up"})}catch(d){I.error("error cleaning up session:",d),d instanceof J?l.status(500).json({error:"Failed to cleanup session",details:d.message}):l.status(500).json({error:"Failed to cleanup session"})}}),e.post("/cleanup-exited",async(c,l)=>{I.log(v.blue("cleaning up all exited sessions"));try{let u=r.cleanupExitedSessions();if(I.log(v.green(`cleaned up ${u.length} local exited sessions`)),s&&o)for(let p of u)o.removeSessionFromRemote(p);let d=u.length,f=[];if(s&&o){let m=o.getRemotes().map(async g=>{try{let h=await fetch(`${g.url}/api/cleanup-exited`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g.token}`},signal:AbortSignal.timeout(1e4)});if(h.ok){let y=(await h.json()).cleanedSessions||[],k=y.length;d+=k;for(let b of y)o.removeSessionFromRemote(b);f.push({remoteName:g.name,cleaned:k})}else throw new Error(`HTTP ${h.status}`)}catch(h){I.error(`failed to cleanup sessions on remote ${g.name}:`,h),f.push({remoteName:g.name,cleaned:0,error:h instanceof Error?h.message:"Unknown error"})}});await Promise.all(m)}l.json({success:!0,message:`${d} exited sessions cleaned up across all servers`,localCleaned:u.length,remoteResults:f})}catch(u){I.error("error cleaning up exited sessions:",u),u instanceof J?l.status(500).json({error:"Failed to cleanup exited sessions",details:u.message}):l.status(500).json({error:"Failed to cleanup exited sessions"})}}),e.get("/sessions/:sessionId/text",async(c,l)=>{let u=c.params.sessionId,d=c.query.styles!==void 0;I.debug(`getting plain text for session ${u}, styles=${d}`);try{if(s&&o){let g=o.getRemoteBySessionId(u);if(g)try{let h=new URL(`${g.url}/api/sessions/${u}/text`);d&&h.searchParams.set("styles","");let S=await fetch(h.toString(),{headers:{Authorization:`Bearer ${g.token}`},signal:AbortSignal.timeout(5e3)});if(!S.ok)return l.status(S.status).json(await S.json());let y=await S.text();return l.setHeader("Content-Type","text/plain"),l.send(y)}catch(h){return I.error(`failed to get text from remote ${g.name}:`,h),l.status(503).json({error:"Failed to reach remote server"})}}if(!r.getSession(u))return l.status(404).json({error:"Session not found"});let p=await i.getBufferSnapshot(u),m=pv(p.cells,d);l.setHeader("Content-Type","text/plain"),l.send(m)}catch(f){I.error("error getting plain text:",f),l.status(500).json({error:"Failed to get terminal text"})}}),e.get("/sessions/:sessionId/buffer",async(c,l)=>{let u=c.params.sessionId;I.debug(`client requesting buffer for session ${u}`);try{if(s&&o){let m=o.getRemoteBySessionId(u);if(m)try{let g=await fetch(`${m.url}/api/sessions/${u}/buffer`,{headers:{Authorization:`Bearer ${m.token}`},signal:AbortSignal.timeout(5e3)});if(!g.ok)return l.status(g.status).json(await g.json());let h=await g.arrayBuffer();return l.setHeader("Content-Type","application/octet-stream"),l.send(Buffer.from(h))}catch(g){return I.error(`failed to get buffer from remote ${m.name}:`,g),l.status(503).json({error:"Failed to reach remote server"})}}if(!r.getSession(u))return I.error(`session ${u} not found`),l.status(404).json({error:"Session not found"});let f=await i.getBufferSnapshot(u),p=i.encodeSnapshot(f);I.debug(`sending buffer for session ${u}: ${p.length} bytes, dimensions: ${f.cols}x${f.rows}, cursor: (${f.cursorX},${f.cursorY})`),l.setHeader("Content-Type","application/octet-stream"),l.send(p)}catch(d){I.error("error getting buffer:",d),l.status(500).json({error:"Failed to get terminal buffer"})}}),e.get("/sessions/:sessionId/stream",async(c,l)=>{let u=c.params.sessionId,d=Date.now();if(I.log(v.blue(`new SSE client connected to session ${u} from ${c.get("User-Agent")?.substring(0,50)||"unknown"}`)),s&&o){let y=o.getRemoteBySessionId(u);if(y)try{let k=new AbortController,b=await fetch(`${y.url}/api/sessions/${u}/stream`,{headers:{Authorization:`Bearer ${y.token}`,Accept:"text/event-stream"},signal:k.signal});if(!b.ok)return l.status(b.status).json(await b.json());l.writeHead(200,{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Cache-Control","X-Accel-Buffering":"no"});let R=b.body?.getReader();if(!R)throw new Error("No response body");let z=new TextDecoder,L={count:0};(async()=>{try{for(;;){let{done:X,value:K}=await R.read();if(X)break;L.count+=K.length;let ge=z.decode(K,{stream:!0});l.write(ge)}}catch(X){I.error(`stream proxy error for remote ${y.name}:`,X)}})(),c.on("close",()=>{I.log(v.yellow(`SSE client disconnected from remote session ${u} (proxied ${L.count} bytes)`)),k.abort()});return}catch(k){return I.error(`failed to stream from remote ${y.name}:`,k),l.status(503).json({error:"Failed to reach remote server"})}}if(!r.getSession(u))return l.status(404).json({error:"Session not found"});let p=r.getSessionPaths(u);if(!p)return l.status(404).json({error:"Session paths not found"});let m=p.stdoutPath;if(!m||!Xd.existsSync(m))return I.warn(`stream path not found for session ${u}`),l.status(404).json({error:"Session stream not found"});l.writeHead(200,{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Cache-Control","X-Accel-Buffering":"no","Content-Encoding":"identity"}),l.flushHeaders(),l.write(`:ok

`),l.flush&&l.flush(),t.addClient(u,m,l),I.debug(`SSE stream setup completed in ${Date.now()-d}ms`);let g=setInterval(()=>{l.write(`:heartbeat

`),l.flush&&l.flush()},3e4),h=!1,S=()=>{h||(h=!0,I.log(v.yellow(`SSE client disconnected from session ${u}`)),t.removeClient(u,l),clearInterval(g))};c.on("close",S),c.on("error",y=>{I.error(`SSE client error for session ${u}:`,y),S()}),l.on("close",S),l.on("finish",S)}),e.post("/sessions/:sessionId/input",async(c,l)=>{let u=c.params.sessionId,{text:d,key:f}=c.body;if(d===void 0&&f===void 0||d!==void 0&&f!==void 0)return I.warn(`invalid input request for session ${u}: both or neither text/key provided`),l.status(400).json({error:"Either text or key must be provided, but not both"});if(d!==void 0&&typeof d!="string")return I.warn(`invalid input request for session ${u}: text is not a string`),l.status(400).json({error:"Text must be a string"});if(f!==void 0&&typeof f!="string")return I.warn(`invalid input request for session ${u}: key is not a string`),l.status(400).json({error:"Key must be a string"});try{if(s&&o){let g=o.getRemoteBySessionId(u);if(g)try{let h=await fetch(`${g.url}/api/sessions/${u}/input`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g.token}`},body:JSON.stringify(c.body),signal:AbortSignal.timeout(5e3)});return h.ok?l.json(await h.json()):l.status(h.status).json(await h.json())}catch(h){return I.error(`failed to send input to remote ${g.name}:`,h),l.status(503).json({error:"Failed to reach remote server"})}}let p=r.getSession(u);if(!p)return I.error(`session ${u} not found for input`),l.status(404).json({error:"Session not found"});if(p.status!=="running")return I.error(`session ${u} is not running (status: ${p.status})`),l.status(400).json({error:"Session is not running"});let m=d!==void 0?{text:d}:{key:f};I.debug(`sending input to session ${u}: ${JSON.stringify(m)}`),r.sendInput(u,m),l.json({success:!0})}catch(p){I.error("error sending input:",p),p instanceof J?l.status(500).json({error:"Failed to send input",details:p.message}):l.status(500).json({error:"Failed to send input"})}}),e.post("/sessions/:sessionId/resize",async(c,l)=>{let u=c.params.sessionId,{cols:d,rows:f}=c.body;if(typeof d!="number"||typeof f!="number")return I.warn(`invalid resize request for session ${u}: cols/rows not numbers`),l.status(400).json({error:"Cols and rows must be numbers"});if(d<1||f<1||d>1e3||f>1e3)return I.warn(`invalid resize request for session ${u}: cols=${d}, rows=${f} out of range`),l.status(400).json({error:"Cols and rows must be between 1 and 1000"});I.debug(`Resizing session ${u} to ${d}x${f}`);try{if(s&&o){let m=o.getRemoteBySessionId(u);if(m)try{let g=await fetch(`${m.url}/api/sessions/${u}/resize`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m.token}`},body:JSON.stringify({cols:d,rows:f}),signal:AbortSignal.timeout(5e3)});return g.ok?l.json(await g.json()):l.status(g.status).json(await g.json())}catch(g){return I.error(`failed to resize session on remote ${m.name}:`,g),l.status(503).json({error:"Failed to reach remote server"})}}let p=r.getSession(u);if(!p)return I.warn(`session ${u} not found for resize`),l.status(404).json({error:"Session not found"});if(p.status!=="running")return I.warn(`session ${u} is not running (status: ${p.status})`),l.status(400).json({error:"Session is not running"});r.resizeSession(u,d,f),I.log(v.green(`session ${u} resized to ${d}x${f}`)),l.json({success:!0,cols:d,rows:f})}catch(p){I.error("error resizing session via PTY service:",p),p instanceof J?l.status(500).json({error:"Failed to resize session",details:p.message}):l.status(500).json({error:"Failed to resize session"})}}),e.patch("/sessions/:sessionId",async(c,l)=>{let u=c.params.sessionId;I.log(v.yellow(`[PATCH] Received rename request for session ${u}`)),I.debug("[PATCH] Request body:",c.body),I.debug("[PATCH] Request headers:",c.headers);let{name:d}=c.body;if(typeof d!="string"||d.trim()==="")return I.warn(`[PATCH] Invalid name provided: ${JSON.stringify(d)}`),l.status(400).json({error:"Name must be a non-empty string"});I.log(v.blue(`[PATCH] Updating session ${u} name to: ${d}`));try{if(s&&o){let m=o.getRemoteBySessionId(u);if(m)try{let g=await fetch(`${m.url}/api/sessions/${u}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m.token}`},body:JSON.stringify({name:d}),signal:AbortSignal.timeout(5e3)});return g.ok?l.json(await g.json()):l.status(g.status).json(await g.json())}catch(g){return I.error(`failed to update session name on remote ${m.name}:`,g),l.status(503).json({error:"Failed to reach remote server"})}}I.debug("[PATCH] Handling local session update");let f=r.getSession(u);if(!f)return I.warn(`[PATCH] Session ${u} not found for name update`),l.status(404).json({error:"Session not found"});I.debug(`[PATCH] Found session: ${JSON.stringify(f)}`),I.debug(`[PATCH] Calling ptyManager.updateSessionName(${u}, ${d})`);let p=r.updateSessionName(u,d);I.log(v.green(`[PATCH] Session ${u} name updated to: ${p}`)),l.json({success:!0,name:p})}catch(f){I.error("error updating session name:",f),f instanceof J?l.status(500).json({error:"Failed to update session name",details:f.message}):l.status(500).json({error:"Failed to update session name"})}}),e.post("/sessions/:sessionId/reset-size",async(c,l)=>{let{sessionId:u}=c.params;try{if(o){let f=o.getRemoteBySessionId(u);if(f){I.debug(`forwarding reset-size to remote ${f.id}`);let p=await fetch(`${f.url}/api/sessions/${u}/reset-size`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${f.token}`}});if(!p.ok){let g=await p.json();return l.status(p.status).json(g)}let m=await p.json();return l.json(m)}}I.log(v.cyan(`resetting terminal size for session ${u}`));let d=r.getSession(u);if(!d)return I.error(`session ${u} not found for reset-size`),l.status(404).json({error:"Session not found"});if(d.status!=="running")return I.error(`session ${u} is not running (status: ${d.status})`),l.status(400).json({error:"Session is not running"});r.resetSessionSize(u),I.log(v.green(`session ${u} size reset to terminal size`)),l.json({success:!0})}catch(d){I.error("error resetting session size via PTY service:",d),d instanceof J?l.status(500).json({error:"Failed to reset session size",details:d.message}):l.status(500).json({error:"Failed to reset session size"})}}),e}function hx(){let n=new Uint8Array(16);for(let r=0;r<16;r++)n[r]=Math.floor(Math.random()*256);n[6]=n[6]&15|64,n[8]=n[8]&63|128;let e=Array.from(n,r=>r.toString(16).padStart(2,"0")).join("");return[e.slice(0,8),e.slice(8,12),e.slice(12,16),e.slice(16,20),e.slice(20,32)].join("-")}async function vx(n){try{let e=Nm("terminal","spawn",{sessionId:n.sessionId,workingDirectory:n.workingDir,command:n.command.join(" "),terminalPreference:null,gitRepoPath:n.gitRepoPath,gitBranch:n.gitBranch,gitAheadCount:n.gitAheadCount,gitBehindCount:n.gitBehindCount,gitHasChanges:n.gitHasChanges,gitIsWorktree:n.gitIsWorktree,gitMainRepoPath:n.gitMainRepoPath},n.sessionId);I.debug(`requesting terminal spawn via control socket for session ${n.sessionId}`);let r=await ee.sendControlMessage(e);if(!r)return{success:!1,error:"No response from Mac app"};if(r.error)return{success:!1,error:r.error};let i=r.payload?.success===!0;return{success:i,error:i?void 0:"Terminal spawn failed"}}catch(e){return I.error("failed to spawn terminal:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}var xv=require("express");W();var yr=T("test-notification");function kv(n){let{sessionMonitor:e,pushNotificationService:r}=n,i=(0,xv.Router)();return i.post("/test-notification",async(t,o)=>{if(yr.info("\u{1F4E8} Test notification requested from client"),yr.debug("Request headers:",t.headers),!e)return yr.error("\u274C SessionMonitor not available - notification system not initialized"),o.status(503).json({error:"Notification system not initialized"});try{let s=ci(),a={type:"test-notification",sessionId:"test-session",sessionName:"Test Notification",timestamp:new Date().toISOString(),message:"This is a test notification from VibeTunnel server",title:`VibeTunnel Test v${s.version}`,body:`Server-side notifications are working correctly! Server version: ${s.version}`};yr.info("\u{1F4E4} Emitting test notification event through SessionMonitor:",a),e.emit("notification",a),yr.info("\u2705 Test notification event emitted successfully through SSE");let c=null;if(r)try{yr.info("\u{1F4E4} Sending test notification through push service..."),c=await r.sendNotification({type:"test",title:a.title||"\u{1F514} Test Notification",body:a.body||"This is a test notification from VibeTunnel",icon:"/apple-touch-icon.png",badge:"/favicon-32.png",tag:"vibetunnel-test",requireInteraction:!1,actions:[{action:"dismiss",title:"Dismiss"}],data:{type:"test-notification",sessionId:a.sessionId,timestamp:a.timestamp}}),yr.info(`\u2705 Push notification sent to ${c.sent} subscribers`)}catch(l){yr.error("\u274C Failed to send push notification:",l)}o.json({success:!0,message:"Test notification sent through SSE and push",event:a,pushResult:c})}catch(s){yr.error("\u274C Failed to send test notification:",s),o.status(500).json({error:"Failed to send test notification",details:s instanceof Error?s.message:"Unknown error"})}}),i}var _v=require("express");W();var Or=T("tmux-routes");function Pv(n){let{ptyManager:e}=n,r=(0,_v.Router)(),i=Hn.getInstance(e);return r.get("/available",async(t,o)=>{try{let s=await i.isAvailable();o.json({available:s})}catch(s){Or.error("Failed to check tmux availability",{error:s}),o.status(500).json({error:"Failed to check tmux availability"})}}),r.get("/sessions",async(t,o)=>{try{let s=await i.listSessions();o.json({sessions:s})}catch(s){Or.error("Failed to list tmux sessions",{error:s}),o.status(500).json({error:"Failed to list tmux sessions"})}}),r.get("/sessions/:sessionName/windows",async(t,o)=>{try{let{sessionName:s}=t.params,a=await i.listWindows(s);o.json({windows:a})}catch(s){Or.error("Failed to list tmux windows",{error:s}),o.status(500).json({error:"Failed to list tmux windows"})}}),r.get("/sessions/:sessionName/panes",async(t,o)=>{try{let{sessionName:s}=t.params,a=t.query.window?Number.parseInt(t.query.window,10):void 0,c=await i.listPanes(s,a);o.json({panes:c})}catch(s){Or.error("Failed to list tmux panes",{error:s}),o.status(500).json({error:"Failed to list tmux panes"})}}),r.post("/sessions",async(t,o)=>{try{let{name:s,command:a}=t.body;if(!s)return o.status(400).json({error:"Session name is required"});await i.createSession(s,a),o.json({success:!0,name:s})}catch(s){Or.error("Failed to create tmux session",{error:s}),o.status(500).json({error:"Failed to create tmux session"})}}),r.post("/attach",async(t,o)=>{try{let{sessionName:s,windowIndex:a,paneIndex:c,cols:l,rows:u,workingDir:d,titleMode:f}=t.body;if(!s)return o.status(400).json({error:"Session name is required"});let p={cols:l,rows:u,workingDir:d,titleMode:f},m=await i.attachToTmux(s,a,c,p);o.json({success:!0,sessionId:m,target:{session:s,window:a,pane:c}})}catch(s){Or.error("Failed to attach to tmux session",{error:s}),o.status(500).json({error:"Failed to attach to tmux session"})}}),r.post("/sessions/:sessionName/send",async(t,o)=>{try{let{sessionName:s}=t.params,{command:a,windowIndex:c,paneIndex:l}=t.body;if(!a)return o.status(400).json({error:"Command is required"});await i.sendToPane(s,a,c,l),o.json({success:!0})}catch(s){Or.error("Failed to send command to tmux pane",{error:s}),o.status(500).json({error:"Failed to send command to tmux pane"})}}),r.delete("/sessions/:sessionName",async(t,o)=>{try{let{sessionName:s}=t.params;await i.killSession(s),o.json({success:!0})}catch(s){Or.error("Failed to kill tmux session",{error:s}),o.status(500).json({error:"Failed to kill tmux session"})}}),r.get("/context",(t,o)=>{let s=i.isInsideTmux(),a=i.getCurrentSession();o.json({insideTmux:s,currentSession:a})}),r}W();var Ge=T("websocket-input"),Vs=class{ptyManager;terminalManager;activityMonitor;remoteRegistry;authService;isHQMode;remoteConnections=new Map;constructor(e){this.ptyManager=e.ptyManager,this.terminalManager=e.terminalManager,this.activityMonitor=e.activityMonitor,this.remoteRegistry=e.remoteRegistry,this.authService=e.authService,this.isHQMode=e.isHQMode}async connectToRemote(e,r,i){let o=`${e.replace(/^https?:/,a=>a==="https:"?"wss:":"ws:")}/ws/input?sessionId=${r}&token=${encodeURIComponent(i)}`;Ge.log(`Establishing proxy connection to remote: ${o}`);let s=new WebSocket(o);return new Promise((a,c)=>{let l=setTimeout(()=>{s.close(),c(new Error("Remote WebSocket connection timeout"))},5e3);s.addEventListener("open",()=>{clearTimeout(l),Ge.log(`Remote WebSocket proxy established for session ${r}`),a(s)}),s.addEventListener("error",u=>{clearTimeout(l),Ge.error(`Remote WebSocket error for session ${r}:`,u),c(u)})})}async handleConnection(e,r,i){Ge.log(`WebSocket input connection established for session ${r}, user ${i}`);let t=null;if(this.isHQMode&&this.remoteRegistry){let o=this.remoteRegistry.getRemoteBySessionId(r);if(o){Ge.log(`Session ${r} is on remote ${o.name}, establishing proxy connection`);try{t=await this.connectToRemote(o.url,r,o.token),this.remoteConnections.set(r,t),t.addEventListener("close",()=>{Ge.log(`Remote WebSocket closed for session ${r}`),this.remoteConnections.delete(r),e.close()}),t.addEventListener("error",s=>{Ge.error(`Remote WebSocket error for session ${r}:`,s),this.remoteConnections.delete(r),e.close()})}catch(s){Ge.error(`Failed to establish proxy connection to remote for session ${r}:`,s),e.close();return}}}e.on("message",o=>{try{if(t&&t.readyState===WebSocket.OPEN){o instanceof Buffer?t.send(o):Array.isArray(o)?t.send(Buffer.concat(o)):t.send(o);return}let s=o.toString();if(!s)return;try{let a;if(Ge.debug(`Raw WebSocket input: ${JSON.stringify(s)} (length: ${s.length})`),s.startsWith("\0")&&s.endsWith("\0")&&s.length>2){let c=s.slice(1,-1);Ge.debug(`Detected special key: "${c}"`),a={key:c},Ge.debug(`Mapped to special key: ${JSON.stringify(a)}`)}else a={text:s},Ge.debug(`Regular text input: ${JSON.stringify(a)}`);Ge.debug(`Sending to PTY manager: ${JSON.stringify(a)}`),this.ptyManager.sendInput(r,a)}catch(a){Ge.warn(`Failed to send input to session ${r}:`,a)}}catch(s){Ge.error("Error processing WebSocket input message:",s)}}),e.on("close",()=>{Ge.log(`WebSocket input connection closed for session ${r}`),t&&(t.close(),this.remoteConnections.delete(r))}),e.on("error",o=>{Ge.error(`WebSocket input error for session ${r}:`,o)})}};var Iv=require("express"),Qt=C(require("path")),Ev=require("util");W();$n();Ir();var ce=T("worktree-routes"),yx=(0,Ev.promisify)(require("child_process").execFile);async function Me(n,e={}){try{let{stdout:r,stderr:i}=await yx("git",n,{cwd:e.cwd||process.cwd(),timeout:e.timeout||1e4,maxBuffer:10485760,env:{...process.env,GIT_TERMINAL_PROMPT:"0"}});return{stdout:r.toString(),stderr:i.toString()}}catch(r){throw Nr(r,"Git command failed")}}async function bx(n){try{let{stdout:e}=await Me(["symbolic-ref","refs/remotes/origin/HEAD"],{cwd:n}),r=e.trim().match(/refs\/remotes\/origin\/(.+)$/);if(r)return r[1]}catch{ce.debug("Could not detect default branch from origin")}try{return await Me(["rev-parse","--verify","main"],{cwd:n}),"main"}catch{return"master"}}function Gs(n){let e=[],r=n.trim().split(`
`),i=null;for(let t of r){if(t===""){i?.path&&i.HEAD&&e.push({path:i.path,branch:i.branch||"HEAD",HEAD:i.HEAD,detached:i.detached||!1,prunable:i.prunable,locked:i.locked,lockedReason:i.lockedReason}),i=null;continue}let[o,...s]=t.split(" "),a=s.join(" ");if(o==="worktree")i={path:a};else if(i)switch(o){case"HEAD":i.HEAD=a;break;case"branch":i.branch=a;break;case"detached":i.detached=!0;break;case"prunable":i.prunable=!0;break;case"locked":i.locked=!0,a&&(i.lockedReason=a);break}}return i?.path&&i.HEAD&&e.push({path:i.path,branch:i.branch||"HEAD",HEAD:i.HEAD,detached:i.detached||!1,prunable:i.prunable,locked:i.locked,lockedReason:i.lockedReason}),e}async function wx(n,e,r){let i={commitsAhead:0,filesChanged:0,insertions:0,deletions:0};try{let{stdout:t}=await Me(["rev-list","--count",`${r}...${e}`],{cwd:n});i.commitsAhead=Number.parseInt(t.trim())||0}catch(t){ce.debug(`Could not get commit count for ${e}: ${t}`)}try{let{stdout:t}=await Me(["diff","--shortstat",`${r}...${e}`],{cwd:n}),o=t.match(/(\d+) files? changed(?:, (\d+) insertions?\(\+\))?(?:, (\d+) deletions?\(-\))?/);o&&(i.filesChanged=Number.parseInt(o[1])||0,i.insertions=Number.parseInt(o[2])||0,i.deletions=Number.parseInt(o[3])||0)}catch(t){ce.debug(`Could not get diff stats for ${e}: ${t}`)}return i}async function Tv(n){try{let{stdout:e}=await Me(["status","--porcelain"],{cwd:n});return e.trim().length>0}catch(e){return ce.debug(`Could not check uncommitted changes for ${n}: ${e}`),!1}}function Cv(){let n=(0,Iv.Router)();return n.get("/worktrees",async(e,r)=>{try{let{repoPath:i}=e.query;if(!i||typeof i!="string")return r.status(400).json({error:"Missing or invalid repoPath parameter"});let t=Qt.resolve(i);ce.debug(`Listing worktrees for repo: ${t}`);let o=await bx(t);ce.debug(`Using base branch: ${o}`);let s;try{let{stdout:u}=await Me(["config","vibetunnel.followWorktree"],{cwd:t}),d=u.trim();if(d){let{stdout:f}=await Me(["worktree","list","--porcelain"],{cwd:t}),m=Gs(f).find(g=>g.path===d);m&&(s=m.branch.replace(/^refs\/heads\//,""))}}catch{}let{stdout:a}=await Me(["worktree","list","--porcelain"],{cwd:t}),c=Gs(a),l=await Promise.all(c.map(async u=>{if(u.detached||!u.branch)return u;let d=await wx(u.path,u.branch,o),f=await Tv(u.path);return{...u,...d,stats:d,hasUncommittedChanges:f}}));return r.json({worktrees:l,baseBranch:o,followBranch:s})}catch(i){ce.error("Error listing worktrees:",i);let t=i;return t.code==="ENOENT"||t.stderr?.includes("not a git repository")?r.json({worktrees:[],baseBranch:"main",followBranch:void 0}):r.status(500).json({error:"Failed to list worktrees",details:t.stderr||t.message})}}),n.delete("/worktrees/:branch",async(e,r)=>{try{let{branch:i}=e.params,{repoPath:t,force:o}=e.query;if(!t||typeof t!="string")return r.status(400).json({error:"Missing or invalid repoPath parameter"});let s=Qt.resolve(t),a=o==="true";ce.debug(`Removing worktree for branch: ${i}, force: ${a}`);let{stdout:c}=await Me(["worktree","list","--porcelain"],{cwd:s}),u=Gs(c).find(f=>{let p=f.branch?.replace(/^refs\/heads\//,"");return f.branch===`refs/heads/${i}`||p===i||f.branch===i});if(!u)return r.status(404).json({error:`Worktree for branch '${i}' not found`});if(!a&&await Tv(u.path))return r.status(409).json({error:"Worktree has uncommitted changes",worktreePath:u.path});let d=["worktree","remove"];return a&&d.push("--force"),d.push(u.path),await Me(d,{cwd:s}),ce.info(`Successfully removed worktree: ${u.path}`),r.json({success:!0,message:"Worktree removed successfully",removedPath:u.path})}catch(i){ce.error("Error removing worktree:",i);let t=i;return r.status(500).json({error:"Failed to remove worktree",details:t.stderr||t.message})}}),n.post("/worktrees/prune",async(e,r)=>{try{let{repoPath:i}=e.body;if(!i||typeof i!="string")return r.status(400).json({error:"Missing or invalid repoPath in request body"});let t=Qt.resolve(i);ce.debug(`Pruning worktrees for repo: ${t}`);let{stdout:o,stderr:s}=await Me(["worktree","prune"],{cwd:t});return ce.info("Successfully pruned worktree information"),r.json({success:!0,message:"Worktree information pruned successfully",output:o||s||"No output",pruned:o||s||""})}catch(i){ce.error("Error pruning worktrees:",i);let t=i;return r.status(500).json({error:"Failed to prune worktrees",details:t.stderr||t.message})}}),n.post("/worktrees",async(e,r)=>{try{let{repoPath:i,branch:t,path:o,baseBranch:s}=e.body;if(!i||typeof i!="string")return r.status(400).json({error:"Missing or invalid repoPath in request body"});if(!t||typeof t!="string")return r.status(400).json({error:"Missing or invalid branch in request body"});if(!o||typeof o!="string")return r.status(400).json({error:"Missing or invalid path in request body"});let a=Qt.resolve(i),c=Qt.resolve(o);ce.debug(`Creating worktree for branch: ${t} at path: ${c}`);let l=["worktree","add"];return s?l.push("-b",t,c,s):l.push(c,t),await Me(l,{cwd:a}),ce.info(`Successfully created worktree at: ${c}`),r.json({message:"Worktree created successfully",worktreePath:c,branch:t})}catch(i){ce.error("Error creating worktree:",i);let t=i;return r.status(500).json({error:"Failed to create worktree",details:t.stderr||t.message})}}),n.post("/worktrees/follow",async(e,r)=>{try{let{repoPath:i,branch:t,enable:o}=e.body;if(!i||typeof i!="string")return r.status(400).json({error:"Missing or invalid repoPath in request body"});if(typeof o!="boolean")return r.status(400).json({error:"Missing or invalid enable flag in request body"});if(o&&(!t||typeof t!="string"))return r.status(400).json({error:"Missing or invalid branch in request body"});let s=Qt.resolve(i);if(ce.debug(`${o?"Enabling":"Disabling"} follow mode${t?` for branch: ${t}`:""}`),o){let a=await En(s);ce.debug(`Git hooks installed: ${a}`);let c=null;if(!a){ce.info("Installing Git hooks for follow mode");let f=await In(s);if(c=f,!f.success)return ce.error("Failed to install Git hooks:",f.errors),r.status(500).json({error:"Failed to install Git hooks",details:f.errors});ce.info("Git hooks installed successfully")}let{stdout:l}=await Me(["worktree","list","--porcelain"],{cwd:s}),d=Gs(l).find(f=>f.branch===t||f.branch===`refs/heads/${t}`||f.branch.replace(/^refs\/heads\//,"")===t);if(!d)return r.status(400).json({error:`No worktree found for branch: ${t}`});await Me(["config","--local","vibetunnel.followWorktree",d.path],{cwd:s}),ce.info(`Follow mode enabled for branch: ${t}`);try{let f=t.replace(/^refs\/heads\//,""),{stdout:p}=await Me(["branch","--list",f],{cwd:s});if(p.trim())await Me(["checkout",f],{cwd:s}),ce.info(`Main repository switched to branch: ${f}`);else try{await Me(["fetch","origin",`${f}:${f}`],{cwd:s}),await Me(["checkout",f],{cwd:s}),ce.info(`Fetched and switched to branch: ${f}`)}catch(m){ce.warn(`Could not fetch/switch to branch ${f}:`,m)}}catch(f){ce.warn(`Could not immediately switch to branch ${t}:`,f)}if(ee.isMacAppConnected()){let f=Je("system","notification",{level:"info",title:"Follow Mode Enabled",message:`Now following branch '${t}' in ${Qt.basename(s)}`});ee.sendToMac(f)}return r.json({success:!0,enabled:!0,message:"Follow mode enabled",branch:t,hooksInstalled:!0,hooksInstallResult:c})}else{await Me(["config","--local","--unset","vibetunnel.followWorktree"],{cwd:s}),ce.info("Uninstalling Git hooks");let a=await gi(s);if(a.success?ce.info("Git hooks uninstalled successfully"):ce.warn("Failed to uninstall some Git hooks:",a.errors),ce.info("Follow mode disabled"),ee.isMacAppConnected()){let c=Je("system","notification",{level:"info",title:"Follow Mode Disabled",message:`Follow mode has been disabled for ${Qt.basename(s)}`});ee.sendToMac(c)}return r.json({success:!0,enabled:!1,message:"Follow mode disabled",branch:t})}}catch(i){if(gp(i)&&!e.body.enable)return ce.debug("Follow mode was already disabled"),r.json({success:!0,enabled:!1,message:"Follow mode disabled"});ce.error("Error managing follow mode:",i);let t=i;return r.status(500).json({error:"Failed to manage follow mode",details:t.stderr||t.message})}}),n}Fe();var le=C(require("fs")),br=C(require("path"));W();var _e=T("activity-monitor"),Hs=class{controlPath;activities=new Map;watchers=new Map;checkInterval=null;ACTIVITY_TIMEOUT=500;CHECK_INTERVAL=100;constructor(e){this.controlPath=e}start(){_e.log(v.green("activity monitor started"));let e=this.scanSessions();e>0&&_e.log(v.blue(`monitoring ${e} existing sessions`)),this.checkInterval=setInterval(()=>{this.scanSessions(),this.updateActivityStates()},this.CHECK_INTERVAL)}stop(){_e.log(v.yellow("stopping activity monitor")),this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null);let e=this.watchers.size;for(let[r,i]of this.watchers)i.close(),this.watchers.delete(r);this.activities.clear(),e>0&&_e.log(v.gray(`closed ${e} file watchers`))}scanSessions(){try{if(!le.existsSync(this.controlPath))return 0;let e=le.readdirSync(this.controlPath,{withFileTypes:!0}),r=0;for(let t of e)if(t.isDirectory()){let o=t.name;if(this.activities.has(o))continue;let s=br.join(this.controlPath,o,"stdout");le.existsSync(s)&&this.startMonitoringSession(o,s)&&r++}let i=[];for(let[t,o]of this.activities){let s=br.join(this.controlPath,t);le.existsSync(s)||i.push(t)}if(i.length>0){_e.log(v.yellow(`cleaning up ${i.length} removed sessions`));for(let t of i)this.stopMonitoringSession(t)}return r}catch(e){return _e.error("failed to scan sessions:",e),0}}startMonitoringSession(e,r){try{let i=le.statSync(r);this.activities.set(e,{sessionId:e,isActive:!1,lastActivityTime:Date.now(),lastFileSize:i.size});let t=le.watch(r,o=>{o==="change"&&this.handleFileChange(e,r)});return this.watchers.set(e,t),_e.debug(`started monitoring session ${e}`),!0}catch(i){return _e.error(`failed to start monitor for session ${e}:`,i),!1}}stopMonitoringSession(e){let r=this.watchers.get(e);r&&(r.close(),this.watchers.delete(e)),this.activities.delete(e),_e.debug(`stopped monitoring session ${e}`)}handleFileChange(e,r){try{let i=this.activities.get(e);if(!i)return;if(!le.existsSync(r)){this.stopMonitoringSession(e);return}let t=le.statSync(r);if(t.size>i.lastFileSize){let o=i.isActive;i.isActive=!0,i.lastActivityTime=Date.now(),i.lastFileSize=t.size,o||_e.debug(`session ${e} became active`),this.writeActivityStatus(e,!0)}}catch(i){i.code==="ENOENT"?this.stopMonitoringSession(e):_e.error(`failed to handle file change for session ${e}:`,i)}}updateActivityStates(){let e=Date.now();for(let[r,i]of this.activities)i.isActive&&e-i.lastActivityTime>this.ACTIVITY_TIMEOUT&&(i.isActive=!1,_e.debug(`session ${r} became inactive`),this.writeActivityStatus(r,!1))}writeActivityStatus(e,r){try{let i=br.join(this.controlPath,e,"activity.json"),t=br.join(this.controlPath,e,"session.json"),o={isActive:r,timestamp:new Date().toISOString()};if(le.existsSync(t))try{let s=JSON.parse(le.readFileSync(t,"utf8"));o.session=s}catch{_e.debug(`could not read session.json for ${e}`)}le.writeFileSync(i,JSON.stringify(o,null,2))}catch(i){_e.error(`failed to write activity status for session ${e}:`,i)}}getActivityStatus(){let e={},r=Date.now();try{if(!le.existsSync(this.controlPath))return e;let i=le.readdirSync(this.controlPath,{withFileTypes:!0});for(let o of i)if(o.isDirectory()){let s=o.name,a=br.join(this.controlPath,s,"activity.json"),c=br.join(this.controlPath,s,"session.json");if(le.existsSync(a))try{let l=JSON.parse(le.readFileSync(a,"utf8"));e[s]=l}catch{_e.debug(`could not read activity.json for ${s}`);let u=this.activities.get(s);if(u){let d={isActive:u.isActive,timestamp:new Date().toISOString()};if(le.existsSync(c))try{let f=JSON.parse(le.readFileSync(c,"utf8"));d.session=f}catch{_e.debug(`could not read session.json for ${s} when creating activity`)}e[s]=d}}else if(le.existsSync(c))try{let l=JSON.parse(le.readFileSync(c,"utf8"));e[s]={isActive:!1,timestamp:new Date().toISOString(),session:l}}catch{_e.debug(`could not read session.json for ${s}`)}}let t=Date.now()-r;t>100&&_e.warn(`activity status scan took ${t}ms for ${Object.keys(e).length} sessions`)}catch(i){_e.error("failed to read activity status:",i)}return e}getSessionActivityStatus(e){let r=br.join(this.controlPath,e,"session.json");try{let i=br.join(this.controlPath,e,"activity.json");if(le.existsSync(i))return JSON.parse(le.readFileSync(i,"utf8"))}catch{_e.debug(`could not read activity.json for session ${e}, creating from current state`);let t=this.activities.get(e);if(t){let o={isActive:t.isActive,timestamp:new Date().toISOString()};if(le.existsSync(r))try{let s=JSON.parse(le.readFileSync(r,"utf8"));o.session=s}catch{_e.debug(`could not read session.json for ${e} in getSessionActivityStatus`)}return o}}if(le.existsSync(r))try{let i=JSON.parse(le.readFileSync(r,"utf8"));return{isActive:!1,timestamp:new Date().toISOString(),session:i}}catch{_e.debug(`could not read session.json for ${e} when creating default activity`)}return null}};var wr=C(require("crypto")),Js=C(require("jsonwebtoken"));var to=C(require("fs")),sn=C(require("path"));function Nv(n){let e={exports:{}};return process.dlopen(e,n),e.exports}var on,zv=sn.dirname(process.execPath),jv=sn.join(zv,"authenticate_pam.node"),Av=sn.join(zv,"native","authenticate_pam.node");if(to.existsSync(jv)||to.existsSync(Av)){let n=[jv,Av,...[1,2,3].map(r=>sn.join(__dirname,...Array(r).fill(".."),"native","authenticate_pam.node"))],e=!1;for(let r of n)if(to.existsSync(r))try{let i=Nv(r);if(i.authenticate)on=i.authenticate;else throw new Error("Module does not export authenticate function");e=!0;break}catch{}e||(console.warn("Warning: authenticate-pam native module not found. PAM authentication will not work."),on=(r,i,t)=>{t(new Error("PAM authentication not available"))})}else{let n=!1;try{let e=require("authenticate-pam");on=e.authenticate||e.default||e,n=!0}catch{}if(!n){let e=[1,3,2],r=["optional-modules","authenticate-pam","build","Release","authenticate_pam.node"];for(let i of e){let t=[__dirname,...Array(i).fill(".."),...r],o=sn.join(...t);if(to.existsSync(o))try{let s=Nv(o);if(s.authenticate){on=s.authenticate,n=!0,console.log("Loaded authenticate-pam from optional-modules location:",o);break}}catch{}}}n||(console.warn("Warning: authenticate-pam native module not found. PAM authentication will not work."),on=(e,r,i)=>{i(new Error("PAM authentication not available"))})}var qs=class{challenges=new Map;jwtSecret;challengeTimeout=300*1e3;constructor(){this.jwtSecret=process.env.JWT_SECRET||this.generateSecret(),setInterval(()=>this.cleanupExpiredChallenges(),6e4)}generateSecret(){return wr.randomBytes(64).toString("hex")}cleanupExpiredChallenges(){let e=Date.now();for(let[r,i]of this.challenges.entries())e-i.timestamp>this.challengeTimeout&&this.challenges.delete(r)}async authenticateWithSSHKey(e){try{let r=this.challenges.get(e.challengeId);if(!r)return{success:!1,error:"Invalid or expired challenge"};let i=Buffer.from(e.signature,"base64");if(!this.verifySSHSignature(r.challenge,i,e.publicKey))return{success:!1,error:"Invalid SSH key signature"};if(!await this.checkSSHKeyAuthorization(r.userId,e.publicKey))return{success:!1,error:"SSH key not authorized for this user"};this.challenges.delete(e.challengeId);let s=this.generateToken(r.userId);return{success:!0,userId:r.userId,token:s}}catch(r){return console.error("SSH key authentication error:",r),{success:!1,error:"SSH key authentication failed"}}}async authenticateWithPassword(e,r){try{let i=process.env.VIBETUNNEL_USERNAME,t=process.env.VIBETUNNEL_PASSWORD;if(i&&t)if(e===i&&r===t){let a=this.generateToken(e);return{success:!0,userId:e,token:a}}else return{success:!1,error:"Invalid username or password"};if(!await this.verifyPAMCredentials(e,r))return{success:!1,error:"Invalid username or password"};let s=this.generateToken(e);return{success:!0,userId:e,token:s}}catch(i){return console.error("PAM authentication error:",i),{success:!1,error:"Authentication failed"}}}createChallenge(e){let r=wr.randomUUID(),i=wr.randomBytes(32);return this.challenges.set(r,{challengeId:r,challenge:i,timestamp:Date.now(),userId:e}),{challengeId:r,challenge:i.toString("base64")}}verifyToken(e){try{return{valid:!0,userId:Js.verify(e,this.jwtSecret).userId}}catch{return{valid:!1}}}generateToken(e){return Js.sign({userId:e,iat:Math.floor(Date.now()/1e3)},this.jwtSecret,{expiresIn:"24h"})}async verifyPAMCredentials(e,r){return new Promise(i=>{on(e,r,t=>{t?(console.error("PAM authentication failed:",t.message),i(!1)):i(!0)})})}verifySSHSignature(e,r,i){try{if(!e||!r||!i)return console.error("Missing required parameters for signature verification"),!1;let t=i.trim().split(" ");if(t.length<2)return console.error("Invalid SSH public key format"),!1;let o=t[0],s=t[1];if(o==="ssh-ed25519"){if(r.length!==64)return console.error(`Invalid Ed25519 signature length: ${r.length} (expected 64)`),!1;let a=Buffer.from(s,"base64"),c=0,l=a.readUInt32BE(c);c+=4+l;let u=a.readUInt32BE(c);if(c+=4,u!==32)return console.error(`Invalid Ed25519 key length: ${u} (expected 32)`),!1;let d=a.subarray(c,c+32),f=wr.createPublicKey({key:Buffer.concat([Buffer.from([48,42]),Buffer.from([48,5]),Buffer.from([6,3,43,101,112]),Buffer.from([3,33,0]),d]),format:"der",type:"spki"}),p=wr.verify(null,e,f,r);return console.log(`\u{1F510} Ed25519 signature verification: ${p?"PASSED":"FAILED"}`),p}return console.error(`Unsupported key type: ${o}`),!1}catch(t){return console.error("SSH signature verification failed:",t),!1}}async checkSSHKeyAuthorization(e,r){try{let i=require("os"),t=require("fs"),o=require("path"),s=e===process.env.USER?i.homedir():`/home/${e}`,a=o.join(s,".ssh","authorized_keys");if(!t.existsSync(a))return!1;let c=t.readFileSync(a,"utf8"),l=r.trim().split(" "),u=l.length>1?l[1]:l[0];return c.includes(u)}catch(i){return console.error("Error checking SSH key authorization:",i),!1}}getCurrentUser(){return process.env.USER||process.env.USERNAME||"unknown"}async userExists(e){try{let{spawnSync:r}=require("child_process");return r("id",[e],{stdio:"ignore"}).status===0}catch{return!1}}};Fe();var an=require("ws");W();var H=T("buffer-aggregator"),Ks=class{config;remoteConnections=new Map;clientSubscriptions=new Map;constructor(e){this.config=e,H.log(`BufferAggregator initialized (HQ mode: ${e.isHQMode})`)}async handleClientConnection(e){H.log(v.blue("New client connected"));let r=`client-${Date.now()}`;H.debug(`Assigned client ID: ${r}`),this.clientSubscriptions.set(e,new Map),e.send(JSON.stringify({type:"connected",version:"1.0"})),H.debug("Sent welcome message to client"),e.on("message",async i=>{try{let t=JSON.parse(i.toString());await this.handleClientMessage(e,t)}catch(t){H.error("Error handling client message:",t),e.send(JSON.stringify({type:"error",message:"Invalid message format"}))}}),e.on("close",()=>{this.handleClientDisconnect(e)}),e.on("error",i=>{H.error("Client WebSocket error:",i)})}async handleClientMessage(e,r){let i=this.clientSubscriptions.get(e);if(i)if(r.type==="subscribe"&&r.sessionId){let t=r.sessionId;if(i.has(t)){let s=i.get(t);s&&s(),i.delete(t)}let o=this.config.isHQMode&&this.config.remoteRegistry&&this.config.remoteRegistry.getRemoteBySessionId(t);o?(H.debug(`Subscribing to remote session ${t} on remote ${o.id}`),await this.subscribeToRemoteSession(e,t,o.id)):(H.debug(`Subscribing to local session ${t}`),await this.subscribeToLocalSession(e,t)),e.send(JSON.stringify({type:"subscribed",sessionId:t})),H.log(v.green(`Client subscribed to session ${t}`))}else if(r.type==="unsubscribe"&&r.sessionId){let t=r.sessionId,o=i.get(t);if(o&&(o(),i.delete(t),H.log(v.yellow(`Client unsubscribed from session ${t}`))),this.config.isHQMode&&this.config.remoteRegistry){let s=this.config.remoteRegistry.getRemoteBySessionId(t);if(s){let a=this.remoteConnections.get(s.id);a&&(a.subscriptions.delete(t),a.ws.readyState===an.WebSocket.OPEN?(a.ws.send(JSON.stringify({type:"unsubscribe",sessionId:t})),H.debug(`Sent unsubscribe request to remote ${a.remoteName} for session ${t}`)):H.debug(`Cannot unsubscribe from remote ${a.remoteName} - WebSocket not open`))}}}else r.type==="ping"&&e.send(JSON.stringify({type:"pong",timestamp:Date.now()}))}async subscribeToLocalSession(e,r){let i=this.clientSubscriptions.get(e);if(i)try{let t=await this.config.terminalManager.subscribeToBufferChanges(r,(d,f)=>{try{let p=this.config.terminalManager.encodeSnapshot(f),m=Buffer.from(d,"utf8"),g=5+m.length+p.length,h=Buffer.allocUnsafe(g),S=0;h.writeUInt8(191,S),S+=1,h.writeUInt32LE(m.length,S),S+=4,m.copy(h,S),S+=m.length,p.copy(h,S),e.readyState===an.WebSocket.OPEN?e.send(h):H.debug("Skipping buffer update - client WebSocket not open")}catch(p){H.error("Error encoding buffer update:",p)}});i.set(r,t),H.debug(`Created subscription for local session ${r}`),H.debug(`Sending initial buffer for session ${r}`);let o=await this.config.terminalManager.getBufferSnapshot(r),s=this.config.terminalManager.encodeSnapshot(o),a=Buffer.from(r,"utf8"),c=5+a.length+s.length,l=Buffer.allocUnsafe(c),u=0;l.writeUInt8(191,u),u+=1,l.writeUInt32LE(a.length,u),u+=4,a.copy(l,u),u+=a.length,s.copy(l,u),e.readyState===an.WebSocket.OPEN?(e.send(l),H.debug(`Sent initial buffer (${l.length} bytes) for session ${r}`)):H.warn("Cannot send initial buffer - client WebSocket not open")}catch(t){H.error(`Error subscribing to local session ${r}:`,t),e.send(JSON.stringify({type:"error",message:"Failed to subscribe to session"}))}}async subscribeToRemoteSession(e,r,i){let t=this.remoteConnections.get(i);if(!t||t.ws.readyState!==an.WebSocket.OPEN){if(H.debug(`No active connection to remote ${i}, establishing new connection`),!await this.connectToRemote(i)){H.warn(`Failed to connect to remote ${i} for session ${r}`),e.send(JSON.stringify({type:"error",message:"Failed to connect to remote server"}));return}t=this.remoteConnections.get(i)}if(!t)return;t.subscriptions.add(r),t.ws.send(JSON.stringify({type:"subscribe",sessionId:r})),H.debug(`Sent subscription request to remote ${t.remoteName} for session ${r}`);let o=this.clientSubscriptions.get(e);o&&o.set(r,()=>{})}async connectToRemote(e){if(H.log(`Connecting to remote ${e}`),!this.config.remoteRegistry)return H.warn("No remote registry available"),!1;let r=this.config.remoteRegistry.getRemote(e);if(!r)return H.warn(`Remote ${e} not found in registry`),!1;try{let i=`${r.url.replace(/^http/,"ws")}/buffers`,t=new an.WebSocket(i,{headers:{Authorization:`Bearer ${r.token}`}});H.debug(`Attempting WebSocket connection to ${i}`),await new Promise((s,a)=>{let c=setTimeout(()=>{H.warn(`Connection to remote ${r.name} timed out after 5s`),a(new Error("Connection timeout"))},5e3);t.on("open",()=>{clearTimeout(c),s()}),t.on("error",l=>{clearTimeout(c),a(l)})});let o={ws:t,remoteId:r.id,remoteName:r.name,subscriptions:new Set};return this.remoteConnections.set(e,o),t.on("message",s=>{this.handleRemoteMessage(e,s)}),H.debug(`Remote ${r.name} connection established with ${o.subscriptions.size} initial subscriptions`),t.on("close",()=>{H.log(v.yellow(`Disconnected from remote ${r.name}`)),this.remoteConnections.delete(e)}),t.on("error",s=>{H.error(`Remote ${r.name} WebSocket error:`,s)}),H.log(v.green(`Connected to remote ${r.name}`)),!0}catch(i){return H.error(`Failed to connect to remote ${e}:`,i),!1}}handleRemoteMessage(e,r){if(r.length>0&&r[0]===191)this.forwardBufferToClients(r);else try{let i=JSON.parse(r.toString());H.debug(`Remote ${e} message:`,i.type)}catch(i){H.error("Failed to parse remote message:",i)}}forwardBufferToClients(e){if(e.length<5)return;let r=e.readUInt32LE(1);if(e.length<5+r)return;let i=e.subarray(5,5+r).toString("utf8"),t=0;for(let[o,s]of this.clientSubscriptions)s.has(i)&&o.readyState===an.WebSocket.OPEN&&(o.send(e),t++);t>0&&H.debug(`Forwarded buffer update for session ${i} to ${t} clients`)}handleClientDisconnect(e){let r=this.clientSubscriptions.get(e);if(r){let i=r.size;for(let[t,o]of r)H.debug(`Cleaning up subscription for session ${t}`),o();r.clear(),H.debug(`Cleaned up ${i} subscriptions`)}this.clientSubscriptions.delete(e),H.log(v.yellow("Client disconnected"))}async onRemoteRegistered(e){H.log(`Remote ${e} registered, establishing connection`),await this.connectToRemote(e)||H.warn(`Failed to establish connection to newly registered remote ${e}`)}onRemoteUnregistered(e){H.log(`Remote ${e} unregistered, closing connection`);let r=this.remoteConnections.get(e);r?(H.debug(`Closing connection to remote ${r.remoteName} with ${r.subscriptions.size} active subscriptions`),r.ws.close(),this.remoteConnections.delete(e)):H.debug(`No active connection found for unregistered remote ${e}`)}destroy(){H.log(v.yellow("Shutting down BufferAggregator"));let e=this.clientSubscriptions.size;for(let[i]of this.clientSubscriptions)i.close();this.clientSubscriptions.clear(),H.debug(`Closed ${e} client connections`);let r=this.remoteConnections.size;for(let[i,t]of this.remoteConnections)t.ws.close();this.remoteConnections.clear(),H.debug(`Closed ${r} remote connections`)}};var Qv=require("fs"),ia=require("fs/promises"),Yv=require("events"),te=C(require("path"),1);var Sr=require("node:fs/promises"),Mv=require("node:stream"),$r=require("node:path"),vt={FILE_TYPE:"files",DIR_TYPE:"directories",FILE_DIR_TYPE:"files_directories",EVERYTHING_TYPE:"all"},ef={root:".",fileFilter:n=>!0,directoryFilter:n=>!0,type:vt.FILE_TYPE,lstat:!1,depth:2147483648,alwaysStat:!1,highWaterMark:4096};Object.freeze(ef);var Uv="READDIRP_RECURSIVE_ERROR",Sx=new Set(["ENOENT","EPERM","EACCES","ELOOP",Uv]),Dv=[vt.DIR_TYPE,vt.EVERYTHING_TYPE,vt.FILE_DIR_TYPE,vt.FILE_TYPE],$x=new Set([vt.DIR_TYPE,vt.EVERYTHING_TYPE,vt.FILE_DIR_TYPE]),xx=new Set([vt.EVERYTHING_TYPE,vt.FILE_DIR_TYPE,vt.FILE_TYPE]),kx=n=>Sx.has(n.code),_x=process.platform==="win32",Rv=n=>!0,Ov=n=>{if(n===void 0)return Rv;if(typeof n=="function")return n;if(typeof n=="string"){let e=n.trim();return r=>r.basename===e}if(Array.isArray(n)){let e=n.map(r=>r.trim());return r=>e.some(i=>r.basename===i)}return Rv},tf=class extends Mv.Readable{constructor(e={}){super({objectMode:!0,autoDestroy:!0,highWaterMark:e.highWaterMark});let r={...ef,...e},{root:i,type:t}=r;this._fileFilter=Ov(r.fileFilter),this._directoryFilter=Ov(r.directoryFilter);let o=r.lstat?Sr.lstat:Sr.stat;_x?this._stat=s=>o(s,{bigint:!0}):this._stat=o,this._maxDepth=r.depth??ef.depth,this._wantsDir=t?$x.has(t):!1,this._wantsFile=t?xx.has(t):!1,this._wantsEverything=t===vt.EVERYTHING_TYPE,this._root=(0,$r.resolve)(i),this._isDirent=!r.alwaysStat,this._statsProp=this._isDirent?"dirent":"stats",this._rdOptions={encoding:"utf8",withFileTypes:this._isDirent},this.parents=[this._exploreDir(i,1)],this.reading=!1,this.parent=void 0}async _read(e){if(!this.reading){this.reading=!0;try{for(;!this.destroyed&&e>0;){let r=this.parent,i=r&&r.files;if(i&&i.length>0){let{path:t,depth:o}=r,s=i.splice(0,e).map(c=>this._formatEntry(c,t)),a=await Promise.all(s);for(let c of a){if(!c)continue;if(this.destroyed)return;let l=await this._getEntryType(c);l==="directory"&&this._directoryFilter(c)?(o<=this._maxDepth&&this.parents.push(this._exploreDir(c.fullPath,o+1)),this._wantsDir&&(this.push(c),e--)):(l==="file"||this._includeAsFile(c))&&this._fileFilter(c)&&this._wantsFile&&(this.push(c),e--)}}else{let t=this.parents.pop();if(!t){this.push(null);break}if(this.parent=await t,this.destroyed)return}}}catch(r){this.destroy(r)}finally{this.reading=!1}}}async _exploreDir(e,r){let i;try{i=await(0,Sr.readdir)(e,this._rdOptions)}catch(t){this._onError(t)}return{files:i,depth:r,path:e}}async _formatEntry(e,r){let i,t=this._isDirent?e.name:e;try{let o=(0,$r.resolve)((0,$r.join)(r,t));i={path:(0,$r.relative)(this._root,o),fullPath:o,basename:t},i[this._statsProp]=this._isDirent?e:await this._stat(o)}catch(o){this._onError(o);return}return i}_onError(e){kx(e)&&!this.destroyed?this.emit("warn",e):this.destroy(e)}async _getEntryType(e){if(!e&&this._statsProp in e)return"";let r=e[this._statsProp];if(r.isFile())return"file";if(r.isDirectory())return"directory";if(r&&r.isSymbolicLink()){let i=e.fullPath;try{let t=await(0,Sr.realpath)(i),o=await(0,Sr.lstat)(t);if(o.isFile())return"file";if(o.isDirectory()){let s=t.length;if(i.startsWith(t)&&i.substr(s,1)===$r.sep){let a=new Error(`Circular symlink detected: "${i}" points to "${t}"`);return a.code=Uv,this._onError(a)}return"directory"}}catch(t){return this._onError(t),""}}}_includeAsFile(e){let r=e&&e[this._statsProp];return r&&this._wantsEverything&&!r.isDirectory()}};function Fv(n,e={}){let r=e.entryType||e.type;if(r==="both"&&(r=vt.FILE_DIR_TYPE),r&&(e.type=r),n){if(typeof n!="string")throw new TypeError("readdirp: root argument must be a string. Usage: readdirp(root, options)");if(r&&!Dv.includes(r))throw new Error(`readdirp: Invalid type passed. Use one of ${Dv.join(", ")}`)}else throw new Error("readdirp: root argument is required. Usage: readdirp(root, options)");return e.root=n,new tf(e)}var ln=require("fs"),Rt=require("fs/promises"),we=C(require("path"),1),Bv=require("os"),Px="data",of="end",Wv="close",ta=()=>{};var ra=process.platform,sf=ra==="win32",Tx=ra==="darwin",Ix=ra==="linux",Ex=ra==="freebsd",Zv=(0,Bv.type)()==="OS400",xe={ALL:"all",READY:"ready",ADD:"add",CHANGE:"change",ADD_DIR:"addDir",UNLINK:"unlink",UNLINK_DIR:"unlinkDir",RAW:"raw",ERROR:"error"},Dt=xe,Cx="watch",Nx={lstat:Rt.lstat,stat:Rt.stat},cn="listeners",Qs="errHandlers",Kn="rawEmitters",jx=[cn,Qs,Kn],Ax=new Set(["3dm","3ds","3g2","3gp","7z","a","aac","adp","afdesign","afphoto","afpub","ai","aif","aiff","alz","ape","apk","appimage","ar","arj","asf","au","avi","bak","baml","bh","bin","bk","bmp","btif","bz2","bzip2","cab","caf","cgm","class","cmx","cpio","cr2","cur","dat","dcm","deb","dex","djvu","dll","dmg","dng","doc","docm","docx","dot","dotm","dra","DS_Store","dsk","dts","dtshd","dvb","dwg","dxf","ecelp4800","ecelp7470","ecelp9600","egg","eol","eot","epub","exe","f4v","fbs","fh","fla","flac","flatpak","fli","flv","fpx","fst","fvt","g3","gh","gif","graffle","gz","gzip","h261","h263","h264","icns","ico","ief","img","ipa","iso","jar","jpeg","jpg","jpgv","jpm","jxr","key","ktx","lha","lib","lvp","lz","lzh","lzma","lzo","m3u","m4a","m4v","mar","mdi","mht","mid","midi","mj2","mka","mkv","mmr","mng","mobi","mov","movie","mp3","mp4","mp4a","mpeg","mpg","mpga","mxu","nef","npx","numbers","nupkg","o","odp","ods","odt","oga","ogg","ogv","otf","ott","pages","pbm","pcx","pdb","pdf","pea","pgm","pic","png","pnm","pot","potm","potx","ppa","ppam","ppm","pps","ppsm","ppsx","ppt","pptm","pptx","psd","pya","pyc","pyo","pyv","qt","rar","ras","raw","resources","rgb","rip","rlc","rmf","rmvb","rpm","rtf","rz","s3m","s7z","scpt","sgi","shar","snap","sil","sketch","slk","smv","snk","so","stl","suo","sub","swf","tar","tbz","tbz2","tga","tgz","thmx","tif","tiff","tlz","ttc","ttf","txz","udf","uvh","uvi","uvm","uvp","uvs","uvu","viv","vob","war","wav","wax","wbmp","wdp","weba","webm","webp","whl","wim","wm","wma","wmv","wmx","woff","woff2","wrm","wvx","xbm","xif","xla","xlam","xls","xlsb","xlsm","xlsx","xlt","xltm","xltx","xm","xmind","xpi","xpm","xwd","xz","z","zip","zipx"]),zx=n=>Ax.has(we.extname(n).slice(1).toLowerCase()),nf=(n,e)=>{n instanceof Set?n.forEach(e):e(n)},ro=(n,e,r)=>{let i=n[e];i instanceof Set||(n[e]=i=new Set([i])),i.add(r)},Dx=n=>e=>{let r=n[e];r instanceof Set?r.clear():delete n[e]},no=(n,e,r)=>{let i=n[e];i instanceof Set?i.delete(r):i===r&&delete n[e]},Vv=n=>n instanceof Set?n.size===0:!n,Ys=new Map;function Lv(n,e,r,i,t){let o=(s,a)=>{r(n),t(s,a,{watchedPath:n}),a&&n!==a&&Xs(we.resolve(n,a),cn,we.join(n,a))};try{return(0,ln.watch)(n,{persistent:e.persistent},o)}catch(s){i(s);return}}var Xs=(n,e,r,i,t)=>{let o=Ys.get(n);o&&nf(o[e],s=>{s(r,i,t)})},Rx=(n,e,r,i)=>{let{listener:t,errHandler:o,rawEmitter:s}=i,a=Ys.get(e),c;if(!r.persistent)return c=Lv(n,r,t,o,s),c?c.close.bind(c):void 0;if(a)ro(a,cn,t),ro(a,Qs,o),ro(a,Kn,s);else{if(c=Lv(n,r,Xs.bind(null,e,cn),o,Xs.bind(null,e,Kn)),!c)return;c.on(Dt.ERROR,async l=>{let u=Xs.bind(null,e,Qs);if(a&&(a.watcherUnusable=!0),sf&&l.code==="EPERM")try{await(await(0,Rt.open)(n,"r")).close(),u(l)}catch{}else u(l)}),a={listeners:t,errHandlers:o,rawEmitters:s,watcher:c},Ys.set(e,a)}return()=>{no(a,cn,t),no(a,Qs,o),no(a,Kn,s),Vv(a.listeners)&&(a.watcher.close(),Ys.delete(e),jx.forEach(Dx(a)),a.watcher=void 0,Object.freeze(a))}},rf=new Map,Ox=(n,e,r,i)=>{let{listener:t,rawEmitter:o}=i,s=rf.get(e),a=s&&s.options;return a&&(a.persistent<r.persistent||a.interval>r.interval)&&((0,ln.unwatchFile)(e),s=void 0),s?(ro(s,cn,t),ro(s,Kn,o)):(s={listeners:t,rawEmitters:o,options:r,watcher:(0,ln.watchFile)(e,r,(c,l)=>{nf(s.rawEmitters,d=>{d(Dt.CHANGE,e,{curr:c,prev:l})});let u=c.mtimeMs;(c.size!==l.size||u>l.mtimeMs||u===0)&&nf(s.listeners,d=>d(n,c))})},rf.set(e,s)),()=>{no(s,cn,t),no(s,Kn,o),Vv(s.listeners)&&(rf.delete(e),(0,ln.unwatchFile)(e),s.options=s.watcher=void 0,Object.freeze(s))}},ea=class{constructor(e){this.fsw=e,this._boundHandleError=r=>e._handleError(r)}_watchWithNodeFs(e,r){let i=this.fsw.options,t=we.dirname(e),o=we.basename(e);this.fsw._getWatchedDir(t).add(o);let a=we.resolve(e),c={persistent:i.persistent};r||(r=ta);let l;if(i.usePolling){let u=i.interval!==i.binaryInterval;c.interval=u&&zx(o)?i.binaryInterval:i.interval,l=Ox(e,a,c,{listener:r,rawEmitter:this.fsw._emitRaw})}else l=Rx(e,a,c,{listener:r,errHandler:this._boundHandleError,rawEmitter:this.fsw._emitRaw});return l}_handleFile(e,r,i){if(this.fsw.closed)return;let t=we.dirname(e),o=we.basename(e),s=this.fsw._getWatchedDir(t),a=r;if(s.has(o))return;let c=async(u,d)=>{if(this.fsw._throttle(Cx,e,5)){if(!d||d.mtimeMs===0)try{let f=await(0,Rt.stat)(e);if(this.fsw.closed)return;let p=f.atimeMs,m=f.mtimeMs;if((!p||p<=m||m!==a.mtimeMs)&&this.fsw._emit(Dt.CHANGE,e,f),(Tx||Ix||Ex)&&a.ino!==f.ino){this.fsw._closeFile(u),a=f;let g=this._watchWithNodeFs(e,c);g&&this.fsw._addPathCloser(u,g)}else a=f}catch{this.fsw._remove(t,o)}else if(s.has(o)){let f=d.atimeMs,p=d.mtimeMs;(!f||f<=p||p!==a.mtimeMs)&&this.fsw._emit(Dt.CHANGE,e,d),a=d}}},l=this._watchWithNodeFs(e,c);if(!(i&&this.fsw.options.ignoreInitial)&&this.fsw._isntIgnored(e)){if(!this.fsw._throttle(Dt.ADD,e,0))return;this.fsw._emit(Dt.ADD,e,r)}return l}async _handleSymlink(e,r,i,t){if(this.fsw.closed)return;let o=e.fullPath,s=this.fsw._getWatchedDir(r);if(!this.fsw.options.followSymlinks){this.fsw._incrReadyCount();let a;try{a=await(0,Rt.realpath)(i)}catch{return this.fsw._emitReady(),!0}return this.fsw.closed?void 0:(s.has(t)?this.fsw._symlinkPaths.get(o)!==a&&(this.fsw._symlinkPaths.set(o,a),this.fsw._emit(Dt.CHANGE,i,e.stats)):(s.add(t),this.fsw._symlinkPaths.set(o,a),this.fsw._emit(Dt.ADD,i,e.stats)),this.fsw._emitReady(),!0)}if(this.fsw._symlinkPaths.has(o))return!0;this.fsw._symlinkPaths.set(o,!0)}_handleRead(e,r,i,t,o,s,a){if(e=we.join(e,""),a=this.fsw._throttle("readdir",e,1e3),!a)return;let c=this.fsw._getWatchedDir(i.path),l=new Set,u=this.fsw._readdirp(e,{fileFilter:d=>i.filterPath(d),directoryFilter:d=>i.filterDir(d)});if(u)return u.on(Px,async d=>{if(this.fsw.closed){u=void 0;return}let f=d.path,p=we.join(e,f);if(l.add(f),!(d.stats.isSymbolicLink()&&await this._handleSymlink(d,e,p,f))){if(this.fsw.closed){u=void 0;return}(f===t||!t&&!c.has(f))&&(this.fsw._incrReadyCount(),p=we.join(o,we.relative(o,p)),this._addToNodeFs(p,r,i,s+1))}}).on(Dt.ERROR,this._boundHandleError),new Promise((d,f)=>{if(!u)return f();u.once(of,()=>{if(this.fsw.closed){u=void 0;return}let p=a?a.clear():!1;d(void 0),c.getChildren().filter(m=>m!==e&&!l.has(m)).forEach(m=>{this.fsw._remove(e,m)}),u=void 0,p&&this._handleRead(e,!1,i,t,o,s,a)})})}async _handleDir(e,r,i,t,o,s,a){let c=this.fsw._getWatchedDir(we.dirname(e)),l=c.has(we.basename(e));!(i&&this.fsw.options.ignoreInitial)&&!o&&!l&&this.fsw._emit(Dt.ADD_DIR,e,r),c.add(we.basename(e)),this.fsw._getWatchedDir(e);let u,d,f=this.fsw.options.depth;if((f==null||t<=f)&&!this.fsw._symlinkPaths.has(a)){if(!o&&(await this._handleRead(e,i,s,o,e,t,u),this.fsw.closed))return;d=this._watchWithNodeFs(e,(p,m)=>{m&&m.mtimeMs===0||this._handleRead(p,!1,s,o,e,t,u)})}return d}async _addToNodeFs(e,r,i,t,o){let s=this.fsw._emitReady;if(this.fsw._isIgnored(e)||this.fsw.closed)return s(),!1;let a=this.fsw._getWatchHelpers(e);i&&(a.filterPath=c=>i.filterPath(c),a.filterDir=c=>i.filterDir(c));try{let c=await Nx[a.statMethod](a.watchPath);if(this.fsw.closed)return;if(this.fsw._isIgnored(a.watchPath,c))return s(),!1;let l=this.fsw.options.followSymlinks,u;if(c.isDirectory()){let d=we.resolve(e),f=l?await(0,Rt.realpath)(e):e;if(this.fsw.closed||(u=await this._handleDir(a.watchPath,c,r,t,o,a,f),this.fsw.closed))return;d!==f&&f!==void 0&&this.fsw._symlinkPaths.set(d,f)}else if(c.isSymbolicLink()){let d=l?await(0,Rt.realpath)(e):e;if(this.fsw.closed)return;let f=we.dirname(a.watchPath);if(this.fsw._getWatchedDir(f).add(a.watchPath),this.fsw._emit(Dt.ADD,a.watchPath,c),u=await this._handleDir(f,c,r,t,e,a,d),this.fsw.closed)return;d!==void 0&&this.fsw._symlinkPaths.set(we.resolve(e),d)}else u=this._handleFile(a.watchPath,c,r);return s(),u&&this.fsw._addPathCloser(e,u),!1}catch(c){if(this.fsw._handleError(c))return s(),e}}};var af="/",Mx="//",Xv=".",Ux="..",Fx="string",Lx=/\\/g,Gv=/\/\//,Bx=/\..*\.(sw[px])$|~$|\.subl.*\.tmp/,Wx=/^\.[/\\]/;function na(n){return Array.isArray(n)?n:[n]}var cf=n=>typeof n=="object"&&n!==null&&!(n instanceof RegExp);function Zx(n){return typeof n=="function"?n:typeof n=="string"?e=>n===e:n instanceof RegExp?e=>n.test(e):typeof n=="object"&&n!==null?e=>{if(n.path===e)return!0;if(n.recursive){let r=te.relative(n.path,e);return r?!r.startsWith("..")&&!te.isAbsolute(r):!1}return!1}:()=>!1}function Vx(n){if(typeof n!="string")throw new Error("string expected");n=te.normalize(n),n=n.replace(/\\/g,"/");let e=!1;n.startsWith("//")&&(e=!0);let r=/\/\//;for(;n.match(r);)n=n.replace(r,"/");return e&&(n="/"+n),n}function Hv(n,e,r){let i=Vx(e);for(let t=0;t<n.length;t++){let o=n[t];if(o(i,r))return!0}return!1}function Gx(n,e){if(n==null)throw new TypeError("anymatch: specify first argument");let i=na(n).map(t=>Zx(t));return e==null?(t,o)=>Hv(i,t,o):Hv(i,e)}var qv=n=>{let e=na(n).flat();if(!e.every(r=>typeof r===Fx))throw new TypeError(`Non-string provided as watch path: ${e}`);return e.map(ey)},Jv=n=>{let e=n.replace(Lx,af),r=!1;for(e.startsWith(Mx)&&(r=!0);e.match(Gv);)e=e.replace(Gv,af);return r&&(e=af+e),e},ey=n=>Jv(te.normalize(Jv(n))),Kv=(n="")=>e=>typeof e=="string"?ey(te.isAbsolute(e)?e:te.join(n,e)):e,Hx=(n,e)=>te.isAbsolute(n)?n:te.join(e,n),qx=Object.freeze(new Set),lf=class{constructor(e,r){this.path=e,this._removeWatcher=r,this.items=new Set}add(e){let{items:r}=this;r&&e!==Xv&&e!==Ux&&r.add(e)}async remove(e){let{items:r}=this;if(!r||(r.delete(e),r.size>0))return;let i=this.path;try{await(0,ia.readdir)(i)}catch{this._removeWatcher&&this._removeWatcher(te.dirname(i),te.basename(i))}}has(e){let{items:r}=this;if(r)return r.has(e)}getChildren(){let{items:e}=this;return e?[...e.values()]:[]}dispose(){this.items.clear(),this.path="",this._removeWatcher=ta,this.items=qx,Object.freeze(this)}},Jx="stat",Kx="lstat",uf=class{constructor(e,r,i){this.fsw=i;let t=e;this.path=e=e.replace(Wx,""),this.watchPath=t,this.fullWatchPath=te.resolve(t),this.dirParts=[],this.dirParts.forEach(o=>{o.length>1&&o.pop()}),this.followSymlinks=r,this.statMethod=r?Jx:Kx}entryPath(e){return te.join(this.watchPath,te.relative(this.watchPath,e.fullPath))}filterPath(e){let{stats:r}=e;if(r&&r.isSymbolicLink())return this.filterDir(e);let i=this.entryPath(e);return this.fsw._isntIgnored(i,r)&&this.fsw._hasReadPermissions(r)}filterDir(e){return this.fsw._isntIgnored(this.entryPath(e),e.stats)}},df=class extends Yv.EventEmitter{constructor(e={}){super(),this.closed=!1,this._closers=new Map,this._ignoredPaths=new Set,this._throttled=new Map,this._streams=new Set,this._symlinkPaths=new Map,this._watched=new Map,this._pendingWrites=new Map,this._pendingUnlinks=new Map,this._readyCount=0,this._readyEmitted=!1;let r=e.awaitWriteFinish,i={stabilityThreshold:2e3,pollInterval:100},t={persistent:!0,ignoreInitial:!1,ignorePermissionErrors:!1,interval:100,binaryInterval:300,followSymlinks:!0,usePolling:!1,atomic:!0,...e,ignored:e.ignored?na(e.ignored):na([]),awaitWriteFinish:r===!0?i:typeof r=="object"?{...i,...r}:!1};Zv&&(t.usePolling=!0),t.atomic===void 0&&(t.atomic=!t.usePolling);let o=process.env.CHOKIDAR_USEPOLLING;if(o!==void 0){let c=o.toLowerCase();c==="false"||c==="0"?t.usePolling=!1:c==="true"||c==="1"?t.usePolling=!0:t.usePolling=!!c}let s=process.env.CHOKIDAR_INTERVAL;s&&(t.interval=Number.parseInt(s,10));let a=0;this._emitReady=()=>{a++,a>=this._readyCount&&(this._emitReady=ta,this._readyEmitted=!0,process.nextTick(()=>this.emit(xe.READY)))},this._emitRaw=(...c)=>this.emit(xe.RAW,...c),this._boundRemove=this._remove.bind(this),this.options=t,this._nodeFsHandler=new ea(this),Object.freeze(t)}_addIgnoredPath(e){if(cf(e)){for(let r of this._ignoredPaths)if(cf(r)&&r.path===e.path&&r.recursive===e.recursive)return}this._ignoredPaths.add(e)}_removeIgnoredPath(e){if(this._ignoredPaths.delete(e),typeof e=="string")for(let r of this._ignoredPaths)cf(r)&&r.path===e&&this._ignoredPaths.delete(r)}add(e,r,i){let{cwd:t}=this.options;this.closed=!1,this._closePromise=void 0;let o=qv(e);return t&&(o=o.map(s=>Hx(s,t))),o.forEach(s=>{this._removeIgnoredPath(s)}),this._userIgnored=void 0,this._readyCount||(this._readyCount=0),this._readyCount+=o.length,Promise.all(o.map(async s=>{let a=await this._nodeFsHandler._addToNodeFs(s,!i,void 0,0,r);return a&&this._emitReady(),a})).then(s=>{this.closed||s.forEach(a=>{a&&this.add(te.dirname(a),te.basename(r||a))})}),this}unwatch(e){if(this.closed)return this;let r=qv(e),{cwd:i}=this.options;return r.forEach(t=>{!te.isAbsolute(t)&&!this._closers.has(t)&&(i&&(t=te.join(i,t)),t=te.resolve(t)),this._closePath(t),this._addIgnoredPath(t),this._watched.has(t)&&this._addIgnoredPath({path:t,recursive:!0}),this._userIgnored=void 0}),this}close(){if(this._closePromise)return this._closePromise;this.closed=!0,this.removeAllListeners();let e=[];return this._closers.forEach(r=>r.forEach(i=>{let t=i();t instanceof Promise&&e.push(t)})),this._streams.forEach(r=>r.destroy()),this._userIgnored=void 0,this._readyCount=0,this._readyEmitted=!1,this._watched.forEach(r=>r.dispose()),this._closers.clear(),this._watched.clear(),this._streams.clear(),this._symlinkPaths.clear(),this._throttled.clear(),this._closePromise=e.length?Promise.all(e).then(()=>{}):Promise.resolve(),this._closePromise}getWatched(){let e={};return this._watched.forEach((r,i)=>{let o=(this.options.cwd?te.relative(this.options.cwd,i):i)||Xv;e[o]=r.getChildren().sort()}),e}emitWithAll(e,r){this.emit(e,...r),e!==xe.ERROR&&this.emit(xe.ALL,e,...r)}async _emit(e,r,i){if(this.closed)return;let t=this.options;sf&&(r=te.normalize(r)),t.cwd&&(r=te.relative(t.cwd,r));let o=[r];i!=null&&o.push(i);let s=t.awaitWriteFinish,a;if(s&&(a=this._pendingWrites.get(r)))return a.lastChange=new Date,this;if(t.atomic){if(e===xe.UNLINK)return this._pendingUnlinks.set(r,[e,...o]),setTimeout(()=>{this._pendingUnlinks.forEach((c,l)=>{this.emit(...c),this.emit(xe.ALL,...c),this._pendingUnlinks.delete(l)})},typeof t.atomic=="number"?t.atomic:100),this;e===xe.ADD&&this._pendingUnlinks.has(r)&&(e=xe.CHANGE,this._pendingUnlinks.delete(r))}if(s&&(e===xe.ADD||e===xe.CHANGE)&&this._readyEmitted){let c=(l,u)=>{l?(e=xe.ERROR,o[0]=l,this.emitWithAll(e,o)):u&&(o.length>1?o[1]=u:o.push(u),this.emitWithAll(e,o))};return this._awaitWriteFinish(r,s.stabilityThreshold,e,c),this}if(e===xe.CHANGE&&!this._throttle(xe.CHANGE,r,50))return this;if(t.alwaysStat&&i===void 0&&(e===xe.ADD||e===xe.ADD_DIR||e===xe.CHANGE)){let c=t.cwd?te.join(t.cwd,r):r,l;try{l=await(0,ia.stat)(c)}catch{}if(!l||this.closed)return;o.push(l)}return this.emitWithAll(e,o),this}_handleError(e){let r=e&&e.code;return e&&r!=="ENOENT"&&r!=="ENOTDIR"&&(!this.options.ignorePermissionErrors||r!=="EPERM"&&r!=="EACCES")&&this.emit(xe.ERROR,e),e||this.closed}_throttle(e,r,i){this._throttled.has(e)||this._throttled.set(e,new Map);let t=this._throttled.get(e);if(!t)throw new Error("invalid throttle");let o=t.get(r);if(o)return o.count++,!1;let s,a=()=>{let l=t.get(r),u=l?l.count:0;return t.delete(r),clearTimeout(s),l&&clearTimeout(l.timeoutObject),u};s=setTimeout(a,i);let c={timeoutObject:s,clear:a,count:0};return t.set(r,c),c}_incrReadyCount(){return this._readyCount++}_awaitWriteFinish(e,r,i,t){let o=this.options.awaitWriteFinish;if(typeof o!="object")return;let s=o.pollInterval,a,c=e;this.options.cwd&&!te.isAbsolute(e)&&(c=te.join(this.options.cwd,e));let l=new Date,u=this._pendingWrites;function d(f){(0,Qv.stat)(c,(p,m)=>{if(p||!u.has(e)){p&&p.code!=="ENOENT"&&t(p);return}let g=Number(new Date);f&&m.size!==f.size&&(u.get(e).lastChange=g);let h=u.get(e);g-h.lastChange>=r?(u.delete(e),t(void 0,m)):a=setTimeout(d,s,m)})}u.has(e)||(u.set(e,{lastChange:l,cancelWait:()=>(u.delete(e),clearTimeout(a),i)}),a=setTimeout(d,s))}_isIgnored(e,r){if(this.options.atomic&&Bx.test(e))return!0;if(!this._userIgnored){let{cwd:i}=this.options,o=(this.options.ignored||[]).map(Kv(i)),a=[...[...this._ignoredPaths].map(Kv(i)),...o];this._userIgnored=Gx(a,void 0)}return this._userIgnored(e,r)}_isntIgnored(e,r){return!this._isIgnored(e,r)}_getWatchHelpers(e){return new uf(e,this.options.followSymlinks,this)}_getWatchedDir(e){let r=te.resolve(e);return this._watched.has(r)||this._watched.set(r,new lf(r,this._boundRemove)),this._watched.get(r)}_hasReadPermissions(e){return this.options.ignorePermissionErrors?!0:!!(Number(e.mode)&256)}_remove(e,r,i){let t=te.join(e,r),o=te.resolve(t);if(i=i??(this._watched.has(t)||this._watched.has(o)),!this._throttle("remove",t,100))return;!i&&this._watched.size===1&&this.add(e,r,!0),this._getWatchedDir(t).getChildren().forEach(f=>this._remove(t,f));let c=this._getWatchedDir(e),l=c.has(r);c.remove(r),this._symlinkPaths.has(o)&&this._symlinkPaths.delete(o);let u=t;if(this.options.cwd&&(u=te.relative(this.options.cwd,t)),this.options.awaitWriteFinish&&this._pendingWrites.has(u)&&this._pendingWrites.get(u).cancelWait()===xe.ADD)return;this._watched.delete(t),this._watched.delete(o);let d=i?xe.UNLINK_DIR:xe.UNLINK;l&&!this._isIgnored(t)&&this._emit(d,t),this._closePath(t)}_closePath(e){this._closeFile(e);let r=te.dirname(e);this._getWatchedDir(r).remove(te.basename(e))}_closeFile(e){let r=this._closers.get(e);r&&(r.forEach(i=>i()),this._closers.delete(e))}_addPathCloser(e,r){if(!r)return;let i=this._closers.get(e);i||(i=[],this._closers.set(e,i)),i.push(r)}_readdirp(e,r){if(this.closed)return;let i={type:xe.ALL,alwaysStat:!0,lstat:!0,...r,depth:0},t=Fv(e,i);return this._streams.add(t),t.once(Wv,()=>{t=void 0}),t.once(of,()=>{t&&(this._streams.delete(t),t=void 0)}),t}};function oa(n,e={}){let r=new df(e);return r.add(n),r}var xr=C(require("fs")),ty=C(require("os")),pf=C(require("path"));var Yx=[{name:"\u2728 claude",command:"claude --dangerously-skip-permissions"},{name:"\u2728 gemini",command:"gemini"},{command:"opencode"},{command:"crush"},{command:"zsh"},{command:"node"}],ff={enabled:!1,sessionStart:!1,sessionExit:!0,commandCompletion:!1,commandError:!0,bell:!0,claudeTurn:!1,soundEnabled:!0,vibrationEnabled:!1};var mf={version:2,quickStartCommands:Yx,repositoryBasePath:Zn};W();var He=T("config-service"),Xx=M.object({version:M.number(),quickStartCommands:M.array(M.object({name:M.string().optional(),command:M.string().min(1,"Command cannot be empty")})),repositoryBasePath:M.string().optional(),server:M.object({port:M.number(),dashboardAccessMode:M.string(),cleanupOnStartup:M.boolean(),authenticationMode:M.string()}).optional(),development:M.object({debugMode:M.boolean(),useDevServer:M.boolean(),devServerPath:M.string(),logLevel:M.string()}).optional(),preferences:M.object({preferredGitApp:M.string().optional(),preferredTerminal:M.string().optional(),updateChannel:M.string(),showInDock:M.boolean(),preventSleepWhenRunning:M.boolean(),notifications:M.object({enabled:M.boolean(),sessionStart:M.boolean(),sessionExit:M.boolean(),commandCompletion:M.boolean(),commandError:M.boolean(),bell:M.boolean(),claudeTurn:M.boolean(),soundEnabled:M.boolean(),vibrationEnabled:M.boolean()}).optional()}).optional(),remoteAccess:M.object({ngrokEnabled:M.boolean(),ngrokTokenPresent:M.boolean()}).optional(),sessionDefaults:M.object({command:M.string(),workingDirectory:M.string(),spawnWindow:M.boolean(),titleMode:M.string()}).optional()}),sa=class{configDir;configPath;config=mf;watcher;configChangeCallbacks=new Set;constructor(){this.configDir=pf.join(ty.homedir(),".vibetunnel"),this.configPath=pf.join(this.configDir,"config.json"),this.loadConfig()}ensureConfigDir(){try{xr.existsSync(this.configDir)||(xr.mkdirSync(this.configDir,{recursive:!0}),He.info(`Created config directory: ${this.configDir}`))}catch(e){He.error("Failed to create config directory:",e)}}validateConfig(e){try{return Xx.parse(e)}catch(r){throw r instanceof M.ZodError?(He.error("Config validation failed:",r.issues),new Error(`Invalid config: ${r.issues.map(i=>i.message).join(", ")}`)):r}}loadConfig(){try{if(this.ensureConfigDir(),xr.existsSync(this.configPath)){let e=xr.readFileSync(this.configPath,"utf8"),r=JSON.parse(e);try{this.config=this.validateConfig(r),He.info("Loaded and validated configuration from disk")}catch(i){He.warn("Config validation failed, using defaults:",i),this.config=mf,this.saveConfig()}}else He.info("No config file found, creating with defaults"),this.saveConfig()}catch(e){He.error("Failed to load config:",e)}}saveConfig(){try{this.ensureConfigDir(),xr.writeFileSync(this.configPath,JSON.stringify(this.config,null,2),"utf8"),He.info("Saved configuration to disk")}catch(e){throw He.error("Failed to save config:",e),new Error(`Failed to save configuration: ${e instanceof Error?e.message:String(e)}`)}}startWatching(){if(!this.watcher)try{this.watcher=oa(this.configPath,{persistent:!0,ignoreInitial:!0,awaitWriteFinish:{stabilityThreshold:500,pollInterval:100}}),this.watcher.on("change",()=>{He.info("Configuration file changed, reloading...");let e=JSON.stringify(this.config);this.loadConfig(),JSON.stringify(this.config)!==e&&this.notifyConfigChange()}),this.watcher.on("error",e=>{He.error("Config watcher error:",e)}),He.info("Started watching configuration file")}catch(e){He.error("Failed to start config watcher:",e)}}stopWatching(){this.watcher&&(this.watcher.close().catch(e=>{He.error("Error closing config watcher:",e)}),this.watcher=void 0,He.info("Stopped watching configuration file"))}notifyConfigChange(){for(let e of this.configChangeCallbacks)try{e(this.config)}catch(r){He.error("Error in config change callback:",r)}}onConfigChange(e){return this.configChangeCallbacks.add(e),()=>{this.configChangeCallbacks.delete(e)}}getConfig(){return this.config}updateConfig(e){this.config=this.validateConfig(e),this.saveConfig(),this.notifyConfigChange()}updateQuickStartCommands(e){let r={...this.config,quickStartCommands:e};this.config=this.validateConfig(r),this.saveConfig(),this.notifyConfigChange()}updateRepositoryBasePath(e){let r={...this.config,repositoryBasePath:e};this.config=this.validateConfig(r),this.saveConfig(),this.notifyConfigChange()}getConfigPath(){return this.configPath}getNotificationPreferences(){return this.config.preferences?.notifications||ff}updateNotificationPreferences(e){try{let i=M.object({enabled:M.boolean(),sessionStart:M.boolean(),sessionExit:M.boolean(),commandCompletion:M.boolean(),commandError:M.boolean(),bell:M.boolean(),claudeTurn:M.boolean(),soundEnabled:M.boolean(),vibrationEnabled:M.boolean()}).partial().parse(e),o={...this.config.preferences?.notifications||ff,...i};this.config.preferences||(this.config.preferences={updateChannel:"stable",showInDock:!1,preventSleepWhenRunning:!0}),this.config.preferences.notifications=o,this.saveConfig(),this.notifyConfigChange()}catch(r){throw r instanceof M.ZodError?(He.error("Invalid notification preferences:",r.issues),new Error(`Invalid notification preferences: ${r.issues.map(i=>i.message).join(", ")}`)):r}}};Fe();var yt=C(require("fs")),gf=C(require("path"));W();var Pe=T("control-dir-watcher"),aa=class{watcher=null;config;recentlyNotifiedSessions=new Map;constructor(e){this.config=e,Pe.debug(`Initialized with control dir: ${e.controlDir}, HQ mode: ${e.isHQMode}`)}start(){yt.existsSync(this.config.controlDir)||(Pe.debug(v.yellow(`Control directory ${this.config.controlDir} does not exist, creating it`)),yt.mkdirSync(this.config.controlDir,{recursive:!0})),this.watcher=yt.watch(this.config.controlDir,{persistent:!0},async(e,r)=>{e==="rename"&&r&&await this.handleFileChange(r)}),Pe.debug(v.green(`Control directory watcher started for ${this.config.controlDir}`))}async handleFileChange(e){let r=gf.join(this.config.controlDir,e),i=gf.join(r,"session.json");try{if(yt.existsSync(r)&&yt.statSync(r).isDirectory()){let s=null;for(let a=0;a<5;a++){let c=100*2**a;if(Pe.debug(`Attempt ${a+1}/5: Waiting ${c}ms for session.json for ${e}`),await new Promise(l=>setTimeout(l,c)),yt.existsSync(i))try{let l=yt.readFileSync(i,"utf8");s=JSON.parse(l),Pe.debug(`Successfully read session.json for ${e} on attempt ${a+1}`);break}catch(l){Pe.debug(`Failed to read/parse session.json on attempt ${a+1}:`,l)}}if(s){let a=s.id||s.session_id||e;if(Pe.debug(v.blue(`Detected new external session: ${a}`)),this.config.ptyManager&&(this.config.ptyManager.getSession(a)||Pe.debug(v.green(`Attaching to external session: ${a}`))),this.config.pushNotificationService){let c=this.recentlyNotifiedSessions.get(a),l=Date.now();if(c&&l-c<5e3){Pe.debug(`Skipping duplicate notification for session ${a} (notified ${l-c}ms ago)`);return}this.recentlyNotifiedSessions.set(a,l);for(let[d,f]of this.recentlyNotifiedSessions.entries())l-f>6e4&&this.recentlyNotifiedSessions.delete(d);let u=s.name||s.command||"Terminal Session";this.config.pushNotificationService?.sendNotification({type:"session-start",title:"Session Started",body:`${u} has started.`,icon:"/apple-touch-icon.png",badge:"/favicon-32.png",tag:`vibetunnel-session-start-${a}`,requireInteraction:!1,data:{type:"session-start",sessionId:a,sessionName:u,timestamp:new Date().toISOString()},actions:[{action:"view-session",title:"View Session"},{action:"dismiss",title:"Dismiss"}]}).catch(d=>Pe.error("Push notify session-start failed:",d))}if(this.config.hqClient&&!ht())try{await this.notifyHQAboutSession(a,"created")}catch(c){Pe.error(`Failed to notify HQ about new session ${a}:`,c)}}else Pe.warn(`Session.json not found for ${e} after 5 retries`)}else if(!yt.existsSync(r)){let t=e;if(Pe.debug(v.yellow(`Detected removed session: ${t}`)),this.config.hqClient&&!ht())try{await this.notifyHQAboutSession(t,"deleted")}catch(o){ht()||Pe.error(`Failed to notify HQ about deleted session ${t}:`,o)}this.config.isHQMode&&this.config.remoteRegistry&&(Pe.debug(`Removing session ${t} from remote registry`),this.config.remoteRegistry.removeSessionFromRemote(t))}}catch(t){Pe.error(`Error handling file change for ${e}:`,t)}}async notifyHQAboutSession(e,r){if(!this.config.hqClient||ht()){Pe.debug(`Skipping HQ notification for ${e} (${r}): shutting down or no HQ client`);return}let i=this.config.hqClient.getHQUrl(),t=this.config.hqClient.getHQAuth(),o=this.config.hqClient.getName();Pe.debug(`Notifying HQ at ${i} about ${r} session ${e} from remote ${o}`);let s=Date.now(),a=await fetch(`${i}/api/remotes/${o}/refresh-sessions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:t},body:JSON.stringify({action:r,sessionId:e})});if(!a.ok){if(a.status===503&&ht()){Pe.debug("Got expected 503 from HQ during shutdown");return}throw new Error(`HQ responded with ${a.status}: ${await a.text()}`)}let c=Date.now()-s;Pe.debug(v.green(`Notified HQ about ${r} session ${e} (${c}ms)`))}stop(){this.watcher?(this.watcher.close(),this.watcher=null,Pe.debug(v.yellow("Control directory watcher stopped"))):Pe.debug("Stop called but watcher was not running")}};Fe();vn();W();var Ot=T("hq-client"),ca=class{hqUrl;remoteId;remoteName;token;hqUsername;hqPassword;remoteUrl;constructor(e,r,i,t,o,s){this.hqUrl=e,this.remoteId=Nt(),this.remoteName=t,this.token=s,this.hqUsername=r,this.hqPassword=i,this.remoteUrl=o,Ot.debug("hq client initialized",{hqUrl:e,remoteName:t,remoteId:this.remoteId,remoteUrl:o})}async register(){Ot.log(`registering with hq at ${this.hqUrl}`);try{let e=await fetch(`${this.hqUrl}/api/remotes/register`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Basic ${Buffer.from(`${this.hqUsername}:${this.hqPassword}`).toString("base64")}`},body:JSON.stringify({id:this.remoteId,name:this.remoteName,url:this.remoteUrl,token:this.token})});if(!e.ok){let r=await e.text();throw Ot.error(`registration failed with status ${e.status}: ${r}`),Ot.debug("registration request details:",{url:`${this.hqUrl}/api/remotes/register`,headers:{"Content-Type":"application/json",Authorization:`Basic ${Buffer.from(`${this.hqUsername}:${this.hqPassword}`).toString("base64")}`},body:{id:this.remoteId,name:this.remoteName,url:this.remoteUrl,token:`${this.token.substring(0,8)}...`}}),new Error(`Registration failed (${e.status}): ${r}`)}Ot.log(v.green(`successfully registered with hq: ${this.remoteName} (${this.remoteId})`)+v.gray(` at ${this.hqUrl}`)),Ot.debug("registration details",{remoteId:this.remoteId,remoteName:this.remoteName,token:`${this.token.substring(0,8)}...`})}catch(e){throw Ot.error("failed to register with hq:",e),e}}async destroy(){Ot.log(v.yellow(`unregistering from hq: ${this.remoteName} (${this.remoteId})`));try{let e=await fetch(`${this.hqUrl}/api/remotes/${this.remoteId}`,{method:"DELETE",headers:{Authorization:`Basic ${Buffer.from(`${this.hqUsername}:${this.hqPassword}`).toString("base64")}`}});e.ok?Ot.debug("successfully unregistered from hq"):Ot.debug(`unregistration returned status ${e.status}`)}catch(e){Ot.debug("error during unregistration:",e)}}getRemoteId(){return this.remoteId}getToken(){return this.token}getHQUrl(){return this.hqUrl}getHQAuth(){return`Basic ${Buffer.from(`${this.hqUsername}:${this.hqPassword}`).toString("base64")}`}getName(){return this.remoteName}};var ry=C(require("node:os"));W();var ek=require("bonjour-service"),Mr=T("mdns-service"),hf=class{bonjour=null;service=null;isAdvertising=!1;async startAdvertising(e,r){if(this.isAdvertising){Mr.warn("mDNS service already advertising");return}try{this.bonjour=new ek;let i=r||ry.default.hostname()||"VibeTunnel Server";if(!this.bonjour)throw new Error("Failed to initialize Bonjour");this.service=this.bonjour.publish({name:i,type:"_vibetunnel._tcp",port:e,txt:{version:"1.0",platform:process.platform}}),this.isAdvertising=!0,Mr.log(`Started mDNS advertisement: ${i} on port ${e}`),this.service&&(this.service.on("up",()=>{Mr.debug("mDNS service is up")}),this.service.on("error",(...t)=>{Mr.warn("mDNS service error:",t[0])}))}catch(i){throw Mr.warn("Failed to start mDNS advertisement:",i),i}}async stopAdvertising(){if(this.isAdvertising)try{this.service&&(await new Promise(e=>{this.service&&typeof this.service.stop=="function"?this.service.stop(()=>{Mr.debug("mDNS service stopped"),e()}):e()}),this.service=null),this.bonjour&&(this.bonjour.destroy(),this.bonjour=null),this.isAdvertising=!1,Mr.log("Stopped mDNS advertisement")}catch(e){Mr.warn("Error stopping mDNS advertisement:",e)}}isActive(){return this.isAdvertising}},la=new hf;var Qn=C(require("fs/promises")),ny=C(require("os")),io=C(require("path"));W();var et=T("push-notification-service"),ua=class{vapidManager;subscriptions=new Map;initialized=!1;subscriptionsFile;constructor(e){this.vapidManager=e;let r=io.join(ny.homedir(),".vibetunnel/notifications");this.subscriptionsFile=io.join(r,"subscriptions.json")}async initialize(){if(!this.initialized)try{await Qn.mkdir(io.dirname(this.subscriptionsFile),{recursive:!0}),await this.loadSubscriptions(),this.initialized=!0,et.log("PushNotificationService initialized")}catch(e){throw et.error("Failed to initialize PushNotificationService:",e),e}}async addSubscription(e,r){let i=this.generateSubscriptionId(e,r),t={id:i,endpoint:e,keys:r,subscribedAt:new Date().toISOString(),isActive:!0};return this.subscriptions.set(i,t),await this.saveSubscriptions(),et.log(`New subscription added: ${i}`),i}async removeSubscription(e){let r=this.subscriptions.delete(e);return r&&(await this.saveSubscriptions(),et.log(`Subscription removed: ${e}`)),r}getSubscriptions(){return Array.from(this.subscriptions.values()).filter(e=>e.isActive)}async sendNotification(e){if(!this.vapidManager.isEnabled())throw new Error("VAPID not properly configured");let r=this.getSubscriptions();if(r.length===0)return{success:!0,sent:0,failed:0,errors:[]};let i=0,t=0,o=[],s=JSON.stringify({title:e.title,body:e.body,icon:e.icon||"/apple-touch-icon.png",badge:e.badge||"/favicon-32.png",tag:e.tag||`vibetunnel-${e.type}`,requireInteraction:e.requireInteraction||!1,actions:e.actions||[],data:{type:e.type,timestamp:new Date().toISOString(),...e.data}});for(let a of r)try{let c={endpoint:a.endpoint,keys:a.keys};await this.vapidManager.sendNotification(c,s),i++,et.debug(`Notification sent to: ${a.id}`)}catch(c){t++;let l=`Failed to send to ${a.id}: ${c}`;if(o.push(l),et.warn(l),this.shouldRemoveSubscription(c)){this.subscriptions.delete(a.id);let d=c;et.log(`Removed expired subscription: ${a.id} (status: ${d.statusCode})`)}else{let d=c;et.debug(`Not removing subscription ${a.id}, error: ${c instanceof Error?c.message:String(c)}, statusCode: ${d.statusCode}`)}}return await this.saveSubscriptions(),et.log(`Notification sent: ${i} successful, ${t} failed`,{type:e.type,title:e.title}),{success:!0,sent:i,failed:t,errors:o}}async sendBellNotification(e){let r={type:"bell",title:e.title,body:e.body,icon:e.icon,badge:e.badge,tag:e.tag,requireInteraction:e.requireInteraction,actions:e.actions,data:e.data};return await this.sendNotification(r)}shouldRemoveSubscription(e){if(!(e instanceof Error))return!1;if(e.statusCode===410||e.message.includes("410")||e.message.includes("Gone"))return!0;let i=e.message.toLowerCase();return i.includes("invalid")||i.includes("expired")||i.includes("no such subscription")||i.includes("unsubscribed")}async cleanupInactiveSubscriptions(){let e=this.subscriptions.size,r=Array.from(this.subscriptions.values()).filter(t=>t.isActive);this.subscriptions.clear();for(let t of r)this.subscriptions.set(t.id,t);let i=e-this.subscriptions.size;return i>0&&(await this.saveSubscriptions(),et.log(`Cleaned up ${i} inactive subscriptions`)),i}async loadSubscriptions(){try{let e=await Qn.readFile(this.subscriptionsFile,"utf8"),r=JSON.parse(e);this.subscriptions.clear();for(let i of r)this.subscriptions.set(i.id,i);et.debug(`Loaded ${r.length} subscriptions`)}catch(e){e.code==="ENOENT"?et.debug("No existing subscriptions file found"):et.error("Failed to load subscriptions:",e)}}async saveSubscriptions(){try{let e=Array.from(this.subscriptions.values());await Qn.writeFile(this.subscriptionsFile,JSON.stringify(e,null,2)),et.debug(`Saved ${e.length} subscriptions`)}catch(e){et.error("Failed to save subscriptions:",e)}}async shutdown(){await this.saveSubscriptions(),et.log("PushNotificationService shutdown")}generateSubscriptionId(e,r){try{let i=new URL(e),t=Buffer.from(r.p256dh).toString("base64").substring(0,8);return`${i.hostname}-${t}`}catch{return Buffer.from(e).toString("base64").substring(0,16)}}};Fe();W();var tt=T("remote-registry"),da=class{remotes=new Map;remotesByName=new Map;sessionToRemote=new Map;healthCheckInterval=null;HEALTH_CHECK_INTERVAL=15e3;HEALTH_CHECK_TIMEOUT=5e3;constructor(){this.startHealthChecker(),tt.debug("remote registry initialized with health check interval",{interval:this.HEALTH_CHECK_INTERVAL,timeout:this.HEALTH_CHECK_TIMEOUT})}register(e){if(this.remotesByName.has(e.name))throw new Error(`Remote with name '${e.name}' is already registered`);let r=new Date,i={...e,registeredAt:r,lastHeartbeat:r,sessionIds:new Set};return this.remotes.set(e.id,i),this.remotesByName.set(e.name,i),tt.log(v.green(`remote registered: ${e.name} (${e.id}) from ${e.url}`)),this.checkRemoteHealth(i),i}unregister(e){let r=this.remotes.get(e);if(r){tt.log(v.yellow(`remote unregistered: ${r.name} (${e})`));for(let i of r.sessionIds)this.sessionToRemote.delete(i);return this.remotesByName.delete(r.name),this.remotes.delete(e)}return!1}getRemote(e){let r=this.remotes.get(e);return r||tt.debug(`remote not found: ${e}`),r}getRemoteByUrl(e){return Array.from(this.remotes.values()).find(r=>r.url===e)}getRemotes(){return Array.from(this.remotes.values())}getRemoteBySessionId(e){let r=this.sessionToRemote.get(e);return r?this.remotes.get(r):void 0}updateRemoteSessions(e,r){let i=this.remotes.get(e);if(!i){tt.debug(`cannot update sessions: remote ${e} not found`);return}let t=i.sessionIds.size;for(let o of i.sessionIds)this.sessionToRemote.delete(o);i.sessionIds=new Set(r);for(let o of r)this.sessionToRemote.set(o,e);tt.debug(`updated sessions for remote ${i.name}`,{oldCount:t,newCount:r.length})}addSessionToRemote(e,r){let i=this.remotes.get(e);if(!i){tt.warn(`cannot add session ${r}: remote ${e} not found`);return}i.sessionIds.add(r),this.sessionToRemote.set(r,e),tt.debug(`session ${r} added to remote ${i.name}`)}removeSessionFromRemote(e){let r=this.sessionToRemote.get(e);if(!r){tt.debug(`session ${e} not mapped to any remote`);return}let i=this.remotes.get(r);i&&(i.sessionIds.delete(e),tt.debug(`session ${e} removed from remote ${i.name}`)),this.sessionToRemote.delete(e)}async checkRemoteHealth(e){if(!ht())try{let r=new AbortController,i=setTimeout(()=>r.abort(),this.HEALTH_CHECK_TIMEOUT),t={Authorization:`Bearer ${e.token}`},o=await fetch(`${e.url}/api/health`,{headers:t,signal:r.signal});if(clearTimeout(i),o.ok)e.lastHeartbeat=new Date,tt.debug(`health check passed for ${e.name}`);else throw new Error(`HTTP ${o.status}`)}catch(r){ht()||(tt.warn(`remote failed health check: ${e.name} (${e.id})`,r),this.unregister(e.id))}}startHealthChecker(){tt.debug("starting health checker"),this.healthCheckInterval=setInterval(()=>{if(ht())return;let e=Array.from(this.remotes.values()).map(r=>this.checkRemoteHealth(r));Promise.all(e).catch(r=>{tt.error("error in health checks:",r)})},this.HEALTH_CHECK_INTERVAL)}destroy(){tt.log(v.yellow("destroying remote registry")),this.healthCheckInterval&&(clearInterval(this.healthCheckInterval),tt.debug("health checker stopped"))}};var iy=require("events");W();var oo=T("session-monitor"),tk=3e3,rk=2e3,fa=class extends iy.EventEmitter{constructor(r){super();this.ptyManager=r;this.setupEventListeners(),oo.info("SessionMonitor initialized")}sessions=new Map;claudeIdleNotified=new Set;lastActivityState=new Map;commandThresholdMs=tk;claudeIdleTimers=new Map;setupEventListeners(){this.ptyManager.on("sessionStarted",(r,i)=>{this.handleSessionStarted(r,i)}),this.ptyManager.on("sessionExited",(r,i,t)=>{this.handleSessionExited(r,i,t)}),this.ptyManager.on("commandFinished",r=>{this.handleCommandFinished(r)}),this.ptyManager.on("claudeTurn",(r,i)=>{this.handleClaudeTurn(r,i)})}updateSessionActivity(r,i,t){let o=this.sessions.get(r);if(!o)return;let s=o.activityStatus?.isActive??!1;o.activityStatus={isActive:i,lastActivity:i?new Date:o.activityStatus?.lastActivity,specificStatus:t?{app:t,status:i?"active":"idle"}:o.activityStatus?.specificStatus},this.isClaudeSession(o)&&this.trackClaudeActivity(r,o,s,i),this.lastActivityState.set(r,i)}trackPtyOutput(r,i){let t=this.sessions.get(r);t&&(this.updateSessionActivity(r,!0),i.includes("\x07")&&this.emitNotificationEvent({type:"bell",sessionId:r,sessionName:t.name,timestamp:new Date().toISOString()}),this.isClaudeSession(t)&&this.detectClaudePatterns(r,t,i))}emitNotificationEvent(r){this.emit("notification",{type:this.mapActionToServerEventType(r.type),sessionId:r.sessionId,sessionName:r.sessionName,timestamp:r.timestamp,exitCode:r.exitCode,command:r.command,duration:r.duration,message:r.type==="claude-turn"?"Claude has finished responding":void 0})}mapActionToServerEventType(r){return{"session-start":"session-start","session-exit":"session-exit","command-finished":"command-finished","command-error":"command-error",bell:"bell","claude-turn":"claude-turn"}[r]}updateCommand(r,i){let t=this.sessions.get(r);t&&(t.lastCommand=i,t.commandStartTime=new Date,this.updateSessionActivity(r,!0))}handleCommandCompletion(r,i){let t=this.sessions.get(r);if(!t||!t.commandStartTime||!t.lastCommand)return;let o=Date.now()-t.commandStartTime.getTime();if(t.lastExitCode=i,o>=this.commandThresholdMs){let s={sessionId:r,sessionName:t.name,command:t.lastCommand,duration:o,exitCode:i};i===0?this.emitNotificationEvent({type:"command-finished",sessionId:r,sessionName:t.name,command:t.lastCommand,duration:o,exitCode:i,timestamp:new Date().toISOString()}):this.emitNotificationEvent({type:"command-error",sessionId:r,sessionName:t.name,command:t.lastCommand,duration:o,exitCode:i,timestamp:new Date().toISOString()})}t.commandStartTime=void 0,t.lastCommand=void 0}handleSessionStarted(r,i){let t=this.ptyManager.getSession(r);if(!t)return;let o={id:r,name:i,command:t.command||[],workingDir:t.workingDir||process.cwd(),status:"running",isRunning:!0,pid:t.pid,isClaudeSession:this.detectClaudeCommand(t.command||[])};this.sessions.set(r,o),oo.info(`Session started: ${r} - ${i}`),this.emitNotificationEvent({type:"session-start",sessionId:r,sessionName:i,timestamp:new Date().toISOString()})}handleSessionExited(r,i,t){let o=this.sessions.get(r);if(o){if(o.status="exited",o.isRunning=!1,oo.info(`Session exited: ${r} - ${i} (exit code: ${t})`),this.claudeIdleNotified.delete(r),this.lastActivityState.delete(r),this.claudeIdleTimers.has(r)){let s=this.claudeIdleTimers.get(r);s&&clearTimeout(s),this.claudeIdleTimers.delete(r)}this.emitNotificationEvent({type:"session-exit",sessionId:r,sessionName:i,exitCode:t,timestamp:new Date().toISOString()}),setTimeout(()=>{this.sessions.delete(r)},5e3)}}handleCommandFinished(r){this.handleCommandCompletion(r.sessionId,r.exitCode)}handleClaudeTurn(r,i){this.sessions.get(r)&&this.updateSessionActivity(r,!1,"claude")}isClaudeSession(r){return r.isClaudeSession??!1}detectClaudeCommand(r){return r.join(" ").toLowerCase().includes("claude")}trackClaudeActivity(r,i,t,o){if(this.claudeIdleTimers.has(r)){let s=this.claudeIdleTimers.get(r);s&&clearTimeout(s),this.claudeIdleTimers.delete(r)}if(t&&!o&&!this.claudeIdleNotified.has(r)){let s=setTimeout(()=>{let a=this.sessions.get(r);a?.activityStatus&&!a.activityStatus.isActive&&(oo.info(`\u{1F514} Claude turn detected for session: ${r}`),this.emitNotificationEvent({type:"claude-turn",sessionId:r,sessionName:i.name,timestamp:new Date().toISOString(),activityStatus:{isActive:!1,app:"claude"}}),this.claudeIdleNotified.add(r)),this.claudeIdleTimers.delete(r)},rk);this.claudeIdleTimers.set(r,s)}!t&&o&&this.claudeIdleNotified.delete(r)}detectClaudePatterns(r,i,t){let o=["Thinking...","Analyzing","Working on","Let me"],s=["I've completed","I've finished","Done!","Here's","The task is complete"];for(let a of o)if(t.includes(a)){this.updateSessionActivity(r,!0,"claude");return}for(let a of s)if(t.includes(a)){setTimeout(()=>{this.updateSessionActivity(r,!1,"claude")},1e3);return}}getActiveSessions(){return Array.from(this.sessions.values()).filter(r=>r.isRunning)}getSession(r){return this.sessions.get(r)}async initialize(){let r=await this.ptyManager.listSessions();for(let i of r)if(i.status==="running"){let t={id:i.id,name:i.name,command:i.command,workingDir:i.workingDir,status:"running",isRunning:!0,pid:i.pid,isClaudeSession:this.detectClaudeCommand(i.command)};this.sessions.set(i.id,t)}oo.info(`Initialized with ${this.sessions.size} existing sessions`)}};Fe();var Te=C(require("fs"));W();var oy=require("fs");W();var bt=T("git-watcher"),vf=class{watchers=new Map;startWatching(e,r,i){if(this.watchers.has(e)){bt.debug(`Git watcher already exists for session ${e}`);return}bt.debug(`Starting git watcher for session ${e} at ${i}`);let t=oa(i,{ignoreInitial:!0,ignored:["**/node_modules/**","**/.git/objects/**","**/.git/logs/**","**/dist/**","**/build/**","**/.next/**","**/coverage/**","**/.turbo/**","**/*.log","**/.DS_Store"],depth:0,followSymlinks:!1,usePolling:!1,awaitWriteFinish:!1}),o=[`${i}/.git/index`,`${i}/.git/HEAD`,`${i}/.git/refs/heads`].filter(c=>{try{return(0,oy.accessSync)(c),!0}catch{return!1}});o.length>0&&t.add(o),bt.debug(`Git watcher started for session ${e} with shallow directory watching`);let s={watcher:t,sessionId:e,workingDir:r,gitRepoPath:i,clients:new Set},a=(c,l)=>{(c.includes(".git")||l!=="change")&&bt.debug(`Git watcher event for session ${e}: ${l} ${c}`),s.debounceTimer&&clearTimeout(s.debounceTimer),s.debounceTimer=setTimeout(()=>{this.checkAndBroadcastStatus(s)},300)};t.on("all",(c,l)=>a(l,c)),t.on("error",c=>{bt.error(`Git watcher error for session ${e}:`,c)}),this.watchers.set(e,s),this.checkAndBroadcastStatus(s),s.periodicCheckTimer=setInterval(()=>{this.checkAndBroadcastStatus(s)},2e3)}addClient(e,r){let i=this.watchers.get(e);if(!i){bt.debug(`No git watcher found for session ${e}`);return}i.clients.add(r),bt.debug(`Added SSE client to git watcher for session ${e} (${i.clients.size} total)`),i.lastStatus&&this.sendStatusUpdate(r,e,i.lastStatus)}removeClient(e,r){let i=this.watchers.get(e);i&&(i.clients.delete(r),bt.debug(`Removed SSE client from git watcher for session ${e} (${i.clients.size} remaining)`),i.clients.size===0&&this.stopWatching(e))}stopWatching(e){let r=this.watchers.get(e);r&&(bt.debug(`Stopping git watcher for session ${e}`),r.debounceTimer&&clearTimeout(r.debounceTimer),r.periodicCheckTimer&&clearInterval(r.periodicCheckTimer),r.watcher.close(),this.watchers.delete(e))}async checkAndBroadcastStatus(e){try{let r=await Zs(e.workingDir);this.hasStatusChanged(e.lastStatus,r)&&(bt.debug(`Git status changed for session ${e.sessionId}:`,r),e.lastStatus=r,this.broadcastStatusUpdate(e,r))}catch(r){bt.error(`Failed to get git status for session ${e.sessionId}:`,r)}}hasStatusChanged(e,r){return e?e.modified!==r.modified||e.added!==r.added||e.staged!==r.staged||e.deleted!==r.deleted||e.ahead!==r.ahead||e.behind!==r.behind:!0}broadcastStatusUpdate(e,r){for(let i of e.clients)this.sendStatusUpdate(i,e.sessionId,r)}sendStatusUpdate(e,r,i){try{let t={type:"git-status-update",sessionId:r,gitModifiedCount:i.modified,gitAddedCount:i.added,gitDeletedCount:i.deleted,gitAheadCount:i.ahead,gitBehindCount:i.behind};e.write(`event: session-update
data: ${JSON.stringify(t)}

`)}catch(t){bt.error("Failed to send git status update to client:",t)}}cleanup(){bt.debug("Cleaning up all git watchers");for(let[e]of this.watchers)this.stopWatching(e)}},un=new vf;var oe=T("stream-watcher"),nk=4096;function yf(n){return Array.isArray(n)&&n.length===3&&n[1]==="o"&&typeof n[0]=="number"}function ma(n){return Array.isArray(n)&&n.length===3&&n[1]==="r"&&typeof n[0]=="number"}function bf(n){return Array.isArray(n)&&n[0]==="exit"}var pa=class{activeWatchers=new Map;sessionManager;constructor(e){this.sessionManager=e,process.on("beforeExit",()=>{this.cleanup()}),oe.debug("stream watcher initialized")}processClearSequence(e,r,i,t,o){let s=Xf(e[2]);if(!s)return null;let a=tm(i,o,s.position);return go(s.sequence,a,"(retroactive scan)"),oe.debug(`found at event index ${r}, current resize: ${t?t[2]:"none"}`),{lastClearIndex:r,lastClearOffset:a,lastResizeBeforeClear:t}}parseAsciinemaLine(e){if(!e.trim())return null;try{let r=JSON.parse(e);if(r.version&&r.width&&r.height)return r;if(Array.isArray(r)){if(r[0]==="exit")return r;if(r.length>=3&&typeof r[0]=="number")return r}return null}catch(r){return oe.debug(`skipping invalid JSON line: ${r}`),null}}sendEventToClient(e,r,i=!1){try{let t=r;i&&Array.isArray(r)&&r.length>=3&&typeof r[0]=="number"&&(t=[0,r[1],r[2]]),e.response.write(`data: ${JSON.stringify(t)}

`),Array.isArray(r)&&bf(r)&&(oe.log(v.yellow(`session ${e.response.locals?.sessionId||"unknown"} already ended, closing stream`)),e.response.end())}catch(t){oe.debug(`client write failed (likely disconnected): ${t instanceof Error?t.message:String(t)}`)}}addClient(e,r,i){oe.debug(`adding client to session ${e}`);let t=Date.now()/1e3,o={response:i,startTime:t},s=this.activeWatchers.get(e);if(s)this.sendExistingContent(e,r,o),un.addClient(e,i);else{if(oe.log(v.green(`creating new stream watcher for session ${e}`)),s={clients:new Set,lastOffset:0,lastSize:0,lastMtime:0,lineBuffer:""},this.activeWatchers.set(e,s),this.sendExistingContent(e,r,o),Te.existsSync(r)){let a=Te.statSync(r);s.lastOffset=a.size,s.lastSize=a.size,s.lastMtime=a.mtimeMs,oe.debug(`initial file size: ${a.size} bytes`)}else oe.debug(`stream file does not exist yet: ${r}`);this.startWatching(e,r,s),this.startGitWatching(e,i)}s.clients.add(o),oe.log(v.blue(`client connected to stream ${e} (${s.clients.size} total)`))}removeClient(e,r){let i=this.activeWatchers.get(e);if(!i){oe.debug(`no watcher found for session ${e}`);return}let t;for(let o of i.clients)if(o.response===r){t=o;break}t&&(i.clients.delete(t),oe.log(v.yellow(`client disconnected from stream ${e} (${i.clients.size} remaining)`)),un.removeClient(e,r),i.clients.size===0&&(oe.log(v.yellow(`stopping watcher for session ${e} (no clients)`)),i.watcher&&i.watcher.close(),this.activeWatchers.delete(e),un.stopWatching(e)))}sendExistingContent(e,r,i){try{let t=this.sessionManager.loadSessionInfo(e),o=t?.lastClearOffset??0;if(Te.existsSync(r)){let h=Te.statSync(r);o=Math.min(o,h.size)}let s=null,a=null;try{a=Te.openSync(r,"r");let h=Buffer.alloc(nk),S="",y=0,k=Te.readSync(a,h,0,h.length,y);for(;!S.includes(`
`)&&k>0;)S+=h.toString("utf8",0,k),y+=k,S.includes(`
`)||(k=Te.readSync(a,h,0,h.length,y));let b=S.indexOf(`
`);b!==-1&&(s=JSON.parse(S.slice(0,b)))}catch(h){oe.debug(`failed to read asciinema header for session ${e}: ${h}`)}finally{if(a!==null)try{Te.closeSync(a)}catch(h){oe.debug(`failed to close file descriptor: ${h}`)}}let c=Te.createReadStream(r,{encoding:"utf8",start:o}),l="",u=[],d=-1,f=null,p=null,m=o,g=o;c.on("data",h=>{l+=h.toString();let S=l.indexOf(`
`);for(;S!==-1;){let y=l.slice(0,S);if(l=l.slice(S+1),m+=Buffer.byteLength(y,"utf8")+1,y.trim())try{let k=JSON.parse(y);if(k.version&&k.width&&k.height)s=k;else if(Array.isArray(k)){if(k[0]==="exit")u.push(k);else if(k.length>=3&&typeof k[0]=="number"){let b=k;if(ma(b)&&(p=b),yf(b)&&ja(b[2])){let R=this.processClearSequence(b,u.length,m,p,y);R&&(d=R.lastClearIndex,g=R.lastClearOffset,f=R.lastResizeBeforeClear)}u.push(b)}}}catch(k){oe.debug(`skipping invalid JSON line during analysis: ${k}`)}S=l.indexOf(`
`)}}),c.on("end",()=>{if(l.trim())try{let y=JSON.parse(l);if(m+=Buffer.byteLength(l,"utf8"),Array.isArray(y)){if(y[0]==="exit")u.push(y);else if(y.length>=3&&typeof y[0]=="number"){let k=y;if(ma(k)&&(p=k),yf(k)&&ja(k[2])){let b=this.processClearSequence(k,u.length,m,p,l);b&&(d=b.lastClearIndex,g=b.lastClearOffset,f=b.lastResizeBeforeClear)}u.push(k)}}}catch(y){oe.debug(`skipping invalid JSON in line buffer during analysis: ${y}`)}let h=0;if(d>=0&&(h=d+1,oe.log(v.green(`pruning stream: skipping ${d+1} events before last clear at offset ${g}`)),t&&(t.lastClearOffset=g,this.sessionManager.saveSessionInfo(e,t))),s){let y={...s};if(d>=0&&f){let k=f[2].split("x");y.width=Number.parseInt(k[0],10),y.height=Number.parseInt(k[1],10)}i.response.write(`data: ${JSON.stringify(y)}

`)}let S=!1;for(let y=h;y<u.length;y++){let k=u[y];if(bf(k))S=!0,i.response.write(`data: ${JSON.stringify(k)}

`);else if(yf(k)||ma(k)){let b=[0,k[1],k[2]];i.response.write(`data: ${JSON.stringify(b)}

`)}}S&&(oe.log(v.yellow(`session ${i.response.locals?.sessionId||"unknown"} already ended, closing stream`)),i.response.end())}),c.on("error",h=>{oe.error("failed to analyze stream for pruning:",h)})}catch(t){oe.error("failed to create read stream:",t)}}startWatching(e,r,i){oe.log(v.green(`started watching stream file for session ${e}`)),i.watcher=Te.watch(r,{persistent:!0},t=>{if(t==="change")try{let o=Te.statSync(r);if(o.size>i.lastSize||o.mtimeMs>i.lastMtime){let s=o.size-i.lastSize;if(s>0&&oe.debug(`file grew by ${s} bytes`),i.lastSize=o.size,i.lastMtime=o.mtimeMs,o.size>i.lastOffset){let a=Te.openSync(r,"r"),c=Buffer.alloc(o.size-i.lastOffset);Te.readSync(a,c,0,c.length,i.lastOffset),Te.closeSync(a),i.lastOffset=o.size;let l=c.toString("utf8");i.lineBuffer+=l;let u=i.lineBuffer.split(`
`);i.lineBuffer=u.pop()||"";for(let d of u)d.trim()&&this.broadcastLine(e,d,i)}}}catch(o){oe.error("failed to read file changes:",o)}}),i.watcher.on("error",t=>{oe.error(`file watcher error for session ${e}:`,t)})}broadcastLine(e,r,i){let t=this.parseAsciinemaLine(r);if(!t){oe.debug(`broadcasting raw output line: ${r.substring(0,50)}...`);let s=Date.now()/1e3;for(let a of i.clients){let c=[s-a.startTime,"o",r];this.sendEventToClient(a,c)}return}if(!Array.isArray(t))return;if(bf(t)){oe.log(v.yellow(`session ${e} ended with exit code ${t[1]}`));for(let s of i.clients)this.sendEventToClient(s,t);return}ma(t)&&oe.debug(`Broadcasting resize ${t[2]} to ${i.clients.size} clients`);let o=Date.now()/1e3;for(let s of i.clients){let a=[o-s.startTime,t[1],t[2]];try{s.response.write(`data: ${JSON.stringify(a)}

`),s.response.flush&&s.response.flush()}catch(c){oe.debug(`client write failed (likely disconnected): ${c instanceof Error?c.message:String(c)}`)}}}async startGitWatching(e,r){try{let i=this.sessionManager.loadSessionInfo(e);i?.gitRepoPath&&i.workingDir&&(oe.debug(`Starting git watcher for session ${e} at ${i.gitRepoPath}`),await un.startWatching(e,i.workingDir,i.gitRepoPath),un.addClient(e,r))}catch(i){oe.error(`Failed to start git watching for session ${e}:`,i)}}cleanup(){let e=this.activeWatchers.size;if(e>0){oe.log(v.yellow(`cleaning up ${e} active watchers`));for(let[r,i]of this.activeWatchers)i.watcher&&i.watcher.close(),oe.debug(`closed watcher for session ${r}`);this.activeWatchers.clear()}un.cleanup()}};var sy=require("@xterm/headless");Fe();var ut=C(require("fs")),ay=C(require("path"));var so=class{errorCache=new Map;options;constructor(e={}){this.options={minLogInterval:e.minLogInterval??6e4,summaryInterval:e.summaryInterval??100,maxCacheSize:e.maxCacheSize??100,cacheEntryTTL:e.cacheEntryTTL??3e5,maxKeyLength:e.maxKeyLength??100,keyExtractor:e.keyExtractor??this.defaultKeyExtractor}}shouldLog(e,r){let t=this.options.keyExtractor(e,r).substring(0,this.options.maxKeyLength),o=this.errorCache.get(t),s=Date.now();return o?(o.count++,s-o.lastLogged>=this.options.minLogInterval||o.count%this.options.summaryInterval===0?(o.lastLogged=s,!0):!1):(this.errorCache.set(t,{count:1,lastLogged:s,firstSeen:s}),this.cleanupCacheIfNeeded(),!0)}getErrorStats(e,r){let t=this.options.keyExtractor(e,r).substring(0,this.options.maxKeyLength);return this.errorCache.get(t)}clear(){this.errorCache.clear()}get size(){return this.errorCache.size}defaultKeyExtractor(e,r){let i=e instanceof Error?e.message:String(e),t=r?`:${r.substring(0,30)}`:"";return`${i}${t}`}cleanupCacheIfNeeded(){if(this.errorCache.size<=this.options.maxCacheSize)return;let r=Date.now()-this.options.cacheEntryTTL,i=[];for(let[t,o]of this.errorCache.entries())o.lastLogged<r&&i.push(t);for(let t of i)this.errorCache.delete(t);if(this.errorCache.size>this.options.maxCacheSize){let o=Array.from(this.errorCache.entries()).sort((s,a)=>s[1].lastLogged-a[1].lastLogged).slice(0,this.errorCache.size-this.options.maxCacheSize);for(let[s]of o)this.errorCache.delete(s)}}};function wf(n,e,r){let i=n instanceof Error?n.message:String(n),t=r?` (context: ${r})`:"",o=Date.now()-e.firstSeen,s=ik(o);return`Repeated error: ${e.count} occurrences over ${s}${t} - ${i}`}function ik(n){return n<1e3?`${n}ms`:n<6e4?`${Math.round(n/1e3)}s`:n<36e5?`${Math.round(n/6e4)}m`:`${Math.round(n/36e5)}h`}var mN=new so;W();var se=T("terminal-manager");function qe(n,e=50){return n.length<=e?n:`${n.substring(0,e)}...(${n.length} chars total)`}var Yn={highWatermark:.8,lowWatermark:.5,checkInterval:100,maxPendingLines:1e4,maxPauseTime:300*1e3,bufferCheckInterval:100},ga=class{terminals=new Map;controlDir;bufferListeners=new Map;changeTimers=new Map;writeQueues=new Map;writeTimers=new Map;errorDeduplicator=new so({keyExtractor:(e,r)=>{let i=e instanceof Error?e.message:String(e);return`${r}:${i}`}});originalConsoleWarn;flowControlTimer;constructor(e){this.controlDir=e,this.originalConsoleWarn=console.warn,console.warn=(...r)=>{let i=r[0];typeof i=="string"&&(i.includes("xterm.js parsing error")||i.includes("Unable to process character")||i.includes("Cannot read properties of undefined"))||this.originalConsoleWarn.apply(console,r)},this.startFlowControlTimer()}async getTerminal(e){let r=this.terminals.get(e);if(!r){let i=new sy.Terminal({cols:80,rows:24,scrollback:5e3,allowProposedApi:!0,convertEol:!0});r={terminal:i,lastUpdate:Date.now()},this.terminals.set(e,r),se.log(v.green(`Terminal created for session ${e} (${i.cols}x${i.rows})`)),await this.watchStreamFile(e)}return r.lastUpdate=Date.now(),r.terminal}async watchStreamFile(e){let r=this.terminals.get(e);if(!r)return;let i=ay.join(this.controlDir,e,"stdout"),t=r.lastFileOffset||0,o=r.lineBuffer||"";if(!ut.existsSync(i)){se.error(`Stream file does not exist for session ${qe(e)}: ${qe(i,100)}`);return}try{let s=ut.readFileSync(i,"utf8");t=Buffer.byteLength(s,"utf8");let a=s.split(`
`);for(let c of a)c.trim()&&this.handleStreamLine(e,r,c);r.watcher=ut.watch(i,c=>{if(c==="change")try{let l=ut.statSync(i);if(l.size>t){let u=ut.openSync(i,"r"),d=Buffer.alloc(l.size-t);ut.readSync(u,d,0,d.length,t),ut.closeSync(u),t=l.size,r.lastFileOffset=t;let f=d.toString("utf8");o+=f;let p=o.split(`
`);o=p.pop()||"",r.lineBuffer=o;for(let m of p)m.trim()&&this.handleStreamLine(e,r,m)}}catch(l){se.error(`Error reading stream file for session ${qe(e)}:`,l)}}),se.log(v.green(`Watching stream file for session ${qe(e)}`))}catch(s){throw se.error(`Failed to watch stream file for session ${qe(e)}:`,s),s}}startFlowControlTimer(){let e=0,r=[];this.flowControlTimer=setInterval(()=>{if(e===0){r.length=0;for(let[i,t]of this.terminals)t.isPaused&&r.push(i)}if(r.length>0){let i=r[e%r.length],t=this.terminals.get(i);t?.isPaused&&(t.pausedAt&&Date.now()-t.pausedAt>Yn.maxPauseTime?(se.warn(v.red(`Session ${i} has been paused for too long. Dropping ${t.pendingLines?.length||0} pending lines.`)),t.isPaused=!1,t.pendingLines=[],t.pausedAt=void 0,this.resumeFileWatcher(i).catch(o=>{se.error(`Failed to resume file watcher for session ${i} after timeout:`,o)})):this.checkBufferPressure(i)),e=(e+1)%Math.max(r.length,1)}},Yn.checkInterval)}checkBufferPressure(e){let r=this.terminals.get(e);if(!r)return!1;let i=r.terminal,t=i.buffer.active,o=i.options.scrollback||1e4,s=t.length,a=s/o,c=r.isPaused||!1;if(!c&&a>Yn.highWatermark)return r.isPaused=!0,r.pendingLines=[],r.pausedAt=Date.now(),r.watcher&&(r.watcher.close(),r.watcher=void 0),se.warn(v.yellow(`Buffer pressure high for session ${e}: ${Math.round(a*100)}% (${s}/${o} lines). Pausing file watcher.`)),!0;if(c&&a<Yn.lowWatermark){if(r.pendingLines&&r.pendingLines.length>0&&!r.isProcessingPending){r.isProcessingPending=!0;let l=r.pendingLines.length;se.log(v.green(`Buffer pressure normalized for session ${e}: ${Math.round(a*100)}% (${s}/${o} lines). Processing ${l} pending lines.`)),setImmediate(()=>{let u=r.pendingLines||[];r.pendingLines=[],r.isPaused=!1,r.pausedAt=void 0,r.isProcessingPending=!1;for(let d of u)this.processStreamLine(e,r,d);this.resumeFileWatcher(e).catch(d=>{se.error(`Failed to resume file watcher for session ${qe(e)}:`,d)})})}else(!r.pendingLines||r.pendingLines.length===0)&&(r.isPaused=!1,r.pausedAt=void 0,this.resumeFileWatcher(e).catch(l=>{se.error(`Failed to resume file watcher for session ${qe(e)}:`,l)}),se.log(v.green(`Buffer pressure normalized for session ${e}: ${Math.round(a*100)}% (${s}/${o} lines). Resuming file watcher.`)));return!1}return c}handleStreamLine(e,r,i){r.linesProcessedSinceCheck===void 0&&(r.linesProcessedSinceCheck=0);let t=r.isPaused||!1;if(!t&&r.linesProcessedSinceCheck>=Yn.bufferCheckInterval&&(t=this.checkBufferPressure(e),r.linesProcessedSinceCheck=0),t){r.pendingLines||(r.pendingLines=[]),r.pendingLines.length<Yn.maxPendingLines?r.pendingLines.push(i):se.warn(v.red(`Pending lines limit reached for session ${e}. Dropping new data to prevent memory overflow.`));return}r.linesProcessedSinceCheck++,this.processStreamLine(e,r,i)}processStreamLine(e,r,i){try{let t=JSON.parse(i);if(t.version&&t.width&&t.height){r.terminal.resize(t.width,t.height),this.notifyBufferChange(e);return}if(Array.isArray(t)&&t.length>=3){let[o,s,a]=t;if(o==="exit"){se.log(v.yellow(`Session ${qe(e)} exited with code ${t[1]}`)),r.watcher&&r.watcher.close();return}if(s==="o")this.queueTerminalWrite(e,r,a),this.scheduleBufferChangeNotification(e);else if(s==="r"){let c=a.match(/^(\d+)x(\d+)$/);if(c){let l=Number.parseInt(c[1],10),u=Number.parseInt(c[2],10);r.terminal.resize(l,u),this.notifyBufferChange(e)}}}}catch(t){let o=`${e}:parse-stream-line`;if(this.errorDeduplicator.shouldLog(t,o)){let s=this.errorDeduplicator.getErrorStats(t,o);if(s&&s.count>1)se.warn(wf(t,s,`session ${qe(e)}`));else{let a=i.length>100?`${i.substring(0,100)}...`:i;se.error(`Failed to parse stream line for session ${qe(e)}: ${a}`),t instanceof Error&&t.stack&&se.debug(`Parse error details: ${t.message}`)}}}}async getBufferStats(e){let r=await this.getTerminal(e),i=r.buffer.active,t=this.terminals.get(e);se.debug(`Getting buffer stats for session ${qe(e)}: ${i.length} total rows`);let o=r.options.scrollback||1e4,s=i.length/o;return{totalRows:i.length,cols:r.cols,rows:r.rows,viewportY:i.viewportY,cursorX:i.cursorX,cursorY:i.cursorY,scrollback:r.options.scrollback||0,isPaused:t?.isPaused||!1,pendingLines:t?.pendingLines?.length||0,bufferUtilization:Math.round(s*100),maxBufferLines:o}}async getBufferSnapshot(e){let r=Date.now(),i=await this.getTerminal(e),t=i.buffer.active,o=Math.max(0,t.length-i.rows),a=t.length-o,c=t.cursorX,l=t.cursorY+t.viewportY-o,u=[],d=t.getNullCell();for(let g=0;g<a;g++){let h=t.getLine(o+g),S=[];if(h){for(let k=0;k<i.cols;k++){h.getCell(k,d);let b=d.getChars()||" ",R=d.getWidth();if(R===0)continue;let z=0;d.isBold()&&(z|=1),d.isItalic()&&(z|=2),d.isUnderline()&&(z|=4),d.isDim()&&(z|=8),d.isInverse()&&(z|=16),d.isInvisible()&&(z|=32),d.isStrikethrough()&&(z|=64);let L={char:b,width:R},F=d.getFgColor(),X=d.getBgColor();F!==void 0&&F!==-1&&(L.fg=F),X!==void 0&&X!==-1&&(L.bg=X),z!==0&&(L.attributes=z),S.push(L)}let y=S.length-1;for(;y>=0;){let k=S[y];if(k.char!==" "||k.fg!==void 0||k.bg!==void 0||k.attributes!==void 0)break;y--}y<S.length-1&&S.splice(Math.max(1,y+1))}else S.push({char:" ",width:1});u.push(S)}let f=u.length-1;for(;f>=0&&!u[f].some(S=>S.char!==" "||S.fg!==void 0||S.bg!==void 0||S.attributes!==void 0);)f--;let p=u.slice(0,Math.max(1,f+1)),m=Date.now()-r;return m>10&&se.debug(`Buffer snapshot for session ${e} took ${m}ms (${p.length} rows)`),{cols:i.cols,rows:p.length,viewportY:o,cursorX:c,cursorY:l,cells:p}}cleanupTerminal(e){let r=this.terminals.get(e);if(r){r.watcher&&(r.watcher.close(),r.watcher=void 0);try{r.terminal.dispose()}catch(i){se.warn(`Error disposing terminal for session ${e}:`,i)}this.terminals.delete(e),this.bufferListeners.delete(e),se.debug(`Terminal cleaned up for session ${e}`)}}cleanupInactiveTerminals(e=1440*60*1e3){let r=Date.now(),i=[];for(let[t,o]of this.terminals.entries())r-o.lastUpdate>e&&i.push(t);for(let t of i)this.cleanupTerminal(t);return i.length>0&&se.log(v.yellow(`Cleaned up ${i.length} inactive terminals`)),i.length}encodeSnapshot(e){let r=Date.now(),{cols:i,rows:t,viewportY:o,cursorX:s,cursorY:a,cells:c}=e,l=32;for(let m=0;m<c.length;m++){let g=c[m];if(g.length===0||g.length===1&&g[0].char===" "&&!g[0].fg&&!g[0].bg&&!g[0].attributes)l+=2;else{l+=3;for(let h of g)l+=this.calculateCellSize(h)}}let u=Buffer.allocUnsafe(l),d=0;u.writeUInt16LE(22100,d),d+=2,u.writeUInt8(1,d),d+=1,u.writeUInt8(0,d),d+=1,u.writeUInt32LE(i,d),d+=4,u.writeUInt32LE(t,d),d+=4,u.writeInt32LE(o,d),d+=4,u.writeInt32LE(s,d),d+=4,u.writeInt32LE(a,d),d+=4,u.writeUInt32LE(0,d),d+=4;for(let m=0;m<c.length;m++){let g=c[m];if(g.length===0||g.length===1&&g[0].char===" "&&!g[0].fg&&!g[0].bg&&!g[0].attributes)u.writeUInt8(254,d++),u.writeUInt8(1,d++);else{u.writeUInt8(253,d++),u.writeUInt16LE(g.length,d),d+=2;for(let h of g)d=this.encodeCell(u,d,h)}}let f=u.subarray(0,d),p=Date.now()-r;return p>5&&se.debug(`Encoded snapshot: ${f.length} bytes in ${p}ms (${t} rows)`),f}calculateCellSize(e){let r=e.char===" ",i=e.attributes&&e.attributes!==0,t=e.fg!==void 0,o=e.bg!==void 0,s=e.char.charCodeAt(0)<=127;if(r&&!i&&!t&&!o)return 1;let a=1;if(s)a+=1;else{let c=Buffer.byteLength(e.char,"utf8");a+=1+c}return(i||t||o)&&(a+=1,t&&e.fg!==void 0&&(a+=e.fg>255?3:1),o&&e.bg!==void 0&&(a+=e.bg>255?3:1)),a}encodeCell(e,r,i){let t=i.char===" ",o=i.attributes&&i.attributes!==0,s=i.fg!==void 0,a=i.bg!==void 0,c=i.char.charCodeAt(0)<=127;if(t&&!o&&!s&&!a)return e.writeUInt8(0,r++),r;let l=0;if((o||s||a)&&(l|=128),c?t||(l|=1):(l|=64,l|=2),s&&i.fg!==void 0&&(l|=32,i.fg>255&&(l|=8)),a&&i.bg!==void 0&&(l|=16,i.bg>255&&(l|=4)),e.writeUInt8(l,r++),c)t||e.writeUInt8(i.char.charCodeAt(0),r++);else{let u=Buffer.from(i.char,"utf8");e.writeUInt8(u.length,r++),u.copy(e,r),r+=u.length}return l&128&&(o&&i.attributes!==void 0?e.writeUInt8(i.attributes,r++):(s||a)&&e.writeUInt8(0,r++),s&&i.fg!==void 0&&(i.fg>255?(e.writeUInt8(i.fg>>16&255,r++),e.writeUInt8(i.fg>>8&255,r++),e.writeUInt8(i.fg&255,r++)):e.writeUInt8(i.fg,r++)),a&&i.bg!==void 0&&(i.bg>255?(e.writeUInt8(i.bg>>16&255,r++),e.writeUInt8(i.bg>>8&255,r++),e.writeUInt8(i.bg&255,r++)):e.writeUInt8(i.bg,r++))),r}closeTerminal(e){let r=this.terminals.get(e);if(r){r.watcher&&r.watcher.close(),r.terminal.dispose(),this.terminals.delete(e);let i=this.writeTimers.get(e);i&&(clearTimeout(i),this.writeTimers.delete(e)),this.writeQueues.delete(e),se.log(v.yellow(`Terminal closed for session ${qe(e)}`))}}cleanup(e=1800*1e3){let r=Date.now(),i=[];for(let[t,o]of this.terminals)r-o.lastUpdate>e&&i.push(t);for(let t of i)se.log(v.yellow(`Cleaning up stale terminal for session ${qe(t)}`)),this.closeTerminal(t);i.length>0&&se.log(v.gray(`Cleaned up ${i.length} stale terminals`))}queueTerminalWrite(e,r,i){let t=this.writeQueues.get(e);t||(t=[],this.writeQueues.set(e,t)),t.push(i),this.writeTimers.has(e)||this.processWriteQueue(e,r)}processWriteQueue(e,r){let i=this.writeQueues.get(e);if(!i||i.length===0){this.writeTimers.delete(e);return}let s=i.splice(0,10).join("");try{r.terminal.write(s)}catch(a){let c=`${e}:terminal-write`;if(this.errorDeduplicator.shouldLog(a,c)){let l=this.errorDeduplicator.getErrorStats(a,c);if(l&&l.count>1)se.warn(wf(a,l,`terminal write for session ${qe(e)}`));else{let u=a instanceof Error?a.message:String(a);se.warn(`Terminal write error for session ${qe(e)}: ${u}`),a instanceof Error&&a.stack&&se.debug(`Write error stack: ${a.stack}`)}}}if(i.length>0){let a=setTimeout(()=>{this.processWriteQueue(e,r)},10);this.writeTimers.set(e,a)}else this.writeTimers.delete(e)}getActiveTerminals(){return Array.from(this.terminals.keys())}async subscribeToBufferChanges(e,r){await this.getTerminal(e),this.bufferListeners.has(e)||this.bufferListeners.set(e,new Set);let i=this.bufferListeners.get(e);return i&&(i.add(r),se.log(v.blue(`Buffer listener subscribed for session ${e} (${i.size} total)`))),()=>{let t=this.bufferListeners.get(e);t&&(t.delete(r),se.log(v.yellow(`Buffer listener unsubscribed for session ${e} (${t.size} remaining)`)),t.size===0&&this.bufferListeners.delete(e))}}scheduleBufferChangeNotification(e){let r=this.changeTimers.get(e);r&&clearTimeout(r);let i=setTimeout(()=>{this.changeTimers.delete(e),this.notifyBufferChange(e)},50);this.changeTimers.set(e,i)}async notifyBufferChange(e){let r=this.bufferListeners.get(e);if(!(!r||r.size===0))try{let i=await this.getBufferSnapshot(e);r.forEach(t=>{try{t(e,i)}catch(o){se.error(`Error notifying buffer change listener for ${qe(e)}:`,o)}})}catch(i){se.error(`Error getting buffer snapshot for notification ${qe(e)}:`,i)}}async resumeFileWatcher(e){let r=this.terminals.get(e);!r||r.watcher||await this.watchStreamFile(e)}destroy(){for(let e of this.terminals.keys())this.closeTerminal(e);for(let e of this.changeTimers.values())clearTimeout(e);this.changeTimers.clear();for(let e of this.writeTimers.values())clearTimeout(e);this.writeTimers.clear(),this.writeQueues.clear(),this.flowControlTimer&&(clearInterval(this.flowControlTimer),this.flowControlTimer=void 0),console.warn=this.originalConsoleWarn}};W();var It=C(require("fs")),cy=C(require("os")),Sf=C(require("path")),ha=C(require("web-push"));W();var je=T("vapid-manager"),Xn=class{config=null;vapidDir;keysFilePath;constructor(e){this.vapidDir=e||Sf.join(cy.homedir(),".vibetunnel/vapid"),this.keysFilePath=Sf.join(this.vapidDir,"keys.json")}async initialize(e){let{contactEmail:r,publicKey:i,privateKey:t,generateIfMissing:o=!0}=e;if(i&&t)return je.log("Using provided VAPID keys"),this.config={keyPair:{publicKey:i,privateKey:t},contactEmail:r||"noreply@vibetunnel.local",enabled:!0},await this.saveKeys(this.config.keyPair),this.configureWebPush(),this.config;let s=await this.loadKeys();if(s)return je.log("Using existing VAPID keys"),this.config={keyPair:s,contactEmail:r||"noreply@vibetunnel.local",enabled:!0},this.configureWebPush(),this.config;if(o){je.log("Generating new VAPID keys");let a=this.generateKeys();return this.config={keyPair:a,contactEmail:r||"noreply@vibetunnel.local",enabled:!0},await this.saveKeys(this.config.keyPair),this.configureWebPush(),this.config}return je.warn("No VAPID keys available and generation disabled"),this.config={keyPair:{publicKey:"",privateKey:""},contactEmail:r||"noreply@vibetunnel.local",enabled:!1},this.config}generateKeys(){je.debug("Generating VAPID key pair");let e=ha.default.generateVAPIDKeys();return{publicKey:e.publicKey,privateKey:e.privateKey}}async rotateKeys(e){je.log("Rotating VAPID keys");let r=this.generateKeys();return this.config={keyPair:r,contactEmail:e||this.config?.contactEmail||"noreply@vibetunnel.local",enabled:!0},await this.saveKeys(r),this.configureWebPush(),je.log("VAPID keys rotated successfully"),r}getConfig(){return this.config}getPublicKey(){return this.config?.keyPair.publicKey||null}isEnabled(){return this.config?.enabled===!0&&!!this.config.keyPair.publicKey&&!!this.config.keyPair.privateKey}validateConfig(){let e=[];return this.config?(this.config.keyPair.publicKey||e.push("Missing VAPID public key"),this.config.keyPair.privateKey||e.push("Missing VAPID private key"),this.config.contactEmail||e.push("Missing contact email for VAPID"),this.config.contactEmail&&!this.isValidEmail(this.config.contactEmail)&&e.push("Invalid contact email format"),this.config.keyPair.publicKey&&!this.isValidVapidKey(this.config.keyPair.publicKey)&&e.push("Invalid VAPID public key format"),this.config.keyPair.privateKey&&!this.isValidVapidKey(this.config.keyPair.privateKey)&&e.push("Invalid VAPID private key format"),{valid:e.length===0,errors:e}):(e.push("VAPID manager not initialized"),{valid:!1,errors:e})}async saveKeys(e){try{It.existsSync(this.vapidDir)||(It.mkdirSync(this.vapidDir,{recursive:!0}),je.debug(`Created VAPID directory: ${this.vapidDir}`));let r={publicKey:e.publicKey,privateKey:e.privateKey,generated:new Date().toISOString()};It.writeFileSync(this.keysFilePath,JSON.stringify(r,null,2),{mode:384}),je.debug("VAPID keys saved to disk")}catch(r){throw je.error("Failed to save VAPID keys:",r),new Error(`Failed to save VAPID keys: ${r}`)}}async loadKeys(){try{if(!It.existsSync(this.keysFilePath))return je.debug("No existing VAPID keys file found"),null;let e=JSON.parse(It.readFileSync(this.keysFilePath,"utf8"));return!e.publicKey||!e.privateKey?(je.warn("Invalid VAPID keys file format"),null):(je.debug("VAPID keys loaded from disk"),{publicKey:e.publicKey,privateKey:e.privateKey})}catch(e){return je.error("Failed to load VAPID keys:",e),null}}configureWebPush(){if(!this.config||!this.isEnabled()){je.debug("Skipping web-push configuration - VAPID not enabled");return}try{ha.default.setVapidDetails(`mailto:${this.config.contactEmail}`,this.config.keyPair.publicKey,this.config.keyPair.privateKey),je.debug("Web-push library configured with VAPID details")}catch(e){throw je.error("Failed to configure web-push library:",e),new Error(`Failed to configure web-push: ${e}`)}}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}isValidVapidKey(e){return typeof e=="string"&&e.length>20&&/^[A-Za-z0-9_-]+$/.test(e)}getKeysDirectory(){return this.vapidDir}async removeKeys(){try{It.existsSync(this.keysFilePath)&&(It.unlinkSync(this.keysFilePath),je.log("VAPID keys removed from disk")),this.config=null}catch(e){throw je.error("Failed to remove VAPID keys:",e),new Error(`Failed to remove VAPID keys: ${e}`)}}async sendNotification(e,r,i){if(!this.isEnabled())throw new Error("VAPID not properly configured");try{return await ha.default.sendNotification(e,r,i)}catch(t){throw je.error("Failed to send push notification:",t),t}}},wN=new Xn;Ir();var $=T("server"),gy=!1;function ht(){return gy}function ok(n){gy=n}function sk(){console.log(`
VibeTunnel Server - Terminal Multiplexer

Usage: vibetunnel-server [options]

Options:
  --help                Show this help message
  --version             Show version information
  --port <number>       Server port (default: 4020 or PORT env var)
  --bind <address>      Bind address (default: 0.0.0.0, all interfaces)
  --enable-ssh-keys     Enable SSH key authentication UI and functionality
  --disallow-user-password  Disable password auth, SSH keys only (auto-enables --enable-ssh-keys)
  --no-auth             Disable authentication (auto-login as current user)
  --allow-local-bypass  Allow localhost connections to bypass authentication
  --local-auth-token <token>  Token for localhost authentication bypass
  --enable-tailscale-serve  Enable Tailscale Serve integration (auto-manages proxy and auth)
  --debug               Enable debug logging

Push Notification Options:
  --push-enabled        Enable push notifications (default: enabled)
  --push-disabled       Disable push notifications
  --vapid-email <email> Contact email for VAPID (or PUSH_CONTACT_EMAIL env var)
  --generate-vapid-keys Generate new VAPID keys if none exist

Network Discovery Options:
  --no-mdns             Disable mDNS/Bonjour advertisement (enabled by default)

HQ Mode Options:
  --hq                  Run as HQ (headquarters) server

Remote Server Options:
  --hq-url <url>        HQ server URL to register with
  --hq-username <user>  Username for HQ authentication
  --hq-password <pass>  Password for HQ authentication
  --name <name>         Unique name for this remote server
  --allow-insecure-hq   Allow HTTP URLs for HQ (default: HTTPS only)
  --no-hq-auth          Disable HQ authentication (for testing only)

Environment Variables:
  PORT                  Default port if --port not specified
  VIBETUNNEL_USERNAME   Default username if --username not specified
  VIBETUNNEL_PASSWORD   Default password if --password not specified
  VIBETUNNEL_CONTROL_DIR Control directory for session data
  PUSH_CONTACT_EMAIL    Contact email for VAPID configuration

Examples:
  # Run a simple server with authentication
  vibetunnel-server --username admin --password secret

  # Run as HQ server
  vibetunnel-server --hq --username hq-admin --password hq-secret

  # Run as remote server registering with HQ
  vibetunnel-server --username local --password local123 \\
    --hq-url https://hq.example.com \\
    --hq-username hq-admin --hq-password hq-secret \\
    --name remote-1
`)}function ak(){let n=process.argv.slice(2),e={port:null,bind:null,enableSSHKeys:!1,disallowUserPassword:!1,noAuth:!1,isHQMode:!1,hqUrl:null,hqUsername:null,hqPassword:null,remoteName:null,allowInsecureHQ:!1,showHelp:!1,showVersion:!1,debug:!1,pushEnabled:!0,vapidEmail:null,generateVapidKeys:!0,bellNotificationsEnabled:!0,allowLocalBypass:!1,localAuthToken:null,enableTailscaleServe:!1,noHqAuth:!1,enableMDNS:!0};if(n.includes("--help")||n.includes("-h"))return e.showHelp=!0,e;if(n.includes("--version")||n.includes("-v"))return e.showVersion=!0,e;for(let r=0;r<n.length;r++)n[r]==="--port"&&r+1<n.length?(e.port=Number.parseInt(n[r+1],10),r++):n[r]==="--bind"&&r+1<n.length?(e.bind=n[r+1],r++):n[r]==="--enable-ssh-keys"?e.enableSSHKeys=!0:n[r]==="--disallow-user-password"?(e.disallowUserPassword=!0,e.enableSSHKeys=!0):n[r]==="--no-auth"?e.noAuth=!0:n[r]==="--hq"?e.isHQMode=!0:n[r]==="--hq-url"&&r+1<n.length?(e.hqUrl=n[r+1],r++):n[r]==="--hq-username"&&r+1<n.length?(e.hqUsername=n[r+1],r++):n[r]==="--hq-password"&&r+1<n.length?(e.hqPassword=n[r+1],r++):n[r]==="--name"&&r+1<n.length?(e.remoteName=n[r+1],r++):n[r]==="--allow-insecure-hq"?e.allowInsecureHQ=!0:n[r]==="--debug"?e.debug=!0:n[r]==="--push-enabled"?e.pushEnabled=!0:n[r]==="--push-disabled"?e.pushEnabled=!1:n[r]==="--vapid-email"&&r+1<n.length?(e.vapidEmail=n[r+1],r++):n[r]==="--generate-vapid-keys"?e.generateVapidKeys=!0:n[r]==="--allow-local-bypass"?e.allowLocalBypass=!0:n[r]==="--local-auth-token"&&r+1<n.length?(e.localAuthToken=n[r+1],r++):n[r]==="--enable-tailscale-serve"?e.enableTailscaleServe=!0:n[r]==="--no-hq-auth"?e.noHqAuth=!0:n[r]==="--no-mdns"?e.enableMDNS=!1:n[r].startsWith("--")&&($.error(`Unknown argument: ${n[r]}`),$.error("Use --help to see available options"),process.exit(1));return!e.vapidEmail&&process.env.PUSH_CONTACT_EMAIL&&(e.vapidEmail=process.env.PUSH_CONTACT_EMAIL),e}function ck(n){n.noAuth&&(n.enableSSHKeys||n.disallowUserPassword)&&$.warn("--no-auth overrides all other authentication settings (authentication is disabled)"),n.disallowUserPassword&&!n.enableSSHKeys&&($.warn("--disallow-user-password requires SSH keys, auto-enabling --enable-ssh-keys"),n.enableSSHKeys=!0),n.hqUrl&&(!n.hqUsername||!n.hqPassword)&&!n.noHqAuth&&($.error("HQ username and password required when --hq-url is specified"),$.error("Use --hq-username and --hq-password with --hq-url"),$.error("Or use --no-hq-auth for testing without authentication"),process.exit(1)),n.hqUrl&&!n.remoteName&&($.error("Remote name required when --hq-url is specified"),$.error("Use --name to specify a unique name for this remote server"),process.exit(1)),n.hqUrl&&!n.hqUrl.startsWith("https://")&&!n.allowInsecureHQ&&($.error("HQ URL must use HTTPS protocol"),$.error("Use --allow-insecure-hq to allow HTTP for testing"),process.exit(1)),(n.hqUrl||n.hqUsername||n.hqPassword)&&(!n.hqUrl||!n.hqUsername||!n.hqPassword)&&!n.noHqAuth&&($.error("All HQ parameters required: --hq-url, --hq-username, --hq-password"),$.error("Or use --no-hq-auth for testing without authentication"),process.exit(1)),n.enableTailscaleServe&&n.bind==="0.0.0.0"&&($.error("Security Error: Cannot bind to 0.0.0.0 when using Tailscale Serve"),$.error("Tailscale Serve requires binding to localhost (127.0.0.1)"),$.error("Use --bind 127.0.0.1 or disable Tailscale Serve"),process.exit(1)),n.isHQMode&&n.hqUrl&&($.error("Cannot use --hq and --hq-url together"),$.error("Use --hq to run as HQ server, or --hq-url to register with an HQ"),process.exit(1)),n.noHqAuth&&n.hqUrl&&($.warn("--no-hq-auth is enabled: Remote servers can register without authentication"),$.warn("This should only be used for testing!"))}var ly=!1;async function lk(){if(ly)throw $.error("App already created, preventing duplicate instance"),new Error("Duplicate app creation detected");ly=!0;let n=ak();if(n.showHelp&&(sk(),process.exit(0)),n.showVersion){let P=ci();console.log(`VibeTunnel Server v${P.version}`),console.log(`Built: ${P.buildDate}`),console.log(`Platform: ${P.platform}/${P.arch}`),console.log(`Node: ${P.nodeVersion}`),process.exit(0)}Cm(),ck(n),$.log("Initializing VibeTunnel server components");let e=(0,va.default)(),r=(0,my.createServer)(e),i=new py.WebSocketServer({noServer:!0,perMessageDeflate:!0});e.use((0,fy.default)({contentSecurityPolicy:!1,crossOriginEmbedderPolicy:!1})),$.debug("Configured security headers with helmet"),e.use((0,xf.default)()),$.debug("Configured cookie parser middleware"),e.use((P,N,E)=>{if(P.method==="GET"||P.method==="HEAD"||P.method==="OPTIONS"||P.headers.upgrade==="websocket"||P.path==="/api/auth/password"||P.path==="/api/auth/ssh-key"||P.headers.authorization?.startsWith("Bearer "))return E();let B=P.headers["x-csrf-token"],me=P.cookies?.["csrf-token"];return B&&me&&B===me?E():($.warn(`CSRF protection blocked request to ${P.path} from ${P.ip}`,{hasToken:!!B,hasCookie:!!me,tokensMatch:B===me,userAgent:P.headers["user-agent"],referer:P.headers.referer}),N.status(403).json({error:"CSRF token missing or invalid",details:"Cross-site request forgery protection requires matching CSRF token"}))}),$.debug("Configured CSRF protection using Double-Submit Cookie pattern"),e.use((0,$f.default)({filter:(P,N)=>P.path.match(/\/api\/sessions\/[^/]+\/stream$/)||P.path==="/api/events"?!1:$f.default.filter(P,N),level:6})),$.debug("Configured compression middleware (with SSE exclusion)"),e.use(va.default.json({limit:"10mb"})),e.use((0,xf.default)()),$.debug("Configured express middleware with cookie parser");let t=process.env.VIBETUNNEL_CONTROL_DIR||Ie.join(ba.homedir(),".vibetunnel/control");ya.existsSync(t)?$.debug(`Using existing control directory: ${t}`):(ya.mkdirSync(t,{recursive:!0}),$.log(v.green(`Created control directory: ${t}`))),await or.initialize();let o=new or(t);$.debug("Initialized PTY manager");let s=o.getSessionManager(),a=s.cleanupOldVersionSessions();a.versionChanged?$.log(v.yellow(`Version change detected - cleaned up ${a.cleanedCount} sessions from previous version`)):a.cleanedCount>0&&$.log(v.yellow(`Cleaned up ${a.cleanedCount} legacy sessions without version information`));let c=new ga(t);$.debug("Initialized terminal manager");let l=3600*1e3,u=setInterval(()=>{try{c.cleanupInactiveTerminals(14400*1e3),o.cleanupExitedSessions()}catch(P){$.warn("Error during periodic cleanup:",P)}},l);process.on("exit",()=>{clearInterval(u)});let d=new pa(s);$.debug("Initialized stream watcher");let f=new fa(o);await f.initialize(),o.setSessionMonitor(f),$.debug("Initialized session monitor");let p=new Hs(t);$.debug("Initialized activity monitor");let m=new sa;m.startWatching(),$.debug("Initialized configuration service");let g=null,h=null;if(n.pushEnabled)try{$.log("Initializing push notification services"),g=new Xn,await g.initialize({contactEmail:n.vapidEmail||"noreply@vibetunnel.local",generateIfMissing:!0}),$.log("VAPID keys initialized successfully"),h=new ua(g),await h.initialize(),$.log(v.green("Push notification services initialized"))}catch(P){$.error("Failed to initialize push notification services:",P),$.warn("Continuing without push notifications"),g=null,h=null}else $.debug("Push notifications disabled");f&&h&&($.info("Connecting SessionMonitor to push notification service"),f.on("notification",async P=>{try{let N=null;switch(P.type){case"session-start":N={type:"session-start",title:"\u{1F680} Session Started",body:P.sessionName||"Terminal Session"};break;case"session-exit":N={type:"session-exit",title:"\u{1F3C1} Session Ended",body:P.sessionName||"Terminal Session",data:{exitCode:P.exitCode}};break;case"command-finished":N={type:"command-finished",title:"\u2705 Your Turn",body:P.command||"Command completed",data:{duration:P.duration}};break;case"command-error":N={type:"command-error",title:"\u274C Command Failed",body:P.command||"Command failed",data:{exitCode:P.exitCode}};break;case"bell":N={type:"bell",title:"\u{1F514} Terminal Bell",body:P.sessionName||"Terminal"};break;case"claude-turn":N={type:"claude-turn",title:"\u{1F4AC} Your Turn",body:P.message||"Claude has finished responding"};break;case"test-notification":return;default:return}if(N){let E=await h.sendNotification({...N,icon:"/apple-touch-icon.png",badge:"/favicon-32.png",tag:`vibetunnel-${N.type}`,requireInteraction:N.type==="command-error",actions:[{action:"view-session",title:"View Session"},{action:"dismiss",title:"Dismiss"}],data:{...N.data,type:N.type,sessionId:P.sessionId,timestamp:P.timestamp}});$.debug(`Push notification sent for ${P.type}: ${E.sent} successful, ${E.failed} failed`)}}catch(N){$.error("Failed to send push notification for SessionMonitor event:",N)}}));let S=null,y=null,k=null,b=null,R=null;n.isHQMode?(S=new da,$.log(v.green("Running in HQ mode")),$.debug("Initialized remote registry for HQ mode")):n.hqUrl&&n.remoteName&&(n.noHqAuth||n.hqUsername&&n.hqPassword)&&(R=Nt(),$.debug(`Generated bearer token for remote server: ${n.remoteName}`));let z=new qs;$.debug("Initialized authentication service"),b=new Ks({terminalManager:c,remoteRegistry:S,isHQMode:n.isHQMode}),$.debug("Initialized buffer aggregator");let L=new Vs({ptyManager:o,terminalManager:c,activityMonitor:p,remoteRegistry:S,authService:z,isHQMode:n.isHQMode});$.debug("Initialized WebSocket input handler");let F=_p({enableSSHKeys:n.enableSSHKeys,disallowUserPassword:n.disallowUserPassword,noAuth:n.noAuth,isHQMode:n.isHQMode,bearerToken:R||void 0,authService:z,allowLocalBypass:n.allowLocalBypass,localAuthToken:n.localAuthToken||void 0,allowTailscaleAuth:n.enableTailscaleServe}),K=(()=>{if(process.env.BUILD_PUBLIC_PATH)return $.info(`Using BUILD_PUBLIC_PATH: ${process.env.BUILD_PUBLIC_PATH}`),process.env.BUILD_PUBLIC_PATH;let P=(()=>{if(__filename.includes(Ie.join("node_modules","vibetunnel","lib"))||__filename.includes("node_modules\\vibetunnel\\lib"))return!0;if(Ie.basename(__dirname)==="lib"){let N=Ie.dirname(__dirname),E=Ie.join(N,"package.json");try{return require(E).name==="vibetunnel"}catch{return!1}}return!1})();if(process.env.VIBETUNNEL_BUNDLED==="true"||process.env.BUILD_DATE||P){let N=__dirname;Ie.basename(N)==="dist"&&(N=Ie.dirname(N)),Ie.basename(N)==="lib"&&(N=Ie.dirname(N));let E=Ie.join(N,"public"),B=Ie.join(E,"index.html");return require("fs").existsSync(B)?E:Ie.join(__dirname,"..","public")}else return Ie.join(process.cwd(),"public")})(),ge=!process.env.BUILD_DATE||process.env.NODE_ENV==="development";e.use(va.default.static(K,{extensions:["html"],maxAge:ge?0:"1d",etag:!ge,lastModified:!ge,setHeaders:(P,N)=>{ge?(P.setHeader("Cache-Control","no-cache, no-store, must-revalidate"),P.setHeader("Pragma","no-cache"),P.setHeader("Expires","0")):N.match(/\.(js|css|woff2?|ttf|eot|svg|png|jpg|jpeg|gif|ico)$/)?P.setHeader("Cache-Control","public, max-age=31536000, immutable"):N.endsWith(".html")&&P.setHeader("Cache-Control","public, max-age=3600")}})),$.debug(`Serving static files from: ${K} ${ge?"with caching disabled (dev mode)":"with caching headers"}`),e.get("/api/health",(P,N)=>{let E=ci();N.json({status:"ok",timestamp:new Date().toISOString(),mode:n.isHQMode?"hq":"remote",version:E.version,buildDate:E.buildDate,uptime:E.uptime,pid:E.pid})}),e.get("/api/csrf-token",(P,N)=>{let E=require("crypto").randomBytes(32).toString("hex");N.cookie("csrf-token",E,{httpOnly:!1,secure:process.env.NODE_ENV==="production",sameSite:"strict",maxAge:1440*60*1e3,path:"/"}),N.json({csrfToken:E,expiresAt:Date.now()+1440*60*1e3})}),h&&(o.on("sessionExited",P=>{let N=s.loadSessionInfo(P),E=N?.exitCode??0,B=N?.name||`Session ${P}`,me=E===0?"session-exit":"session-error",ae=E===0?"Session Ended":"Session Ended with Errors",V=E===0?`${B} has finished.`:`${B} exited with code ${E}.`;h.sendNotification({type:me,title:ae,body:V,icon:"/apple-touch-icon.png",badge:"/favicon-32.png",tag:`vibetunnel-${me}-${P}`,requireInteraction:!1,data:{type:me,sessionId:P,sessionName:B,exitCode:E,timestamp:new Date().toISOString()},actions:[{action:"view-logs",title:"View Logs"},{action:"dismiss",title:"Dismiss"}]}).catch(ue=>{$.error("Failed to send session exit notification:",ue)})}),$.debug("Connected session exit notifications to PTY manager"),o.on("commandFinished",({sessionId:P,command:N,exitCode:E,duration:B,timestamp:me})=>{N.toLowerCase().includes("claude")?$.log(v.magenta(`\u{1F4EC} Server received Claude commandFinished event: sessionId=${P}, command="${N}", exitCode=${E}, duration=${B}ms`)):$.debug(`Server received commandFinished event for session ${P}: "${N}"`);let V=E===0?"command-finished":"command-error",ue=E===0?"Command Completed":"Command Failed",Ue=E===0?`${N} completed successfully`:`${N} failed with exit code ${E}`,Lt=B>6e4?`${Math.round(B/6e4)}m ${Math.round(B%6e4/1e3)}s`:`${Math.round(B/1e3)}s`;$.debug(`Sending push notification: type=${V}, title="${ue}", body="${Ue} (${Lt})"`),h.sendNotification({type:V,title:ue,body:`${Ue} (${Lt})`,icon:"/apple-touch-icon.png",badge:"/favicon-32.png",tag:`vibetunnel-command-${P}-${Date.now()}`,requireInteraction:!1,data:{type:V,sessionId:P,command:N,exitCode:E,duration:B,timestamp:me},actions:[{action:"view-session",title:"View Session"},{action:"dismiss",title:"Dismiss"}]}).catch(ao=>{$.error("Failed to send command finished notification:",ao)})}),$.debug("Connected command finished notifications to PTY manager"),o.on("claudeTurn",(P,N)=>{$.info(`\u{1F514} NOTIFICATION DEBUG: Sending push notification for Claude turn - sessionId: ${P}`),h.sendNotification({type:"claude-turn",title:"Claude Ready",body:`${N} is waiting for your input.`,icon:"/apple-touch-icon.png",badge:"/favicon-32.png",tag:`vibetunnel-claude-turn-${P}`,requireInteraction:!0,data:{type:"claude-turn",sessionId:P,sessionName:N,timestamp:new Date().toISOString()},actions:[{action:"view-session",title:"View Session"},{action:"dismiss",title:"Dismiss"}]}).catch(E=>{$.error("Failed to send Claude turn notification:",E)})}),$.debug("Connected Claude turn notifications to PTY manager")),e.get("/api/csrf-token",(P,N)=>{try{let E=dy.randomBytes(32).toString("hex"),B=!process.env.BUILD_DATE||process.env.NODE_ENV==="development";N.cookie("csrf-token",E,{httpOnly:!1,secure:!B,sameSite:"strict",maxAge:1440*60*1e3,path:"/"}),N.json({csrfToken:E,expiresAt:Date.now()+1440*60*1e3}),$.debug("Generated CSRF token for client")}catch(E){$.error("Error generating CSRF token:",E),N.status(500).json({error:"Failed to generate CSRF token"})}}),e.use("/api",F),$.debug("Applied authentication middleware to /api routes"),e.use("/api/auth",Tp({authService:z,enableSSHKeys:n.enableSSHKeys,disallowUserPassword:n.disallowUserPassword,noAuth:n.noAuth})),$.debug("Mounted authentication routes"),e.use("/api",$v({ptyManager:o,terminalManager:c,streamWatcher:d,remoteRegistry:S,isHQMode:n.isHQMode,activityMonitor:p})),$.debug("Mounted session routes"),e.use("/api",av({remoteRegistry:S,isHQMode:n.isHQMode})),$.debug("Mounted remote routes"),e.use("/api",Zh()),$.debug("Mounted filesystem routes"),e.use("/api",Kh()),$.debug("Mounted log routes"),e.use("/api",Fh()),$.debug("Mounted file routes"),e.use("/api",mv()),$.debug("Mounted repository routes"),e.use("/api",Ch({configService:m})),$.debug("Mounted config routes"),e.use("/api",qh()),$.debug("Mounted Git routes"),e.use("/api",Cv()),$.debug("Mounted worktree routes"),e.use("/api",zh()),$.debug("Mounted control routes"),e.use("/api/tmux",Pv({ptyManager:o})),$.debug("Mounted tmux routes"),e.use("/api/multiplexer",nv({ptyManager:o})),$.debug("Mounted multiplexer routes"),e.use("/api",ov({vapidManager:g||new Xn,pushNotificationService:h,sessionMonitor:f})),$.debug("Mounted push notification routes"),e.use("/api",Rh(f)),$.debug("Mounted events routes"),e.use("/api",kv({sessionMonitor:f,pushNotificationService:h})),$.debug("Mounted test notification routes");try{await ee.start(),$.log(v.green("Control UNIX socket: READY"))}catch(P){$.error("Failed to initialize control socket:",P),$.warn("Mac control features will not be available.")}try{await ec.start(),$.log(v.green("API socket server: READY"))}catch(P){$.error("Failed to initialize API socket server:",P),$.warn("vt commands will not work via socket.")}return r.on("upgrade",async(P,N,E)=>{let B=new URL(P.url||"",`http://${P.headers.host||"localhost"}`);if(B.pathname!=="/buffers"&&B.pathname!=="/ws/input"){N.write(`HTTP/1.1 404 Not Found\r
\r
`),N.destroy();return}let me=await new Promise(ae=>{let V=!1,ue=ft=>{V||(V=!0,ae(ft))},Ue={};B.searchParams.forEach((ft,Nf)=>{Ue[Nf]=ft});let Lt={...P,url:P.url,path:B.pathname,userId:void 0,authMethod:void 0,query:Ue,headers:P.headers,ip:P.socket.remoteAddress||"",socket:P.socket,hostname:P.headers.host?.split(":")[0]||"localhost",get:ft=>P.headers[ft.toLowerCase()],header:ft=>P.headers[ft.toLowerCase()],accepts:()=>!1,acceptsCharsets:()=>!1,acceptsEncodings:()=>!1,acceptsLanguages:()=>!1},ao=!1,ky={status:ft=>(ft>=400&&(ao=!0,ue({authenticated:!1})),{json:()=>{},send:()=>{},end:()=>{}}),setHeader:()=>{},send:()=>{},json:()=>{},end:()=>{}},_y=ft=>{ue({authenticated:!ft&&!ao,userId:Lt.userId,authMethod:Lt.authMethod})},Cf=setTimeout(()=>{$.error("WebSocket auth timeout - auth middleware did not complete in time"),ue({authenticated:!1})},5e3);Promise.resolve(F(Lt,ky,_y)).then(()=>{clearTimeout(Cf)}).catch(ft=>{clearTimeout(Cf),$.error("Auth middleware error:",ft),ue({authenticated:!1})})});if(!me.authenticated){$.debug("WebSocket connection rejected: unauthorized"),N.write(`HTTP/1.1 401 Unauthorized\r
\r
`),N.destroy();return}i.handleUpgrade(P,N,E,ae=>{let V=P;V.pathname=B.pathname,V.searchParams=B.searchParams,V.userId=me.userId,V.authMethod=me.authMethod,i.emit("connection",ae,V)})}),i.on("connection",(P,N)=>{let E=N,B=E.pathname,me=E.searchParams;if($.log(`\u{1F50C} WebSocket connection to path: ${B}`),$.log(`\u{1F464} User ID: ${E.userId||"unknown"}`),$.log(`\u{1F510} Auth method: ${E.authMethod||"unknown"}`),B==="/buffers")$.log("\u{1F4CA} Handling buffer WebSocket connection"),b?b.handleClientConnection(P):($.error("BufferAggregator not initialized for WebSocket connection"),P.close());else if(B==="/ws/input"){$.log("\u2328\uFE0F Handling input WebSocket connection");let ae=me?.get("sessionId");if(!ae){$.error("WebSocket input connection missing sessionId parameter"),P.close();return}let V=E.userId||"unknown";L.handleConnection(P,ae,V)}else $.error(`\u274C Unknown WebSocket path: ${B}`),P.close()}),e.get("/",(P,N)=>{N.sendFile(Ie.join(K,"index.html"))}),e.get("/session/:id",(P,N)=>{N.sendFile(Ie.join(K,"index.html"))}),e.get("/worktrees",(P,N)=>{N.sendFile(Ie.join(K,"index.html"))}),e.get("/file-browser",(P,N)=>{N.sendFile(Ie.join(K,"index.html"))}),e.use((P,N)=>{P.path.startsWith("/api/")?N.status(404).json({error:"API endpoint not found"}):N.status(404).sendFile(Ie.join(K,"404.html"),E=>{E&&N.status(404).send("404 - Page not found")})}),{app:e,server:r,wss:i,startServer:()=>{let P=n.port!==null?n.port:Number(process.env.PORT)||4020;$.log(`Starting server on port ${P}`),r.removeAllListeners("error"),r.on("error",E=>{E.code==="EADDRINUSE"?($.error(`Port ${P} is already in use`),!process.env.BUILD_DATE||process.env.NODE_ENV==="development"?($.error(v.yellow(`
Development mode options:`)),$.error(`  1. Run server on different port: ${v.cyan("pnpm run dev:server --port 4021")}`),$.error(`  2. Use environment variable: ${v.cyan("PORT=4021 pnpm run dev")}`),$.error("  3. Stop the existing server (check Activity Monitor for vibetunnel processes)")):$.error("Please use a different port with --port <number> or stop the existing server"),process.exit(9)):($.error("Server error:",E),process.exit(1))}),$.log(`Starting server on port ${P}`);let N=n.bind||(n.enableTailscaleServe?"127.0.0.1":"0.0.0.0");r.listen(P,N,()=>{let E=r.address(),B=typeof E=="string"?P:E?.port||P,me=N==="0.0.0.0"?"localhost":N;if($.log(v.green(`VibeTunnel Server running on http://${me}:${B}`)),ec.setServerInfo(B,`http://${me}:${B}`),n.noAuth?($.warn(v.yellow("Authentication: DISABLED (--no-auth)")),$.warn("Anyone can access this server without authentication")):n.disallowUserPassword?($.log(v.green("Authentication: SSH KEYS ONLY (--disallow-user-password)")),$.log(v.gray("Password authentication is disabled"))):($.log(v.green("Authentication: SYSTEM USER PASSWORD")),n.enableSSHKeys?$.log(v.green("SSH Key Authentication: ENABLED")):$.log(v.gray("SSH Key Authentication: DISABLED (use --enable-ssh-keys to enable)"))),n.enableTailscaleServe&&($.log(v.blue("Starting Tailscale Serve integration...")),Jn.start(B).then(()=>{$.log(v.green("Tailscale Serve: ENABLED")),$.log(v.gray("Users will be auto-authenticated via Tailscale identity headers")),$.log(v.gray("Access via HTTPS on your Tailscale hostname (e.g., https://hostname.tailnet.ts.net)"))}).catch(ae=>{$.error(v.red("Failed to start Tailscale Serve:"),ae.message),$.warn(v.yellow("VibeTunnel will continue running, but Tailscale Serve is not available")),$.log(v.blue("You can manually configure Tailscale Serve with:")),$.log(v.gray(`  tailscale serve ${B}`))})),n.allowLocalBypass&&($.log(v.yellow("Local Bypass: ENABLED")),n.localAuthToken?$.log(v.gray("Local connections require auth token")):$.log(v.gray("Local connections bypass authentication without token"))),n.hqUrl&&n.remoteName&&(n.noHqAuth||n.hqUsername&&n.hqPassword)){let ae=N;N==="0.0.0.0"&&(ae=ba.hostname());let V=`http://${ae}:${B}`;y=new ca(n.hqUrl,n.hqUsername||"no-auth",n.hqPassword||"no-auth",n.remoteName,V,R||""),n.noHqAuth?$.log(v.yellow(`Remote mode: ${n.remoteName} registering WITHOUT HQ authentication (--no-hq-auth)`)):($.log(v.green(`Remote mode: ${n.remoteName} will accept Bearer token for HQ access`)),$.debug(`Bearer token: ${y.getToken()}`))}process.send&&!process.env.VITEST&&process.send({type:"server-started",port:B}),y&&($.log(`Registering with HQ at ${n.hqUrl}`),y.register().catch(ae=>{$.error("Failed to register with HQ:",ae)})),k=new aa({controlDir:t,remoteRegistry:S,isHQMode:n.isHQMode,hqClient:y,ptyManager:o,pushNotificationService:h||void 0}),k.start(),$.debug("Started control directory watcher"),p.start(),$.debug("Started activity monitor"),n.enableMDNS?la.startAdvertising(B).catch(ae=>{$.warn("Failed to start mDNS advertisement:",ae)}):$.debug("mDNS advertisement disabled")})},config:n,configService:m,ptyManager:o,terminalManager:c,streamWatcher:d,remoteRegistry:S,hqClient:y,controlDirWatcher:k,bufferAggregator:b,activityMonitor:p,pushNotificationService:h}}var uy=!1;async function hy(){po(),process.env.DEBUG==="true"||process.argv.includes("--debug"),uy&&($.error("Server already started, preventing duplicate instance"),$.error("This should not happen - duplicate server startup detected"),process.exit(1)),uy=!0,$.debug("Creating VibeTunnel application instance");let n=await lk(),{startServer:e,server:r,terminalManager:i,remoteRegistry:t,hqClient:o,controlDirWatcher:s,activityMonitor:a,config:c,configService:l}=n;(c.debug||process.env.DEBUG==="true")&&(Ia(!0),$.log(v.gray("Debug logging enabled"))),e();let u=setInterval(()=>{i.cleanup(300*1e3)},300*1e3);$.debug("Started terminal cleanup interval (5 minutes)");let d=null;n.pushNotificationService&&(d=setInterval(()=>{n.pushNotificationService?.cleanupInactiveSubscriptions().catch(m=>{$.error("Failed to cleanup inactive subscriptions:",m)})},1800*1e3),$.debug("Started subscription cleanup interval (30 minutes)"));let f=!1,p=async()=>{f&&($.warn("Force exit..."),process.exit(1)),f=!0,ok(!0),$.log(v.yellow(`
Shutting down...`));try{clearInterval(u),d&&clearInterval(d),$.debug("Cleared cleanup intervals"),a.stop(),$.debug("Stopped activity monitor"),l.stopWatching(),$.debug("Stopped configuration service watcher"),la.isActive()&&(await la.stopAdvertising(),$.debug("Stopped mDNS advertisement")),c.enableTailscaleServe&&Jn.isRunning()&&($.log("Stopping Tailscale Serve..."),await Jn.stop(),$.debug("Stopped Tailscale Serve service")),s&&(s.stop(),$.debug("Stopped control directory watcher"));try{let{controlUnixHandler:m}=await Promise.resolve().then(()=>(Ir(),zm));m.stop(),$.debug("Stopped UNIX socket server")}catch{}o&&($.debug("Destroying HQ client connection"),await o.destroy()),t&&($.debug("Destroying remote registry"),t.destroy()),r.close(()=>{$.log(v.green("Server closed successfully")),he(),process.exit(0)}),setTimeout(()=>{$.warn("Graceful shutdown timeout, forcing exit..."),he(),process.exit(1)},5e3)}catch(m){$.error("Error during shutdown:",m),he(),process.exit(1)}};process.on("SIGINT",p),process.on("SIGTERM",p),$.debug("Registered signal handlers for graceful shutdown")}W();Af();process.argv[2]==="version"&&(console.log(`VibeTunnel Server v${Le}`),process.exit(0));var Ef=To(),kk=process.env.VIBETUNNEL_DEBUG==="1"||process.env.VIBETUNNEL_DEBUG==="true";po(kk,Ef);var Yt=T("cli"),xy=global;xy.__vibetunnelStarted&&process.exit(0);xy.__vibetunnelStarted=!0;process.on("uncaughtException",n=>{Yt.error("Uncaught exception:",n),Yt.error("Stack trace:",n.stack),he(),process.exit(1)});process.on("unhandledRejection",(n,e)=>{Yt.error("Unhandled rejection at:",e,"reason:",n),n instanceof Error&&Yt.error("Stack trace:",n.stack),he(),process.exit(1)});function _k(){console.log(`VibeTunnel Server v${Le}`),console.log(""),console.log("Usage:"),console.log("  vibetunnel [options]                    Start VibeTunnel server"),console.log("  vibetunnel fwd <session-id> <command>   Forward command to session"),console.log("  vibetunnel status                       Show server and follow mode status"),console.log("  vibetunnel follow [branch]              Enable Git follow mode"),console.log("  vibetunnel unfollow                     Disable Git follow mode"),console.log("  vibetunnel git-event                    Notify server of Git event"),console.log("  vibetunnel systemd [action]             Manage systemd service (Linux)"),console.log("  vibetunnel version                      Show version"),console.log("  vibetunnel help                         Show this help"),console.log(""),console.log("Systemd Service Actions:"),console.log("  install   - Install VibeTunnel as systemd service (default)"),console.log("  uninstall - Remove VibeTunnel systemd service"),console.log("  status    - Check systemd service status"),console.log(""),console.log("Examples:"),console.log("  vibetunnel --port 8080 --no-auth"),console.log('  vibetunnel fwd abc123 "ls -la"'),console.log("  vibetunnel systemd"),console.log("  vibetunnel systemd uninstall"),console.log(""),console.log("For more options, run: vibetunnel --help")}function Pk(){console.log(`VibeTunnel Server v${Le}`)}async function Tk(){try{await np(process.argv.slice(3))}catch(n){Yt.error("Fatal error:",n),he(),process.exit(1)}}async function Ik(){try{let{installSystemdService:n}=await Promise.resolve().then(()=>(yy(),vy)),e=process.argv[3]||"install";n(e)}catch(n){Yt.error("Failed to load systemd installer:",n),he(),process.exit(1)}}async function Ek(n){try{let{SocketApiClient:e}=await Promise.resolve().then(()=>($y(),Sy)),r=new e;switch(n){case"status":{let i=await r.getStatus();console.log("VibeTunnel Server Status:"),console.log(`  Running: ${i.running?"Yes":"No"}`),i.running&&(console.log(`  Port: ${i.port||"Unknown"}`),console.log(`  URL: ${i.url||"Unknown"}`),i.followMode?(console.log(`
Git Follow Mode:`),console.log(`  Enabled: ${i.followMode.enabled?"Yes":"No"}`),i.followMode.enabled&&i.followMode.branch&&(console.log(`  Following branch: ${i.followMode.branch}`),console.log(`  Worktree: ${i.followMode.repoPath||"Unknown"}`))):console.log(`
Git Follow Mode: Not in a git repository`));break}case"follow":{let i=process.argv.slice(3),t,o;for(let a=0;a<i.length;a++)switch(i[a]){case"--from-worktree":break;case"--worktree-path":t=i[++a];break;case"--main-repo":o=i[++a];break}let s=await r.setFollowMode({enable:!0,worktreePath:t,mainRepoPath:o,repoPath:o});s.success||(console.error(`Failed to enable follow mode: ${s.error||"Unknown error"}`),process.exit(1));break}case"unfollow":{let i=process.cwd(),t=await r.setFollowMode({repoPath:i,enable:!1});t.success?console.log("Disabled follow mode"):(console.error(`Failed to disable follow mode: ${t.error||"Unknown error"}`),process.exit(1));break}case"git-event":{let i=process.cwd();await r.sendGitEvent({repoPath:i,type:"other"});break}}}catch(e){e instanceof Error&&e.message==="VibeTunnel server is not running"?(console.error("Error: VibeTunnel server is not running"),console.error("Start the server first with: vibetunnel")):Yt.error("Socket command failed:",e),he(),process.exit(1)}}function Ck(){Ef!==void 0&&Ef>=3&&Yt.log("Starting VibeTunnel server..."),hy()}async function Nk(){let n=process.argv[2];switch(n){case"version":Pk(),process.exit(0);break;case"help":case"--help":case"-h":_k(),process.exit(0);break;case"fwd":await Tk();break;case"status":case"follow":case"unfollow":case"git-event":await Ek(n);break;case"systemd":await Ik();break;default:Ck();break}}function jk(){return!module.parent&&(require.main===module||require.main===void 0||(require.main?.filename?.endsWith("/vibetunnel-cli")??!1))}jk()&&Nk().catch(n=>{Yt.error("Unhandled error in main execution:",n),n instanceof Error&&Yt.error("Stack trace:",n.stack),he(),process.exit(1)});
/*! Bundled license information:

cookie/index.js:
  (*!
   * cookie
   * Copyright(c) 2012-2014 Roman Shtylman
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   *)

cookie-parser/index.js:
  (*!
   * cookie-parser
   * Copyright(c) 2014 TJ Holowaychuk
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   *)

chokidar/esm/index.js:
  (*! chokidar - MIT License (c) 2012 Paul Miller (paulmillr.com) *)
*/
