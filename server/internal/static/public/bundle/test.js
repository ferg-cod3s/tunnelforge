var Qi=Object.create;var ct=Object.defineProperty;var ci=Object.getOwnPropertyDescriptor;var Zi=Object.getOwnPropertyNames;var es=Object.getPrototypeOf,ts=Object.prototype.hasOwnProperty;var dt=(T,g)=>()=>(T&&(g=T(T=0)),g);var ut=(T,g)=>()=>(g||T((g={exports:{}}).exports,g),g.exports),is=(T,g)=>{for(var l in g)ct(T,l,{get:g[l],enumerable:!0})},ss=(T,g,l,C)=>{if(g&&typeof g=="object"||typeof g=="function")for(let w of Zi(g))!ts.call(T,w)&&w!==l&&ct(T,w,{get:()=>g[w],enumerable:!(C=ci(g,w))||C.enumerable});return T};var ft=(T,g,l)=>(l=T!=null?Qi(es(T)):{},ss(g||!T||!T.__esModule?ct(l,"default",{value:T,enumerable:!0}):l,T));var ee=(T,g,l,C)=>{for(var w=C>1?void 0:C?ci(g,l):g,i=T.length-1,p;i>=0;i--)(p=T[i])&&(w=(C?p(g,l,w):p(w))||w);return C&&w&&ct(g,l,w),w};var Bi=ut(Di=>{(()=>{"use strict";var T={349:(p,s,n)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.CircularList=void 0;let o=n(460),u=n(844);class h extends u.Disposable{constructor(t){super(),this._maxLength=t,this.onDeleteEmitter=this.register(new o.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new o.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new o.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(t){if(this._maxLength===t)return;let e=new Array(t);for(let v=0;v<Math.min(t,this.length);v++)e[v]=this._array[this._getCyclicIndex(v)];this._array=e,this._maxLength=t,this._startIndex=0}get length(){return this._length}set length(t){if(t>this._length)for(let e=this._length;e<t;e++)this._array[e]=void 0;this._length=t}get(t){return this._array[this._getCyclicIndex(t)]}set(t,e){this._array[this._getCyclicIndex(t)]=e}push(t){this._array[this._getCyclicIndex(this._length)]=t,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(t,e,...v){if(e){for(let r=t;r<this._length-e;r++)this._array[this._getCyclicIndex(r)]=this._array[this._getCyclicIndex(r+e)];this._length-=e,this.onDeleteEmitter.fire({index:t,amount:e})}for(let r=this._length-1;r>=t;r--)this._array[this._getCyclicIndex(r+v.length)]=this._array[this._getCyclicIndex(r)];for(let r=0;r<v.length;r++)this._array[this._getCyclicIndex(t+r)]=v[r];if(v.length&&this.onInsertEmitter.fire({index:t,amount:v.length}),this._length+v.length>this._maxLength){let r=this._length+v.length-this._maxLength;this._startIndex+=r,this._length=this._maxLength,this.onTrimEmitter.fire(r)}else this._length+=v.length}trimStart(t){t>this._length&&(t=this._length),this._startIndex+=t,this._length-=t,this.onTrimEmitter.fire(t)}shiftElements(t,e,v){if(!(e<=0)){if(t<0||t>=this._length)throw new Error("start argument out of range");if(t+v<0)throw new Error("Cannot shift elements in list beyond index 0");if(v>0){for(let a=e-1;a>=0;a--)this.set(t+a+v,this.get(t+a));let r=t+e+v-this._length;if(r>0)for(this._length+=r;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let r=0;r<e;r++)this.set(t+r+v,this.get(t+r))}}_getCyclicIndex(t){return(this._startIndex+t)%this._maxLength}}s.CircularList=h},439:(p,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.clone=void 0,s.clone=function n(o,u=5){if(typeof o!="object")return o;let h=Array.isArray(o)?[]:{};for(let _ in o)h[_]=u<=1?o[_]:o[_]&&n(o[_],u-1);return h}},969:(p,s,n)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.CoreTerminal=void 0;let o=n(844),u=n(585),h=n(348),_=n(866),t=n(744),e=n(302),v=n(83),r=n(460),a=n(753),f=n(480),d=n(994),c=n(282),b=n(435),S=n(981),y=n(660),m=!1;class A extends o.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new r.EventEmitter),this._onScroll.event(M=>{this._onScrollApi?.fire(M.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(M){for(let E in M)this.optionsService.options[E]=M[E]}constructor(M){super(),this._windowsWrappingHeuristics=this.register(new o.MutableDisposable),this._onBinary=this.register(new r.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new r.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new r.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new r.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new r.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new r.EventEmitter),this._instantiationService=new h.InstantiationService,this.optionsService=this.register(new e.OptionsService(M)),this._instantiationService.setService(u.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(t.BufferService)),this._instantiationService.setService(u.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(_.LogService)),this._instantiationService.setService(u.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(v.CoreService)),this._instantiationService.setService(u.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(a.CoreMouseService)),this._instantiationService.setService(u.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(f.UnicodeService)),this._instantiationService.setService(u.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(d.CharsetService),this._instantiationService.setService(u.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(y.OscLinkService),this._instantiationService.setService(u.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new b.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,r.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,r.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,r.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,r.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom())),this.register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this.register(this._bufferService.onScroll(E=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this.register(this._inputHandler.onScroll(E=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this.register(new S.WriteBuffer((E,I)=>this._inputHandler.parse(E,I))),this.register((0,r.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(M,E){this._writeBuffer.write(M,E)}writeSync(M,E){this._logService.logLevel<=u.LogLevelEnum.WARN&&!m&&(this._logService.warn("writeSync is unreliable and will be removed soon."),m=!0),this._writeBuffer.writeSync(M,E)}input(M,E=!0){this.coreService.triggerDataEvent(M,E)}resize(M,E){isNaN(M)||isNaN(E)||(M=Math.max(M,t.MINIMUM_COLS),E=Math.max(E,t.MINIMUM_ROWS),this._bufferService.resize(M,E))}scroll(M,E=!1){this._bufferService.scroll(M,E)}scrollLines(M,E,I){this._bufferService.scrollLines(M,E,I)}scrollPages(M){this.scrollLines(M*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(M){let E=M-this._bufferService.buffer.ydisp;E!==0&&this.scrollLines(E)}registerEscHandler(M,E){return this._inputHandler.registerEscHandler(M,E)}registerDcsHandler(M,E){return this._inputHandler.registerDcsHandler(M,E)}registerCsiHandler(M,E){return this._inputHandler.registerCsiHandler(M,E)}registerOscHandler(M,E){return this._inputHandler.registerOscHandler(M,E)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let M=!1,E=this.optionsService.rawOptions.windowsPty;E&&E.buildNumber!==void 0&&E.buildNumber!==void 0?M=E.backend==="conpty"&&E.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(M=!0),M?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){let M=[];M.push(this.onLineFeed(c.updateWindowsModeWrappedState.bind(null,this._bufferService))),M.push(this.registerCsiHandler({final:"H"},()=>((0,c.updateWindowsModeWrappedState)(this._bufferService),!1))),this._windowsWrappingHeuristics.value=(0,o.toDisposable)(()=>{for(let E of M)E.dispose()})}}}s.CoreTerminal=A},460:(p,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.runAndSubscribe=s.forwardEvent=s.EventEmitter=void 0,s.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=n=>(this._listeners.push(n),{dispose:()=>{if(!this._disposed){for(let u=0;u<this._listeners.length;u++)if(this._listeners[u]===n)return void this._listeners.splice(u,1)}}})),this._event}fire(n,o){let u=[];for(let h=0;h<this._listeners.length;h++)u.push(this._listeners[h]);for(let h=0;h<u.length;h++)u[h].call(void 0,n,o)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},s.forwardEvent=function(n,o){return n(u=>o.fire(u))},s.runAndSubscribe=function(n,o){return o(void 0),n(u=>o(u))}},435:function(p,s,n){var o=this&&this.__decorate||function($,L,R,k){var B,N=arguments.length,W=N<3?L:k===null?k=Object.getOwnPropertyDescriptor(L,R):k;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")W=Reflect.decorate($,L,R,k);else for(var q=$.length-1;q>=0;q--)(B=$[q])&&(W=(N<3?B(W):N>3?B(L,R,W):B(L,R))||W);return N>3&&W&&Object.defineProperty(L,R,W),W},u=this&&this.__param||function($,L){return function(R,k){L(R,k,$)}};Object.defineProperty(s,"__esModule",{value:!0}),s.InputHandler=s.WindowsOptionsReportType=void 0;let h=n(584),_=n(116),t=n(15),e=n(844),v=n(482),r=n(437),a=n(460),f=n(643),d=n(511),c=n(734),b=n(585),S=n(480),y=n(242),m=n(351),A=n(941),x={"(":0,")":1,"*":2,"+":3,"-":1,".":2},M=131072;function E($,L){if($>24)return L.setWinLines||!1;switch($){case 1:return!!L.restoreWin;case 2:return!!L.minimizeWin;case 3:return!!L.setWinPosition;case 4:return!!L.setWinSizePixels;case 5:return!!L.raiseWin;case 6:return!!L.lowerWin;case 7:return!!L.refreshWin;case 8:return!!L.setWinSizeChars;case 9:return!!L.maximizeWin;case 10:return!!L.fullscreenWin;case 11:return!!L.getWinState;case 13:return!!L.getWinPosition;case 14:return!!L.getWinSizePixels;case 15:return!!L.getScreenSizePixels;case 16:return!!L.getCellSizePixels;case 18:return!!L.getWinSizeChars;case 19:return!!L.getScreenSizeChars;case 20:return!!L.getIconTitle;case 21:return!!L.getWinTitle;case 22:return!!L.pushTitle;case 23:return!!L.popTitle;case 24:return!!L.setWinLines}return!1}var I;(function($){$[$.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",$[$.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(I||(s.WindowsOptionsReportType=I={}));let F=0;class O extends e.Disposable{getAttrData(){return this._curAttrData}constructor(L,R,k,B,N,W,q,J,Q=new t.EscapeSequenceParser){super(),this._bufferService=L,this._charsetService=R,this._coreService=k,this._logService=B,this._optionsService=N,this._oscLinkService=W,this._coreMouseService=q,this._unicodeService=J,this._parser=Q,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new v.StringToUtf32,this._utf8Decoder=new v.Utf8ToUtf32,this._workCell=new d.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=r.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=r.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new a.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new a.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new a.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new a.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new a.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new a.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new a.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new a.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new a.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new a.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new a.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new a.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new a.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new P(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(D=>this._activeBuffer=D.activeBuffer)),this._parser.setCsiHandlerFallback((D,se)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(D),params:se.toArray()})}),this._parser.setEscHandlerFallback(D=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(D)})}),this._parser.setExecuteHandlerFallback(D=>{this._logService.debug("Unknown EXECUTE code: ",{code:D})}),this._parser.setOscHandlerFallback((D,se,K)=>{this._logService.debug("Unknown OSC code: ",{identifier:D,action:se,data:K})}),this._parser.setDcsHandlerFallback((D,se,K)=>{se==="HOOK"&&(K=K.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(D),action:se,payload:K})}),this._parser.setPrintHandler((D,se,K)=>this.print(D,se,K)),this._parser.registerCsiHandler({final:"@"},D=>this.insertChars(D)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},D=>this.scrollLeft(D)),this._parser.registerCsiHandler({final:"A"},D=>this.cursorUp(D)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},D=>this.scrollRight(D)),this._parser.registerCsiHandler({final:"B"},D=>this.cursorDown(D)),this._parser.registerCsiHandler({final:"C"},D=>this.cursorForward(D)),this._parser.registerCsiHandler({final:"D"},D=>this.cursorBackward(D)),this._parser.registerCsiHandler({final:"E"},D=>this.cursorNextLine(D)),this._parser.registerCsiHandler({final:"F"},D=>this.cursorPrecedingLine(D)),this._parser.registerCsiHandler({final:"G"},D=>this.cursorCharAbsolute(D)),this._parser.registerCsiHandler({final:"H"},D=>this.cursorPosition(D)),this._parser.registerCsiHandler({final:"I"},D=>this.cursorForwardTab(D)),this._parser.registerCsiHandler({final:"J"},D=>this.eraseInDisplay(D,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},D=>this.eraseInDisplay(D,!0)),this._parser.registerCsiHandler({final:"K"},D=>this.eraseInLine(D,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},D=>this.eraseInLine(D,!0)),this._parser.registerCsiHandler({final:"L"},D=>this.insertLines(D)),this._parser.registerCsiHandler({final:"M"},D=>this.deleteLines(D)),this._parser.registerCsiHandler({final:"P"},D=>this.deleteChars(D)),this._parser.registerCsiHandler({final:"S"},D=>this.scrollUp(D)),this._parser.registerCsiHandler({final:"T"},D=>this.scrollDown(D)),this._parser.registerCsiHandler({final:"X"},D=>this.eraseChars(D)),this._parser.registerCsiHandler({final:"Z"},D=>this.cursorBackwardTab(D)),this._parser.registerCsiHandler({final:"`"},D=>this.charPosAbsolute(D)),this._parser.registerCsiHandler({final:"a"},D=>this.hPositionRelative(D)),this._parser.registerCsiHandler({final:"b"},D=>this.repeatPrecedingCharacter(D)),this._parser.registerCsiHandler({final:"c"},D=>this.sendDeviceAttributesPrimary(D)),this._parser.registerCsiHandler({prefix:">",final:"c"},D=>this.sendDeviceAttributesSecondary(D)),this._parser.registerCsiHandler({final:"d"},D=>this.linePosAbsolute(D)),this._parser.registerCsiHandler({final:"e"},D=>this.vPositionRelative(D)),this._parser.registerCsiHandler({final:"f"},D=>this.hVPosition(D)),this._parser.registerCsiHandler({final:"g"},D=>this.tabClear(D)),this._parser.registerCsiHandler({final:"h"},D=>this.setMode(D)),this._parser.registerCsiHandler({prefix:"?",final:"h"},D=>this.setModePrivate(D)),this._parser.registerCsiHandler({final:"l"},D=>this.resetMode(D)),this._parser.registerCsiHandler({prefix:"?",final:"l"},D=>this.resetModePrivate(D)),this._parser.registerCsiHandler({final:"m"},D=>this.charAttributes(D)),this._parser.registerCsiHandler({final:"n"},D=>this.deviceStatus(D)),this._parser.registerCsiHandler({prefix:"?",final:"n"},D=>this.deviceStatusPrivate(D)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},D=>this.softReset(D)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},D=>this.setCursorStyle(D)),this._parser.registerCsiHandler({final:"r"},D=>this.setScrollRegion(D)),this._parser.registerCsiHandler({final:"s"},D=>this.saveCursor(D)),this._parser.registerCsiHandler({final:"t"},D=>this.windowOptions(D)),this._parser.registerCsiHandler({final:"u"},D=>this.restoreCursor(D)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},D=>this.insertColumns(D)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},D=>this.deleteColumns(D)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},D=>this.selectProtected(D)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},D=>this.requestMode(D,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},D=>this.requestMode(D,!1)),this._parser.setExecuteHandler(h.C0.BEL,()=>this.bell()),this._parser.setExecuteHandler(h.C0.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(h.C0.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(h.C0.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(h.C0.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(h.C0.BS,()=>this.backspace()),this._parser.setExecuteHandler(h.C0.HT,()=>this.tab()),this._parser.setExecuteHandler(h.C0.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(h.C0.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(h.C1.IND,()=>this.index()),this._parser.setExecuteHandler(h.C1.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(h.C1.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new y.OscHandler(D=>(this.setTitle(D),this.setIconName(D),!0))),this._parser.registerOscHandler(1,new y.OscHandler(D=>this.setIconName(D))),this._parser.registerOscHandler(2,new y.OscHandler(D=>this.setTitle(D))),this._parser.registerOscHandler(4,new y.OscHandler(D=>this.setOrReportIndexedColor(D))),this._parser.registerOscHandler(8,new y.OscHandler(D=>this.setHyperlink(D))),this._parser.registerOscHandler(10,new y.OscHandler(D=>this.setOrReportFgColor(D))),this._parser.registerOscHandler(11,new y.OscHandler(D=>this.setOrReportBgColor(D))),this._parser.registerOscHandler(12,new y.OscHandler(D=>this.setOrReportCursorColor(D))),this._parser.registerOscHandler(104,new y.OscHandler(D=>this.restoreIndexedColor(D))),this._parser.registerOscHandler(110,new y.OscHandler(D=>this.restoreFgColor(D))),this._parser.registerOscHandler(111,new y.OscHandler(D=>this.restoreBgColor(D))),this._parser.registerOscHandler(112,new y.OscHandler(D=>this.restoreCursorColor(D))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(let D in _.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:D},()=>this.selectCharset("("+D)),this._parser.registerEscHandler({intermediates:")",final:D},()=>this.selectCharset(")"+D)),this._parser.registerEscHandler({intermediates:"*",final:D},()=>this.selectCharset("*"+D)),this._parser.registerEscHandler({intermediates:"+",final:D},()=>this.selectCharset("+"+D)),this._parser.registerEscHandler({intermediates:"-",final:D},()=>this.selectCharset("-"+D)),this._parser.registerEscHandler({intermediates:".",final:D},()=>this.selectCharset("."+D)),this._parser.registerEscHandler({intermediates:"/",final:D},()=>this.selectCharset("/"+D));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(D=>(this._logService.error("Parsing error: ",D),D)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new m.DcsHandler((D,se)=>this.requestStatusString(D,se)))}_preserveStack(L,R,k,B){this._parseStack.paused=!0,this._parseStack.cursorStartX=L,this._parseStack.cursorStartY=R,this._parseStack.decodedLength=k,this._parseStack.position=B}_logSlowResolvingAsync(L){this._logService.logLevel<=b.LogLevelEnum.WARN&&Promise.race([L,new Promise((R,k)=>setTimeout(()=>k("#SLOW_TIMEOUT"),5e3))]).catch(R=>{if(R!=="#SLOW_TIMEOUT")throw R;console.warn("async parser handler taking longer than 5000 ms")})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(L,R){let k,B=this._activeBuffer.x,N=this._activeBuffer.y,W=0,q=this._parseStack.paused;if(q){if(k=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,R))return this._logSlowResolvingAsync(k),k;B=this._parseStack.cursorStartX,N=this._parseStack.cursorStartY,this._parseStack.paused=!1,L.length>M&&(W=this._parseStack.position+M)}if(this._logService.logLevel<=b.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof L=="string"?` "${L}"`:` "${Array.prototype.map.call(L,D=>String.fromCharCode(D)).join("")}"`),typeof L=="string"?L.split("").map(D=>D.charCodeAt(0)):L),this._parseBuffer.length<L.length&&this._parseBuffer.length<M&&(this._parseBuffer=new Uint32Array(Math.min(L.length,M))),q||this._dirtyRowTracker.clearRange(),L.length>M)for(let D=W;D<L.length;D+=M){let se=D+M<L.length?D+M:L.length,K=typeof L=="string"?this._stringDecoder.decode(L.substring(D,se),this._parseBuffer):this._utf8Decoder.decode(L.subarray(D,se),this._parseBuffer);if(k=this._parser.parse(this._parseBuffer,K))return this._preserveStack(B,N,K,D),this._logSlowResolvingAsync(k),k}else if(!q){let D=typeof L=="string"?this._stringDecoder.decode(L,this._parseBuffer):this._utf8Decoder.decode(L,this._parseBuffer);if(k=this._parser.parse(this._parseBuffer,D))return this._preserveStack(B,N,D,0),this._logSlowResolvingAsync(k),k}this._activeBuffer.x===B&&this._activeBuffer.y===N||this._onCursorMove.fire();let J=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),Q=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);Q<this._bufferService.rows&&this._onRequestRefreshRows.fire(Math.min(Q,this._bufferService.rows-1),Math.min(J,this._bufferService.rows-1))}print(L,R,k){let B,N,W=this._charsetService.charset,q=this._optionsService.rawOptions.screenReaderMode,J=this._bufferService.cols,Q=this._coreService.decPrivateModes.wraparound,D=this._coreService.modes.insertMode,se=this._curAttrData,K=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&k-R>0&&K.getWidth(this._activeBuffer.x-1)===2&&K.setCellFromCodepoint(this._activeBuffer.x-1,0,1,se);let Z=this._parser.precedingJoinState;for(let V=R;V<k;++V){if(B=L[V],B<127&&W){let ge=W[String.fromCharCode(B)];ge&&(B=ge.charCodeAt(0))}let ue=this._unicodeService.charProperties(B,Z);N=S.UnicodeService.extractWidth(ue);let pe=S.UnicodeService.extractShouldJoin(ue),fe=pe?S.UnicodeService.extractWidth(Z):0;if(Z=ue,q&&this._onA11yChar.fire((0,v.stringFromCodePoint)(B)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+N-fe>J){if(Q){let ge=K,we=this._activeBuffer.x-fe;for(this._activeBuffer.x=fe,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),K=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),fe>0&&K instanceof r.BufferLine&&K.copyCellsFrom(ge,we,0,fe,!1);we<J;)ge.setCellFromCodepoint(we++,0,1,se)}else if(this._activeBuffer.x=J-1,N===2)continue}if(pe&&this._activeBuffer.x){let ge=K.getWidth(this._activeBuffer.x-1)?1:2;K.addCodepointToCell(this._activeBuffer.x-ge,B,N);for(let we=N-fe;--we>=0;)K.setCellFromCodepoint(this._activeBuffer.x++,0,0,se)}else if(D&&(K.insertCells(this._activeBuffer.x,N-fe,this._activeBuffer.getNullCell(se)),K.getWidth(J-1)===2&&K.setCellFromCodepoint(J-1,f.NULL_CELL_CODE,f.NULL_CELL_WIDTH,se)),K.setCellFromCodepoint(this._activeBuffer.x++,B,N,se),N>0)for(;--N;)K.setCellFromCodepoint(this._activeBuffer.x++,0,0,se)}this._parser.precedingJoinState=Z,this._activeBuffer.x<J&&k-R>0&&K.getWidth(this._activeBuffer.x)===0&&!K.hasContent(this._activeBuffer.x)&&K.setCellFromCodepoint(this._activeBuffer.x,0,1,se),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(L,R){return L.final!=="t"||L.prefix||L.intermediates?this._parser.registerCsiHandler(L,R):this._parser.registerCsiHandler(L,k=>!E(k.params[0],this._optionsService.rawOptions.windowOptions)||R(k))}registerDcsHandler(L,R){return this._parser.registerDcsHandler(L,new m.DcsHandler(R))}registerEscHandler(L,R){return this._parser.registerEscHandler(L,R)}registerOscHandler(L,R){return this._parser.registerOscHandler(L,new y.OscHandler(R))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)?.isWrapped){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;let L=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);L.hasWidth(this._activeBuffer.x)&&!L.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let L=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-L),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(L=this._bufferService.cols-1){this._activeBuffer.x=Math.min(L,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(L,R){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=L,this._activeBuffer.y=this._activeBuffer.scrollTop+R):(this._activeBuffer.x=L,this._activeBuffer.y=R),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(L,R){this._restrictCursor(),this._setCursor(this._activeBuffer.x+L,this._activeBuffer.y+R)}cursorUp(L){let R=this._activeBuffer.y-this._activeBuffer.scrollTop;return R>=0?this._moveCursor(0,-Math.min(R,L.params[0]||1)):this._moveCursor(0,-(L.params[0]||1)),!0}cursorDown(L){let R=this._activeBuffer.scrollBottom-this._activeBuffer.y;return R>=0?this._moveCursor(0,Math.min(R,L.params[0]||1)):this._moveCursor(0,L.params[0]||1),!0}cursorForward(L){return this._moveCursor(L.params[0]||1,0),!0}cursorBackward(L){return this._moveCursor(-(L.params[0]||1),0),!0}cursorNextLine(L){return this.cursorDown(L),this._activeBuffer.x=0,!0}cursorPrecedingLine(L){return this.cursorUp(L),this._activeBuffer.x=0,!0}cursorCharAbsolute(L){return this._setCursor((L.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(L){return this._setCursor(L.length>=2?(L.params[1]||1)-1:0,(L.params[0]||1)-1),!0}charPosAbsolute(L){return this._setCursor((L.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(L){return this._moveCursor(L.params[0]||1,0),!0}linePosAbsolute(L){return this._setCursor(this._activeBuffer.x,(L.params[0]||1)-1),!0}vPositionRelative(L){return this._moveCursor(0,L.params[0]||1),!0}hVPosition(L){return this.cursorPosition(L),!0}tabClear(L){let R=L.params[0];return R===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:R===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(L){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let R=L.params[0]||1;for(;R--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(L){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let R=L.params[0]||1;for(;R--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(L){let R=L.params[0];return R===1&&(this._curAttrData.bg|=536870912),R!==2&&R!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(L,R,k,B=!1,N=!1){let W=this._activeBuffer.lines.get(this._activeBuffer.ybase+L);W.replaceCells(R,k,this._activeBuffer.getNullCell(this._eraseAttrData()),N),B&&(W.isWrapped=!1)}_resetBufferLine(L,R=!1){let k=this._activeBuffer.lines.get(this._activeBuffer.ybase+L);k&&(k.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),R),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+L),k.isWrapped=!1)}eraseInDisplay(L,R=!1){let k;switch(this._restrictCursor(this._bufferService.cols),L.params[0]){case 0:for(k=this._activeBuffer.y,this._dirtyRowTracker.markDirty(k),this._eraseInBufferLine(k++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,R);k<this._bufferService.rows;k++)this._resetBufferLine(k,R);this._dirtyRowTracker.markDirty(k);break;case 1:for(k=this._activeBuffer.y,this._dirtyRowTracker.markDirty(k),this._eraseInBufferLine(k,0,this._activeBuffer.x+1,!0,R),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(k+1).isWrapped=!1);k--;)this._resetBufferLine(k,R);this._dirtyRowTracker.markDirty(0);break;case 2:for(k=this._bufferService.rows,this._dirtyRowTracker.markDirty(k-1);k--;)this._resetBufferLine(k,R);this._dirtyRowTracker.markDirty(0);break;case 3:let B=this._activeBuffer.lines.length-this._bufferService.rows;B>0&&(this._activeBuffer.lines.trimStart(B),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-B,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-B,0),this._onScroll.fire(0))}return!0}eraseInLine(L,R=!1){switch(this._restrictCursor(this._bufferService.cols),L.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,R);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,R);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,R)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(L){this._restrictCursor();let R=L.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let k=this._activeBuffer.ybase+this._activeBuffer.y,B=this._bufferService.rows-1-this._activeBuffer.scrollBottom,N=this._bufferService.rows-1+this._activeBuffer.ybase-B+1;for(;R--;)this._activeBuffer.lines.splice(N-1,1),this._activeBuffer.lines.splice(k,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(L){this._restrictCursor();let R=L.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let k=this._activeBuffer.ybase+this._activeBuffer.y,B;for(B=this._bufferService.rows-1-this._activeBuffer.scrollBottom,B=this._bufferService.rows-1+this._activeBuffer.ybase-B;R--;)this._activeBuffer.lines.splice(k,1),this._activeBuffer.lines.splice(B,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(L){this._restrictCursor();let R=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return R&&(R.insertCells(this._activeBuffer.x,L.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(L){this._restrictCursor();let R=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return R&&(R.deleteCells(this._activeBuffer.x,L.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(L){let R=L.params[0]||1;for(;R--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(L){let R=L.params[0]||1;for(;R--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(r.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(L){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let R=L.params[0]||1;for(let k=this._activeBuffer.scrollTop;k<=this._activeBuffer.scrollBottom;++k){let B=this._activeBuffer.lines.get(this._activeBuffer.ybase+k);B.deleteCells(0,R,this._activeBuffer.getNullCell(this._eraseAttrData())),B.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(L){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let R=L.params[0]||1;for(let k=this._activeBuffer.scrollTop;k<=this._activeBuffer.scrollBottom;++k){let B=this._activeBuffer.lines.get(this._activeBuffer.ybase+k);B.insertCells(0,R,this._activeBuffer.getNullCell(this._eraseAttrData())),B.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(L){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let R=L.params[0]||1;for(let k=this._activeBuffer.scrollTop;k<=this._activeBuffer.scrollBottom;++k){let B=this._activeBuffer.lines.get(this._activeBuffer.ybase+k);B.insertCells(this._activeBuffer.x,R,this._activeBuffer.getNullCell(this._eraseAttrData())),B.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(L){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let R=L.params[0]||1;for(let k=this._activeBuffer.scrollTop;k<=this._activeBuffer.scrollBottom;++k){let B=this._activeBuffer.lines.get(this._activeBuffer.ybase+k);B.deleteCells(this._activeBuffer.x,R,this._activeBuffer.getNullCell(this._eraseAttrData())),B.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(L){this._restrictCursor();let R=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return R&&(R.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(L.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(L){let R=this._parser.precedingJoinState;if(!R)return!0;let k=L.params[0]||1,B=S.UnicodeService.extractWidth(R),N=this._activeBuffer.x-B,W=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(N),q=new Uint32Array(W.length*k),J=0;for(let D=0;D<W.length;){let se=W.codePointAt(D)||0;q[J++]=se,D+=se>65535?2:1}let Q=J;for(let D=1;D<k;++D)q.copyWithin(Q,0,J),Q+=J;return this.print(q,0,Q),!0}sendDeviceAttributesPrimary(L){return L.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(h.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(h.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(L){return L.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(h.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(h.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(L.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(h.C0.ESC+"[>83;40003;0c")),!0}_is(L){return(this._optionsService.rawOptions.termName+"").indexOf(L)===0}setMode(L){for(let R=0;R<L.length;R++)switch(L.params[R]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(L){for(let R=0;R<L.length;R++)switch(L.params[R]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,_.DEFAULT_CHARSET),this._charsetService.setgCharset(1,_.DEFAULT_CHARSET),this._charsetService.setgCharset(2,_.DEFAULT_CHARSET),this._charsetService.setgCharset(3,_.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(L){for(let R=0;R<L.length;R++)switch(L.params[R]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(L){for(let R=0;R<L.length;R++)switch(L.params[R]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),L.params[R]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(L,R){let k=this._coreService.decPrivateModes,{activeProtocol:B,activeEncoding:N}=this._coreMouseService,W=this._coreService,{buffers:q,cols:J}=this._bufferService,{active:Q,alt:D}=q,se=this._optionsService.rawOptions,K=pe=>pe?1:2,Z=L.params[0];return V=Z,ue=R?Z===2?4:Z===4?K(W.modes.insertMode):Z===12?3:Z===20?K(se.convertEol):0:Z===1?K(k.applicationCursorKeys):Z===3?se.windowOptions.setWinLines?J===80?2:J===132?1:0:0:Z===6?K(k.origin):Z===7?K(k.wraparound):Z===8?3:Z===9?K(B==="X10"):Z===12?K(se.cursorBlink):Z===25?K(!W.isCursorHidden):Z===45?K(k.reverseWraparound):Z===66?K(k.applicationKeypad):Z===67?4:Z===1e3?K(B==="VT200"):Z===1002?K(B==="DRAG"):Z===1003?K(B==="ANY"):Z===1004?K(k.sendFocus):Z===1005?4:Z===1006?K(N==="SGR"):Z===1015?4:Z===1016?K(N==="SGR_PIXELS"):Z===1048?1:Z===47||Z===1047||Z===1049?K(Q===D):Z===2004?K(k.bracketedPasteMode):0,W.triggerDataEvent(`${h.C0.ESC}[${R?"":"?"}${V};${ue}$y`),!0;var V,ue}_updateAttrColor(L,R,k,B,N){return R===2?(L|=50331648,L&=-16777216,L|=c.AttributeData.fromColorRGB([k,B,N])):R===5&&(L&=-50331904,L|=33554432|255&k),L}_extractColor(L,R,k){let B=[0,0,-1,0,0,0],N=0,W=0;do{if(B[W+N]=L.params[R+W],L.hasSubParams(R+W)){let q=L.getSubParams(R+W),J=0;do B[1]===5&&(N=1),B[W+J+1+N]=q[J];while(++J<q.length&&J+W+1+N<B.length);break}if(B[1]===5&&W+N>=2||B[1]===2&&W+N>=5)break;B[1]&&(N=1)}while(++W+R<L.length&&W+N<B.length);for(let q=2;q<B.length;++q)B[q]===-1&&(B[q]=0);switch(B[0]){case 38:k.fg=this._updateAttrColor(k.fg,B[1],B[3],B[4],B[5]);break;case 48:k.bg=this._updateAttrColor(k.bg,B[1],B[3],B[4],B[5]);break;case 58:k.extended=k.extended.clone(),k.extended.underlineColor=this._updateAttrColor(k.extended.underlineColor,B[1],B[3],B[4],B[5])}return W}_processUnderline(L,R){R.extended=R.extended.clone(),(!~L||L>5)&&(L=1),R.extended.underlineStyle=L,R.fg|=268435456,L===0&&(R.fg&=-268435457),R.updateExtended()}_processSGR0(L){L.fg=r.DEFAULT_ATTR_DATA.fg,L.bg=r.DEFAULT_ATTR_DATA.bg,L.extended=L.extended.clone(),L.extended.underlineStyle=0,L.extended.underlineColor&=-67108864,L.updateExtended()}charAttributes(L){if(L.length===1&&L.params[0]===0)return this._processSGR0(this._curAttrData),!0;let R=L.length,k,B=this._curAttrData;for(let N=0;N<R;N++)k=L.params[N],k>=30&&k<=37?(B.fg&=-50331904,B.fg|=16777216|k-30):k>=40&&k<=47?(B.bg&=-50331904,B.bg|=16777216|k-40):k>=90&&k<=97?(B.fg&=-50331904,B.fg|=16777224|k-90):k>=100&&k<=107?(B.bg&=-50331904,B.bg|=16777224|k-100):k===0?this._processSGR0(B):k===1?B.fg|=134217728:k===3?B.bg|=67108864:k===4?(B.fg|=268435456,this._processUnderline(L.hasSubParams(N)?L.getSubParams(N)[0]:1,B)):k===5?B.fg|=536870912:k===7?B.fg|=67108864:k===8?B.fg|=1073741824:k===9?B.fg|=2147483648:k===2?B.bg|=134217728:k===21?this._processUnderline(2,B):k===22?(B.fg&=-134217729,B.bg&=-134217729):k===23?B.bg&=-67108865:k===24?(B.fg&=-268435457,this._processUnderline(0,B)):k===25?B.fg&=-536870913:k===27?B.fg&=-67108865:k===28?B.fg&=-1073741825:k===29?B.fg&=2147483647:k===39?(B.fg&=-67108864,B.fg|=16777215&r.DEFAULT_ATTR_DATA.fg):k===49?(B.bg&=-67108864,B.bg|=16777215&r.DEFAULT_ATTR_DATA.bg):k===38||k===48||k===58?N+=this._extractColor(L,N,B):k===53?B.bg|=1073741824:k===55?B.bg&=-1073741825:k===59?(B.extended=B.extended.clone(),B.extended.underlineColor=-1,B.updateExtended()):k===100?(B.fg&=-67108864,B.fg|=16777215&r.DEFAULT_ATTR_DATA.fg,B.bg&=-67108864,B.bg|=16777215&r.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",k);return!0}deviceStatus(L){switch(L.params[0]){case 5:this._coreService.triggerDataEvent(`${h.C0.ESC}[0n`);break;case 6:let R=this._activeBuffer.y+1,k=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${h.C0.ESC}[${R};${k}R`)}return!0}deviceStatusPrivate(L){if(L.params[0]===6){let R=this._activeBuffer.y+1,k=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${h.C0.ESC}[?${R};${k}R`)}return!0}softReset(L){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=r.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(L){let R=L.params[0]||1;switch(R){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}let k=R%2==1;return this._optionsService.options.cursorBlink=k,!0}setScrollRegion(L){let R=L.params[0]||1,k;return(L.length<2||(k=L.params[1])>this._bufferService.rows||k===0)&&(k=this._bufferService.rows),k>R&&(this._activeBuffer.scrollTop=R-1,this._activeBuffer.scrollBottom=k-1,this._setCursor(0,0)),!0}windowOptions(L){if(!E(L.params[0],this._optionsService.rawOptions.windowOptions))return!0;let R=L.length>1?L.params[1]:0;switch(L.params[0]){case 14:R!==2&&this._onRequestWindowsOptionsReport.fire(I.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(I.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${h.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:R!==0&&R!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),R!==0&&R!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:R!==0&&R!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),R!==0&&R!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(L){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(L){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(L){return this._windowTitle=L,this._onTitleChange.fire(L),!0}setIconName(L){return this._iconName=L,!0}setOrReportIndexedColor(L){let R=[],k=L.split(";");for(;k.length>1;){let B=k.shift(),N=k.shift();if(/^\d+$/.exec(B)){let W=parseInt(B);if(H(W))if(N==="?")R.push({type:0,index:W});else{let q=(0,A.parseColor)(N);q&&R.push({type:1,index:W,color:q})}}}return R.length&&this._onColor.fire(R),!0}setHyperlink(L){let R=L.split(";");return!(R.length<2)&&(R[1]?this._createHyperlink(R[0],R[1]):!R[0]&&this._finishHyperlink())}_createHyperlink(L,R){this._getCurrentLinkId()&&this._finishHyperlink();let k=L.split(":"),B,N=k.findIndex(W=>W.startsWith("id="));return N!==-1&&(B=k[N].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:B,uri:R}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(L,R){let k=L.split(";");for(let B=0;B<k.length&&!(R>=this._specialColors.length);++B,++R)if(k[B]==="?")this._onColor.fire([{type:0,index:this._specialColors[R]}]);else{let N=(0,A.parseColor)(k[B]);N&&this._onColor.fire([{type:1,index:this._specialColors[R],color:N}])}return!0}setOrReportFgColor(L){return this._setOrReportSpecialColor(L,0)}setOrReportBgColor(L){return this._setOrReportSpecialColor(L,1)}setOrReportCursorColor(L){return this._setOrReportSpecialColor(L,2)}restoreIndexedColor(L){if(!L)return this._onColor.fire([{type:2}]),!0;let R=[],k=L.split(";");for(let B=0;B<k.length;++B)if(/^\d+$/.exec(k[B])){let N=parseInt(k[B]);H(N)&&R.push({type:2,index:N})}return R.length&&this._onColor.fire(R),!0}restoreFgColor(L){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(L){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(L){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,_.DEFAULT_CHARSET),!0}selectCharset(L){return L.length!==2?(this.selectDefaultCharset(),!0):(L[0]==="/"||this._charsetService.setgCharset(x[L[0]],_.CHARSETS[L[1]]||_.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){let L=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,L,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=r.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=r.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(L){return this._charsetService.setgLevel(L),!0}screenAlignmentPattern(){let L=new d.CellData;L.content=4194373,L.fg=this._curAttrData.fg,L.bg=this._curAttrData.bg,this._setCursor(0,0);for(let R=0;R<this._bufferService.rows;++R){let k=this._activeBuffer.ybase+this._activeBuffer.y+R,B=this._activeBuffer.lines.get(k);B&&(B.fill(L),B.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(L,R){let k=this._bufferService.buffer,B=this._optionsService.rawOptions;return(N=>(this._coreService.triggerDataEvent(`${h.C0.ESC}${N}${h.C0.ESC}\\`),!0))(L==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:L==='"p'?'P1$r61;1"p':L==="r"?`P1$r${k.scrollTop+1};${k.scrollBottom+1}r`:L==="m"?"P1$r0m":L===" q"?`P1$r${{block:2,underline:4,bar:6}[B.cursorStyle]-(B.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(L,R){this._dirtyRowTracker.markRangeDirty(L,R)}}s.InputHandler=O;let P=class{constructor($){this._bufferService=$,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty($){$<this.start?this.start=$:$>this.end&&(this.end=$)}markRangeDirty($,L){$>L&&(F=$,$=L,L=F),$<this.start&&(this.start=$),L>this.end&&(this.end=L)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function H($){return 0<=$&&$<256}P=o([u(0,b.IBufferService)],P)},844:(p,s)=>{function n(o){for(let u of o)u.dispose();o.length=0}Object.defineProperty(s,"__esModule",{value:!0}),s.getDisposeArrayDisposable=s.disposeArray=s.toDisposable=s.MutableDisposable=s.Disposable=void 0,s.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(let o of this._disposables)o.dispose();this._disposables.length=0}register(o){return this._disposables.push(o),o}unregister(o){let u=this._disposables.indexOf(o);u!==-1&&this._disposables.splice(u,1)}},s.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(o){this._isDisposed||o===this._value||(this._value?.dispose(),this._value=o)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}},s.toDisposable=function(o){return{dispose:o}},s.disposeArray=n,s.getDisposeArrayDisposable=function(o){return{dispose:()=>n(o)}}},114:(p,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.isChromeOS=s.isLinux=s.isWindows=s.isIphone=s.isIpad=s.isMac=s.getSafariVersion=s.isSafari=s.isLegacyEdge=s.isFirefox=s.isNode=void 0,s.isNode=typeof process<"u"&&"title"in process;let n=s.isNode?"node":navigator.userAgent,o=s.isNode?"node":navigator.platform;s.isFirefox=n.includes("Firefox"),s.isLegacyEdge=n.includes("Edge"),s.isSafari=/^((?!chrome|android).)*safari/i.test(n),s.getSafariVersion=function(){if(!s.isSafari)return 0;let u=n.match(/Version\/(\d+)/);return u===null||u.length<2?0:parseInt(u[1])},s.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(o),s.isIpad=o==="iPad",s.isIphone=o==="iPhone",s.isWindows=["Windows","Win16","Win32","WinCE"].includes(o),s.isLinux=o.indexOf("Linux")>=0,s.isChromeOS=/\bCrOS\b/.test(n)},226:(p,s,n)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.DebouncedIdleTask=s.IdleTaskQueue=s.PriorityTaskQueue=void 0;let o=n(114);class u{constructor(){this._tasks=[],this._i=0}enqueue(t){this._tasks.push(t),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(t){this._idleCallback=void 0;let e=0,v=0,r=t.timeRemaining(),a=0;for(;this._i<this._tasks.length;){if(e=Date.now(),this._tasks[this._i]()||this._i++,e=Math.max(1,Date.now()-e),v=Math.max(e,v),a=t.timeRemaining(),1.5*v>a)return r-e<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(r-e))}ms`),void this._start();r=a}this.clear()}}class h extends u{_requestCallback(t){return setTimeout(()=>t(this._createDeadline(16)))}_cancelCallback(t){clearTimeout(t)}_createDeadline(t){let e=Date.now()+t;return{timeRemaining:()=>Math.max(0,e-Date.now())}}}s.PriorityTaskQueue=h,s.IdleTaskQueue=!o.isNode&&"requestIdleCallback"in window?class extends u{_requestCallback(_){return requestIdleCallback(_)}_cancelCallback(_){cancelIdleCallback(_)}}:h,s.DebouncedIdleTask=class{constructor(){this._queue=new s.IdleTaskQueue}set(_){this._queue.clear(),this._queue.enqueue(_)}flush(){this._queue.flush()}}},282:(p,s,n)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.updateWindowsModeWrappedState=void 0;let o=n(643);s.updateWindowsModeWrappedState=function(u){let h=u.buffer.lines.get(u.buffer.ybase+u.buffer.y-1),_=h?.get(u.cols-1),t=u.buffer.lines.get(u.buffer.ybase+u.buffer.y);t&&_&&(t.isWrapped=_[o.CHAR_DATA_CODE_INDEX]!==o.NULL_CELL_CODE&&_[o.CHAR_DATA_CODE_INDEX]!==o.WHITESPACE_CELL_CODE)}},734:(p,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.ExtendedAttrs=s.AttributeData=void 0;class n{constructor(){this.fg=0,this.bg=0,this.extended=new o}static toColorRGB(h){return[h>>>16&255,h>>>8&255,255&h]}static fromColorRGB(h){return(255&h[0])<<16|(255&h[1])<<8|255&h[2]}clone(){let h=new n;return h.fg=this.fg,h.bg=this.bg,h.extended=this.extended.clone(),h}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}s.AttributeData=n;class o{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(h){this._ext=h}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(h){this._ext&=-469762049,this._ext|=h<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(h){this._ext&=-67108864,this._ext|=67108863&h}get urlId(){return this._urlId}set urlId(h){this._urlId=h}get underlineVariantOffset(){let h=(3758096384&this._ext)>>29;return h<0?4294967288^h:h}set underlineVariantOffset(h){this._ext&=536870911,this._ext|=h<<29&3758096384}constructor(h=0,_=0){this._ext=0,this._urlId=0,this._ext=h,this._urlId=_}clone(){return new o(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}s.ExtendedAttrs=o},92:(p,s,n)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.Buffer=s.MAX_BUFFER_SIZE=void 0;let o=n(349),u=n(226),h=n(734),_=n(437),t=n(634),e=n(511),v=n(643),r=n(863),a=n(116);s.MAX_BUFFER_SIZE=4294967295,s.Buffer=class{constructor(f,d,c){this._hasScrollback=f,this._optionsService=d,this._bufferService=c,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=_.DEFAULT_ATTR_DATA.clone(),this.savedCharset=a.DEFAULT_CHARSET,this.markers=[],this._nullCell=e.CellData.fromCharData([0,v.NULL_CELL_CHAR,v.NULL_CELL_WIDTH,v.NULL_CELL_CODE]),this._whitespaceCell=e.CellData.fromCharData([0,v.WHITESPACE_CELL_CHAR,v.WHITESPACE_CELL_WIDTH,v.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new u.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new o.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(f){return f?(this._nullCell.fg=f.fg,this._nullCell.bg=f.bg,this._nullCell.extended=f.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new h.ExtendedAttrs),this._nullCell}getWhitespaceCell(f){return f?(this._whitespaceCell.fg=f.fg,this._whitespaceCell.bg=f.bg,this._whitespaceCell.extended=f.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new h.ExtendedAttrs),this._whitespaceCell}getBlankLine(f,d){return new _.BufferLine(this._bufferService.cols,this.getNullCell(f),d)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){let f=this.ybase+this.y-this.ydisp;return f>=0&&f<this._rows}_getCorrectBufferLength(f){if(!this._hasScrollback)return f;let d=f+this._optionsService.rawOptions.scrollback;return d>s.MAX_BUFFER_SIZE?s.MAX_BUFFER_SIZE:d}fillViewportRows(f){if(this.lines.length===0){f===void 0&&(f=_.DEFAULT_ATTR_DATA);let d=this._rows;for(;d--;)this.lines.push(this.getBlankLine(f))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new o.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(f,d){let c=this.getNullCell(_.DEFAULT_ATTR_DATA),b=0,S=this._getCorrectBufferLength(d);if(S>this.lines.maxLength&&(this.lines.maxLength=S),this.lines.length>0){if(this._cols<f)for(let m=0;m<this.lines.length;m++)b+=+this.lines.get(m).resize(f,c);let y=0;if(this._rows<d)for(let m=this._rows;m<d;m++)this.lines.length<d+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new _.BufferLine(f,c)):this.ybase>0&&this.lines.length<=this.ybase+this.y+y+1?(this.ybase--,y++,this.ydisp>0&&this.ydisp--):this.lines.push(new _.BufferLine(f,c)));else for(let m=this._rows;m>d;m--)this.lines.length>d+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(S<this.lines.maxLength){let m=this.lines.length-S;m>0&&(this.lines.trimStart(m),this.ybase=Math.max(this.ybase-m,0),this.ydisp=Math.max(this.ydisp-m,0),this.savedY=Math.max(this.savedY-m,0)),this.lines.maxLength=S}this.x=Math.min(this.x,f-1),this.y=Math.min(this.y,d-1),y&&(this.y+=y),this.savedX=Math.min(this.savedX,f-1),this.scrollTop=0}if(this.scrollBottom=d-1,this._isReflowEnabled&&(this._reflow(f,d),this._cols>f))for(let y=0;y<this.lines.length;y++)b+=+this.lines.get(y).resize(f,c);this._cols=f,this._rows=d,this._memoryCleanupQueue.clear(),b>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let f=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,f=!1);let d=0;for(;this._memoryCleanupPosition<this.lines.length;)if(d+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),d>100)return!0;return f}get _isReflowEnabled(){let f=this._optionsService.rawOptions.windowsPty;return f&&f.buildNumber?this._hasScrollback&&f.backend==="conpty"&&f.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(f,d){this._cols!==f&&(f>this._cols?this._reflowLarger(f,d):this._reflowSmaller(f,d))}_reflowLarger(f,d){let c=(0,t.reflowLargerGetLinesToRemove)(this.lines,this._cols,f,this.ybase+this.y,this.getNullCell(_.DEFAULT_ATTR_DATA));if(c.length>0){let b=(0,t.reflowLargerCreateNewLayout)(this.lines,c);(0,t.reflowLargerApplyNewLayout)(this.lines,b.layout),this._reflowLargerAdjustViewport(f,d,b.countRemoved)}}_reflowLargerAdjustViewport(f,d,c){let b=this.getNullCell(_.DEFAULT_ATTR_DATA),S=c;for(;S-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<d&&this.lines.push(new _.BufferLine(f,b))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-c,0)}_reflowSmaller(f,d){let c=this.getNullCell(_.DEFAULT_ATTR_DATA),b=[],S=0;for(let y=this.lines.length-1;y>=0;y--){let m=this.lines.get(y);if(!m||!m.isWrapped&&m.getTrimmedLength()<=f)continue;let A=[m];for(;m.isWrapped&&y>0;)m=this.lines.get(--y),A.unshift(m);let x=this.ybase+this.y;if(x>=y&&x<y+A.length)continue;let M=A[A.length-1].getTrimmedLength(),E=(0,t.reflowSmallerGetNewLineLengths)(A,this._cols,f),I=E.length-A.length,F;F=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+I):Math.max(0,this.lines.length-this.lines.maxLength+I);let O=[];for(let k=0;k<I;k++){let B=this.getBlankLine(_.DEFAULT_ATTR_DATA,!0);O.push(B)}O.length>0&&(b.push({start:y+A.length+S,newLines:O}),S+=O.length),A.push(...O);let P=E.length-1,H=E[P];H===0&&(P--,H=E[P]);let $=A.length-I-1,L=M;for(;$>=0;){let k=Math.min(L,H);if(A[P]===void 0)break;if(A[P].copyCellsFrom(A[$],L-k,H-k,k,!0),H-=k,H===0&&(P--,H=E[P]),L-=k,L===0){$--;let B=Math.max($,0);L=(0,t.getWrappedLineTrimmedLength)(A,B,this._cols)}}for(let k=0;k<A.length;k++)E[k]<f&&A[k].setCell(E[k],c);let R=I-F;for(;R-- >0;)this.ybase===0?this.y<d-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+S)-d&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+I,this.ybase+d-1)}if(b.length>0){let y=[],m=[];for(let P=0;P<this.lines.length;P++)m.push(this.lines.get(P));let A=this.lines.length,x=A-1,M=0,E=b[M];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+S);let I=0;for(let P=Math.min(this.lines.maxLength-1,A+S-1);P>=0;P--)if(E&&E.start>x+I){for(let H=E.newLines.length-1;H>=0;H--)this.lines.set(P--,E.newLines[H]);P++,y.push({index:x+1,amount:E.newLines.length}),I+=E.newLines.length,E=b[++M]}else this.lines.set(P,m[x--]);let F=0;for(let P=y.length-1;P>=0;P--)y[P].index+=F,this.lines.onInsertEmitter.fire(y[P]),F+=y[P].amount;let O=Math.max(0,A+S-this.lines.maxLength);O>0&&this.lines.onTrimEmitter.fire(O)}}translateBufferLineToString(f,d,c=0,b){let S=this.lines.get(f);return S?S.translateToString(d,c,b):""}getWrappedRangeForLine(f){let d=f,c=f;for(;d>0&&this.lines.get(d).isWrapped;)d--;for(;c+1<this.lines.length&&this.lines.get(c+1).isWrapped;)c++;return{first:d,last:c}}setupTabStops(f){for(f!=null?this.tabs[f]||(f=this.prevStop(f)):(this.tabs={},f=0);f<this._cols;f+=this._optionsService.rawOptions.tabStopWidth)this.tabs[f]=!0}prevStop(f){for(f==null&&(f=this.x);!this.tabs[--f]&&f>0;);return f>=this._cols?this._cols-1:f<0?0:f}nextStop(f){for(f==null&&(f=this.x);!this.tabs[++f]&&f<this._cols;);return f>=this._cols?this._cols-1:f<0?0:f}clearMarkers(f){this._isClearing=!0;for(let d=0;d<this.markers.length;d++)this.markers[d].line===f&&(this.markers[d].dispose(),this.markers.splice(d--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let f=0;f<this.markers.length;f++)this.markers[f].dispose(),this.markers.splice(f--,1);this._isClearing=!1}addMarker(f){let d=new r.Marker(f);return this.markers.push(d),d.register(this.lines.onTrim(c=>{d.line-=c,d.line<0&&d.dispose()})),d.register(this.lines.onInsert(c=>{d.line>=c.index&&(d.line+=c.amount)})),d.register(this.lines.onDelete(c=>{d.line>=c.index&&d.line<c.index+c.amount&&d.dispose(),d.line>c.index&&(d.line-=c.amount)})),d.register(d.onDispose(()=>this._removeMarker(d))),d}_removeMarker(f){this._isClearing||this.markers.splice(this.markers.indexOf(f),1)}}},437:(p,s,n)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.BufferLine=s.DEFAULT_ATTR_DATA=void 0;let o=n(734),u=n(511),h=n(643),_=n(482);s.DEFAULT_ATTR_DATA=Object.freeze(new o.AttributeData);let t=0;class e{constructor(r,a,f=!1){this.isWrapped=f,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*r);let d=a||u.CellData.fromCharData([0,h.NULL_CELL_CHAR,h.NULL_CELL_WIDTH,h.NULL_CELL_CODE]);for(let c=0;c<r;++c)this.setCell(c,d);this.length=r}get(r){let a=this._data[3*r+0],f=2097151&a;return[this._data[3*r+1],2097152&a?this._combined[r]:f?(0,_.stringFromCodePoint)(f):"",a>>22,2097152&a?this._combined[r].charCodeAt(this._combined[r].length-1):f]}set(r,a){this._data[3*r+1]=a[h.CHAR_DATA_ATTR_INDEX],a[h.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[r]=a[1],this._data[3*r+0]=2097152|r|a[h.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*r+0]=a[h.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|a[h.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(r){return this._data[3*r+0]>>22}hasWidth(r){return 12582912&this._data[3*r+0]}getFg(r){return this._data[3*r+1]}getBg(r){return this._data[3*r+2]}hasContent(r){return 4194303&this._data[3*r+0]}getCodePoint(r){let a=this._data[3*r+0];return 2097152&a?this._combined[r].charCodeAt(this._combined[r].length-1):2097151&a}isCombined(r){return 2097152&this._data[3*r+0]}getString(r){let a=this._data[3*r+0];return 2097152&a?this._combined[r]:2097151&a?(0,_.stringFromCodePoint)(2097151&a):""}isProtected(r){return 536870912&this._data[3*r+2]}loadCell(r,a){return t=3*r,a.content=this._data[t+0],a.fg=this._data[t+1],a.bg=this._data[t+2],2097152&a.content&&(a.combinedData=this._combined[r]),268435456&a.bg&&(a.extended=this._extendedAttrs[r]),a}setCell(r,a){2097152&a.content&&(this._combined[r]=a.combinedData),268435456&a.bg&&(this._extendedAttrs[r]=a.extended),this._data[3*r+0]=a.content,this._data[3*r+1]=a.fg,this._data[3*r+2]=a.bg}setCellFromCodepoint(r,a,f,d){268435456&d.bg&&(this._extendedAttrs[r]=d.extended),this._data[3*r+0]=a|f<<22,this._data[3*r+1]=d.fg,this._data[3*r+2]=d.bg}addCodepointToCell(r,a,f){let d=this._data[3*r+0];2097152&d?this._combined[r]+=(0,_.stringFromCodePoint)(a):2097151&d?(this._combined[r]=(0,_.stringFromCodePoint)(2097151&d)+(0,_.stringFromCodePoint)(a),d&=-2097152,d|=2097152):d=a|4194304,f&&(d&=-12582913,d|=f<<22),this._data[3*r+0]=d}insertCells(r,a,f){if((r%=this.length)&&this.getWidth(r-1)===2&&this.setCellFromCodepoint(r-1,0,1,f),a<this.length-r){let d=new u.CellData;for(let c=this.length-r-a-1;c>=0;--c)this.setCell(r+a+c,this.loadCell(r+c,d));for(let c=0;c<a;++c)this.setCell(r+c,f)}else for(let d=r;d<this.length;++d)this.setCell(d,f);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,f)}deleteCells(r,a,f){if(r%=this.length,a<this.length-r){let d=new u.CellData;for(let c=0;c<this.length-r-a;++c)this.setCell(r+c,this.loadCell(r+a+c,d));for(let c=this.length-a;c<this.length;++c)this.setCell(c,f)}else for(let d=r;d<this.length;++d)this.setCell(d,f);r&&this.getWidth(r-1)===2&&this.setCellFromCodepoint(r-1,0,1,f),this.getWidth(r)!==0||this.hasContent(r)||this.setCellFromCodepoint(r,0,1,f)}replaceCells(r,a,f,d=!1){if(d)for(r&&this.getWidth(r-1)===2&&!this.isProtected(r-1)&&this.setCellFromCodepoint(r-1,0,1,f),a<this.length&&this.getWidth(a-1)===2&&!this.isProtected(a)&&this.setCellFromCodepoint(a,0,1,f);r<a&&r<this.length;)this.isProtected(r)||this.setCell(r,f),r++;else for(r&&this.getWidth(r-1)===2&&this.setCellFromCodepoint(r-1,0,1,f),a<this.length&&this.getWidth(a-1)===2&&this.setCellFromCodepoint(a,0,1,f);r<a&&r<this.length;)this.setCell(r++,f)}resize(r,a){if(r===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;let f=3*r;if(r>this.length){if(this._data.buffer.byteLength>=4*f)this._data=new Uint32Array(this._data.buffer,0,f);else{let d=new Uint32Array(f);d.set(this._data),this._data=d}for(let d=this.length;d<r;++d)this.setCell(d,a)}else{this._data=this._data.subarray(0,f);let d=Object.keys(this._combined);for(let b=0;b<d.length;b++){let S=parseInt(d[b],10);S>=r&&delete this._combined[S]}let c=Object.keys(this._extendedAttrs);for(let b=0;b<c.length;b++){let S=parseInt(c[b],10);S>=r&&delete this._extendedAttrs[S]}}return this.length=r,4*f*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){let r=new Uint32Array(this._data.length);return r.set(this._data),this._data=r,1}return 0}fill(r,a=!1){if(a)for(let f=0;f<this.length;++f)this.isProtected(f)||this.setCell(f,r);else{this._combined={},this._extendedAttrs={};for(let f=0;f<this.length;++f)this.setCell(f,r)}}copyFrom(r){this.length!==r.length?this._data=new Uint32Array(r._data):this._data.set(r._data),this.length=r.length,this._combined={};for(let a in r._combined)this._combined[a]=r._combined[a];this._extendedAttrs={};for(let a in r._extendedAttrs)this._extendedAttrs[a]=r._extendedAttrs[a];this.isWrapped=r.isWrapped}clone(){let r=new e(0);r._data=new Uint32Array(this._data),r.length=this.length;for(let a in this._combined)r._combined[a]=this._combined[a];for(let a in this._extendedAttrs)r._extendedAttrs[a]=this._extendedAttrs[a];return r.isWrapped=this.isWrapped,r}getTrimmedLength(){for(let r=this.length-1;r>=0;--r)if(4194303&this._data[3*r+0])return r+(this._data[3*r+0]>>22);return 0}getNoBgTrimmedLength(){for(let r=this.length-1;r>=0;--r)if(4194303&this._data[3*r+0]||50331648&this._data[3*r+2])return r+(this._data[3*r+0]>>22);return 0}copyCellsFrom(r,a,f,d,c){let b=r._data;if(c)for(let y=d-1;y>=0;y--){for(let m=0;m<3;m++)this._data[3*(f+y)+m]=b[3*(a+y)+m];268435456&b[3*(a+y)+2]&&(this._extendedAttrs[f+y]=r._extendedAttrs[a+y])}else for(let y=0;y<d;y++){for(let m=0;m<3;m++)this._data[3*(f+y)+m]=b[3*(a+y)+m];268435456&b[3*(a+y)+2]&&(this._extendedAttrs[f+y]=r._extendedAttrs[a+y])}let S=Object.keys(r._combined);for(let y=0;y<S.length;y++){let m=parseInt(S[y],10);m>=a&&(this._combined[m-a+f]=r._combined[m])}}translateToString(r,a,f,d){a=a??0,f=f??this.length,r&&(f=Math.min(f,this.getTrimmedLength())),d&&(d.length=0);let c="";for(;a<f;){let b=this._data[3*a+0],S=2097151&b,y=2097152&b?this._combined[a]:S?(0,_.stringFromCodePoint)(S):h.WHITESPACE_CELL_CHAR;if(c+=y,d)for(let m=0;m<y.length;++m)d.push(a);a+=b>>22||1}return d&&d.push(a),c}}s.BufferLine=e},634:(p,s)=>{function n(o,u,h){if(u===o.length-1)return o[u].getTrimmedLength();let _=!o[u].hasContent(h-1)&&o[u].getWidth(h-1)===1,t=o[u+1].getWidth(0)===2;return _&&t?h-1:h}Object.defineProperty(s,"__esModule",{value:!0}),s.getWrappedLineTrimmedLength=s.reflowSmallerGetNewLineLengths=s.reflowLargerApplyNewLayout=s.reflowLargerCreateNewLayout=s.reflowLargerGetLinesToRemove=void 0,s.reflowLargerGetLinesToRemove=function(o,u,h,_,t){let e=[];for(let v=0;v<o.length-1;v++){let r=v,a=o.get(++r);if(!a.isWrapped)continue;let f=[o.get(v)];for(;r<o.length&&a.isWrapped;)f.push(a),a=o.get(++r);if(_>=v&&_<r){v+=f.length-1;continue}let d=0,c=n(f,d,u),b=1,S=0;for(;b<f.length;){let m=n(f,b,u),A=m-S,x=h-c,M=Math.min(A,x);f[d].copyCellsFrom(f[b],S,c,M,!1),c+=M,c===h&&(d++,c=0),S+=M,S===m&&(b++,S=0),c===0&&d!==0&&f[d-1].getWidth(h-1)===2&&(f[d].copyCellsFrom(f[d-1],h-1,c++,1,!1),f[d-1].setCell(h-1,t))}f[d].replaceCells(c,h,t);let y=0;for(let m=f.length-1;m>0&&(m>d||f[m].getTrimmedLength()===0);m--)y++;y>0&&(e.push(v+f.length-y),e.push(y)),v+=f.length-1}return e},s.reflowLargerCreateNewLayout=function(o,u){let h=[],_=0,t=u[_],e=0;for(let v=0;v<o.length;v++)if(t===v){let r=u[++_];o.onDeleteEmitter.fire({index:v-e,amount:r}),v+=r-1,e+=r,t=u[++_]}else h.push(v);return{layout:h,countRemoved:e}},s.reflowLargerApplyNewLayout=function(o,u){let h=[];for(let _=0;_<u.length;_++)h.push(o.get(u[_]));for(let _=0;_<h.length;_++)o.set(_,h[_]);o.length=u.length},s.reflowSmallerGetNewLineLengths=function(o,u,h){let _=[],t=o.map((a,f)=>n(o,f,u)).reduce((a,f)=>a+f),e=0,v=0,r=0;for(;r<t;){if(t-r<h){_.push(t-r);break}e+=h;let a=n(o,v,u);e>a&&(e-=a,v++);let f=o[v].getWidth(e-1)===2;f&&e--;let d=f?h-1:h;_.push(d),r+=d}return _},s.getWrappedLineTrimmedLength=n},295:(p,s,n)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.BufferSet=void 0;let o=n(460),u=n(844),h=n(92);class _ extends u.Disposable{constructor(e,v){super(),this._optionsService=e,this._bufferService=v,this._onBufferActivate=this.register(new o.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new h.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new h.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(e){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(e),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(e,v){this._normal.resize(e,v),this._alt.resize(e,v),this.setupTabStops(e)}setupTabStops(e){this._normal.setupTabStops(e),this._alt.setupTabStops(e)}}s.BufferSet=_},511:(p,s,n)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.CellData=void 0;let o=n(482),u=n(643),h=n(734);class _ extends h.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new h.ExtendedAttrs,this.combinedData=""}static fromCharData(e){let v=new _;return v.setFromCharData(e),v}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,o.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(e){this.fg=e[u.CHAR_DATA_ATTR_INDEX],this.bg=0;let v=!1;if(e[u.CHAR_DATA_CHAR_INDEX].length>2)v=!0;else if(e[u.CHAR_DATA_CHAR_INDEX].length===2){let r=e[u.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=r&&r<=56319){let a=e[u.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=a&&a<=57343?this.content=1024*(r-55296)+a-56320+65536|e[u.CHAR_DATA_WIDTH_INDEX]<<22:v=!0}else v=!0}else this.content=e[u.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|e[u.CHAR_DATA_WIDTH_INDEX]<<22;v&&(this.combinedData=e[u.CHAR_DATA_CHAR_INDEX],this.content=2097152|e[u.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}s.CellData=_},643:(p,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.WHITESPACE_CELL_CODE=s.WHITESPACE_CELL_WIDTH=s.WHITESPACE_CELL_CHAR=s.NULL_CELL_CODE=s.NULL_CELL_WIDTH=s.NULL_CELL_CHAR=s.CHAR_DATA_CODE_INDEX=s.CHAR_DATA_WIDTH_INDEX=s.CHAR_DATA_CHAR_INDEX=s.CHAR_DATA_ATTR_INDEX=s.DEFAULT_EXT=s.DEFAULT_ATTR=s.DEFAULT_COLOR=void 0,s.DEFAULT_COLOR=0,s.DEFAULT_ATTR=256|s.DEFAULT_COLOR<<9,s.DEFAULT_EXT=0,s.CHAR_DATA_ATTR_INDEX=0,s.CHAR_DATA_CHAR_INDEX=1,s.CHAR_DATA_WIDTH_INDEX=2,s.CHAR_DATA_CODE_INDEX=3,s.NULL_CELL_CHAR="",s.NULL_CELL_WIDTH=1,s.NULL_CELL_CODE=0,s.WHITESPACE_CELL_CHAR=" ",s.WHITESPACE_CELL_WIDTH=1,s.WHITESPACE_CELL_CODE=32},863:(p,s,n)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.Marker=void 0;let o=n(460),u=n(844);class h{get id(){return this._id}constructor(t){this.line=t,this.isDisposed=!1,this._disposables=[],this._id=h._nextId++,this._onDispose=this.register(new o.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,u.disposeArray)(this._disposables),this._disposables.length=0)}register(t){return this._disposables.push(t),t}}s.Marker=h,h._nextId=1},116:(p,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.DEFAULT_CHARSET=s.CHARSETS=void 0,s.CHARSETS={},s.DEFAULT_CHARSET=s.CHARSETS.B,s.CHARSETS[0]={"`":"\u25C6",a:"\u2592",b:"\u2409",c:"\u240C",d:"\u240D",e:"\u240A",f:"\xB0",g:"\xB1",h:"\u2424",i:"\u240B",j:"\u2518",k:"\u2510",l:"\u250C",m:"\u2514",n:"\u253C",o:"\u23BA",p:"\u23BB",q:"\u2500",r:"\u23BC",s:"\u23BD",t:"\u251C",u:"\u2524",v:"\u2534",w:"\u252C",x:"\u2502",y:"\u2264",z:"\u2265","{":"\u03C0","|":"\u2260","}":"\xA3","~":"\xB7"},s.CHARSETS.A={"#":"\xA3"},s.CHARSETS.B=void 0,s.CHARSETS[4]={"#":"\xA3","@":"\xBE","[":"ij","\\":"\xBD","]":"|","{":"\xA8","|":"f","}":"\xBC","~":"\xB4"},s.CHARSETS.C=s.CHARSETS[5]={"[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},s.CHARSETS.R={"#":"\xA3","@":"\xE0","[":"\xB0","\\":"\xE7","]":"\xA7","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xA8"},s.CHARSETS.Q={"@":"\xE0","[":"\xE2","\\":"\xE7","]":"\xEA","^":"\xEE","`":"\xF4","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xFB"},s.CHARSETS.K={"@":"\xA7","[":"\xC4","\\":"\xD6","]":"\xDC","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xDF"},s.CHARSETS.Y={"#":"\xA3","@":"\xA7","[":"\xB0","\\":"\xE7","]":"\xE9","`":"\xF9","{":"\xE0","|":"\xF2","}":"\xE8","~":"\xEC"},s.CHARSETS.E=s.CHARSETS[6]={"@":"\xC4","[":"\xC6","\\":"\xD8","]":"\xC5","^":"\xDC","`":"\xE4","{":"\xE6","|":"\xF8","}":"\xE5","~":"\xFC"},s.CHARSETS.Z={"#":"\xA3","@":"\xA7","[":"\xA1","\\":"\xD1","]":"\xBF","{":"\xB0","|":"\xF1","}":"\xE7"},s.CHARSETS.H=s.CHARSETS[7]={"@":"\xC9","[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},s.CHARSETS["="]={"#":"\xF9","@":"\xE0","[":"\xE9","\\":"\xE7","]":"\xEA","^":"\xEE",_:"\xE8","`":"\xF4","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xFB"}},584:(p,s)=>{var n,o,u;Object.defineProperty(s,"__esModule",{value:!0}),s.C1_ESCAPED=s.C1=s.C0=void 0,function(h){h.NUL="\0",h.SOH="",h.STX="",h.ETX="",h.EOT="",h.ENQ="",h.ACK="",h.BEL="\x07",h.BS="\b",h.HT="	",h.LF=`
`,h.VT="\v",h.FF="\f",h.CR="\r",h.SO="",h.SI="",h.DLE="",h.DC1="",h.DC2="",h.DC3="",h.DC4="",h.NAK="",h.SYN="",h.ETB="",h.CAN="",h.EM="",h.SUB="",h.ESC="\x1B",h.FS="",h.GS="",h.RS="",h.US="",h.SP=" ",h.DEL="\x7F"}(n||(s.C0=n={})),function(h){h.PAD="\x80",h.HOP="\x81",h.BPH="\x82",h.NBH="\x83",h.IND="\x84",h.NEL="\x85",h.SSA="\x86",h.ESA="\x87",h.HTS="\x88",h.HTJ="\x89",h.VTS="\x8A",h.PLD="\x8B",h.PLU="\x8C",h.RI="\x8D",h.SS2="\x8E",h.SS3="\x8F",h.DCS="\x90",h.PU1="\x91",h.PU2="\x92",h.STS="\x93",h.CCH="\x94",h.MW="\x95",h.SPA="\x96",h.EPA="\x97",h.SOS="\x98",h.SGCI="\x99",h.SCI="\x9A",h.CSI="\x9B",h.ST="\x9C",h.OSC="\x9D",h.PM="\x9E",h.APC="\x9F"}(o||(s.C1=o={})),function(h){h.ST=`${n.ESC}\\`}(u||(s.C1_ESCAPED=u={}))},482:(p,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.Utf8ToUtf32=s.StringToUtf32=s.utf32ToString=s.stringFromCodePoint=void 0,s.stringFromCodePoint=function(n){return n>65535?(n-=65536,String.fromCharCode(55296+(n>>10))+String.fromCharCode(n%1024+56320)):String.fromCharCode(n)},s.utf32ToString=function(n,o=0,u=n.length){let h="";for(let _=o;_<u;++_){let t=n[_];t>65535?(t-=65536,h+=String.fromCharCode(55296+(t>>10))+String.fromCharCode(t%1024+56320)):h+=String.fromCharCode(t)}return h},s.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(n,o){let u=n.length;if(!u)return 0;let h=0,_=0;if(this._interim){let t=n.charCodeAt(_++);56320<=t&&t<=57343?o[h++]=1024*(this._interim-55296)+t-56320+65536:(o[h++]=this._interim,o[h++]=t),this._interim=0}for(let t=_;t<u;++t){let e=n.charCodeAt(t);if(55296<=e&&e<=56319){if(++t>=u)return this._interim=e,h;let v=n.charCodeAt(t);56320<=v&&v<=57343?o[h++]=1024*(e-55296)+v-56320+65536:(o[h++]=e,o[h++]=v)}else e!==65279&&(o[h++]=e)}return h}},s.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(n,o){let u=n.length;if(!u)return 0;let h,_,t,e,v=0,r=0,a=0;if(this.interim[0]){let c=!1,b=this.interim[0];b&=(224&b)==192?31:(240&b)==224?15:7;let S,y=0;for(;(S=63&this.interim[++y])&&y<4;)b<<=6,b|=S;let m=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,A=m-y;for(;a<A;){if(a>=u)return 0;if(S=n[a++],(192&S)!=128){a--,c=!0;break}this.interim[y++]=S,b<<=6,b|=63&S}c||(m===2?b<128?a--:o[v++]=b:m===3?b<2048||b>=55296&&b<=57343||b===65279||(o[v++]=b):b<65536||b>1114111||(o[v++]=b)),this.interim.fill(0)}let f=u-4,d=a;for(;d<u;){for(;!(!(d<f)||128&(h=n[d])||128&(_=n[d+1])||128&(t=n[d+2])||128&(e=n[d+3]));)o[v++]=h,o[v++]=_,o[v++]=t,o[v++]=e,d+=4;if(h=n[d++],h<128)o[v++]=h;else if((224&h)==192){if(d>=u)return this.interim[0]=h,v;if(_=n[d++],(192&_)!=128){d--;continue}if(r=(31&h)<<6|63&_,r<128){d--;continue}o[v++]=r}else if((240&h)==224){if(d>=u)return this.interim[0]=h,v;if(_=n[d++],(192&_)!=128){d--;continue}if(d>=u)return this.interim[0]=h,this.interim[1]=_,v;if(t=n[d++],(192&t)!=128){d--;continue}if(r=(15&h)<<12|(63&_)<<6|63&t,r<2048||r>=55296&&r<=57343||r===65279)continue;o[v++]=r}else if((248&h)==240){if(d>=u)return this.interim[0]=h,v;if(_=n[d++],(192&_)!=128){d--;continue}if(d>=u)return this.interim[0]=h,this.interim[1]=_,v;if(t=n[d++],(192&t)!=128){d--;continue}if(d>=u)return this.interim[0]=h,this.interim[1]=_,this.interim[2]=t,v;if(e=n[d++],(192&e)!=128){d--;continue}if(r=(7&h)<<18|(63&_)<<12|(63&t)<<6|63&e,r<65536||r>1114111)continue;o[v++]=r}}return v}}},225:(p,s,n)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.UnicodeV6=void 0;let o=n(480),u=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],h=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],_;s.UnicodeV6=class{constructor(){if(this.version="6",!_){_=new Uint8Array(65536),_.fill(1),_[0]=0,_.fill(0,1,32),_.fill(0,127,160),_.fill(2,4352,4448),_[9001]=2,_[9002]=2,_.fill(2,11904,42192),_[12351]=1,_.fill(2,44032,55204),_.fill(2,63744,64256),_.fill(2,65040,65050),_.fill(2,65072,65136),_.fill(2,65280,65377),_.fill(2,65504,65511);for(let t=0;t<u.length;++t)_.fill(0,u[t][0],u[t][1]+1)}}wcwidth(t){return t<32?0:t<127?1:t<65536?_[t]:function(e,v){let r,a=0,f=v.length-1;if(e<v[0][0]||e>v[f][1])return!1;for(;f>=a;)if(r=a+f>>1,e>v[r][1])a=r+1;else{if(!(e<v[r][0]))return!0;f=r-1}return!1}(t,h)?0:t>=131072&&t<=196605||t>=196608&&t<=262141?2:1}charProperties(t,e){let v=this.wcwidth(t),r=v===0&&e!==0;if(r){let a=o.UnicodeService.extractWidth(e);a===0?r=!1:a>v&&(v=a)}return o.UnicodeService.createPropertyValue(0,v,r)}}},981:(p,s,n)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.WriteBuffer=void 0;let o=n(460),u=n(844);class h extends u.Disposable{constructor(t){super(),this._action=t,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new o.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(t,e){if(e!==void 0&&this._syncCalls>e)return void(this._syncCalls=0);if(this._pendingData+=t.length,this._writeBuffer.push(t),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let v;for(this._isSyncWriting=!0;v=this._writeBuffer.shift();){this._action(v);let r=this._callbacks.shift();r&&r()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(t,e){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=t.length,this._writeBuffer.push(t),this._callbacks.push(e),void this._innerWrite();setTimeout(()=>this._innerWrite())}this._pendingData+=t.length,this._writeBuffer.push(t),this._callbacks.push(e)}_innerWrite(t=0,e=!0){let v=t||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){let r=this._writeBuffer[this._bufferOffset],a=this._action(r,e);if(a){let d=c=>Date.now()-v>=12?setTimeout(()=>this._innerWrite(0,c)):this._innerWrite(v,c);return void a.catch(c=>(queueMicrotask(()=>{throw c}),Promise.resolve(!1))).then(d)}let f=this._callbacks[this._bufferOffset];if(f&&f(),this._bufferOffset++,this._pendingData-=r.length,Date.now()-v>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}s.WriteBuffer=h},941:(p,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.toRgbString=s.parseColor=void 0;let n=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,o=/^[\da-f]+$/;function u(h,_){let t=h.toString(16),e=t.length<2?"0"+t:t;switch(_){case 4:return t[0];case 8:return e;case 12:return(e+e).slice(0,3);default:return e+e}}s.parseColor=function(h){if(!h)return;let _=h.toLowerCase();if(_.indexOf("rgb:")===0){_=_.slice(4);let t=n.exec(_);if(t){let e=t[1]?15:t[4]?255:t[7]?4095:65535;return[Math.round(parseInt(t[1]||t[4]||t[7]||t[10],16)/e*255),Math.round(parseInt(t[2]||t[5]||t[8]||t[11],16)/e*255),Math.round(parseInt(t[3]||t[6]||t[9]||t[12],16)/e*255)]}}else if(_.indexOf("#")===0&&(_=_.slice(1),o.exec(_)&&[3,6,9,12].includes(_.length))){let t=_.length/3,e=[0,0,0];for(let v=0;v<3;++v){let r=parseInt(_.slice(t*v,t*v+t),16);e[v]=t===1?r<<4:t===2?r:t===3?r>>4:r>>8}return e}},s.toRgbString=function(h,_=16){let[t,e,v]=h;return`rgb:${u(t,_)}/${u(e,_)}/${u(v,_)}`}},770:(p,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.PAYLOAD_LIMIT=void 0,s.PAYLOAD_LIMIT=1e7},351:(p,s,n)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.DcsHandler=s.DcsParser=void 0;let o=n(482),u=n(742),h=n(770),_=[];s.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=_,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=_}registerHandler(e,v){this._handlers[e]===void 0&&(this._handlers[e]=[]);let r=this._handlers[e];return r.push(v),{dispose:()=>{let a=r.indexOf(v);a!==-1&&r.splice(a,1)}}}clearHandler(e){this._handlers[e]&&delete this._handlers[e]}setHandlerFallback(e){this._handlerFb=e}reset(){if(this._active.length)for(let e=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;e>=0;--e)this._active[e].unhook(!1);this._stack.paused=!1,this._active=_,this._ident=0}hook(e,v){if(this.reset(),this._ident=e,this._active=this._handlers[e]||_,this._active.length)for(let r=this._active.length-1;r>=0;r--)this._active[r].hook(v);else this._handlerFb(this._ident,"HOOK",v)}put(e,v,r){if(this._active.length)for(let a=this._active.length-1;a>=0;a--)this._active[a].put(e,v,r);else this._handlerFb(this._ident,"PUT",(0,o.utf32ToString)(e,v,r))}unhook(e,v=!0){if(this._active.length){let r=!1,a=this._active.length-1,f=!1;if(this._stack.paused&&(a=this._stack.loopPosition-1,r=v,f=this._stack.fallThrough,this._stack.paused=!1),!f&&r===!1){for(;a>=0&&(r=this._active[a].unhook(e),r!==!0);a--)if(r instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=a,this._stack.fallThrough=!1,r;a--}for(;a>=0;a--)if(r=this._active[a].unhook(!1),r instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=a,this._stack.fallThrough=!0,r}else this._handlerFb(this._ident,"UNHOOK",e);this._active=_,this._ident=0}};let t=new u.Params;t.addParam(0),s.DcsHandler=class{constructor(e){this._handler=e,this._data="",this._params=t,this._hitLimit=!1}hook(e){this._params=e.length>1||e.params[0]?e.clone():t,this._data="",this._hitLimit=!1}put(e,v,r){this._hitLimit||(this._data+=(0,o.utf32ToString)(e,v,r),this._data.length>h.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(e){let v=!1;if(this._hitLimit)v=!1;else if(e&&(v=this._handler(this._data,this._params),v instanceof Promise))return v.then(r=>(this._params=t,this._data="",this._hitLimit=!1,r));return this._params=t,this._data="",this._hitLimit=!1,v}}},15:(p,s,n)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.EscapeSequenceParser=s.VT500_TRANSITION_TABLE=s.TransitionTable=void 0;let o=n(844),u=n(742),h=n(242),_=n(351);class t{constructor(a){this.table=new Uint8Array(a)}setDefault(a,f){this.table.fill(a<<4|f)}add(a,f,d,c){this.table[f<<8|a]=d<<4|c}addMany(a,f,d,c){for(let b=0;b<a.length;b++)this.table[f<<8|a[b]]=d<<4|c}}s.TransitionTable=t;let e=160;s.VT500_TRANSITION_TABLE=function(){let r=new t(4095),a=Array.apply(null,Array(256)).map((y,m)=>m),f=(y,m)=>a.slice(y,m),d=f(32,127),c=f(0,24);c.push(25),c.push.apply(c,f(28,32));let b=f(0,14),S;for(S in r.setDefault(1,0),r.addMany(d,0,2,0),b)r.addMany([24,26,153,154],S,3,0),r.addMany(f(128,144),S,3,0),r.addMany(f(144,152),S,3,0),r.add(156,S,0,0),r.add(27,S,11,1),r.add(157,S,4,8),r.addMany([152,158,159],S,0,7),r.add(155,S,11,3),r.add(144,S,11,9);return r.addMany(c,0,3,0),r.addMany(c,1,3,1),r.add(127,1,0,1),r.addMany(c,8,0,8),r.addMany(c,3,3,3),r.add(127,3,0,3),r.addMany(c,4,3,4),r.add(127,4,0,4),r.addMany(c,6,3,6),r.addMany(c,5,3,5),r.add(127,5,0,5),r.addMany(c,2,3,2),r.add(127,2,0,2),r.add(93,1,4,8),r.addMany(d,8,5,8),r.add(127,8,5,8),r.addMany([156,27,24,26,7],8,6,0),r.addMany(f(28,32),8,0,8),r.addMany([88,94,95],1,0,7),r.addMany(d,7,0,7),r.addMany(c,7,0,7),r.add(156,7,0,0),r.add(127,7,0,7),r.add(91,1,11,3),r.addMany(f(64,127),3,7,0),r.addMany(f(48,60),3,8,4),r.addMany([60,61,62,63],3,9,4),r.addMany(f(48,60),4,8,4),r.addMany(f(64,127),4,7,0),r.addMany([60,61,62,63],4,0,6),r.addMany(f(32,64),6,0,6),r.add(127,6,0,6),r.addMany(f(64,127),6,0,0),r.addMany(f(32,48),3,9,5),r.addMany(f(32,48),5,9,5),r.addMany(f(48,64),5,0,6),r.addMany(f(64,127),5,7,0),r.addMany(f(32,48),4,9,5),r.addMany(f(32,48),1,9,2),r.addMany(f(32,48),2,9,2),r.addMany(f(48,127),2,10,0),r.addMany(f(48,80),1,10,0),r.addMany(f(81,88),1,10,0),r.addMany([89,90,92],1,10,0),r.addMany(f(96,127),1,10,0),r.add(80,1,11,9),r.addMany(c,9,0,9),r.add(127,9,0,9),r.addMany(f(28,32),9,0,9),r.addMany(f(32,48),9,9,12),r.addMany(f(48,60),9,8,10),r.addMany([60,61,62,63],9,9,10),r.addMany(c,11,0,11),r.addMany(f(32,128),11,0,11),r.addMany(f(28,32),11,0,11),r.addMany(c,10,0,10),r.add(127,10,0,10),r.addMany(f(28,32),10,0,10),r.addMany(f(48,60),10,8,10),r.addMany([60,61,62,63],10,0,11),r.addMany(f(32,48),10,9,12),r.addMany(c,12,0,12),r.add(127,12,0,12),r.addMany(f(28,32),12,0,12),r.addMany(f(32,48),12,9,12),r.addMany(f(48,64),12,0,11),r.addMany(f(64,127),12,12,13),r.addMany(f(64,127),10,12,13),r.addMany(f(64,127),9,12,13),r.addMany(c,13,13,13),r.addMany(d,13,13,13),r.add(127,13,0,13),r.addMany([27,156,24,26],13,14,0),r.add(e,0,2,0),r.add(e,8,5,8),r.add(e,6,0,6),r.add(e,11,0,11),r.add(e,13,13,13),r}();class v extends o.Disposable{constructor(a=s.VT500_TRANSITION_TABLE){super(),this._transitions=a,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new u.Params,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(f,d,c)=>{},this._executeHandlerFb=f=>{},this._csiHandlerFb=(f,d)=>{},this._escHandlerFb=f=>{},this._errorHandlerFb=f=>f,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,o.toDisposable)(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this.register(new h.OscParser),this._dcsParser=this.register(new _.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(a,f=[64,126]){let d=0;if(a.prefix){if(a.prefix.length>1)throw new Error("only one byte as prefix supported");if(d=a.prefix.charCodeAt(0),d&&60>d||d>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(a.intermediates){if(a.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let b=0;b<a.intermediates.length;++b){let S=a.intermediates.charCodeAt(b);if(32>S||S>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");d<<=8,d|=S}}if(a.final.length!==1)throw new Error("final must be a single byte");let c=a.final.charCodeAt(0);if(f[0]>c||c>f[1])throw new Error(`final must be in range ${f[0]} .. ${f[1]}`);return d<<=8,d|=c,d}identToString(a){let f=[];for(;a;)f.push(String.fromCharCode(255&a)),a>>=8;return f.reverse().join("")}setPrintHandler(a){this._printHandler=a}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(a,f){let d=this._identifier(a,[48,126]);this._escHandlers[d]===void 0&&(this._escHandlers[d]=[]);let c=this._escHandlers[d];return c.push(f),{dispose:()=>{let b=c.indexOf(f);b!==-1&&c.splice(b,1)}}}clearEscHandler(a){this._escHandlers[this._identifier(a,[48,126])]&&delete this._escHandlers[this._identifier(a,[48,126])]}setEscHandlerFallback(a){this._escHandlerFb=a}setExecuteHandler(a,f){this._executeHandlers[a.charCodeAt(0)]=f}clearExecuteHandler(a){this._executeHandlers[a.charCodeAt(0)]&&delete this._executeHandlers[a.charCodeAt(0)]}setExecuteHandlerFallback(a){this._executeHandlerFb=a}registerCsiHandler(a,f){let d=this._identifier(a);this._csiHandlers[d]===void 0&&(this._csiHandlers[d]=[]);let c=this._csiHandlers[d];return c.push(f),{dispose:()=>{let b=c.indexOf(f);b!==-1&&c.splice(b,1)}}}clearCsiHandler(a){this._csiHandlers[this._identifier(a)]&&delete this._csiHandlers[this._identifier(a)]}setCsiHandlerFallback(a){this._csiHandlerFb=a}registerDcsHandler(a,f){return this._dcsParser.registerHandler(this._identifier(a),f)}clearDcsHandler(a){this._dcsParser.clearHandler(this._identifier(a))}setDcsHandlerFallback(a){this._dcsParser.setHandlerFallback(a)}registerOscHandler(a,f){return this._oscParser.registerHandler(a,f)}clearOscHandler(a){this._oscParser.clearHandler(a)}setOscHandlerFallback(a){this._oscParser.setHandlerFallback(a)}setErrorHandler(a){this._errorHandler=a}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(a,f,d,c,b){this._parseStack.state=a,this._parseStack.handlers=f,this._parseStack.handlerPos=d,this._parseStack.transition=c,this._parseStack.chunkPos=b}parse(a,f,d){let c,b=0,S=0,y=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,y=this._parseStack.chunkPos+1;else{if(d===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");let m=this._parseStack.handlers,A=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(d===!1&&A>-1){for(;A>=0&&(c=m[A](this._params),c!==!0);A--)if(c instanceof Promise)return this._parseStack.handlerPos=A,c}this._parseStack.handlers=[];break;case 4:if(d===!1&&A>-1){for(;A>=0&&(c=m[A](),c!==!0);A--)if(c instanceof Promise)return this._parseStack.handlerPos=A,c}this._parseStack.handlers=[];break;case 6:if(b=a[this._parseStack.chunkPos],c=this._dcsParser.unhook(b!==24&&b!==26,d),c)return c;b===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(b=a[this._parseStack.chunkPos],c=this._oscParser.end(b!==24&&b!==26,d),c)return c;b===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,y=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=15&this._parseStack.transition}for(let m=y;m<f;++m){switch(b=a[m],S=this._transitions.table[this.currentState<<8|(b<160?b:e)],S>>4){case 2:for(let I=m+1;;++I){if(I>=f||(b=a[I])<32||b>126&&b<e){this._printHandler(a,m,I),m=I-1;break}if(++I>=f||(b=a[I])<32||b>126&&b<e){this._printHandler(a,m,I),m=I-1;break}if(++I>=f||(b=a[I])<32||b>126&&b<e){this._printHandler(a,m,I),m=I-1;break}if(++I>=f||(b=a[I])<32||b>126&&b<e){this._printHandler(a,m,I),m=I-1;break}}break;case 3:this._executeHandlers[b]?this._executeHandlers[b]():this._executeHandlerFb(b),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:m,code:b,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:let A=this._csiHandlers[this._collect<<8|b],x=A?A.length-1:-1;for(;x>=0&&(c=A[x](this._params),c!==!0);x--)if(c instanceof Promise)return this._preserveStack(3,A,x,S,m),c;x<0&&this._csiHandlerFb(this._collect<<8|b,this._params),this.precedingJoinState=0;break;case 8:do switch(b){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(b-48)}while(++m<f&&(b=a[m])>47&&b<60);m--;break;case 9:this._collect<<=8,this._collect|=b;break;case 10:let M=this._escHandlers[this._collect<<8|b],E=M?M.length-1:-1;for(;E>=0&&(c=M[E](),c!==!0);E--)if(c instanceof Promise)return this._preserveStack(4,M,E,S,m),c;E<0&&this._escHandlerFb(this._collect<<8|b),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|b,this._params);break;case 13:for(let I=m+1;;++I)if(I>=f||(b=a[I])===24||b===26||b===27||b>127&&b<e){this._dcsParser.put(a,m,I),m=I-1;break}break;case 14:if(c=this._dcsParser.unhook(b!==24&&b!==26),c)return this._preserveStack(6,[],0,S,m),c;b===27&&(S|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let I=m+1;;I++)if(I>=f||(b=a[I])<32||b>127&&b<e){this._oscParser.put(a,m,I),m=I-1;break}break;case 6:if(c=this._oscParser.end(b!==24&&b!==26),c)return this._preserveStack(5,[],0,S,m),c;b===27&&(S|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0}this.currentState=15&S}}}s.EscapeSequenceParser=v},242:(p,s,n)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.OscHandler=s.OscParser=void 0;let o=n(770),u=n(482),h=[];s.OscParser=class{constructor(){this._state=0,this._active=h,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(_,t){this._handlers[_]===void 0&&(this._handlers[_]=[]);let e=this._handlers[_];return e.push(t),{dispose:()=>{let v=e.indexOf(t);v!==-1&&e.splice(v,1)}}}clearHandler(_){this._handlers[_]&&delete this._handlers[_]}setHandlerFallback(_){this._handlerFb=_}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=h}reset(){if(this._state===2)for(let _=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;_>=0;--_)this._active[_].end(!1);this._stack.paused=!1,this._active=h,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||h,this._active.length)for(let _=this._active.length-1;_>=0;_--)this._active[_].start();else this._handlerFb(this._id,"START")}_put(_,t,e){if(this._active.length)for(let v=this._active.length-1;v>=0;v--)this._active[v].put(_,t,e);else this._handlerFb(this._id,"PUT",(0,u.utf32ToString)(_,t,e))}start(){this.reset(),this._state=1}put(_,t,e){if(this._state!==3){if(this._state===1)for(;t<e;){let v=_[t++];if(v===59){this._state=2,this._start();break}if(v<48||57<v)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+v-48}this._state===2&&e-t>0&&this._put(_,t,e)}}end(_,t=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let e=!1,v=this._active.length-1,r=!1;if(this._stack.paused&&(v=this._stack.loopPosition-1,e=t,r=this._stack.fallThrough,this._stack.paused=!1),!r&&e===!1){for(;v>=0&&(e=this._active[v].end(_),e!==!0);v--)if(e instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=v,this._stack.fallThrough=!1,e;v--}for(;v>=0;v--)if(e=this._active[v].end(!1),e instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=v,this._stack.fallThrough=!0,e}else this._handlerFb(this._id,"END",_);this._active=h,this._id=-1,this._state=0}}},s.OscHandler=class{constructor(_){this._handler=_,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(_,t,e){this._hitLimit||(this._data+=(0,u.utf32ToString)(_,t,e),this._data.length>o.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(_){let t=!1;if(this._hitLimit)t=!1;else if(_&&(t=this._handler(this._data),t instanceof Promise))return t.then(e=>(this._data="",this._hitLimit=!1,e));return this._data="",this._hitLimit=!1,t}}},742:(p,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.Params=void 0;let n=2147483647;class o{static fromArray(h){let _=new o;if(!h.length)return _;for(let t=Array.isArray(h[0])?1:0;t<h.length;++t){let e=h[t];if(Array.isArray(e))for(let v=0;v<e.length;++v)_.addSubParam(e[v]);else _.addParam(e)}return _}constructor(h=32,_=32){if(this.maxLength=h,this.maxSubParamsLength=_,_>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(h),this.length=0,this._subParams=new Int32Array(_),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(h),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){let h=new o(this.maxLength,this.maxSubParamsLength);return h.params.set(this.params),h.length=this.length,h._subParams.set(this._subParams),h._subParamsLength=this._subParamsLength,h._subParamsIdx.set(this._subParamsIdx),h._rejectDigits=this._rejectDigits,h._rejectSubDigits=this._rejectSubDigits,h._digitIsSub=this._digitIsSub,h}toArray(){let h=[];for(let _=0;_<this.length;++_){h.push(this.params[_]);let t=this._subParamsIdx[_]>>8,e=255&this._subParamsIdx[_];e-t>0&&h.push(Array.prototype.slice.call(this._subParams,t,e))}return h}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(h){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(h<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=h>n?n:h}}addSubParam(h){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(h<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=h>n?n:h,this._subParamsIdx[this.length-1]++}}hasSubParams(h){return(255&this._subParamsIdx[h])-(this._subParamsIdx[h]>>8)>0}getSubParams(h){let _=this._subParamsIdx[h]>>8,t=255&this._subParamsIdx[h];return t-_>0?this._subParams.subarray(_,t):null}getSubParamsAll(){let h={};for(let _=0;_<this.length;++_){let t=this._subParamsIdx[_]>>8,e=255&this._subParamsIdx[_];e-t>0&&(h[_]=this._subParams.slice(t,e))}return h}addDigit(h){let _;if(this._rejectDigits||!(_=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;let t=this._digitIsSub?this._subParams:this.params,e=t[_-1];t[_-1]=~e?Math.min(10*e+h,n):h}}s.Params=o},741:(p,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.AddonManager=void 0,s.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let n=this._addons.length-1;n>=0;n--)this._addons[n].instance.dispose()}loadAddon(n,o){let u={instance:o,dispose:o.dispose,isDisposed:!1};this._addons.push(u),o.dispose=()=>this._wrappedAddonDispose(u),o.activate(n)}_wrappedAddonDispose(n){if(n.isDisposed)return;let o=-1;for(let u=0;u<this._addons.length;u++)if(this._addons[u]===n){o=u;break}if(o===-1)throw new Error("Could not dispose an addon that has not been loaded");n.isDisposed=!0,n.dispose.apply(n.instance),this._addons.splice(o,1)}}},771:(p,s,n)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.BufferApiView=void 0;let o=n(785),u=n(511);s.BufferApiView=class{constructor(h,_){this._buffer=h,this.type=_}init(h){return this._buffer=h,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(h){let _=this._buffer.lines.get(h);if(_)return new o.BufferLineApiView(_)}getNullCell(){return new u.CellData}}},785:(p,s,n)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.BufferLineApiView=void 0;let o=n(511);s.BufferLineApiView=class{constructor(u){this._line=u}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(u,h){if(!(u<0||u>=this._line.length))return h?(this._line.loadCell(u,h),h):this._line.loadCell(u,new o.CellData)}translateToString(u,h,_){return this._line.translateToString(u,h,_)}}},285:(p,s,n)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.BufferNamespaceApi=void 0;let o=n(771),u=n(460),h=n(844);class _ extends h.Disposable{constructor(e){super(),this._core=e,this._onBufferChange=this.register(new u.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new o.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new o.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}s.BufferNamespaceApi=_},975:(p,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.ParserApi=void 0,s.ParserApi=class{constructor(n){this._core=n}registerCsiHandler(n,o){return this._core.registerCsiHandler(n,u=>o(u.toArray()))}addCsiHandler(n,o){return this.registerCsiHandler(n,o)}registerDcsHandler(n,o){return this._core.registerDcsHandler(n,(u,h)=>o(u,h.toArray()))}addDcsHandler(n,o){return this.registerDcsHandler(n,o)}registerEscHandler(n,o){return this._core.registerEscHandler(n,o)}addEscHandler(n,o){return this.registerEscHandler(n,o)}registerOscHandler(n,o){return this._core.registerOscHandler(n,o)}addOscHandler(n,o){return this.registerOscHandler(n,o)}}},90:(p,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.UnicodeApi=void 0,s.UnicodeApi=class{constructor(n){this._core=n}register(n){this._core.unicodeService.register(n)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(n){this._core.unicodeService.activeVersion=n}}},744:function(p,s,n){var o=this&&this.__decorate||function(r,a,f,d){var c,b=arguments.length,S=b<3?a:d===null?d=Object.getOwnPropertyDescriptor(a,f):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(r,a,f,d);else for(var y=r.length-1;y>=0;y--)(c=r[y])&&(S=(b<3?c(S):b>3?c(a,f,S):c(a,f))||S);return b>3&&S&&Object.defineProperty(a,f,S),S},u=this&&this.__param||function(r,a){return function(f,d){a(f,d,r)}};Object.defineProperty(s,"__esModule",{value:!0}),s.BufferService=s.MINIMUM_ROWS=s.MINIMUM_COLS=void 0;let h=n(460),_=n(844),t=n(295),e=n(585);s.MINIMUM_COLS=2,s.MINIMUM_ROWS=1;let v=s.BufferService=class extends _.Disposable{get buffer(){return this.buffers.active}constructor(r){super(),this.isUserScrolling=!1,this._onResize=this.register(new h.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new h.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(r.rawOptions.cols||0,s.MINIMUM_COLS),this.rows=Math.max(r.rawOptions.rows||0,s.MINIMUM_ROWS),this.buffers=this.register(new t.BufferSet(r,this))}resize(r,a){this.cols=r,this.rows=a,this.buffers.resize(r,a),this._onResize.fire({cols:r,rows:a})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(r,a=!1){let f=this.buffer,d;d=this._cachedBlankLine,d&&d.length===this.cols&&d.getFg(0)===r.fg&&d.getBg(0)===r.bg||(d=f.getBlankLine(r,a),this._cachedBlankLine=d),d.isWrapped=a;let c=f.ybase+f.scrollTop,b=f.ybase+f.scrollBottom;if(f.scrollTop===0){let S=f.lines.isFull;b===f.lines.length-1?S?f.lines.recycle().copyFrom(d):f.lines.push(d.clone()):f.lines.splice(b+1,0,d.clone()),S?this.isUserScrolling&&(f.ydisp=Math.max(f.ydisp-1,0)):(f.ybase++,this.isUserScrolling||f.ydisp++)}else{let S=b-c+1;f.lines.shiftElements(c+1,S-1,-1),f.lines.set(b,d.clone())}this.isUserScrolling||(f.ydisp=f.ybase),this._onScroll.fire(f.ydisp)}scrollLines(r,a,f){let d=this.buffer;if(r<0){if(d.ydisp===0)return;this.isUserScrolling=!0}else r+d.ydisp>=d.ybase&&(this.isUserScrolling=!1);let c=d.ydisp;d.ydisp=Math.max(Math.min(d.ydisp+r,d.ybase),0),c!==d.ydisp&&(a||this._onScroll.fire(d.ydisp))}};s.BufferService=v=o([u(0,e.IOptionsService)],v)},994:(p,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.CharsetService=void 0,s.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(n){this.glevel=n,this.charset=this._charsets[n]}setgCharset(n,o){this._charsets[n]=o,this.glevel===n&&(this.charset=o)}}},753:function(p,s,n){var o=this&&this.__decorate||function(d,c,b,S){var y,m=arguments.length,A=m<3?c:S===null?S=Object.getOwnPropertyDescriptor(c,b):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")A=Reflect.decorate(d,c,b,S);else for(var x=d.length-1;x>=0;x--)(y=d[x])&&(A=(m<3?y(A):m>3?y(c,b,A):y(c,b))||A);return m>3&&A&&Object.defineProperty(c,b,A),A},u=this&&this.__param||function(d,c){return function(b,S){c(b,S,d)}};Object.defineProperty(s,"__esModule",{value:!0}),s.CoreMouseService=void 0;let h=n(585),_=n(460),t=n(844),e={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:d=>d.button!==4&&d.action===1&&(d.ctrl=!1,d.alt=!1,d.shift=!1,!0)},VT200:{events:19,restrict:d=>d.action!==32},DRAG:{events:23,restrict:d=>d.action!==32||d.button!==3},ANY:{events:31,restrict:d=>!0}};function v(d,c){let b=(d.ctrl?16:0)|(d.shift?4:0)|(d.alt?8:0);return d.button===4?(b|=64,b|=d.action):(b|=3&d.button,4&d.button&&(b|=64),8&d.button&&(b|=128),d.action===32?b|=32:d.action!==0||c||(b|=3)),b}let r=String.fromCharCode,a={DEFAULT:d=>{let c=[v(d,!1)+32,d.col+32,d.row+32];return c[0]>255||c[1]>255||c[2]>255?"":`\x1B[M${r(c[0])}${r(c[1])}${r(c[2])}`},SGR:d=>{let c=d.action===0&&d.button!==4?"m":"M";return`\x1B[<${v(d,!0)};${d.col};${d.row}${c}`},SGR_PIXELS:d=>{let c=d.action===0&&d.button!==4?"m":"M";return`\x1B[<${v(d,!0)};${d.x};${d.y}${c}`}},f=s.CoreMouseService=class extends t.Disposable{constructor(d,c){super(),this._bufferService=d,this._coreService=c,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new _.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(let b of Object.keys(e))this.addProtocol(b,e[b]);for(let b of Object.keys(a))this.addEncoding(b,a[b]);this.reset()}addProtocol(d,c){this._protocols[d]=c}addEncoding(d,c){this._encodings[d]=c}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(d){if(!this._protocols[d])throw new Error(`unknown protocol "${d}"`);this._activeProtocol=d,this._onProtocolChange.fire(this._protocols[d].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(d){if(!this._encodings[d])throw new Error(`unknown encoding "${d}"`);this._activeEncoding=d}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(d){if(d.col<0||d.col>=this._bufferService.cols||d.row<0||d.row>=this._bufferService.rows||d.button===4&&d.action===32||d.button===3&&d.action!==32||d.button!==4&&(d.action===2||d.action===3)||(d.col++,d.row++,d.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,d,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(d))return!1;let c=this._encodings[this._activeEncoding](d);return c&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(c):this._coreService.triggerDataEvent(c,!0)),this._lastEvent=d,!0}explainEvents(d){return{down:!!(1&d),up:!!(2&d),drag:!!(4&d),move:!!(8&d),wheel:!!(16&d)}}_equalEvents(d,c,b){if(b){if(d.x!==c.x||d.y!==c.y)return!1}else if(d.col!==c.col||d.row!==c.row)return!1;return d.button===c.button&&d.action===c.action&&d.ctrl===c.ctrl&&d.alt===c.alt&&d.shift===c.shift}};s.CoreMouseService=f=o([u(0,h.IBufferService),u(1,h.ICoreService)],f)},83:function(p,s,n){var o=this&&this.__decorate||function(f,d,c,b){var S,y=arguments.length,m=y<3?d:b===null?b=Object.getOwnPropertyDescriptor(d,c):b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(f,d,c,b);else for(var A=f.length-1;A>=0;A--)(S=f[A])&&(m=(y<3?S(m):y>3?S(d,c,m):S(d,c))||m);return y>3&&m&&Object.defineProperty(d,c,m),m},u=this&&this.__param||function(f,d){return function(c,b){d(c,b,f)}};Object.defineProperty(s,"__esModule",{value:!0}),s.CoreService=void 0;let h=n(439),_=n(460),t=n(844),e=n(585),v=Object.freeze({insertMode:!1}),r=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0}),a=s.CoreService=class extends t.Disposable{constructor(f,d,c){super(),this._bufferService=f,this._logService=d,this._optionsService=c,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new _.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new _.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new _.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new _.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,h.clone)(v),this.decPrivateModes=(0,h.clone)(r)}reset(){this.modes=(0,h.clone)(v),this.decPrivateModes=(0,h.clone)(r)}triggerDataEvent(f,d=!1){if(this._optionsService.rawOptions.disableStdin)return;let c=this._bufferService.buffer;d&&this._optionsService.rawOptions.scrollOnUserInput&&c.ybase!==c.ydisp&&this._onRequestScrollToBottom.fire(),d&&this._onUserInput.fire(),this._logService.debug(`sending data "${f}"`,()=>f.split("").map(b=>b.charCodeAt(0))),this._onData.fire(f)}triggerBinaryEvent(f){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${f}"`,()=>f.split("").map(d=>d.charCodeAt(0))),this._onBinary.fire(f))}};s.CoreService=a=o([u(0,e.IBufferService),u(1,e.ILogService),u(2,e.IOptionsService)],a)},348:(p,s,n)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.InstantiationService=s.ServiceCollection=void 0;let o=n(585),u=n(343);class h{constructor(...t){this._entries=new Map;for(let[e,v]of t)this.set(e,v)}set(t,e){let v=this._entries.get(t);return this._entries.set(t,e),v}forEach(t){for(let[e,v]of this._entries.entries())t(e,v)}has(t){return this._entries.has(t)}get(t){return this._entries.get(t)}}s.ServiceCollection=h,s.InstantiationService=class{constructor(){this._services=new h,this._services.set(o.IInstantiationService,this)}setService(_,t){this._services.set(_,t)}getService(_){return this._services.get(_)}createInstance(_,...t){let e=(0,u.getServiceDependencies)(_).sort((a,f)=>a.index-f.index),v=[];for(let a of e){let f=this._services.get(a.id);if(!f)throw new Error(`[createInstance] ${_.name} depends on UNKNOWN service ${a.id}.`);v.push(f)}let r=e.length>0?e[0].index:t.length;if(t.length!==r)throw new Error(`[createInstance] First service dependency of ${_.name} at position ${r+1} conflicts with ${t.length} static arguments`);return new _(...t,...v)}}},866:function(p,s,n){var o=this&&this.__decorate||function(r,a,f,d){var c,b=arguments.length,S=b<3?a:d===null?d=Object.getOwnPropertyDescriptor(a,f):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(r,a,f,d);else for(var y=r.length-1;y>=0;y--)(c=r[y])&&(S=(b<3?c(S):b>3?c(a,f,S):c(a,f))||S);return b>3&&S&&Object.defineProperty(a,f,S),S},u=this&&this.__param||function(r,a){return function(f,d){a(f,d,r)}};Object.defineProperty(s,"__esModule",{value:!0}),s.traceCall=s.setTraceLogger=s.LogService=void 0;let h=n(844),_=n(585),t={trace:_.LogLevelEnum.TRACE,debug:_.LogLevelEnum.DEBUG,info:_.LogLevelEnum.INFO,warn:_.LogLevelEnum.WARN,error:_.LogLevelEnum.ERROR,off:_.LogLevelEnum.OFF},e,v=s.LogService=class extends h.Disposable{get logLevel(){return this._logLevel}constructor(r){super(),this._optionsService=r,this._logLevel=_.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),e=this}_updateLogLevel(){this._logLevel=t[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(r){for(let a=0;a<r.length;a++)typeof r[a]=="function"&&(r[a]=r[a]())}_log(r,a,f){this._evalLazyOptionalParams(f),r.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+a,...f)}trace(r,...a){this._logLevel<=_.LogLevelEnum.TRACE&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,r,a)}debug(r,...a){this._logLevel<=_.LogLevelEnum.DEBUG&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,r,a)}info(r,...a){this._logLevel<=_.LogLevelEnum.INFO&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,r,a)}warn(r,...a){this._logLevel<=_.LogLevelEnum.WARN&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,r,a)}error(r,...a){this._logLevel<=_.LogLevelEnum.ERROR&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,r,a)}};s.LogService=v=o([u(0,_.IOptionsService)],v),s.setTraceLogger=function(r){e=r},s.traceCall=function(r,a,f){if(typeof f.value!="function")throw new Error("not supported");let d=f.value;f.value=function(...c){if(e.logLevel!==_.LogLevelEnum.TRACE)return d.apply(this,c);e.trace(`GlyphRenderer#${d.name}(${c.map(S=>JSON.stringify(S)).join(", ")})`);let b=d.apply(this,c);return e.trace(`GlyphRenderer#${d.name} return`,b),b}}},302:(p,s,n)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.OptionsService=s.DEFAULT_OPTIONS=void 0;let o=n(460),u=n(844),h=n(114);s.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rescaleOverlappingGlyphs:!1,rightClickSelectsWord:h.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};let _=["normal","bold","100","200","300","400","500","600","700","800","900"];class t extends u.Disposable{constructor(v){super(),this._onOptionChange=this.register(new o.EventEmitter),this.onOptionChange=this._onOptionChange.event;let r={...s.DEFAULT_OPTIONS};for(let a in v)if(a in r)try{let f=v[a];r[a]=this._sanitizeAndValidateOption(a,f)}catch(f){console.error(f)}this.rawOptions=r,this.options={...r},this._setupOptions(),this.register((0,u.toDisposable)(()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null}))}onSpecificOptionChange(v,r){return this.onOptionChange(a=>{a===v&&r(this.rawOptions[v])})}onMultipleOptionChange(v,r){return this.onOptionChange(a=>{v.indexOf(a)!==-1&&r()})}_setupOptions(){let v=a=>{if(!(a in s.DEFAULT_OPTIONS))throw new Error(`No option with key "${a}"`);return this.rawOptions[a]},r=(a,f)=>{if(!(a in s.DEFAULT_OPTIONS))throw new Error(`No option with key "${a}"`);f=this._sanitizeAndValidateOption(a,f),this.rawOptions[a]!==f&&(this.rawOptions[a]=f,this._onOptionChange.fire(a))};for(let a in this.rawOptions){let f={get:v.bind(this,a),set:r.bind(this,a)};Object.defineProperty(this.options,a,f)}}_sanitizeAndValidateOption(v,r){switch(v){case"cursorStyle":if(r||(r=s.DEFAULT_OPTIONS[v]),!function(a){return a==="block"||a==="underline"||a==="bar"}(r))throw new Error(`"${r}" is not a valid value for ${v}`);break;case"wordSeparator":r||(r=s.DEFAULT_OPTIONS[v]);break;case"fontWeight":case"fontWeightBold":if(typeof r=="number"&&1<=r&&r<=1e3)break;r=_.includes(r)?r:s.DEFAULT_OPTIONS[v];break;case"cursorWidth":r=Math.floor(r);case"lineHeight":case"tabStopWidth":if(r<1)throw new Error(`${v} cannot be less than 1, value: ${r}`);break;case"minimumContrastRatio":r=Math.max(1,Math.min(21,Math.round(10*r)/10));break;case"scrollback":if((r=Math.min(r,4294967295))<0)throw new Error(`${v} cannot be less than 0, value: ${r}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(r<=0)throw new Error(`${v} cannot be less than or equal to 0, value: ${r}`);break;case"rows":case"cols":if(!r&&r!==0)throw new Error(`${v} must be numeric, value: ${r}`);break;case"windowsPty":r=r??{}}return r}}s.OptionsService=t},660:function(p,s,n){var o=this&&this.__decorate||function(t,e,v,r){var a,f=arguments.length,d=f<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,v):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(t,e,v,r);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(d=(f<3?a(d):f>3?a(e,v,d):a(e,v))||d);return f>3&&d&&Object.defineProperty(e,v,d),d},u=this&&this.__param||function(t,e){return function(v,r){e(v,r,t)}};Object.defineProperty(s,"__esModule",{value:!0}),s.OscLinkService=void 0;let h=n(585),_=s.OscLinkService=class{constructor(t){this._bufferService=t,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(t){let e=this._bufferService.buffer;if(t.id===void 0){let c=e.addMarker(e.ybase+e.y),b={data:t,id:this._nextId++,lines:[c]};return c.onDispose(()=>this._removeMarkerFromLink(b,c)),this._dataByLinkId.set(b.id,b),b.id}let v=t,r=this._getEntryIdKey(v),a=this._entriesWithId.get(r);if(a)return this.addLineToLink(a.id,e.ybase+e.y),a.id;let f=e.addMarker(e.ybase+e.y),d={id:this._nextId++,key:this._getEntryIdKey(v),data:v,lines:[f]};return f.onDispose(()=>this._removeMarkerFromLink(d,f)),this._entriesWithId.set(d.key,d),this._dataByLinkId.set(d.id,d),d.id}addLineToLink(t,e){let v=this._dataByLinkId.get(t);if(v&&v.lines.every(r=>r.line!==e)){let r=this._bufferService.buffer.addMarker(e);v.lines.push(r),r.onDispose(()=>this._removeMarkerFromLink(v,r))}}getLinkData(t){return this._dataByLinkId.get(t)?.data}_getEntryIdKey(t){return`${t.id};;${t.uri}`}_removeMarkerFromLink(t,e){let v=t.lines.indexOf(e);v!==-1&&(t.lines.splice(v,1),t.lines.length===0&&(t.data.id!==void 0&&this._entriesWithId.delete(t.key),this._dataByLinkId.delete(t.id)))}};s.OscLinkService=_=o([u(0,h.IBufferService)],_)},343:(p,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.createDecorator=s.getServiceDependencies=s.serviceRegistry=void 0;let n="di$target",o="di$dependencies";s.serviceRegistry=new Map,s.getServiceDependencies=function(u){return u[o]||[]},s.createDecorator=function(u){if(s.serviceRegistry.has(u))return s.serviceRegistry.get(u);let h=function(_,t,e){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(v,r,a){r[n]===r?r[o].push({id:v,index:a}):(r[o]=[{id:v,index:a}],r[n]=r)})(h,_,e)};return h.toString=()=>u,s.serviceRegistry.set(u,h),h}},585:(p,s,n)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.IDecorationService=s.IUnicodeService=s.IOscLinkService=s.IOptionsService=s.ILogService=s.LogLevelEnum=s.IInstantiationService=s.ICharsetService=s.ICoreService=s.ICoreMouseService=s.IBufferService=void 0;let o=n(343);var u;s.IBufferService=(0,o.createDecorator)("BufferService"),s.ICoreMouseService=(0,o.createDecorator)("CoreMouseService"),s.ICoreService=(0,o.createDecorator)("CoreService"),s.ICharsetService=(0,o.createDecorator)("CharsetService"),s.IInstantiationService=(0,o.createDecorator)("InstantiationService"),function(h){h[h.TRACE=0]="TRACE",h[h.DEBUG=1]="DEBUG",h[h.INFO=2]="INFO",h[h.WARN=3]="WARN",h[h.ERROR=4]="ERROR",h[h.OFF=5]="OFF"}(u||(s.LogLevelEnum=u={})),s.ILogService=(0,o.createDecorator)("LogService"),s.IOptionsService=(0,o.createDecorator)("OptionsService"),s.IOscLinkService=(0,o.createDecorator)("OscLinkService"),s.IUnicodeService=(0,o.createDecorator)("UnicodeService"),s.IDecorationService=(0,o.createDecorator)("DecorationService")},480:(p,s,n)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.UnicodeService=void 0;let o=n(460),u=n(225);class h{static extractShouldJoin(t){return(1&t)!=0}static extractWidth(t){return t>>1&3}static extractCharKind(t){return t>>3}static createPropertyValue(t,e,v=!1){return(16777215&t)<<3|(3&e)<<1|(v?1:0)}constructor(){this._providers=Object.create(null),this._active="",this._onChange=new o.EventEmitter,this.onChange=this._onChange.event;let t=new u.UnicodeV6;this.register(t),this._active=t.version,this._activeProvider=t}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(t){if(!this._providers[t])throw new Error(`unknown Unicode version "${t}"`);this._active=t,this._activeProvider=this._providers[t],this._onChange.fire(t)}register(t){this._providers[t.version]=t}wcwidth(t){return this._activeProvider.wcwidth(t)}getStringCellWidth(t){let e=0,v=0,r=t.length;for(let a=0;a<r;++a){let f=t.charCodeAt(a);if(55296<=f&&f<=56319){if(++a>=r)return e+this.wcwidth(f);let b=t.charCodeAt(a);56320<=b&&b<=57343?f=1024*(f-55296)+b-56320+65536:e+=this.wcwidth(b)}let d=this.charProperties(f,v),c=h.extractWidth(d);h.extractShouldJoin(d)&&(c-=h.extractWidth(v)),e+=c,v=d}return e}charProperties(t,e){return this._activeProvider.charProperties(t,e)}}s.UnicodeService=h},781:(p,s,n)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.Terminal=void 0;let o=n(437),u=n(969),h=n(460);class _ extends u.CoreTerminal{constructor(e={}){super(e),this._onBell=this.register(new h.EventEmitter),this.onBell=this._onBell.event,this._onCursorMove=this.register(new h.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onTitleChange=this.register(new h.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onA11yCharEmitter=this.register(new h.EventEmitter),this.onA11yChar=this._onA11yCharEmitter.event,this._onA11yTabEmitter=this.register(new h.EventEmitter),this.onA11yTab=this._onA11yTabEmitter.event,this._setup(),this.register(this._inputHandler.onRequestBell(()=>this.bell())),this.register(this._inputHandler.onRequestReset(()=>this.reset())),this.register((0,h.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,h.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,h.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,h.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter))}get buffer(){return this.buffers.active}get markers(){return this.buffer.markers}addMarker(e){if(this.buffer===this.buffers.normal)return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+e)}bell(){this._onBell.fire()}input(e,v=!0){this.coreService.triggerDataEvent(e,v)}resize(e,v){e===this.cols&&v===this.rows||super.resize(e,v)}clear(){if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let e=1;e<this.rows;e++)this.buffer.lines.push(this.buffer.getBlankLine(o.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0})}}reset(){this.options.rows=this.rows,this.options.cols=this.cols,this._setup(),super.reset()}}s.Terminal=_}},g={};function l(p){var s=g[p];if(s!==void 0)return s.exports;var n=g[p]={exports:{}};return T[p].call(n.exports,n,n.exports,l),n.exports}var C={};(()=>{var p=C;Object.defineProperty(p,"__esModule",{value:!0}),p.Terminal=void 0;let s=l(285),n=l(975),o=l(90),u=l(781),h=l(741),_=l(844),t=["cols","rows"];class e extends _.Disposable{constructor(r){super(),this._core=this.register(new u.Terminal(r)),this._addonManager=this.register(new h.AddonManager),this._publicOptions={...this._core.options};let a=d=>this._core.options[d],f=(d,c)=>{this._checkReadonlyOptions(d),this._core.options[d]=c};for(let d in this._core.options){Object.defineProperty(this._publicOptions,d,{get:()=>this._core.options[d],set:b=>{this._checkReadonlyOptions(d),this._core.options[d]=b}});let c={get:a.bind(this,d),set:f.bind(this,d)};Object.defineProperty(this._publicOptions,d,c)}}_checkReadonlyOptions(r){if(t.includes(r))throw new Error(`Option "${r}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.options.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onLineFeed(){return this._core.onLineFeed}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onTitleChange(){return this._core.onTitleChange}get parser(){return this._checkProposedApi(),this._parser||(this._parser=new n.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new o.UnicodeApi(this._core)}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._checkProposedApi(),this._buffer||(this._buffer=this.register(new s.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){let r=this._core.coreService.decPrivateModes,a="none";switch(this._core.coreMouseService.activeProtocol){case"X10":a="x10";break;case"VT200":a="vt200";break;case"DRAG":a="drag";break;case"ANY":a="any"}return{applicationCursorKeysMode:r.applicationCursorKeys,applicationKeypadMode:r.applicationKeypad,bracketedPasteMode:r.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:a,originMode:r.origin,reverseWraparoundMode:r.reverseWraparound,sendFocusMode:r.sendFocus,wraparoundMode:r.wraparound}}get options(){return this._publicOptions}set options(r){for(let a in r)this._publicOptions[a]=r[a]}input(r,a=!0){this._core.input(r,a)}resize(r,a){this._verifyIntegers(r,a),this._core.resize(r,a)}registerMarker(r=0){return this._checkProposedApi(),this._verifyIntegers(r),this._core.addMarker(r)}addMarker(r){return this.registerMarker(r)}dispose(){super.dispose()}scrollLines(r){this._verifyIntegers(r),this._core.scrollLines(r)}scrollPages(r){this._verifyIntegers(r),this._core.scrollPages(r)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(r){this._verifyIntegers(r),this._core.scrollToLine(r)}clear(){this._core.clear()}write(r,a){this._core.write(r,a)}writeln(r,a){this._core.write(r),this._core.write(`\r
`,a)}reset(){this._core.reset()}loadAddon(r){this._addonManager.loadAddon(this,r)}_verifyIntegers(...r){for(let a of r)if(a===1/0||isNaN(a)||a%1!=0)throw new Error("This API only accepts integers")}}p.Terminal=e})();var w=Di;for(var i in C)w[i]=C[i];C.__esModule&&Object.defineProperty(w,"__esModule",{value:!0})})()});var Zt=dt(()=>{});var ce,kt,Rt,Oi=dt(()=>{globalThis.crypto?.subtle&&(ce=globalThis.crypto.subtle);kt=class kt{constructor(g){this.keys=new Map;this.cryptoErrorShown=!1;this.storageKey=g||kt.DEFAULT_STORAGE_KEY,this.loadKeysFromStorage()}ensureCryptoAvailable(){if(!ce)throw this.cryptoErrorShown||(this.showCryptoError(),this.cryptoErrorShown=!0),new Error("Web Crypto API is not available")}showCryptoError(){if(!document.body){console.error("Web Crypto API not available and DOM not ready to show error");return}let g=window.location.hostname,l=g.match(/^(192\.168\.|10\.|172\.(1[6-9]|2[0-9]|3[0-1])\.)/),C=g!=="localhost"&&g!=="127.0.0.1",w=`SSH key operations are unavailable because the Web Crypto API is not accessible.

`;if(l||C&&window.location.protocol==="http:"?(l&&window.location.protocol==="https:"?w+=`Even though you're using HTTPS, browsers block the Web Crypto API on local network IPs.

`:w+=`This happens when accessing TunnelForge over HTTP from non-localhost addresses.

`,w+=`To fix this, use one of these methods:
`,w+=`1. Access via http://localhost:4020 instead
`,w+=`   - Use SSH tunnel: ssh -L 4020:localhost:4020 user@server
`,w+=`2. Enable HTTPS on the server (recommended for production)
`,w+=`3. For Chrome: Enable insecure origins at chrome://flags/#unsafely-treat-insecure-origin-as-secure
`,w+=`   - Add your server URL (e.g., http://192.168.1.100:4020)
`,w+=`   - Restart Chrome after changing the flag
`,w+="   - Note: Firefox also enforces these restrictions since v75"):(w+=`Your browser may not support the Web Crypto API or it may be disabled.
`,w+="Please use a modern browser (Chrome 60+, Firefox 75+, Safari 11+)."),!document.querySelector("#crypto-error-style")){let i=document.createElement("style");i.id="crypto-error-style",i.textContent=`
        .crypto-error-banner {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          background: #dc2626;
          color: white;
          padding: 16px;
          z-index: 9999;
          font-family: monospace;
          white-space: pre-wrap;
          box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
      `,document.head.appendChild(i)}if(!document.querySelector(".crypto-error-banner")){let i=document.createElement("div");i.className="crypto-error-banner",i.textContent=w,document.body.appendChild(i)}}isUnlocked(){return!0}async addKey(g,l){if(this.ensureCryptoAvailable(),!ce)throw new Error("Crypto not available");try{let C=await this.parsePrivateKey(l),w=this.generateKeyId(),i={id:w,name:g,publicKey:C.publicKey,privateKey:l,algorithm:"Ed25519",encrypted:C.encrypted,fingerprint:C.fingerprint,createdAt:new Date().toISOString()};return this.keys.set(w,i),this.saveKeysToStorage(),w}catch(C){throw new Error(`Failed to add SSH key: ${C}`)}}removeKey(g){this.keys.delete(g),this.saveKeysToStorage()}listKeys(){return Array.from(this.keys.values()).map(g=>({id:g.id,name:g.name,publicKey:g.publicKey,algorithm:g.algorithm,encrypted:g.encrypted,fingerprint:g.fingerprint,createdAt:g.createdAt}))}async sign(g,l){if(this.ensureCryptoAvailable(),!ce)throw new Error("Crypto not available");let C=this.keys.get(g);if(!C)throw new Error("SSH key not found");if(!C.privateKey)throw new Error("Private key not available for signing");try{let w=C.privateKey;if(C.encrypted){let n=await this.promptForPassword(C.name);if(!n)throw new Error("Password required for encrypted key");w=await this.decryptPrivateKey(C.privateKey,n)}let i=await this.importPrivateKey(w,C.algorithm),p=this.base64ToArrayBuffer(l),s=await ce.sign({name:"Ed25519"},i,p);return{signature:this.arrayBufferToBase64(s),algorithm:C.algorithm}}catch(w){throw new Error(`Failed to sign data: ${w}`)}}async generateKeyPair(g,l){if(this.ensureCryptoAvailable(),!ce)throw new Error("Crypto not available");console.log(`\u{1F511} SSH Agent: Starting Ed25519 key generation for "${g}"`);try{let w=await ce.generateKey({name:"Ed25519"},!0,["sign","verify"]),i=await ce.exportKey("pkcs8",w.privateKey),p=await ce.exportKey("raw",w.publicKey),s=this.arrayBufferToPEM(i,"PRIVATE KEY"),n=this.convertEd25519ToSSHPublicKey(p),o=!!l;l&&(s=await this.encryptPrivateKey(s,l));let u=this.generateKeyId(),h={id:u,name:g,publicKey:n,privateKey:s,algorithm:"Ed25519",encrypted:o,fingerprint:await this.generateFingerprint(n),createdAt:new Date().toISOString()};return this.keys.set(u,h),await this.saveKeysToStorage(),console.log(`\u{1F511} SSH Agent: Key "${g}" generated successfully with ID: ${u}`),{keyId:u,privateKeyPEM:s}}catch(C){throw new Error(`Failed to generate key pair: ${C}`)}}getPublicKey(g){let l=this.keys.get(g);return l?l.publicKey:null}getPrivateKey(g){let l=this.keys.get(g);return l?l.privateKey:null}async parsePrivateKey(g){let l=g.includes("BEGIN ENCRYPTED PRIVATE KEY")||g.includes("Proc-Type: 4,ENCRYPTED");if(g.includes("BEGIN PRIVATE KEY")||g.includes("BEGIN ENCRYPTED PRIVATE KEY")){let C="ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIImported...";return{publicKey:C,algorithm:"Ed25519",fingerprint:await this.generateFingerprint(C),encrypted:l}}throw new Error("Only Ed25519 private keys are supported")}async importPrivateKey(g,l){if(!ce)throw new Error("Crypto not available");let C=g.replace("-----BEGIN PRIVATE KEY-----","").replace("-----END PRIVATE KEY-----","").replace(/\s/g,""),w=this.base64ToArrayBuffer(C);return ce.importKey("pkcs8",w,{name:"Ed25519"},!1,["sign"])}convertEd25519ToSSHPublicKey(g){let l=new Uint8Array(g),w=new TextEncoder().encode("ssh-ed25519"),i=new ArrayBuffer(4+w.length+4+l.length),p=new DataView(i),s=new Uint8Array(i),n=0;return p.setUint32(n,w.length,!1),n+=4,s.set(w,n),n+=w.length,p.setUint32(n,l.length,!1),n+=4,s.set(l,n),`ssh-ed25519 ${this.arrayBufferToBase64(i)}`}async generateFingerprint(g){if(!ce)throw new Error("Crypto not available");let l=new TextEncoder,C=await ce.digest("SHA-256",l.encode(g));return this.arrayBufferToBase64(C).substring(0,16)}generateKeyId(){return window.crypto.randomUUID()}arrayBufferToBase64(g){let l=new Uint8Array(g),C="";for(let w=0;w<l.length;w++)C+=String.fromCharCode(l[w]);return btoa(C)}base64ToArrayBuffer(g){let l=atob(g),C=new Uint8Array(l.length);for(let w=0;w<l.length;w++)C[w]=l.charCodeAt(w);return C.buffer}arrayBufferToPEM(g,l){let w=this.arrayBufferToBase64(g).match(/.{1,64}/g)||[];return`-----BEGIN ${l}-----
${w.join(`
`)}
-----END ${l}-----`}async loadKeysFromStorage(){try{let g=localStorage.getItem(this.storageKey);if(g){let l=JSON.parse(g);this.keys.clear(),l.forEach(C=>this.keys.set(C.id,C))}}catch(g){console.error("Failed to load SSH keys from storage:",g)}}async saveKeysToStorage(){try{let g=Array.from(this.keys.values());localStorage.setItem(this.storageKey,JSON.stringify(g))}catch(g){console.error("Failed to save SSH keys to storage:",g)}}async encryptPrivateKey(g,l){if(!ce)throw new Error("Crypto not available");let C=new TextEncoder,w=C.encode(g),i=await ce.importKey("raw",C.encode(l),{name:"PBKDF2"},!1,["deriveKey"]),p=crypto.getRandomValues(new Uint8Array(16)),s=await ce.deriveKey({name:"PBKDF2",salt:p,iterations:1e5,hash:"SHA-256"},i,{name:"AES-GCM",length:256},!1,["encrypt"]),n=crypto.getRandomValues(new Uint8Array(12)),o=await ce.encrypt({name:"AES-GCM",iv:n},s,w),u=new Uint8Array(p.length+n.length+o.byteLength);return u.set(p,0),u.set(n,p.length),u.set(new Uint8Array(o),p.length+n.length),`-----BEGIN ENCRYPTED PRIVATE KEY-----
${this.arrayBufferToBase64(u.buffer)}
-----END ENCRYPTED PRIVATE KEY-----`}async decryptPrivateKey(g,l){if(!ce)throw new Error("Crypto not available");let C=g.replace("-----BEGIN ENCRYPTED PRIVATE KEY-----","").replace("-----END ENCRYPTED PRIVATE KEY-----","").replace(/\s/g,""),w=this.base64ToArrayBuffer(C),i=new Uint8Array(w),p=i.slice(0,16),s=i.slice(16,28),n=i.slice(28),o=new TextEncoder,u=await ce.importKey("raw",o.encode(l),{name:"PBKDF2"},!1,["deriveKey"]),h=await ce.deriveKey({name:"PBKDF2",salt:p,iterations:1e5,hash:"SHA-256"},u,{name:"AES-GCM",length:256},!1,["decrypt"]),_=await ce.decrypt({name:"AES-GCM",iv:s},h,n);return new TextDecoder().decode(_)}async promptForPassword(g){return window.prompt(`Enter password for SSH key "${g}":`)}};kt.DEFAULT_STORAGE_KEY="tunnelforge_ssh_keys";Rt=kt});var $i={};is($i,{AuthClient:()=>Dt,authClient:()=>ws});var _e,Le,Dt,ws,Fi=dt(()=>{Zt();qe();Oi();_e=Ae("auth-client"),Le=class Le{constructor(){this.currentUser=null;this.sshAgent=new Rt,this.loadCurrentUser()}getSSHAgent(){return this.sshAgent}isAuthenticated(){return this.currentUser!==null&&this.isTokenValid()}getCurrentUser(){return this.currentUser}async getCurrentSystemUser(){try{let g=await fetch("/api/auth/current-user");if(g.ok)return(await g.json()).userId;throw new Error("Failed to get current user")}catch(g){throw _e.error("Failed to get current system user:",g),g}}async getUserAvatar(g){try{let s=await fetch(`/api/auth/avatar/${g}`);if(s.ok){let n=await s.json();if(n.avatar&&n.avatar.startsWith("data:"))return n.avatar}}catch(s){_e.error("Failed to get user avatar:",s)}let l=getComputedStyle(document.documentElement),C=l.getPropertyValue("--color-text-dim").trim().split(" ").map(s=>Number.parseInt(s)),w=l.getPropertyValue("--color-text-muted").trim().split(" ").map(s=>Number.parseInt(s)),i=`rgb(${C.join(", ")})`,p=`rgb(${w.join(", ")})`;return"data:image/svg+xml;base64,"+btoa(`
      <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="24" cy="24" r="24" fill="${i}"/>
        <circle cx="24" cy="18" r="8" fill="${p}"/>
        <path d="M8 38c0-8.837 7.163-16 16-16s16 7.163 16 16" fill="${p}"/>
      </svg>
    `)}async authenticateWithSSHKey(g,l){try{if(!this.sshAgent.isUnlocked())return{success:!1,error:"SSH agent is locked"};let C=await this.createChallenge(g),w=await this.sshAgent.sign(l,C.challenge),i=this.sshAgent.getPublicKey(l);if(!i)return{success:!1,error:"SSH key not found"};let s=await(await fetch("/api/auth/ssh-key",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challengeId:C.challengeId,publicKey:i,signature:w.signature})})).json();return _e.log("\u{1F510} SSH key auth server response:",s),s.success?(_e.log("\u2705 SSH key auth successful, setting current user"),this.setCurrentUser({userId:s.userId,token:s.token,authMethod:"ssh-key",loginTime:Date.now()}),_e.log("\u{1F464} Current user set:",this.getCurrentUser())):_e.log("\u274C SSH key auth failed:",s.error),s}catch(C){return _e.error("SSH key authentication failed:",C),{success:!1,error:"SSH key authentication failed"}}}async authenticateWithPassword(g,l){try{let w=await(await fetch("/api/auth/password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:g,password:l})})).json();return w.success&&this.setCurrentUser({userId:w.userId,token:w.token,authMethod:"password",loginTime:Date.now()}),w}catch(C){return _e.error("Password authentication failed:",C),{success:!1,error:"Password authentication failed"}}}async authenticate(g){if(_e.log("\u{1F680} Starting SSH authentication for user:",g),this.sshAgent.isUnlocked()){let l=this.sshAgent.listKeys();_e.log("\u{1F5DD}\uFE0F Found SSH keys:",l.length,l.map(C=>({id:C.id,name:C.name})));for(let C of l)try{_e.log(`\u{1F511} Trying SSH key: ${C.name} (${C.id})`);let w=await this.authenticateWithSSHKey(g,C.id);if(_e.log(`\u{1F3AF} SSH key ${C.name} result:`,w),w.success)return _e.log(`\u2705 Authenticated with SSH key: ${C.name}`),w}catch(w){_e.warn(`\u274C SSH key authentication failed for key ${C.name}:`,w)}}else _e.log("\u{1F512} SSH agent is locked");return{success:!1,error:"SSH key authentication failed. Password authentication required."}}async logout(){try{this.currentUser?.token&&await fetch("/api/auth/logout",{method:"POST",headers:{Authorization:`Bearer ${this.currentUser.token}`,"Content-Type":"application/json"}})}catch(g){_e.warn("Server logout failed:",g)}finally{this.clearCurrentUser()}}getAuthHeader(){return this.currentUser?.token?{Authorization:`Bearer ${this.currentUser.token}`}:{}}async fetch(g,l){let C={...this.getAuthHeader(),...l?.headers||{}};return fetch(g,{...l,headers:C})}async verifyToken(){if(!this.currentUser?.token)return!1;try{return(await(await fetch("/api/auth/verify",{headers:{Authorization:`Bearer ${this.currentUser.token}`}})).json()).valid}catch(g){return _e.error("Token verification failed:",g),!1}}async unlockSSHAgent(g){return!0}lockSSHAgent(){}isSSHAgentUnlocked(){return!0}async createChallenge(g){let l=await fetch("/api/auth/challenge",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:g})});if(!l.ok)throw new Error("Failed to create authentication challenge");return l.json()}setCurrentUser(g){this.currentUser=g,this.saveCurrentUser()}setNoAuthUser(g){this.setCurrentUser({userId:g,token:"no-auth-token",authMethod:"password",loginTime:Date.now()}),_e.log("\u{1F464} No-auth user set:",this.getCurrentUser())}clearCurrentUser(){this.currentUser=null,localStorage.removeItem(Le.TOKEN_KEY),localStorage.removeItem(Le.USER_KEY)}saveCurrentUser(){this.currentUser&&(localStorage.setItem(Le.TOKEN_KEY,this.currentUser.token),localStorage.setItem(Le.USER_KEY,JSON.stringify({userId:this.currentUser.userId,authMethod:this.currentUser.authMethod,loginTime:this.currentUser.loginTime})))}loadCurrentUser(){try{let g=localStorage.getItem(Le.TOKEN_KEY),l=localStorage.getItem(Le.USER_KEY);if(g&&l){let C=JSON.parse(l);this.currentUser={token:g,userId:C.userId,authMethod:C.authMethod,loginTime:C.loginTime},this.verifyToken().then(w=>{w||this.clearCurrentUser()})}}catch(g){_e.error("Failed to load current user:",g),this.clearCurrentUser()}}isTokenValid(){if(!this.currentUser)return!1;let g=Date.now()-this.currentUser.loginTime,l=1440*60*1e3;return g<l}};Le.TOKEN_KEY="tunnelforge_auth_token",Le.USER_KEY="tunnelforge_user_data";Dt=Le,ws=new Dt});async function Ls(){let T=Date.now();if(nt&&T-nt.timestamp<xs)return nt.noAuth;try{let g=await fetch("/api/auth/config");if(g.ok)return nt={noAuth:(await g.json()).noAuth===!0,timestamp:T},nt.noAuth}catch{}return!1}function As(T){return T.map(g=>{if(typeof g=="object"&&g!==null)try{return JSON.stringify(g,null,2)}catch{return String(g)}return g})}async function Es(T,g,l){try{let{authClient:C}=await Promise.resolve().then(()=>(Fi(),$i)),w=C.getAuthHeader(),i=await Ls();if(!w.Authorization&&!i)return;let p={"Content-Type":"application/json"};w.Authorization&&(p.Authorization=w.Authorization),await fetch("/api/logs/client",{method:"POST",headers:p,body:JSON.stringify({level:T,module:g,args:As(l)})})}catch{}}function Ae(T){let g=l=>(...C)=>{l==="debug"&&!Ss||(console[l](`[${T}]`,...C),Es(l,T,C))};return{log:g("log"),warn:g("warn"),error:g("error"),debug:g("debug")}}var Ss,nt,xs,qe=dt(()=>{Zt();Ss=!1,nt=null,xs=6e4});var qi=ut((Pt,ai)=>{(function(T,g){typeof Pt=="object"&&typeof ai=="object"?ai.exports=g():typeof define=="function"&&define.amd?define([],g):typeof Pt=="object"?Pt.WebglAddon=g():T.WebglAddon=g()})(self,()=>(()=>{"use strict";var T={965:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.GlyphRenderer=void 0;let s=p(374),n=p(509),o=p(855),u=p(859),h=p(381),_=11,t=_*Float32Array.BYTES_PER_ELEMENT,e,v=0,r=0,a=0;class f extends u.Disposable{constructor(c,b,S,y){super(),this._terminal=c,this._gl=b,this._dimensions=S,this._optionsService=y,this._activeBuffer=0,this._vertices={count:0,attributes:new Float32Array(0),attributesBuffers:[new Float32Array(0),new Float32Array(0)]};let m=this._gl;n.TextureAtlas.maxAtlasPages===void 0&&(n.TextureAtlas.maxAtlasPages=Math.min(32,(0,s.throwIfFalsy)(m.getParameter(m.MAX_TEXTURE_IMAGE_UNITS))),n.TextureAtlas.maxTextureSize=(0,s.throwIfFalsy)(m.getParameter(m.MAX_TEXTURE_SIZE))),this._program=(0,s.throwIfFalsy)((0,h.createProgram)(m,`#version 300 es
layout (location = 0) in vec2 a_unitquad;
layout (location = 1) in vec2 a_cellpos;
layout (location = 2) in vec2 a_offset;
layout (location = 3) in vec2 a_size;
layout (location = 4) in float a_texpage;
layout (location = 5) in vec2 a_texcoord;
layout (location = 6) in vec2 a_texsize;

uniform mat4 u_projection;
uniform vec2 u_resolution;

out vec2 v_texcoord;
flat out int v_texpage;

void main() {
  vec2 zeroToOne = (a_offset / u_resolution) + a_cellpos + (a_unitquad * a_size);
  gl_Position = u_projection * vec4(zeroToOne, 0.0, 1.0);
  v_texpage = int(a_texpage);
  v_texcoord = a_texcoord + a_unitquad * a_texsize;
}`,function(F){let O="";for(let P=1;P<F;P++)O+=` else if (v_texpage == ${P}) { outColor = texture(u_texture[${P}], v_texcoord); }`;return`#version 300 es
precision lowp float;

in vec2 v_texcoord;
flat in int v_texpage;

uniform sampler2D u_texture[${F}];

out vec4 outColor;

void main() {
  if (v_texpage == 0) {
    outColor = texture(u_texture[0], v_texcoord);
  } ${O}
}`}(n.TextureAtlas.maxAtlasPages))),this.register((0,u.toDisposable)(()=>m.deleteProgram(this._program))),this._projectionLocation=(0,s.throwIfFalsy)(m.getUniformLocation(this._program,"u_projection")),this._resolutionLocation=(0,s.throwIfFalsy)(m.getUniformLocation(this._program,"u_resolution")),this._textureLocation=(0,s.throwIfFalsy)(m.getUniformLocation(this._program,"u_texture")),this._vertexArrayObject=m.createVertexArray(),m.bindVertexArray(this._vertexArrayObject);let A=new Float32Array([0,0,1,0,0,1,1,1]),x=m.createBuffer();this.register((0,u.toDisposable)(()=>m.deleteBuffer(x))),m.bindBuffer(m.ARRAY_BUFFER,x),m.bufferData(m.ARRAY_BUFFER,A,m.STATIC_DRAW),m.enableVertexAttribArray(0),m.vertexAttribPointer(0,2,this._gl.FLOAT,!1,0,0);let M=new Uint8Array([0,1,2,3]),E=m.createBuffer();this.register((0,u.toDisposable)(()=>m.deleteBuffer(E))),m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,E),m.bufferData(m.ELEMENT_ARRAY_BUFFER,M,m.STATIC_DRAW),this._attributesBuffer=(0,s.throwIfFalsy)(m.createBuffer()),this.register((0,u.toDisposable)(()=>m.deleteBuffer(this._attributesBuffer))),m.bindBuffer(m.ARRAY_BUFFER,this._attributesBuffer),m.enableVertexAttribArray(2),m.vertexAttribPointer(2,2,m.FLOAT,!1,t,0),m.vertexAttribDivisor(2,1),m.enableVertexAttribArray(3),m.vertexAttribPointer(3,2,m.FLOAT,!1,t,2*Float32Array.BYTES_PER_ELEMENT),m.vertexAttribDivisor(3,1),m.enableVertexAttribArray(4),m.vertexAttribPointer(4,1,m.FLOAT,!1,t,4*Float32Array.BYTES_PER_ELEMENT),m.vertexAttribDivisor(4,1),m.enableVertexAttribArray(5),m.vertexAttribPointer(5,2,m.FLOAT,!1,t,5*Float32Array.BYTES_PER_ELEMENT),m.vertexAttribDivisor(5,1),m.enableVertexAttribArray(6),m.vertexAttribPointer(6,2,m.FLOAT,!1,t,7*Float32Array.BYTES_PER_ELEMENT),m.vertexAttribDivisor(6,1),m.enableVertexAttribArray(1),m.vertexAttribPointer(1,2,m.FLOAT,!1,t,9*Float32Array.BYTES_PER_ELEMENT),m.vertexAttribDivisor(1,1),m.useProgram(this._program);let I=new Int32Array(n.TextureAtlas.maxAtlasPages);for(let F=0;F<n.TextureAtlas.maxAtlasPages;F++)I[F]=F;m.uniform1iv(this._textureLocation,I),m.uniformMatrix4fv(this._projectionLocation,!1,h.PROJECTION_MATRIX),this._atlasTextures=[];for(let F=0;F<n.TextureAtlas.maxAtlasPages;F++){let O=new h.GLTexture((0,s.throwIfFalsy)(m.createTexture()));this.register((0,u.toDisposable)(()=>m.deleteTexture(O.texture))),m.activeTexture(m.TEXTURE0+F),m.bindTexture(m.TEXTURE_2D,O.texture),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texImage2D(m.TEXTURE_2D,0,m.RGBA,1,1,0,m.RGBA,m.UNSIGNED_BYTE,new Uint8Array([255,0,0,255])),this._atlasTextures[F]=O}m.enable(m.BLEND),m.blendFunc(m.SRC_ALPHA,m.ONE_MINUS_SRC_ALPHA),this.handleResize()}beginFrame(){return!this._atlas||this._atlas.beginFrame()}updateCell(c,b,S,y,m,A,x,M,E){this._updateCell(this._vertices.attributes,c,b,S,y,m,A,x,M,E)}_updateCell(c,b,S,y,m,A,x,M,E,I){v=(S*this._terminal.cols+b)*_,y!==o.NULL_CELL_CODE&&y!==void 0?this._atlas&&(e=M&&M.length>1?this._atlas.getRasterizedGlyphCombinedChar(M,m,A,x,!1):this._atlas.getRasterizedGlyph(y,m,A,x,!1),r=Math.floor((this._dimensions.device.cell.width-this._dimensions.device.char.width)/2),m!==I&&e.offset.x>r?(a=e.offset.x-r,c[v]=-(e.offset.x-a)+this._dimensions.device.char.left,c[v+1]=-e.offset.y+this._dimensions.device.char.top,c[v+2]=(e.size.x-a)/this._dimensions.device.canvas.width,c[v+3]=e.size.y/this._dimensions.device.canvas.height,c[v+4]=e.texturePage,c[v+5]=e.texturePositionClipSpace.x+a/this._atlas.pages[e.texturePage].canvas.width,c[v+6]=e.texturePositionClipSpace.y,c[v+7]=e.sizeClipSpace.x-a/this._atlas.pages[e.texturePage].canvas.width,c[v+8]=e.sizeClipSpace.y):(c[v]=-e.offset.x+this._dimensions.device.char.left,c[v+1]=-e.offset.y+this._dimensions.device.char.top,c[v+2]=e.size.x/this._dimensions.device.canvas.width,c[v+3]=e.size.y/this._dimensions.device.canvas.height,c[v+4]=e.texturePage,c[v+5]=e.texturePositionClipSpace.x,c[v+6]=e.texturePositionClipSpace.y,c[v+7]=e.sizeClipSpace.x,c[v+8]=e.sizeClipSpace.y),this._optionsService.rawOptions.rescaleOverlappingGlyphs&&(0,s.allowRescaling)(y,E,e.size.x,this._dimensions.device.cell.width)&&(c[v+2]=(this._dimensions.device.cell.width-1)/this._dimensions.device.canvas.width)):c.fill(0,v,v+_-1-2)}clear(){let c=this._terminal,b=c.cols*c.rows*_;this._vertices.count!==b?this._vertices.attributes=new Float32Array(b):this._vertices.attributes.fill(0);let S=0;for(;S<this._vertices.attributesBuffers.length;S++)this._vertices.count!==b?this._vertices.attributesBuffers[S]=new Float32Array(b):this._vertices.attributesBuffers[S].fill(0);this._vertices.count=b,S=0;for(let y=0;y<c.rows;y++)for(let m=0;m<c.cols;m++)this._vertices.attributes[S+9]=m/c.cols,this._vertices.attributes[S+10]=y/c.rows,S+=_}handleResize(){let c=this._gl;c.useProgram(this._program),c.viewport(0,0,c.canvas.width,c.canvas.height),c.uniform2f(this._resolutionLocation,c.canvas.width,c.canvas.height),this.clear()}render(c){if(!this._atlas)return;let b=this._gl;b.useProgram(this._program),b.bindVertexArray(this._vertexArrayObject),this._activeBuffer=(this._activeBuffer+1)%2;let S=this._vertices.attributesBuffers[this._activeBuffer],y=0;for(let m=0;m<c.lineLengths.length;m++){let A=m*this._terminal.cols*_,x=this._vertices.attributes.subarray(A,A+c.lineLengths[m]*_);S.set(x,y),y+=x.length}b.bindBuffer(b.ARRAY_BUFFER,this._attributesBuffer),b.bufferData(b.ARRAY_BUFFER,S.subarray(0,y),b.STREAM_DRAW);for(let m=0;m<this._atlas.pages.length;m++)this._atlas.pages[m].version!==this._atlasTextures[m].version&&this._bindAtlasPageTexture(b,this._atlas,m);b.drawElementsInstanced(b.TRIANGLE_STRIP,4,b.UNSIGNED_BYTE,0,y/_)}setAtlas(c){this._atlas=c;for(let b of this._atlasTextures)b.version=-1}_bindAtlasPageTexture(c,b,S){c.activeTexture(c.TEXTURE0+S),c.bindTexture(c.TEXTURE_2D,this._atlasTextures[S].texture),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,b.pages[S].canvas),c.generateMipmap(c.TEXTURE_2D),this._atlasTextures[S].version=b.pages[S].version}setDimensions(c){this._dimensions=c}}i.GlyphRenderer=f},742:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.RectangleRenderer=void 0;let s=p(374),n=p(859),o=p(310),u=p(381),h=8*Float32Array.BYTES_PER_ELEMENT;class _{constructor(){this.attributes=new Float32Array(160),this.count=0}}let t=0,e=0,v=0,r=0,a=0,f=0,d=0;class c extends n.Disposable{constructor(S,y,m,A){super(),this._terminal=S,this._gl=y,this._dimensions=m,this._themeService=A,this._vertices=new _,this._verticesCursor=new _;let x=this._gl;this._program=(0,s.throwIfFalsy)((0,u.createProgram)(x,`#version 300 es
layout (location = 0) in vec2 a_position;
layout (location = 1) in vec2 a_size;
layout (location = 2) in vec4 a_color;
layout (location = 3) in vec2 a_unitquad;

uniform mat4 u_projection;

out vec4 v_color;

void main() {
  vec2 zeroToOne = a_position + (a_unitquad * a_size);
  gl_Position = u_projection * vec4(zeroToOne, 0.0, 1.0);
  v_color = a_color;
}`,`#version 300 es
precision lowp float;

in vec4 v_color;

out vec4 outColor;

void main() {
  outColor = v_color;
}`)),this.register((0,n.toDisposable)(()=>x.deleteProgram(this._program))),this._projectionLocation=(0,s.throwIfFalsy)(x.getUniformLocation(this._program,"u_projection")),this._vertexArrayObject=x.createVertexArray(),x.bindVertexArray(this._vertexArrayObject);let M=new Float32Array([0,0,1,0,0,1,1,1]),E=x.createBuffer();this.register((0,n.toDisposable)(()=>x.deleteBuffer(E))),x.bindBuffer(x.ARRAY_BUFFER,E),x.bufferData(x.ARRAY_BUFFER,M,x.STATIC_DRAW),x.enableVertexAttribArray(3),x.vertexAttribPointer(3,2,this._gl.FLOAT,!1,0,0);let I=new Uint8Array([0,1,2,3]),F=x.createBuffer();this.register((0,n.toDisposable)(()=>x.deleteBuffer(F))),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,F),x.bufferData(x.ELEMENT_ARRAY_BUFFER,I,x.STATIC_DRAW),this._attributesBuffer=(0,s.throwIfFalsy)(x.createBuffer()),this.register((0,n.toDisposable)(()=>x.deleteBuffer(this._attributesBuffer))),x.bindBuffer(x.ARRAY_BUFFER,this._attributesBuffer),x.enableVertexAttribArray(0),x.vertexAttribPointer(0,2,x.FLOAT,!1,h,0),x.vertexAttribDivisor(0,1),x.enableVertexAttribArray(1),x.vertexAttribPointer(1,2,x.FLOAT,!1,h,2*Float32Array.BYTES_PER_ELEMENT),x.vertexAttribDivisor(1,1),x.enableVertexAttribArray(2),x.vertexAttribPointer(2,4,x.FLOAT,!1,h,4*Float32Array.BYTES_PER_ELEMENT),x.vertexAttribDivisor(2,1),this._updateCachedColors(A.colors),this.register(this._themeService.onChangeColors(O=>{this._updateCachedColors(O),this._updateViewportRectangle()}))}renderBackgrounds(){this._renderVertices(this._vertices)}renderCursor(){this._renderVertices(this._verticesCursor)}_renderVertices(S){let y=this._gl;y.useProgram(this._program),y.bindVertexArray(this._vertexArrayObject),y.uniformMatrix4fv(this._projectionLocation,!1,u.PROJECTION_MATRIX),y.bindBuffer(y.ARRAY_BUFFER,this._attributesBuffer),y.bufferData(y.ARRAY_BUFFER,S.attributes,y.DYNAMIC_DRAW),y.drawElementsInstanced(this._gl.TRIANGLE_STRIP,4,y.UNSIGNED_BYTE,0,S.count)}handleResize(){this._updateViewportRectangle()}setDimensions(S){this._dimensions=S}_updateCachedColors(S){this._bgFloat=this._colorToFloat32Array(S.background),this._cursorFloat=this._colorToFloat32Array(S.cursor)}_updateViewportRectangle(){this._addRectangleFloat(this._vertices.attributes,0,0,0,this._terminal.cols*this._dimensions.device.cell.width,this._terminal.rows*this._dimensions.device.cell.height,this._bgFloat)}updateBackgrounds(S){let y=this._terminal,m=this._vertices,A,x,M,E,I,F,O,P,H,$,L,R=1;for(A=0;A<y.rows;A++){for(M=-1,E=0,I=0,F=!1,x=0;x<y.cols;x++)O=(A*y.cols+x)*o.RENDER_MODEL_INDICIES_PER_CELL,P=S.cells[O+o.RENDER_MODEL_BG_OFFSET],H=S.cells[O+o.RENDER_MODEL_FG_OFFSET],$=!!(67108864&H),(P!==E||H!==I&&(F||$))&&((E!==0||F&&I!==0)&&(L=8*R++,this._updateRectangle(m,L,I,E,M,x,A)),M=x,E=P,I=H,F=$);(E!==0||F&&I!==0)&&(L=8*R++,this._updateRectangle(m,L,I,E,M,y.cols,A))}m.count=R}updateCursor(S){let y=this._verticesCursor,m=S.cursor;if(!m||m.style==="block")return void(y.count=0);let A,x=0;m.style!=="bar"&&m.style!=="outline"||(A=8*x++,this._addRectangleFloat(y.attributes,A,m.x*this._dimensions.device.cell.width,m.y*this._dimensions.device.cell.height,m.style==="bar"?m.dpr*m.cursorWidth:m.dpr,this._dimensions.device.cell.height,this._cursorFloat)),m.style!=="underline"&&m.style!=="outline"||(A=8*x++,this._addRectangleFloat(y.attributes,A,m.x*this._dimensions.device.cell.width,(m.y+1)*this._dimensions.device.cell.height-m.dpr,m.width*this._dimensions.device.cell.width,m.dpr,this._cursorFloat)),m.style==="outline"&&(A=8*x++,this._addRectangleFloat(y.attributes,A,m.x*this._dimensions.device.cell.width,m.y*this._dimensions.device.cell.height,m.width*this._dimensions.device.cell.width,m.dpr,this._cursorFloat),A=8*x++,this._addRectangleFloat(y.attributes,A,(m.x+m.width)*this._dimensions.device.cell.width-m.dpr,m.y*this._dimensions.device.cell.height,m.dpr,this._dimensions.device.cell.height,this._cursorFloat)),y.count=x}_updateRectangle(S,y,m,A,x,M,E){if(67108864&m)switch(50331648&m){case 16777216:case 33554432:t=this._themeService.colors.ansi[255&m].rgba;break;case 50331648:t=(16777215&m)<<8;break;default:t=this._themeService.colors.foreground.rgba}else switch(50331648&A){case 16777216:case 33554432:t=this._themeService.colors.ansi[255&A].rgba;break;case 50331648:t=(16777215&A)<<8;break;default:t=this._themeService.colors.background.rgba}S.attributes.length<y+4&&(S.attributes=(0,u.expandFloat32Array)(S.attributes,this._terminal.rows*this._terminal.cols*8)),e=x*this._dimensions.device.cell.width,v=E*this._dimensions.device.cell.height,r=(t>>24&255)/255,a=(t>>16&255)/255,f=(t>>8&255)/255,d=1,this._addRectangle(S.attributes,y,e,v,(M-x)*this._dimensions.device.cell.width,this._dimensions.device.cell.height,r,a,f,d)}_addRectangle(S,y,m,A,x,M,E,I,F,O){S[y]=m/this._dimensions.device.canvas.width,S[y+1]=A/this._dimensions.device.canvas.height,S[y+2]=x/this._dimensions.device.canvas.width,S[y+3]=M/this._dimensions.device.canvas.height,S[y+4]=E,S[y+5]=I,S[y+6]=F,S[y+7]=O}_addRectangleFloat(S,y,m,A,x,M,E){S[y]=m/this._dimensions.device.canvas.width,S[y+1]=A/this._dimensions.device.canvas.height,S[y+2]=x/this._dimensions.device.canvas.width,S[y+3]=M/this._dimensions.device.canvas.height,S[y+4]=E[0],S[y+5]=E[1],S[y+6]=E[2],S[y+7]=E[3]}_colorToFloat32Array(S){return new Float32Array([(S.rgba>>24&255)/255,(S.rgba>>16&255)/255,(S.rgba>>8&255)/255,(255&S.rgba)/255])}}i.RectangleRenderer=c},310:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.RenderModel=i.COMBINED_CHAR_BIT_MASK=i.RENDER_MODEL_EXT_OFFSET=i.RENDER_MODEL_FG_OFFSET=i.RENDER_MODEL_BG_OFFSET=i.RENDER_MODEL_INDICIES_PER_CELL=void 0;let s=p(296);i.RENDER_MODEL_INDICIES_PER_CELL=4,i.RENDER_MODEL_BG_OFFSET=1,i.RENDER_MODEL_FG_OFFSET=2,i.RENDER_MODEL_EXT_OFFSET=3,i.COMBINED_CHAR_BIT_MASK=2147483648,i.RenderModel=class{constructor(){this.cells=new Uint32Array(0),this.lineLengths=new Uint32Array(0),this.selection=(0,s.createSelectionRenderModel)()}resize(n,o){let u=n*o*i.RENDER_MODEL_INDICIES_PER_CELL;u!==this.cells.length&&(this.cells=new Uint32Array(u),this.lineLengths=new Uint32Array(o))}clear(){this.cells.fill(0,0),this.lineLengths.fill(0,0)}}},666:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.JoinedCellData=i.WebglRenderer=void 0;let s=p(820),n=p(274),o=p(627),u=p(457),h=p(56),_=p(374),t=p(345),e=p(859),v=p(147),r=p(782),a=p(855),f=p(965),d=p(742),c=p(310),b=p(733);class S extends e.Disposable{constructor(x,M,E,I,F,O,P,H,$){super(),this._terminal=x,this._characterJoinerService=M,this._charSizeService=E,this._coreBrowserService=I,this._coreService=F,this._decorationService=O,this._optionsService=P,this._themeService=H,this._cursorBlinkStateManager=new e.MutableDisposable,this._charAtlasDisposable=this.register(new e.MutableDisposable),this._observerDisposable=this.register(new e.MutableDisposable),this._model=new c.RenderModel,this._workCell=new r.CellData,this._workCell2=new r.CellData,this._rectangleRenderer=this.register(new e.MutableDisposable),this._glyphRenderer=this.register(new e.MutableDisposable),this._onChangeTextureAtlas=this.register(new t.EventEmitter),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this.register(new t.EventEmitter),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=this.register(new t.EventEmitter),this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._onRequestRedraw=this.register(new t.EventEmitter),this.onRequestRedraw=this._onRequestRedraw.event,this._onContextLoss=this.register(new t.EventEmitter),this.onContextLoss=this._onContextLoss.event,this.register(this._themeService.onChangeColors(()=>this._handleColorChange())),this._cellColorResolver=new n.CellColorResolver(this._terminal,this._optionsService,this._model.selection,this._decorationService,this._coreBrowserService,this._themeService),this._core=this._terminal._core,this._renderLayers=[new b.LinkRenderLayer(this._core.screenElement,2,this._terminal,this._core.linkifier,this._coreBrowserService,P,this._themeService)],this.dimensions=(0,_.createRenderDimensions)(),this._devicePixelRatio=this._coreBrowserService.dpr,this._updateDimensions(),this._updateCursorBlink(),this.register(P.onOptionChange(()=>this._handleOptionsChanged())),this._canvas=this._coreBrowserService.mainDocument.createElement("canvas");let L={antialias:!1,depth:!1,preserveDrawingBuffer:$};if(this._gl=this._canvas.getContext("webgl2",L),!this._gl)throw new Error("WebGL2 not supported "+this._gl);this.register((0,s.addDisposableDomListener)(this._canvas,"webglcontextlost",R=>{console.log("webglcontextlost event received"),R.preventDefault(),this._contextRestorationTimeout=setTimeout(()=>{this._contextRestorationTimeout=void 0,console.warn("webgl context not restored; firing onContextLoss"),this._onContextLoss.fire(R)},3e3)})),this.register((0,s.addDisposableDomListener)(this._canvas,"webglcontextrestored",R=>{console.warn("webglcontextrestored event received"),clearTimeout(this._contextRestorationTimeout),this._contextRestorationTimeout=void 0,(0,o.removeTerminalFromCache)(this._terminal),this._initializeWebGLState(),this._requestRedrawViewport()})),this._observerDisposable.value=(0,h.observeDevicePixelDimensions)(this._canvas,this._coreBrowserService.window,(R,k)=>this._setCanvasDevicePixelDimensions(R,k)),this.register(this._coreBrowserService.onWindowChange(R=>{this._observerDisposable.value=(0,h.observeDevicePixelDimensions)(this._canvas,R,(k,B)=>this._setCanvasDevicePixelDimensions(k,B))})),this._core.screenElement.appendChild(this._canvas),[this._rectangleRenderer.value,this._glyphRenderer.value]=this._initializeWebGLState(),this._isAttached=this._coreBrowserService.window.document.body.contains(this._core.screenElement),this.register((0,e.toDisposable)(()=>{for(let R of this._renderLayers)R.dispose();this._canvas.parentElement?.removeChild(this._canvas),(0,o.removeTerminalFromCache)(this._terminal)}))}get textureAtlas(){return this._charAtlas?.pages[0].canvas}_handleColorChange(){this._refreshCharAtlas(),this._clearModel(!0)}handleDevicePixelRatioChange(){this._devicePixelRatio!==this._coreBrowserService.dpr&&(this._devicePixelRatio=this._coreBrowserService.dpr,this.handleResize(this._terminal.cols,this._terminal.rows))}handleResize(x,M){this._updateDimensions(),this._model.resize(this._terminal.cols,this._terminal.rows);for(let E of this._renderLayers)E.resize(this._terminal,this.dimensions);this._canvas.width=this.dimensions.device.canvas.width,this._canvas.height=this.dimensions.device.canvas.height,this._canvas.style.width=`${this.dimensions.css.canvas.width}px`,this._canvas.style.height=`${this.dimensions.css.canvas.height}px`,this._core.screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._core.screenElement.style.height=`${this.dimensions.css.canvas.height}px`,this._rectangleRenderer.value?.setDimensions(this.dimensions),this._rectangleRenderer.value?.handleResize(),this._glyphRenderer.value?.setDimensions(this.dimensions),this._glyphRenderer.value?.handleResize(),this._refreshCharAtlas(),this._clearModel(!1)}handleCharSizeChanged(){this.handleResize(this._terminal.cols,this._terminal.rows)}handleBlur(){for(let x of this._renderLayers)x.handleBlur(this._terminal);this._cursorBlinkStateManager.value?.pause(),this._requestRedrawViewport()}handleFocus(){for(let x of this._renderLayers)x.handleFocus(this._terminal);this._cursorBlinkStateManager.value?.resume(),this._requestRedrawViewport()}handleSelectionChanged(x,M,E){for(let I of this._renderLayers)I.handleSelectionChanged(this._terminal,x,M,E);this._model.selection.update(this._core,x,M,E),this._requestRedrawViewport()}handleCursorMove(){for(let x of this._renderLayers)x.handleCursorMove(this._terminal);this._cursorBlinkStateManager.value?.restartBlinkAnimation()}_handleOptionsChanged(){this._updateDimensions(),this._refreshCharAtlas(),this._updateCursorBlink()}_initializeWebGLState(){return this._rectangleRenderer.value=new d.RectangleRenderer(this._terminal,this._gl,this.dimensions,this._themeService),this._glyphRenderer.value=new f.GlyphRenderer(this._terminal,this._gl,this.dimensions,this._optionsService),this.handleCharSizeChanged(),[this._rectangleRenderer.value,this._glyphRenderer.value]}_refreshCharAtlas(){if(this.dimensions.device.char.width<=0&&this.dimensions.device.char.height<=0)return void(this._isAttached=!1);let x=(0,o.acquireTextureAtlas)(this._terminal,this._optionsService.rawOptions,this._themeService.colors,this.dimensions.device.cell.width,this.dimensions.device.cell.height,this.dimensions.device.char.width,this.dimensions.device.char.height,this._coreBrowserService.dpr);this._charAtlas!==x&&(this._onChangeTextureAtlas.fire(x.pages[0].canvas),this._charAtlasDisposable.value=(0,e.getDisposeArrayDisposable)([(0,t.forwardEvent)(x.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas),(0,t.forwardEvent)(x.onRemoveTextureAtlasCanvas,this._onRemoveTextureAtlasCanvas)])),this._charAtlas=x,this._charAtlas.warmUp(),this._glyphRenderer.value?.setAtlas(this._charAtlas)}_clearModel(x){this._model.clear(),x&&this._glyphRenderer.value?.clear()}clearTextureAtlas(){this._charAtlas?.clearTexture(),this._clearModel(!0),this._requestRedrawViewport()}clear(){this._clearModel(!0);for(let x of this._renderLayers)x.reset(this._terminal);this._cursorBlinkStateManager.value?.restartBlinkAnimation(),this._updateCursorBlink()}registerCharacterJoiner(x){return-1}deregisterCharacterJoiner(x){return!1}renderRows(x,M){if(!this._isAttached){if(!(this._coreBrowserService.window.document.body.contains(this._core.screenElement)&&this._charSizeService.width&&this._charSizeService.height))return;this._updateDimensions(),this._refreshCharAtlas(),this._isAttached=!0}for(let E of this._renderLayers)E.handleGridChanged(this._terminal,x,M);this._glyphRenderer.value&&this._rectangleRenderer.value&&(this._glyphRenderer.value.beginFrame()?(this._clearModel(!0),this._updateModel(0,this._terminal.rows-1)):this._updateModel(x,M),this._rectangleRenderer.value.renderBackgrounds(),this._glyphRenderer.value.render(this._model),this._cursorBlinkStateManager.value&&!this._cursorBlinkStateManager.value.isCursorVisible||this._rectangleRenderer.value.renderCursor())}_updateCursorBlink(){this._terminal.options.cursorBlink?this._cursorBlinkStateManager.value=new u.CursorBlinkStateManager(()=>{this._requestRedrawCursor()},this._coreBrowserService):this._cursorBlinkStateManager.clear(),this._requestRedrawCursor()}_updateModel(x,M){let E=this._core,I,F,O,P,H,$,L,R,k,B,N,W,q,J,Q=this._workCell;x=m(x,E.rows-1,0),M=m(M,E.rows-1,0);let D=this._terminal.buffer.active.baseY+this._terminal.buffer.active.cursorY,se=D-E.buffer.ydisp,K=Math.min(this._terminal.buffer.active.cursorX,E.cols-1),Z=-1,V=this._coreService.isCursorInitialized&&!this._coreService.isCursorHidden&&(!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isCursorVisible);this._model.cursor=void 0;let ue=!1;for(F=x;F<=M;F++)for(O=F+E.buffer.ydisp,P=E.buffer.lines.get(O),this._model.lineLengths[F]=0,H=this._characterJoinerService.getJoinedCharacters(O),q=0;q<E.cols;q++)if(I=this._cellColorResolver.result.bg,P.loadCell(q,Q),q===0&&(I=this._cellColorResolver.result.bg),$=!1,L=q,H.length>0&&q===H[0][0]&&($=!0,R=H.shift(),Q=new y(Q,P.translateToString(!0,R[0],R[1]),R[1]-R[0]),L=R[1]-1),k=Q.getChars(),B=Q.getCode(),W=(F*E.cols+q)*c.RENDER_MODEL_INDICIES_PER_CELL,this._cellColorResolver.resolve(Q,q,O,this.dimensions.device.cell.width),V&&O===D&&(q===K&&(this._model.cursor={x:K,y:se,width:Q.getWidth(),style:this._coreBrowserService.isFocused?E.options.cursorStyle||"block":E.options.cursorInactiveStyle,cursorWidth:E.options.cursorWidth,dpr:this._devicePixelRatio},Z=K+Q.getWidth()-1),q>=K&&q<=Z&&(this._coreBrowserService.isFocused&&(E.options.cursorStyle||"block")==="block"||this._coreBrowserService.isFocused===!1&&E.options.cursorInactiveStyle==="block")&&(this._cellColorResolver.result.fg=50331648|this._themeService.colors.cursorAccent.rgba>>8&16777215,this._cellColorResolver.result.bg=50331648|this._themeService.colors.cursor.rgba>>8&16777215)),B!==a.NULL_CELL_CODE&&(this._model.lineLengths[F]=q+1),(this._model.cells[W]!==B||this._model.cells[W+c.RENDER_MODEL_BG_OFFSET]!==this._cellColorResolver.result.bg||this._model.cells[W+c.RENDER_MODEL_FG_OFFSET]!==this._cellColorResolver.result.fg||this._model.cells[W+c.RENDER_MODEL_EXT_OFFSET]!==this._cellColorResolver.result.ext)&&(ue=!0,k.length>1&&(B|=c.COMBINED_CHAR_BIT_MASK),this._model.cells[W]=B,this._model.cells[W+c.RENDER_MODEL_BG_OFFSET]=this._cellColorResolver.result.bg,this._model.cells[W+c.RENDER_MODEL_FG_OFFSET]=this._cellColorResolver.result.fg,this._model.cells[W+c.RENDER_MODEL_EXT_OFFSET]=this._cellColorResolver.result.ext,N=Q.getWidth(),this._glyphRenderer.value.updateCell(q,F,B,this._cellColorResolver.result.bg,this._cellColorResolver.result.fg,this._cellColorResolver.result.ext,k,N,I),$))for(Q=this._workCell,q++;q<L;q++)J=(F*E.cols+q)*c.RENDER_MODEL_INDICIES_PER_CELL,this._glyphRenderer.value.updateCell(q,F,a.NULL_CELL_CODE,0,0,0,a.NULL_CELL_CHAR,0,0),this._model.cells[J]=a.NULL_CELL_CODE,this._model.cells[J+c.RENDER_MODEL_BG_OFFSET]=this._cellColorResolver.result.bg,this._model.cells[J+c.RENDER_MODEL_FG_OFFSET]=this._cellColorResolver.result.fg,this._model.cells[J+c.RENDER_MODEL_EXT_OFFSET]=this._cellColorResolver.result.ext;ue&&this._rectangleRenderer.value.updateBackgrounds(this._model),this._rectangleRenderer.value.updateCursor(this._model)}_updateDimensions(){this._charSizeService.width&&this._charSizeService.height&&(this.dimensions.device.char.width=Math.floor(this._charSizeService.width*this._devicePixelRatio),this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*this._devicePixelRatio),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.top=this._optionsService.rawOptions.lineHeight===1?0:Math.round((this.dimensions.device.cell.height-this.dimensions.device.char.height)/2),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.char.left=Math.floor(this._optionsService.rawOptions.letterSpacing/2),this.dimensions.device.canvas.height=this._terminal.rows*this.dimensions.device.cell.height,this.dimensions.device.canvas.width=this._terminal.cols*this.dimensions.device.cell.width,this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/this._devicePixelRatio),this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/this._devicePixelRatio),this.dimensions.css.cell.height=this.dimensions.device.cell.height/this._devicePixelRatio,this.dimensions.css.cell.width=this.dimensions.device.cell.width/this._devicePixelRatio)}_setCanvasDevicePixelDimensions(x,M){this._canvas.width===x&&this._canvas.height===M||(this._canvas.width=x,this._canvas.height=M,this._requestRedrawViewport())}_requestRedrawViewport(){this._onRequestRedraw.fire({start:0,end:this._terminal.rows-1})}_requestRedrawCursor(){let x=this._terminal.buffer.active.cursorY;this._onRequestRedraw.fire({start:x,end:x})}}i.WebglRenderer=S;class y extends v.AttributeData{constructor(x,M,E){super(),this.content=0,this.combinedData="",this.fg=x.fg,this.bg=x.bg,this.combinedData=M,this._width=E}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(x){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}function m(A,x,M=0){return Math.max(Math.min(A,x),M)}i.JoinedCellData=y},381:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.GLTexture=i.expandFloat32Array=i.createShader=i.createProgram=i.PROJECTION_MATRIX=void 0;let s=p(374);function n(o,u,h){let _=(0,s.throwIfFalsy)(o.createShader(u));if(o.shaderSource(_,h),o.compileShader(_),o.getShaderParameter(_,o.COMPILE_STATUS))return _;console.error(o.getShaderInfoLog(_)),o.deleteShader(_)}i.PROJECTION_MATRIX=new Float32Array([2,0,0,0,0,-2,0,0,0,0,1,0,-1,1,0,1]),i.createProgram=function(o,u,h){let _=(0,s.throwIfFalsy)(o.createProgram());if(o.attachShader(_,(0,s.throwIfFalsy)(n(o,o.VERTEX_SHADER,u))),o.attachShader(_,(0,s.throwIfFalsy)(n(o,o.FRAGMENT_SHADER,h))),o.linkProgram(_),o.getProgramParameter(_,o.LINK_STATUS))return _;console.error(o.getProgramInfoLog(_)),o.deleteProgram(_)},i.createShader=n,i.expandFloat32Array=function(o,u){let h=Math.min(2*o.length,u),_=new Float32Array(h);for(let t=0;t<o.length;t++)_[t]=o[t];return _},i.GLTexture=class{constructor(o){this.texture=o,this.version=-1}}},592:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BaseRenderLayer=void 0;let s=p(627),n=p(237),o=p(374),u=p(859);class h extends u.Disposable{constructor(t,e,v,r,a,f,d,c){super(),this._container=e,this._alpha=a,this._coreBrowserService=f,this._optionsService=d,this._themeService=c,this._deviceCharWidth=0,this._deviceCharHeight=0,this._deviceCellWidth=0,this._deviceCellHeight=0,this._deviceCharLeft=0,this._deviceCharTop=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add(`xterm-${v}-layer`),this._canvas.style.zIndex=r.toString(),this._initCanvas(),this._container.appendChild(this._canvas),this.register(this._themeService.onChangeColors(b=>{this._refreshCharAtlas(t,b),this.reset(t)})),this.register((0,u.toDisposable)(()=>{this._canvas.remove()}))}_initCanvas(){this._ctx=(0,o.throwIfFalsy)(this._canvas.getContext("2d",{alpha:this._alpha})),this._alpha||this._clearAll()}handleBlur(t){}handleFocus(t){}handleCursorMove(t){}handleGridChanged(t,e,v){}handleSelectionChanged(t,e,v,r=!1){}_setTransparency(t,e){if(e===this._alpha)return;let v=this._canvas;this._alpha=e,this._canvas=this._canvas.cloneNode(),this._initCanvas(),this._container.replaceChild(this._canvas,v),this._refreshCharAtlas(t,this._themeService.colors),this.handleGridChanged(t,0,t.rows-1)}_refreshCharAtlas(t,e){this._deviceCharWidth<=0&&this._deviceCharHeight<=0||(this._charAtlas=(0,s.acquireTextureAtlas)(t,this._optionsService.rawOptions,e,this._deviceCellWidth,this._deviceCellHeight,this._deviceCharWidth,this._deviceCharHeight,this._coreBrowserService.dpr),this._charAtlas.warmUp())}resize(t,e){this._deviceCellWidth=e.device.cell.width,this._deviceCellHeight=e.device.cell.height,this._deviceCharWidth=e.device.char.width,this._deviceCharHeight=e.device.char.height,this._deviceCharLeft=e.device.char.left,this._deviceCharTop=e.device.char.top,this._canvas.width=e.device.canvas.width,this._canvas.height=e.device.canvas.height,this._canvas.style.width=`${e.css.canvas.width}px`,this._canvas.style.height=`${e.css.canvas.height}px`,this._alpha||this._clearAll(),this._refreshCharAtlas(t,this._themeService.colors)}_fillBottomLineAtCells(t,e,v=1){this._ctx.fillRect(t*this._deviceCellWidth,(e+1)*this._deviceCellHeight-this._coreBrowserService.dpr-1,v*this._deviceCellWidth,this._coreBrowserService.dpr)}_clearAll(){this._alpha?this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height))}_clearCells(t,e,v,r){this._alpha?this._ctx.clearRect(t*this._deviceCellWidth,e*this._deviceCellHeight,v*this._deviceCellWidth,r*this._deviceCellHeight):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(t*this._deviceCellWidth,e*this._deviceCellHeight,v*this._deviceCellWidth,r*this._deviceCellHeight))}_fillCharTrueColor(t,e,v,r){this._ctx.font=this._getFont(t,!1,!1),this._ctx.textBaseline=n.TEXT_BASELINE,this._clipCell(v,r,e.getWidth()),this._ctx.fillText(e.getChars(),v*this._deviceCellWidth+this._deviceCharLeft,r*this._deviceCellHeight+this._deviceCharTop+this._deviceCharHeight)}_clipCell(t,e,v){this._ctx.beginPath(),this._ctx.rect(t*this._deviceCellWidth,e*this._deviceCellHeight,v*this._deviceCellWidth,this._deviceCellHeight),this._ctx.clip()}_getFont(t,e,v){return`${v?"italic":""} ${e?t.options.fontWeightBold:t.options.fontWeight} ${t.options.fontSize*this._coreBrowserService.dpr}px ${t.options.fontFamily}`}}i.BaseRenderLayer=h},733:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.LinkRenderLayer=void 0;let s=p(197),n=p(237),o=p(592);class u extends o.BaseRenderLayer{constructor(_,t,e,v,r,a,f){super(e,_,"link",t,!0,r,a,f),this.register(v.onShowLinkUnderline(d=>this._handleShowLinkUnderline(d))),this.register(v.onHideLinkUnderline(d=>this._handleHideLinkUnderline(d)))}resize(_,t){super.resize(_,t),this._state=void 0}reset(_){this._clearCurrentLink()}_clearCurrentLink(){if(this._state){this._clearCells(this._state.x1,this._state.y1,this._state.cols-this._state.x1,1);let _=this._state.y2-this._state.y1-1;_>0&&this._clearCells(0,this._state.y1+1,this._state.cols,_),this._clearCells(0,this._state.y2,this._state.x2,1),this._state=void 0}}_handleShowLinkUnderline(_){if(_.fg===n.INVERTED_DEFAULT_COLOR?this._ctx.fillStyle=this._themeService.colors.background.css:_.fg!==void 0&&(0,s.is256Color)(_.fg)?this._ctx.fillStyle=this._themeService.colors.ansi[_.fg].css:this._ctx.fillStyle=this._themeService.colors.foreground.css,_.y1===_.y2)this._fillBottomLineAtCells(_.x1,_.y1,_.x2-_.x1);else{this._fillBottomLineAtCells(_.x1,_.y1,_.cols-_.x1);for(let t=_.y1+1;t<_.y2;t++)this._fillBottomLineAtCells(0,t,_.cols);this._fillBottomLineAtCells(0,_.y2,_.x2)}this._state=_}_handleHideLinkUnderline(_){this._clearCurrentLink()}}i.LinkRenderLayer=u},820:(w,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.addDisposableDomListener=void 0,i.addDisposableDomListener=function(p,s,n,o){p.addEventListener(s,n,o);let u=!1;return{dispose:()=>{u||(u=!0,p.removeEventListener(s,n,o))}}}},274:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CellColorResolver=void 0;let s=p(855),n=p(160),o=p(374),u,h=0,_=0,t=!1,e=!1,v=!1,r=0;i.CellColorResolver=class{constructor(a,f,d,c,b,S){this._terminal=a,this._optionService=f,this._selectionRenderModel=d,this._decorationService=c,this._coreBrowserService=b,this._themeService=S,this.result={fg:0,bg:0,ext:0}}resolve(a,f,d,c){if(this.result.bg=a.bg,this.result.fg=a.fg,this.result.ext=268435456&a.bg?a.extended.ext:0,_=0,h=0,e=!1,t=!1,v=!1,u=this._themeService.colors,r=0,a.getCode()!==s.NULL_CELL_CODE&&a.extended.underlineStyle===4){let b=Math.max(1,Math.floor(this._optionService.rawOptions.fontSize*this._coreBrowserService.dpr/15));r=f*c%(2*Math.round(b))}if(this._decorationService.forEachDecorationAtCell(f,d,"bottom",b=>{b.backgroundColorRGB&&(_=b.backgroundColorRGB.rgba>>8&16777215,e=!0),b.foregroundColorRGB&&(h=b.foregroundColorRGB.rgba>>8&16777215,t=!0)}),v=this._selectionRenderModel.isCellSelected(this._terminal,f,d),v){if(67108864&this.result.fg||(50331648&this.result.bg)!=0){if(67108864&this.result.fg)switch(50331648&this.result.fg){case 16777216:case 33554432:_=this._themeService.colors.ansi[255&this.result.fg].rgba;break;case 50331648:_=(16777215&this.result.fg)<<8|255;break;default:_=this._themeService.colors.foreground.rgba}else switch(50331648&this.result.bg){case 16777216:case 33554432:_=this._themeService.colors.ansi[255&this.result.bg].rgba;break;case 50331648:_=(16777215&this.result.bg)<<8|255}_=n.rgba.blend(_,4294967040&(this._coreBrowserService.isFocused?u.selectionBackgroundOpaque:u.selectionInactiveBackgroundOpaque).rgba|128)>>8&16777215}else _=(this._coreBrowserService.isFocused?u.selectionBackgroundOpaque:u.selectionInactiveBackgroundOpaque).rgba>>8&16777215;if(e=!0,u.selectionForeground&&(h=u.selectionForeground.rgba>>8&16777215,t=!0),(0,o.treatGlyphAsBackgroundColor)(a.getCode())){if(67108864&this.result.fg&&(50331648&this.result.bg)==0)h=(this._coreBrowserService.isFocused?u.selectionBackgroundOpaque:u.selectionInactiveBackgroundOpaque).rgba>>8&16777215;else{if(67108864&this.result.fg)switch(50331648&this.result.bg){case 16777216:case 33554432:h=this._themeService.colors.ansi[255&this.result.bg].rgba;break;case 50331648:h=(16777215&this.result.bg)<<8|255}else switch(50331648&this.result.fg){case 16777216:case 33554432:h=this._themeService.colors.ansi[255&this.result.fg].rgba;break;case 50331648:h=(16777215&this.result.fg)<<8|255;break;default:h=this._themeService.colors.foreground.rgba}h=n.rgba.blend(h,4294967040&(this._coreBrowserService.isFocused?u.selectionBackgroundOpaque:u.selectionInactiveBackgroundOpaque).rgba|128)>>8&16777215}t=!0}}this._decorationService.forEachDecorationAtCell(f,d,"top",b=>{b.backgroundColorRGB&&(_=b.backgroundColorRGB.rgba>>8&16777215,e=!0),b.foregroundColorRGB&&(h=b.foregroundColorRGB.rgba>>8&16777215,t=!0)}),e&&(_=v?-16777216&a.bg&-134217729|_|50331648:-16777216&a.bg|_|50331648),t&&(h=-16777216&a.fg&-67108865|h|50331648),67108864&this.result.fg&&(e&&!t&&(h=(50331648&this.result.bg)==0?-134217728&this.result.fg|16777215&u.background.rgba>>8|50331648:-134217728&this.result.fg|67108863&this.result.bg,t=!0),!e&&t&&(_=(50331648&this.result.fg)==0?-67108864&this.result.bg|16777215&u.foreground.rgba>>8|50331648:-67108864&this.result.bg|67108863&this.result.fg,e=!0)),u=void 0,this.result.bg=e?_:this.result.bg,this.result.fg=t?h:this.result.fg,this.result.ext&=536870911,this.result.ext|=r<<29&3758096384}}},627:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.removeTerminalFromCache=i.acquireTextureAtlas=void 0;let s=p(509),n=p(197),o=[];i.acquireTextureAtlas=function(u,h,_,t,e,v,r,a){let f=(0,n.generateConfig)(t,e,v,r,h,_,a);for(let b=0;b<o.length;b++){let S=o[b],y=S.ownedBy.indexOf(u);if(y>=0){if((0,n.configEquals)(S.config,f))return S.atlas;S.ownedBy.length===1?(S.atlas.dispose(),o.splice(b,1)):S.ownedBy.splice(y,1);break}}for(let b=0;b<o.length;b++){let S=o[b];if((0,n.configEquals)(S.config,f))return S.ownedBy.push(u),S.atlas}let d=u._core,c={atlas:new s.TextureAtlas(document,f,d.unicodeService),config:f,ownedBy:[u]};return o.push(c),c.atlas},i.removeTerminalFromCache=function(u){for(let h=0;h<o.length;h++){let _=o[h].ownedBy.indexOf(u);if(_!==-1){o[h].ownedBy.length===1?(o[h].atlas.dispose(),o.splice(h,1)):o[h].ownedBy.splice(_,1);break}}}},197:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.is256Color=i.configEquals=i.generateConfig=void 0;let s=p(160);i.generateConfig=function(n,o,u,h,_,t,e){let v={foreground:t.foreground,background:t.background,cursor:s.NULL_COLOR,cursorAccent:s.NULL_COLOR,selectionForeground:s.NULL_COLOR,selectionBackgroundTransparent:s.NULL_COLOR,selectionBackgroundOpaque:s.NULL_COLOR,selectionInactiveBackgroundTransparent:s.NULL_COLOR,selectionInactiveBackgroundOpaque:s.NULL_COLOR,ansi:t.ansi.slice(),contrastCache:t.contrastCache,halfContrastCache:t.halfContrastCache};return{customGlyphs:_.customGlyphs,devicePixelRatio:e,letterSpacing:_.letterSpacing,lineHeight:_.lineHeight,deviceCellWidth:n,deviceCellHeight:o,deviceCharWidth:u,deviceCharHeight:h,fontFamily:_.fontFamily,fontSize:_.fontSize,fontWeight:_.fontWeight,fontWeightBold:_.fontWeightBold,allowTransparency:_.allowTransparency,drawBoldTextInBrightColors:_.drawBoldTextInBrightColors,minimumContrastRatio:_.minimumContrastRatio,colors:v}},i.configEquals=function(n,o){for(let u=0;u<n.colors.ansi.length;u++)if(n.colors.ansi[u].rgba!==o.colors.ansi[u].rgba)return!1;return n.devicePixelRatio===o.devicePixelRatio&&n.customGlyphs===o.customGlyphs&&n.lineHeight===o.lineHeight&&n.letterSpacing===o.letterSpacing&&n.fontFamily===o.fontFamily&&n.fontSize===o.fontSize&&n.fontWeight===o.fontWeight&&n.fontWeightBold===o.fontWeightBold&&n.allowTransparency===o.allowTransparency&&n.deviceCharWidth===o.deviceCharWidth&&n.deviceCharHeight===o.deviceCharHeight&&n.drawBoldTextInBrightColors===o.drawBoldTextInBrightColors&&n.minimumContrastRatio===o.minimumContrastRatio&&n.colors.foreground.rgba===o.colors.foreground.rgba&&n.colors.background.rgba===o.colors.background.rgba},i.is256Color=function(n){return(50331648&n)==16777216||(50331648&n)==33554432}},237:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.TEXT_BASELINE=i.DIM_OPACITY=i.INVERTED_DEFAULT_COLOR=void 0;let s=p(399);i.INVERTED_DEFAULT_COLOR=257,i.DIM_OPACITY=.5,i.TEXT_BASELINE=s.isFirefox||s.isLegacyEdge?"bottom":"ideographic"},457:(w,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CursorBlinkStateManager=void 0,i.CursorBlinkStateManager=class{constructor(p,s){this._renderCallback=p,this._coreBrowserService=s,this.isCursorVisible=!0,this._coreBrowserService.isFocused&&this._restartInterval()}get isPaused(){return!(this._blinkStartTimeout||this._blinkInterval)}dispose(){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}restartBlinkAnimation(){this.isPaused||(this._animationTimeRestarted=Date.now(),this.isCursorVisible=!0,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})))}_restartInterval(p=600){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout=this._coreBrowserService.window.setTimeout(()=>{if(this._animationTimeRestarted){let s=600-(Date.now()-this._animationTimeRestarted);if(this._animationTimeRestarted=void 0,s>0)return void this._restartInterval(s)}this.isCursorVisible=!1,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0}),this._blinkInterval=this._coreBrowserService.window.setInterval(()=>{if(this._animationTimeRestarted){let s=600-(Date.now()-this._animationTimeRestarted);return this._animationTimeRestarted=void 0,void this._restartInterval(s)}this.isCursorVisible=!this.isCursorVisible,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})},600)},p)}pause(){this.isCursorVisible=!0,this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}resume(){this.pause(),this._animationTimeRestarted=void 0,this._restartInterval(),this.restartBlinkAnimation()}}},860:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.tryDrawCustomChar=i.powerlineDefinitions=i.boxDrawingDefinitions=i.blockElementDefinitions=void 0;let s=p(374);i.blockElementDefinitions={"\u2580":[{x:0,y:0,w:8,h:4}],"\u2581":[{x:0,y:7,w:8,h:1}],"\u2582":[{x:0,y:6,w:8,h:2}],"\u2583":[{x:0,y:5,w:8,h:3}],"\u2584":[{x:0,y:4,w:8,h:4}],"\u2585":[{x:0,y:3,w:8,h:5}],"\u2586":[{x:0,y:2,w:8,h:6}],"\u2587":[{x:0,y:1,w:8,h:7}],"\u2588":[{x:0,y:0,w:8,h:8}],"\u2589":[{x:0,y:0,w:7,h:8}],"\u258A":[{x:0,y:0,w:6,h:8}],"\u258B":[{x:0,y:0,w:5,h:8}],"\u258C":[{x:0,y:0,w:4,h:8}],"\u258D":[{x:0,y:0,w:3,h:8}],"\u258E":[{x:0,y:0,w:2,h:8}],"\u258F":[{x:0,y:0,w:1,h:8}],"\u2590":[{x:4,y:0,w:4,h:8}],"\u2594":[{x:0,y:0,w:8,h:1}],"\u2595":[{x:7,y:0,w:1,h:8}],"\u2596":[{x:0,y:4,w:4,h:4}],"\u2597":[{x:4,y:4,w:4,h:4}],"\u2598":[{x:0,y:0,w:4,h:4}],"\u2599":[{x:0,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"\u259A":[{x:0,y:0,w:4,h:4},{x:4,y:4,w:4,h:4}],"\u259B":[{x:0,y:0,w:4,h:8},{x:4,y:0,w:4,h:4}],"\u259C":[{x:0,y:0,w:8,h:4},{x:4,y:0,w:4,h:8}],"\u259D":[{x:4,y:0,w:4,h:4}],"\u259E":[{x:4,y:0,w:4,h:4},{x:0,y:4,w:4,h:4}],"\u259F":[{x:4,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"\u{1FB70}":[{x:1,y:0,w:1,h:8}],"\u{1FB71}":[{x:2,y:0,w:1,h:8}],"\u{1FB72}":[{x:3,y:0,w:1,h:8}],"\u{1FB73}":[{x:4,y:0,w:1,h:8}],"\u{1FB74}":[{x:5,y:0,w:1,h:8}],"\u{1FB75}":[{x:6,y:0,w:1,h:8}],"\u{1FB76}":[{x:0,y:1,w:8,h:1}],"\u{1FB77}":[{x:0,y:2,w:8,h:1}],"\u{1FB78}":[{x:0,y:3,w:8,h:1}],"\u{1FB79}":[{x:0,y:4,w:8,h:1}],"\u{1FB7A}":[{x:0,y:5,w:8,h:1}],"\u{1FB7B}":[{x:0,y:6,w:8,h:1}],"\u{1FB7C}":[{x:0,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"\u{1FB7D}":[{x:0,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"\u{1FB7E}":[{x:7,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"\u{1FB7F}":[{x:7,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"\u{1FB80}":[{x:0,y:0,w:8,h:1},{x:0,y:7,w:8,h:1}],"\u{1FB81}":[{x:0,y:0,w:8,h:1},{x:0,y:2,w:8,h:1},{x:0,y:4,w:8,h:1},{x:0,y:7,w:8,h:1}],"\u{1FB82}":[{x:0,y:0,w:8,h:2}],"\u{1FB83}":[{x:0,y:0,w:8,h:3}],"\u{1FB84}":[{x:0,y:0,w:8,h:5}],"\u{1FB85}":[{x:0,y:0,w:8,h:6}],"\u{1FB86}":[{x:0,y:0,w:8,h:7}],"\u{1FB87}":[{x:6,y:0,w:2,h:8}],"\u{1FB88}":[{x:5,y:0,w:3,h:8}],"\u{1FB89}":[{x:3,y:0,w:5,h:8}],"\u{1FB8A}":[{x:2,y:0,w:6,h:8}],"\u{1FB8B}":[{x:1,y:0,w:7,h:8}],"\u{1FB95}":[{x:0,y:0,w:2,h:2},{x:4,y:0,w:2,h:2},{x:2,y:2,w:2,h:2},{x:6,y:2,w:2,h:2},{x:0,y:4,w:2,h:2},{x:4,y:4,w:2,h:2},{x:2,y:6,w:2,h:2},{x:6,y:6,w:2,h:2}],"\u{1FB96}":[{x:2,y:0,w:2,h:2},{x:6,y:0,w:2,h:2},{x:0,y:2,w:2,h:2},{x:4,y:2,w:2,h:2},{x:2,y:4,w:2,h:2},{x:6,y:4,w:2,h:2},{x:0,y:6,w:2,h:2},{x:4,y:6,w:2,h:2}],"\u{1FB97}":[{x:0,y:2,w:8,h:2},{x:0,y:6,w:8,h:2}]};let n={"\u2591":[[1,0,0,0],[0,0,0,0],[0,0,1,0],[0,0,0,0]],"\u2592":[[1,0],[0,0],[0,1],[0,0]],"\u2593":[[0,1],[1,1],[1,0],[1,1]]};i.boxDrawingDefinitions={"\u2500":{1:"M0,.5 L1,.5"},"\u2501":{3:"M0,.5 L1,.5"},"\u2502":{1:"M.5,0 L.5,1"},"\u2503":{3:"M.5,0 L.5,1"},"\u250C":{1:"M0.5,1 L.5,.5 L1,.5"},"\u250F":{3:"M0.5,1 L.5,.5 L1,.5"},"\u2510":{1:"M0,.5 L.5,.5 L.5,1"},"\u2513":{3:"M0,.5 L.5,.5 L.5,1"},"\u2514":{1:"M.5,0 L.5,.5 L1,.5"},"\u2517":{3:"M.5,0 L.5,.5 L1,.5"},"\u2518":{1:"M.5,0 L.5,.5 L0,.5"},"\u251B":{3:"M.5,0 L.5,.5 L0,.5"},"\u251C":{1:"M.5,0 L.5,1 M.5,.5 L1,.5"},"\u2523":{3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"\u2524":{1:"M.5,0 L.5,1 M.5,.5 L0,.5"},"\u252B":{3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"\u252C":{1:"M0,.5 L1,.5 M.5,.5 L.5,1"},"\u2533":{3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"\u2534":{1:"M0,.5 L1,.5 M.5,.5 L.5,0"},"\u253B":{3:"M0,.5 L1,.5 M.5,.5 L.5,0"},"\u253C":{1:"M0,.5 L1,.5 M.5,0 L.5,1"},"\u254B":{3:"M0,.5 L1,.5 M.5,0 L.5,1"},"\u2574":{1:"M.5,.5 L0,.5"},"\u2578":{3:"M.5,.5 L0,.5"},"\u2575":{1:"M.5,.5 L.5,0"},"\u2579":{3:"M.5,.5 L.5,0"},"\u2576":{1:"M.5,.5 L1,.5"},"\u257A":{3:"M.5,.5 L1,.5"},"\u2577":{1:"M.5,.5 L.5,1"},"\u257B":{3:"M.5,.5 L.5,1"},"\u2550":{1:(t,e)=>`M0,${.5-e} L1,${.5-e} M0,${.5+e} L1,${.5+e}`},"\u2551":{1:(t,e)=>`M${.5-t},0 L${.5-t},1 M${.5+t},0 L${.5+t},1`},"\u2552":{1:(t,e)=>`M.5,1 L.5,${.5-e} L1,${.5-e} M.5,${.5+e} L1,${.5+e}`},"\u2553":{1:(t,e)=>`M${.5-t},1 L${.5-t},.5 L1,.5 M${.5+t},.5 L${.5+t},1`},"\u2554":{1:(t,e)=>`M1,${.5-e} L${.5-t},${.5-e} L${.5-t},1 M1,${.5+e} L${.5+t},${.5+e} L${.5+t},1`},"\u2555":{1:(t,e)=>`M0,${.5-e} L.5,${.5-e} L.5,1 M0,${.5+e} L.5,${.5+e}`},"\u2556":{1:(t,e)=>`M${.5+t},1 L${.5+t},.5 L0,.5 M${.5-t},.5 L${.5-t},1`},"\u2557":{1:(t,e)=>`M0,${.5+e} L${.5-t},${.5+e} L${.5-t},1 M0,${.5-e} L${.5+t},${.5-e} L${.5+t},1`},"\u2558":{1:(t,e)=>`M.5,0 L.5,${.5+e} L1,${.5+e} M.5,${.5-e} L1,${.5-e}`},"\u2559":{1:(t,e)=>`M1,.5 L${.5-t},.5 L${.5-t},0 M${.5+t},.5 L${.5+t},0`},"\u255A":{1:(t,e)=>`M1,${.5-e} L${.5+t},${.5-e} L${.5+t},0 M1,${.5+e} L${.5-t},${.5+e} L${.5-t},0`},"\u255B":{1:(t,e)=>`M0,${.5+e} L.5,${.5+e} L.5,0 M0,${.5-e} L.5,${.5-e}`},"\u255C":{1:(t,e)=>`M0,.5 L${.5+t},.5 L${.5+t},0 M${.5-t},.5 L${.5-t},0`},"\u255D":{1:(t,e)=>`M0,${.5-e} L${.5-t},${.5-e} L${.5-t},0 M0,${.5+e} L${.5+t},${.5+e} L${.5+t},0`},"\u255E":{1:(t,e)=>`M.5,0 L.5,1 M.5,${.5-e} L1,${.5-e} M.5,${.5+e} L1,${.5+e}`},"\u255F":{1:(t,e)=>`M${.5-t},0 L${.5-t},1 M${.5+t},0 L${.5+t},1 M${.5+t},.5 L1,.5`},"\u2560":{1:(t,e)=>`M${.5-t},0 L${.5-t},1 M1,${.5+e} L${.5+t},${.5+e} L${.5+t},1 M1,${.5-e} L${.5+t},${.5-e} L${.5+t},0`},"\u2561":{1:(t,e)=>`M.5,0 L.5,1 M0,${.5-e} L.5,${.5-e} M0,${.5+e} L.5,${.5+e}`},"\u2562":{1:(t,e)=>`M0,.5 L${.5-t},.5 M${.5-t},0 L${.5-t},1 M${.5+t},0 L${.5+t},1`},"\u2563":{1:(t,e)=>`M${.5+t},0 L${.5+t},1 M0,${.5+e} L${.5-t},${.5+e} L${.5-t},1 M0,${.5-e} L${.5-t},${.5-e} L${.5-t},0`},"\u2564":{1:(t,e)=>`M0,${.5-e} L1,${.5-e} M0,${.5+e} L1,${.5+e} M.5,${.5+e} L.5,1`},"\u2565":{1:(t,e)=>`M0,.5 L1,.5 M${.5-t},.5 L${.5-t},1 M${.5+t},.5 L${.5+t},1`},"\u2566":{1:(t,e)=>`M0,${.5-e} L1,${.5-e} M0,${.5+e} L${.5-t},${.5+e} L${.5-t},1 M1,${.5+e} L${.5+t},${.5+e} L${.5+t},1`},"\u2567":{1:(t,e)=>`M.5,0 L.5,${.5-e} M0,${.5-e} L1,${.5-e} M0,${.5+e} L1,${.5+e}`},"\u2568":{1:(t,e)=>`M0,.5 L1,.5 M${.5-t},.5 L${.5-t},0 M${.5+t},.5 L${.5+t},0`},"\u2569":{1:(t,e)=>`M0,${.5+e} L1,${.5+e} M0,${.5-e} L${.5-t},${.5-e} L${.5-t},0 M1,${.5-e} L${.5+t},${.5-e} L${.5+t},0`},"\u256A":{1:(t,e)=>`M.5,0 L.5,1 M0,${.5-e} L1,${.5-e} M0,${.5+e} L1,${.5+e}`},"\u256B":{1:(t,e)=>`M0,.5 L1,.5 M${.5-t},0 L${.5-t},1 M${.5+t},0 L${.5+t},1`},"\u256C":{1:(t,e)=>`M0,${.5+e} L${.5-t},${.5+e} L${.5-t},1 M1,${.5+e} L${.5+t},${.5+e} L${.5+t},1 M0,${.5-e} L${.5-t},${.5-e} L${.5-t},0 M1,${.5-e} L${.5+t},${.5-e} L${.5+t},0`},"\u2571":{1:"M1,0 L0,1"},"\u2572":{1:"M0,0 L1,1"},"\u2573":{1:"M1,0 L0,1 M0,0 L1,1"},"\u257C":{1:"M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"\u257D":{1:"M.5,.5 L.5,0",3:"M.5,.5 L.5,1"},"\u257E":{1:"M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u257F":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"\u250D":{1:"M.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"\u250E":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2511":{1:"M.5,.5 L.5,1",3:"M.5,.5 L0,.5"},"\u2512":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"\u2515":{1:"M.5,.5 L.5,0",3:"M.5,.5 L1,.5"},"\u2516":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"\u2519":{1:"M.5,.5 L.5,0",3:"M.5,.5 L0,.5"},"\u251A":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,0"},"\u251D":{1:"M.5,0 L.5,1",3:"M.5,.5 L1,.5"},"\u251E":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"\u251F":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2520":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1"},"\u2521":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"\u2522":{1:"M.5,.5 L.5,0",3:"M0.5,1 L.5,.5 L1,.5"},"\u2525":{1:"M.5,0 L.5,1",3:"M.5,.5 L0,.5"},"\u2526":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"\u2527":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"\u2528":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1"},"\u2529":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L0,.5"},"\u252A":{1:"M.5,.5 L.5,0",3:"M0,.5 L.5,.5 L.5,1"},"\u252D":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u252E":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"\u252F":{1:"M.5,.5 L.5,1",3:"M0,.5 L1,.5"},"\u2530":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2531":{1:"M.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"\u2532":{1:"M.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"\u2535":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u2536":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"\u2537":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5"},"\u2538":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,0"},"\u2539":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"\u253A":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,.5 L1,.5"},"\u253D":{1:"M.5,0 L.5,1 M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u253E":{1:"M.5,0 L.5,1 M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"\u253F":{1:"M.5,0 L.5,1",3:"M0,.5 L1,.5"},"\u2540":{1:"M0,.5 L1,.5 M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"\u2541":{1:"M.5,.5 L.5,0 M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2542":{1:"M0,.5 L1,.5",3:"M.5,0 L.5,1"},"\u2543":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"\u2544":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"\u2545":{1:"M.5,0 L.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"\u2546":{1:"M.5,0 L.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"\u2547":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0 M0,.5 L1,.5"},"\u2548":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"\u2549":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"\u254A":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"\u254C":{1:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"\u254D":{3:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"\u2504":{1:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"\u2505":{3:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"\u2508":{1:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"\u2509":{3:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"\u254E":{1:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"\u254F":{3:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"\u2506":{1:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"\u2507":{3:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"\u250A":{1:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"\u250B":{3:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"\u256D":{1:(t,e)=>`M.5,1 L.5,${.5+e/.15*.5} C.5,${.5+e/.15*.5},.5,.5,1,.5`},"\u256E":{1:(t,e)=>`M.5,1 L.5,${.5+e/.15*.5} C.5,${.5+e/.15*.5},.5,.5,0,.5`},"\u256F":{1:(t,e)=>`M.5,0 L.5,${.5-e/.15*.5} C.5,${.5-e/.15*.5},.5,.5,0,.5`},"\u2570":{1:(t,e)=>`M.5,0 L.5,${.5-e/.15*.5} C.5,${.5-e/.15*.5},.5,.5,1,.5`}},i.powerlineDefinitions={"\uE0B0":{d:"M0,0 L1,.5 L0,1",type:0,rightPadding:2},"\uE0B1":{d:"M-1,-.5 L1,.5 L-1,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0B2":{d:"M1,0 L0,.5 L1,1",type:0,leftPadding:2},"\uE0B3":{d:"M2,-.5 L0,.5 L2,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0B4":{d:"M0,0 L0,1 C0.552,1,1,0.776,1,.5 C1,0.224,0.552,0,0,0",type:0,rightPadding:1},"\uE0B5":{d:"M.2,1 C.422,1,.8,.826,.78,.5 C.8,.174,0.422,0,.2,0",type:1,rightPadding:1},"\uE0B6":{d:"M1,0 L1,1 C0.448,1,0,0.776,0,.5 C0,0.224,0.448,0,1,0",type:0,leftPadding:1},"\uE0B7":{d:"M.8,1 C0.578,1,0.2,.826,.22,.5 C0.2,0.174,0.578,0,0.8,0",type:1,leftPadding:1},"\uE0B8":{d:"M-.5,-.5 L1.5,1.5 L-.5,1.5",type:0},"\uE0B9":{d:"M-.5,-.5 L1.5,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0BA":{d:"M1.5,-.5 L-.5,1.5 L1.5,1.5",type:0},"\uE0BC":{d:"M1.5,-.5 L-.5,1.5 L-.5,-.5",type:0},"\uE0BD":{d:"M1.5,-.5 L-.5,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0BE":{d:"M-.5,-.5 L1.5,1.5 L1.5,-.5",type:0}},i.powerlineDefinitions["\uE0BB"]=i.powerlineDefinitions["\uE0BD"],i.powerlineDefinitions["\uE0BF"]=i.powerlineDefinitions["\uE0B9"],i.tryDrawCustomChar=function(t,e,v,r,a,f,d,c){let b=i.blockElementDefinitions[e];if(b)return function(A,x,M,E,I,F){for(let O=0;O<x.length;O++){let P=x[O],H=I/8,$=F/8;A.fillRect(M+P.x*H,E+P.y*$,P.w*H,P.h*$)}}(t,b,v,r,a,f),!0;let S=n[e];if(S)return function(A,x,M,E,I,F){let O=o.get(x);O||(O=new Map,o.set(x,O));let P=A.fillStyle;if(typeof P!="string")throw new Error(`Unexpected fillStyle type "${P}"`);let H=O.get(P);if(!H){let $=x[0].length,L=x.length,R=A.canvas.ownerDocument.createElement("canvas");R.width=$,R.height=L;let k=(0,s.throwIfFalsy)(R.getContext("2d")),B=new ImageData($,L),N,W,q,J;if(P.startsWith("#"))N=parseInt(P.slice(1,3),16),W=parseInt(P.slice(3,5),16),q=parseInt(P.slice(5,7),16),J=P.length>7&&parseInt(P.slice(7,9),16)||1;else{if(!P.startsWith("rgba"))throw new Error(`Unexpected fillStyle color format "${P}" when drawing pattern glyph`);[N,W,q,J]=P.substring(5,P.length-1).split(",").map(Q=>parseFloat(Q))}for(let Q=0;Q<L;Q++)for(let D=0;D<$;D++)B.data[4*(Q*$+D)]=N,B.data[4*(Q*$+D)+1]=W,B.data[4*(Q*$+D)+2]=q,B.data[4*(Q*$+D)+3]=x[Q][D]*(255*J);k.putImageData(B,0,0),H=(0,s.throwIfFalsy)(A.createPattern(R,null)),O.set(P,H)}A.fillStyle=H,A.fillRect(M,E,I,F)}(t,S,v,r,a,f),!0;let y=i.boxDrawingDefinitions[e];if(y)return function(A,x,M,E,I,F,O){A.strokeStyle=A.fillStyle;for(let[P,H]of Object.entries(x)){let $;A.beginPath(),A.lineWidth=O*Number.parseInt(P),$=typeof H=="function"?H(.15,.15/F*I):H;for(let L of $.split(" ")){let R=L[0],k=h[R];if(!k){console.error(`Could not find drawing instructions for "${R}"`);continue}let B=L.substring(1).split(",");B[0]&&B[1]&&k(A,_(B,I,F,M,E,!0,O))}A.stroke(),A.closePath()}}(t,y,v,r,a,f,c),!0;let m=i.powerlineDefinitions[e];return!!m&&(function(A,x,M,E,I,F,O,P){let H=new Path2D;H.rect(M,E,I,F),A.clip(H),A.beginPath();let $=O/12;A.lineWidth=P*$;for(let L of x.d.split(" ")){let R=L[0],k=h[R];if(!k){console.error(`Could not find drawing instructions for "${R}"`);continue}let B=L.substring(1).split(",");B[0]&&B[1]&&k(A,_(B,I,F,M,E,!1,P,(x.leftPadding??0)*($/2),(x.rightPadding??0)*($/2)))}x.type===1?(A.strokeStyle=A.fillStyle,A.stroke()):A.fill(),A.closePath()}(t,m,v,r,a,f,d,c),!0)};let o=new Map;function u(t,e,v=0){return Math.max(Math.min(t,e),v)}let h={C:(t,e)=>t.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5]),L:(t,e)=>t.lineTo(e[0],e[1]),M:(t,e)=>t.moveTo(e[0],e[1])};function _(t,e,v,r,a,f,d,c=0,b=0){let S=t.map(y=>parseFloat(y)||parseInt(y));if(S.length<2)throw new Error("Too few arguments for instruction");for(let y=0;y<S.length;y+=2)S[y]*=e-c*d-b*d,f&&S[y]!==0&&(S[y]=u(Math.round(S[y]+.5)-.5,e,0)),S[y]+=r+c*d;for(let y=1;y<S.length;y+=2)S[y]*=v,f&&S[y]!==0&&(S[y]=u(Math.round(S[y]+.5)-.5,v,0)),S[y]+=a;return S}},56:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.observeDevicePixelDimensions=void 0;let s=p(859);i.observeDevicePixelDimensions=function(n,o,u){let h=new o.ResizeObserver(_=>{let t=_.find(r=>r.target===n);if(!t)return;if(!("devicePixelContentBoxSize"in t))return h?.disconnect(),void(h=void 0);let e=t.devicePixelContentBoxSize[0].inlineSize,v=t.devicePixelContentBoxSize[0].blockSize;e>0&&v>0&&u(e,v)});try{h.observe(n,{box:["device-pixel-content-box"]})}catch{h.disconnect(),h=void 0}return(0,s.toDisposable)(()=>h?.disconnect())}},374:(w,i)=>{function p(n){return 57508<=n&&n<=57558}function s(n){return n>=128512&&n<=128591||n>=127744&&n<=128511||n>=128640&&n<=128767||n>=9728&&n<=9983||n>=9984&&n<=10175||n>=65024&&n<=65039||n>=129280&&n<=129535||n>=127462&&n<=127487}Object.defineProperty(i,"__esModule",{value:!0}),i.computeNextVariantOffset=i.createRenderDimensions=i.treatGlyphAsBackgroundColor=i.allowRescaling=i.isEmoji=i.isRestrictedPowerlineGlyph=i.isPowerlineGlyph=i.throwIfFalsy=void 0,i.throwIfFalsy=function(n){if(!n)throw new Error("value must not be falsy");return n},i.isPowerlineGlyph=p,i.isRestrictedPowerlineGlyph=function(n){return 57520<=n&&n<=57527},i.isEmoji=s,i.allowRescaling=function(n,o,u,h){return o===1&&u>Math.ceil(1.5*h)&&n!==void 0&&n>255&&!s(n)&&!p(n)&&!function(_){return 57344<=_&&_<=63743}(n)},i.treatGlyphAsBackgroundColor=function(n){return p(n)||function(o){return 9472<=o&&o<=9631}(n)},i.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}},i.computeNextVariantOffset=function(n,o,u=0){return(n-(2*Math.round(o)-u))%(2*Math.round(o))}},296:(w,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.createSelectionRenderModel=void 0;class p{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(n,o,u,h=!1){if(this.selectionStart=o,this.selectionEnd=u,!o||!u||o[0]===u[0]&&o[1]===u[1])return void this.clear();let _=n.buffers.active.ydisp,t=o[1]-_,e=u[1]-_,v=Math.max(t,0),r=Math.min(e,n.rows-1);v>=n.rows||r<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=h,this.viewportStartRow=t,this.viewportEndRow=e,this.viewportCappedStartRow=v,this.viewportCappedEndRow=r,this.startCol=o[0],this.endCol=u[0])}isCellSelected(n,o,u){return!!this.hasSelection&&(u-=n.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?o>=this.startCol&&u>=this.viewportCappedStartRow&&o<this.endCol&&u<=this.viewportCappedEndRow:o<this.startCol&&u>=this.viewportCappedStartRow&&o>=this.endCol&&u<=this.viewportCappedEndRow:u>this.viewportStartRow&&u<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&u===this.viewportStartRow&&o>=this.startCol&&o<this.endCol||this.viewportStartRow<this.viewportEndRow&&u===this.viewportEndRow&&o<this.endCol||this.viewportStartRow<this.viewportEndRow&&u===this.viewportStartRow&&o>=this.startCol)}}i.createSelectionRenderModel=function(){return new p}},509:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.TextureAtlas=void 0;let s=p(237),n=p(860),o=p(374),u=p(160),h=p(345),_=p(485),t=p(385),e=p(147),v=p(855),r={texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},offset:{x:0,y:0},size:{x:0,y:0},sizeClipSpace:{x:0,y:0}},a;class f{get pages(){return this._pages}constructor(y,m,A){this._document=y,this._config=m,this._unicodeService=A,this._didWarmUp=!1,this._cacheMap=new _.FourKeyMap,this._cacheMapCombined=new _.FourKeyMap,this._pages=[],this._activePages=[],this._workBoundingBox={top:0,left:0,bottom:0,right:0},this._workAttributeData=new e.AttributeData,this._textureSize=512,this._onAddTextureAtlasCanvas=new h.EventEmitter,this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=new h.EventEmitter,this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._requestClearModel=!1,this._createNewPage(),this._tmpCanvas=b(y,4*this._config.deviceCellWidth+4,this._config.deviceCellHeight+4),this._tmpCtx=(0,o.throwIfFalsy)(this._tmpCanvas.getContext("2d",{alpha:this._config.allowTransparency,willReadFrequently:!0}))}dispose(){for(let y of this.pages)y.canvas.remove();this._onAddTextureAtlasCanvas.dispose()}warmUp(){this._didWarmUp||(this._doWarmUp(),this._didWarmUp=!0)}_doWarmUp(){let y=new t.IdleTaskQueue;for(let m=33;m<126;m++)y.enqueue(()=>{if(!this._cacheMap.get(m,v.DEFAULT_COLOR,v.DEFAULT_COLOR,v.DEFAULT_EXT)){let A=this._drawToCache(m,v.DEFAULT_COLOR,v.DEFAULT_COLOR,v.DEFAULT_EXT);this._cacheMap.set(m,v.DEFAULT_COLOR,v.DEFAULT_COLOR,v.DEFAULT_EXT,A)}})}beginFrame(){return this._requestClearModel}clearTexture(){if(this._pages[0].currentRow.x!==0||this._pages[0].currentRow.y!==0){for(let y of this._pages)y.clear();this._cacheMap.clear(),this._cacheMapCombined.clear(),this._didWarmUp=!1}}_createNewPage(){if(f.maxAtlasPages&&this._pages.length>=Math.max(4,f.maxAtlasPages)){let m=this._pages.filter(O=>2*O.canvas.width<=(f.maxTextureSize||4096)).sort((O,P)=>P.canvas.width!==O.canvas.width?P.canvas.width-O.canvas.width:P.percentageUsed-O.percentageUsed),A=-1,x=0;for(let O=0;O<m.length;O++)if(m[O].canvas.width!==x)A=O,x=m[O].canvas.width;else if(O-A==3)break;let M=m.slice(A,A+4),E=M.map(O=>O.glyphs[0].texturePage).sort((O,P)=>O>P?1:-1),I=this.pages.length-M.length,F=this._mergePages(M,I);F.version++;for(let O=E.length-1;O>=0;O--)this._deletePage(E[O]);this.pages.push(F),this._requestClearModel=!0,this._onAddTextureAtlasCanvas.fire(F.canvas)}let y=new d(this._document,this._textureSize);return this._pages.push(y),this._activePages.push(y),this._onAddTextureAtlasCanvas.fire(y.canvas),y}_mergePages(y,m){let A=2*y[0].canvas.width,x=new d(this._document,A,y);for(let[M,E]of y.entries()){let I=M*E.canvas.width%A,F=Math.floor(M/2)*E.canvas.height;x.ctx.drawImage(E.canvas,I,F);for(let P of E.glyphs)P.texturePage=m,P.sizeClipSpace.x=P.size.x/A,P.sizeClipSpace.y=P.size.y/A,P.texturePosition.x+=I,P.texturePosition.y+=F,P.texturePositionClipSpace.x=P.texturePosition.x/A,P.texturePositionClipSpace.y=P.texturePosition.y/A;this._onRemoveTextureAtlasCanvas.fire(E.canvas);let O=this._activePages.indexOf(E);O!==-1&&this._activePages.splice(O,1)}return x}_deletePage(y){this._pages.splice(y,1);for(let m=y;m<this._pages.length;m++){let A=this._pages[m];for(let x of A.glyphs)x.texturePage--;A.version++}}getRasterizedGlyphCombinedChar(y,m,A,x,M){return this._getFromCacheMap(this._cacheMapCombined,y,m,A,x,M)}getRasterizedGlyph(y,m,A,x,M){return this._getFromCacheMap(this._cacheMap,y,m,A,x,M)}_getFromCacheMap(y,m,A,x,M,E=!1){return a=y.get(m,A,x,M),a||(a=this._drawToCache(m,A,x,M,E),y.set(m,A,x,M,a)),a}_getColorFromAnsiIndex(y){if(y>=this._config.colors.ansi.length)throw new Error("No color found for idx "+y);return this._config.colors.ansi[y]}_getBackgroundColor(y,m,A,x){if(this._config.allowTransparency)return u.NULL_COLOR;let M;switch(y){case 16777216:case 33554432:M=this._getColorFromAnsiIndex(m);break;case 50331648:let E=e.AttributeData.toColorRGB(m);M=u.channels.toColor(E[0],E[1],E[2]);break;default:M=A?u.color.opaque(this._config.colors.foreground):this._config.colors.background}return M}_getForegroundColor(y,m,A,x,M,E,I,F,O,P){let H=this._getMinimumContrastColor(y,m,A,x,M,E,I,O,F,P);if(H)return H;let $;switch(M){case 16777216:case 33554432:this._config.drawBoldTextInBrightColors&&O&&E<8&&(E+=8),$=this._getColorFromAnsiIndex(E);break;case 50331648:let L=e.AttributeData.toColorRGB(E);$=u.channels.toColor(L[0],L[1],L[2]);break;default:$=I?this._config.colors.background:this._config.colors.foreground}return this._config.allowTransparency&&($=u.color.opaque($)),F&&($=u.color.multiplyOpacity($,s.DIM_OPACITY)),$}_resolveBackgroundRgba(y,m,A){switch(y){case 16777216:case 33554432:return this._getColorFromAnsiIndex(m).rgba;case 50331648:return m<<8;default:return A?this._config.colors.foreground.rgba:this._config.colors.background.rgba}}_resolveForegroundRgba(y,m,A,x){switch(y){case 16777216:case 33554432:return this._config.drawBoldTextInBrightColors&&x&&m<8&&(m+=8),this._getColorFromAnsiIndex(m).rgba;case 50331648:return m<<8;default:return A?this._config.colors.background.rgba:this._config.colors.foreground.rgba}}_getMinimumContrastColor(y,m,A,x,M,E,I,F,O,P){if(this._config.minimumContrastRatio===1||P)return;let H=this._getContrastCache(O),$=H.getColor(y,x);if($!==void 0)return $||void 0;let L=this._resolveBackgroundRgba(m,A,I),R=this._resolveForegroundRgba(M,E,I,F),k=u.rgba.ensureContrastRatio(L,R,this._config.minimumContrastRatio/(O?2:1));if(!k)return void H.setColor(y,x,null);let B=u.channels.toColor(k>>24&255,k>>16&255,k>>8&255);return H.setColor(y,x,B),B}_getContrastCache(y){return y?this._config.colors.halfContrastCache:this._config.colors.contrastCache}_drawToCache(y,m,A,x,M=!1){let E=typeof y=="number"?String.fromCharCode(y):y,I=Math.min(this._config.deviceCellWidth*Math.max(E.length,2)+4,this._textureSize);this._tmpCanvas.width<I&&(this._tmpCanvas.width=I);let F=Math.min(this._config.deviceCellHeight+8,this._textureSize);if(this._tmpCanvas.height<F&&(this._tmpCanvas.height=F),this._tmpCtx.save(),this._workAttributeData.fg=A,this._workAttributeData.bg=m,this._workAttributeData.extended.ext=x,this._workAttributeData.isInvisible())return r;let O=!!this._workAttributeData.isBold(),P=!!this._workAttributeData.isInverse(),H=!!this._workAttributeData.isDim(),$=!!this._workAttributeData.isItalic(),L=!!this._workAttributeData.isUnderline(),R=!!this._workAttributeData.isStrikethrough(),k=!!this._workAttributeData.isOverline(),B=this._workAttributeData.getFgColor(),N=this._workAttributeData.getFgColorMode(),W=this._workAttributeData.getBgColor(),q=this._workAttributeData.getBgColorMode();if(P){let U=B;B=W,W=U;let Y=N;N=q,q=Y}let J=this._getBackgroundColor(q,W,P,H);this._tmpCtx.globalCompositeOperation="copy",this._tmpCtx.fillStyle=J.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.globalCompositeOperation="source-over";let Q=O?this._config.fontWeightBold:this._config.fontWeight,D=$?"italic":"";this._tmpCtx.font=`${D} ${Q} ${this._config.fontSize*this._config.devicePixelRatio}px ${this._config.fontFamily}`,this._tmpCtx.textBaseline=s.TEXT_BASELINE;let se=E.length===1&&(0,o.isPowerlineGlyph)(E.charCodeAt(0)),K=E.length===1&&(0,o.isRestrictedPowerlineGlyph)(E.charCodeAt(0)),Z=this._getForegroundColor(m,q,W,A,N,B,P,H,O,(0,o.treatGlyphAsBackgroundColor)(E.charCodeAt(0)));this._tmpCtx.fillStyle=Z.css;let V=K?0:4,ue=!1;this._config.customGlyphs!==!1&&(ue=(0,n.tryDrawCustomChar)(this._tmpCtx,E,V,V,this._config.deviceCellWidth,this._config.deviceCellHeight,this._config.fontSize,this._config.devicePixelRatio));let pe,fe=!se;if(pe=typeof y=="number"?this._unicodeService.wcwidth(y):this._unicodeService.getStringCellWidth(y),L){this._tmpCtx.save();let U=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),Y=U%2==1?.5:0;if(this._tmpCtx.lineWidth=U,this._workAttributeData.isUnderlineColorDefault())this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle;else if(this._workAttributeData.isUnderlineColorRGB())fe=!1,this._tmpCtx.strokeStyle=`rgb(${e.AttributeData.toColorRGB(this._workAttributeData.getUnderlineColor()).join(",")})`;else{fe=!1;let ae=this._workAttributeData.getUnderlineColor();this._config.drawBoldTextInBrightColors&&this._workAttributeData.isBold()&&ae<8&&(ae+=8),this._tmpCtx.strokeStyle=this._getColorFromAnsiIndex(ae).css}this._tmpCtx.beginPath();let oe=V,ie=Math.ceil(V+this._config.deviceCharHeight)-Y-(M?2*U:0),Se=ie+U,xe=ie+2*U,me=this._workAttributeData.getUnderlineVariantOffset();for(let ae=0;ae<pe;ae++){this._tmpCtx.save();let te=oe+ae*this._config.deviceCellWidth,re=oe+(ae+1)*this._config.deviceCellWidth,Pe=te+this._config.deviceCellWidth/2;switch(this._workAttributeData.extended.underlineStyle){case 2:this._tmpCtx.moveTo(te,ie),this._tmpCtx.lineTo(re,ie),this._tmpCtx.moveTo(te,xe),this._tmpCtx.lineTo(re,xe);break;case 3:let Ee=U<=1?xe:Math.ceil(V+this._config.deviceCharHeight-U/2)-Y,Me=U<=1?ie:Math.ceil(V+this._config.deviceCharHeight+U/2)-Y,Ve=new Path2D;Ve.rect(te,ie,this._config.deviceCellWidth,xe-ie),this._tmpCtx.clip(Ve),this._tmpCtx.moveTo(te-this._config.deviceCellWidth/2,Se),this._tmpCtx.bezierCurveTo(te-this._config.deviceCellWidth/2,Me,te,Me,te,Se),this._tmpCtx.bezierCurveTo(te,Ee,Pe,Ee,Pe,Se),this._tmpCtx.bezierCurveTo(Pe,Me,re,Me,re,Se),this._tmpCtx.bezierCurveTo(re,Ee,re+this._config.deviceCellWidth/2,Ee,re+this._config.deviceCellWidth/2,Se);break;case 4:let Te=me===0?0:me>=U?2*U-me:U-me;me>=U||Te===0?(this._tmpCtx.setLineDash([Math.round(U),Math.round(U)]),this._tmpCtx.moveTo(te+Te,ie),this._tmpCtx.lineTo(re,ie)):(this._tmpCtx.setLineDash([Math.round(U),Math.round(U)]),this._tmpCtx.moveTo(te,ie),this._tmpCtx.lineTo(te+Te,ie),this._tmpCtx.moveTo(te+Te+U,ie),this._tmpCtx.lineTo(re,ie)),me=(0,o.computeNextVariantOffset)(re-te,U,me);break;case 5:let Ht=.6,Ut=.3,Ie=re-te,Ke=Math.floor(Ht*Ie),Xe=Math.floor(Ut*Ie),Nt=Ie-Ke-Xe;this._tmpCtx.setLineDash([Ke,Xe,Nt]),this._tmpCtx.moveTo(te,ie),this._tmpCtx.lineTo(re,ie);break;default:this._tmpCtx.moveTo(te,ie),this._tmpCtx.lineTo(re,ie)}this._tmpCtx.stroke(),this._tmpCtx.restore()}if(this._tmpCtx.restore(),!ue&&this._config.fontSize>=12&&!this._config.allowTransparency&&E!==" "){this._tmpCtx.save(),this._tmpCtx.textBaseline="alphabetic";let ae=this._tmpCtx.measureText(E);if(this._tmpCtx.restore(),"actualBoundingBoxDescent"in ae&&ae.actualBoundingBoxDescent>0){this._tmpCtx.save();let te=new Path2D;te.rect(oe,ie-Math.ceil(U/2),this._config.deviceCellWidth*pe,xe-ie+Math.ceil(U/2)),this._tmpCtx.clip(te),this._tmpCtx.lineWidth=3*this._config.devicePixelRatio,this._tmpCtx.strokeStyle=J.css,this._tmpCtx.strokeText(E,V,V+this._config.deviceCharHeight),this._tmpCtx.restore()}}}if(k){let U=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),Y=U%2==1?.5:0;this._tmpCtx.lineWidth=U,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(V,V+Y),this._tmpCtx.lineTo(V+this._config.deviceCharWidth*pe,V+Y),this._tmpCtx.stroke()}if(ue||this._tmpCtx.fillText(E,V,V+this._config.deviceCharHeight),E==="_"&&!this._config.allowTransparency){let U=c(this._tmpCtx.getImageData(V,V,this._config.deviceCellWidth,this._config.deviceCellHeight),J,Z,fe);if(U)for(let Y=1;Y<=5&&(this._tmpCtx.save(),this._tmpCtx.fillStyle=J.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.restore(),this._tmpCtx.fillText(E,V,V+this._config.deviceCharHeight-Y),U=c(this._tmpCtx.getImageData(V,V,this._config.deviceCellWidth,this._config.deviceCellHeight),J,Z,fe),U);Y++);}if(R){let U=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/10)),Y=this._tmpCtx.lineWidth%2==1?.5:0;this._tmpCtx.lineWidth=U,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(V,V+Math.floor(this._config.deviceCharHeight/2)-Y),this._tmpCtx.lineTo(V+this._config.deviceCharWidth*pe,V+Math.floor(this._config.deviceCharHeight/2)-Y),this._tmpCtx.stroke()}this._tmpCtx.restore();let ge=this._tmpCtx.getImageData(0,0,this._tmpCanvas.width,this._tmpCanvas.height),we;if(we=this._config.allowTransparency?function(U){for(let Y=0;Y<U.data.length;Y+=4)if(U.data[Y+3]>0)return!1;return!0}(ge):c(ge,J,Z,fe),we)return r;let X=this._findGlyphBoundingBox(ge,this._workBoundingBox,I,K,ue,V),j,G;for(;;){if(this._activePages.length===0){let U=this._createNewPage();j=U,G=U.currentRow,G.height=X.size.y;break}j=this._activePages[this._activePages.length-1],G=j.currentRow;for(let U of this._activePages)X.size.y<=U.currentRow.height&&(j=U,G=U.currentRow);for(let U=this._activePages.length-1;U>=0;U--)for(let Y of this._activePages[U].fixedRows)Y.height<=G.height&&X.size.y<=Y.height&&(j=this._activePages[U],G=Y);if(G.y+X.size.y>=j.canvas.height||G.height>X.size.y+2){let U=!1;if(j.currentRow.y+j.currentRow.height+X.size.y>=j.canvas.height){let Y;for(let oe of this._activePages)if(oe.currentRow.y+oe.currentRow.height+X.size.y<oe.canvas.height){Y=oe;break}if(Y)j=Y;else if(f.maxAtlasPages&&this._pages.length>=f.maxAtlasPages&&G.y+X.size.y<=j.canvas.height&&G.height>=X.size.y&&G.x+X.size.x<=j.canvas.width)U=!0;else{let oe=this._createNewPage();j=oe,G=oe.currentRow,G.height=X.size.y,U=!0}}U||(j.currentRow.height>0&&j.fixedRows.push(j.currentRow),G={x:0,y:j.currentRow.y+j.currentRow.height,height:X.size.y},j.fixedRows.push(G),j.currentRow={x:0,y:G.y+G.height,height:0})}if(G.x+X.size.x<=j.canvas.width)break;G===j.currentRow?(G.x=0,G.y+=G.height,G.height=0):j.fixedRows.splice(j.fixedRows.indexOf(G),1)}return X.texturePage=this._pages.indexOf(j),X.texturePosition.x=G.x,X.texturePosition.y=G.y,X.texturePositionClipSpace.x=G.x/j.canvas.width,X.texturePositionClipSpace.y=G.y/j.canvas.height,X.sizeClipSpace.x/=j.canvas.width,X.sizeClipSpace.y/=j.canvas.height,G.height=Math.max(G.height,X.size.y),G.x+=X.size.x,j.ctx.putImageData(ge,X.texturePosition.x-this._workBoundingBox.left,X.texturePosition.y-this._workBoundingBox.top,this._workBoundingBox.left,this._workBoundingBox.top,X.size.x,X.size.y),j.addGlyph(X),j.version++,X}_findGlyphBoundingBox(y,m,A,x,M,E){m.top=0;let I=x?this._config.deviceCellHeight:this._tmpCanvas.height,F=x?this._config.deviceCellWidth:A,O=!1;for(let P=0;P<I;P++){for(let H=0;H<F;H++){let $=P*this._tmpCanvas.width*4+4*H+3;if(y.data[$]!==0){m.top=P,O=!0;break}}if(O)break}m.left=0,O=!1;for(let P=0;P<E+F;P++){for(let H=0;H<I;H++){let $=H*this._tmpCanvas.width*4+4*P+3;if(y.data[$]!==0){m.left=P,O=!0;break}}if(O)break}m.right=F,O=!1;for(let P=E+F-1;P>=E;P--){for(let H=0;H<I;H++){let $=H*this._tmpCanvas.width*4+4*P+3;if(y.data[$]!==0){m.right=P,O=!0;break}}if(O)break}m.bottom=I,O=!1;for(let P=I-1;P>=0;P--){for(let H=0;H<F;H++){let $=P*this._tmpCanvas.width*4+4*H+3;if(y.data[$]!==0){m.bottom=P,O=!0;break}}if(O)break}return{texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},size:{x:m.right-m.left+1,y:m.bottom-m.top+1},sizeClipSpace:{x:m.right-m.left+1,y:m.bottom-m.top+1},offset:{x:-m.left+E+(x||M?Math.floor((this._config.deviceCellWidth-this._config.deviceCharWidth)/2):0),y:-m.top+E+(x||M?this._config.lineHeight===1?0:Math.round((this._config.deviceCellHeight-this._config.deviceCharHeight)/2):0)}}}}i.TextureAtlas=f;class d{get percentageUsed(){return this._usedPixels/(this.canvas.width*this.canvas.height)}get glyphs(){return this._glyphs}addGlyph(y){this._glyphs.push(y),this._usedPixels+=y.size.x*y.size.y}constructor(y,m,A){if(this._usedPixels=0,this._glyphs=[],this.version=0,this.currentRow={x:0,y:0,height:0},this.fixedRows=[],A)for(let x of A)this._glyphs.push(...x.glyphs),this._usedPixels+=x._usedPixels;this.canvas=b(y,m,m),this.ctx=(0,o.throwIfFalsy)(this.canvas.getContext("2d",{alpha:!0}))}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.currentRow.x=0,this.currentRow.y=0,this.currentRow.height=0,this.fixedRows.length=0,this.version++}}function c(S,y,m,A){let x=y.rgba>>>24,M=y.rgba>>>16&255,E=y.rgba>>>8&255,I=m.rgba>>>24,F=m.rgba>>>16&255,O=m.rgba>>>8&255,P=Math.floor((Math.abs(x-I)+Math.abs(M-F)+Math.abs(E-O))/12),H=!0;for(let $=0;$<S.data.length;$+=4)S.data[$]===x&&S.data[$+1]===M&&S.data[$+2]===E||A&&Math.abs(S.data[$]-x)+Math.abs(S.data[$+1]-M)+Math.abs(S.data[$+2]-E)<P?S.data[$+3]=0:H=!1;return H}function b(S,y,m){let A=S.createElement("canvas");return A.width=y,A.height=m,A}},160:(w,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.contrastRatio=i.toPaddedHex=i.rgba=i.rgb=i.css=i.color=i.channels=i.NULL_COLOR=void 0;let p=0,s=0,n=0,o=0;var u,h,_,t,e;function v(a){let f=a.toString(16);return f.length<2?"0"+f:f}function r(a,f){return a<f?(f+.05)/(a+.05):(a+.05)/(f+.05)}i.NULL_COLOR={css:"#00000000",rgba:0},function(a){a.toCss=function(f,d,c,b){return b!==void 0?`#${v(f)}${v(d)}${v(c)}${v(b)}`:`#${v(f)}${v(d)}${v(c)}`},a.toRgba=function(f,d,c,b=255){return(f<<24|d<<16|c<<8|b)>>>0},a.toColor=function(f,d,c,b){return{css:a.toCss(f,d,c,b),rgba:a.toRgba(f,d,c,b)}}}(u||(i.channels=u={})),function(a){function f(d,c){return o=Math.round(255*c),[p,s,n]=e.toChannels(d.rgba),{css:u.toCss(p,s,n,o),rgba:u.toRgba(p,s,n,o)}}a.blend=function(d,c){if(o=(255&c.rgba)/255,o===1)return{css:c.css,rgba:c.rgba};let b=c.rgba>>24&255,S=c.rgba>>16&255,y=c.rgba>>8&255,m=d.rgba>>24&255,A=d.rgba>>16&255,x=d.rgba>>8&255;return p=m+Math.round((b-m)*o),s=A+Math.round((S-A)*o),n=x+Math.round((y-x)*o),{css:u.toCss(p,s,n),rgba:u.toRgba(p,s,n)}},a.isOpaque=function(d){return(255&d.rgba)==255},a.ensureContrastRatio=function(d,c,b){let S=e.ensureContrastRatio(d.rgba,c.rgba,b);if(S)return u.toColor(S>>24&255,S>>16&255,S>>8&255)},a.opaque=function(d){let c=(255|d.rgba)>>>0;return[p,s,n]=e.toChannels(c),{css:u.toCss(p,s,n),rgba:c}},a.opacity=f,a.multiplyOpacity=function(d,c){return o=255&d.rgba,f(d,o*c/255)},a.toColorRGB=function(d){return[d.rgba>>24&255,d.rgba>>16&255,d.rgba>>8&255]}}(h||(i.color=h={})),function(a){let f,d;try{let c=document.createElement("canvas");c.width=1,c.height=1;let b=c.getContext("2d",{willReadFrequently:!0});b&&(f=b,f.globalCompositeOperation="copy",d=f.createLinearGradient(0,0,1,1))}catch{}a.toColor=function(c){if(c.match(/#[\da-f]{3,8}/i))switch(c.length){case 4:return p=parseInt(c.slice(1,2).repeat(2),16),s=parseInt(c.slice(2,3).repeat(2),16),n=parseInt(c.slice(3,4).repeat(2),16),u.toColor(p,s,n);case 5:return p=parseInt(c.slice(1,2).repeat(2),16),s=parseInt(c.slice(2,3).repeat(2),16),n=parseInt(c.slice(3,4).repeat(2),16),o=parseInt(c.slice(4,5).repeat(2),16),u.toColor(p,s,n,o);case 7:return{css:c,rgba:(parseInt(c.slice(1),16)<<8|255)>>>0};case 9:return{css:c,rgba:parseInt(c.slice(1),16)>>>0}}let b=c.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(b)return p=parseInt(b[1]),s=parseInt(b[2]),n=parseInt(b[3]),o=Math.round(255*(b[5]===void 0?1:parseFloat(b[5]))),u.toColor(p,s,n,o);if(!f||!d)throw new Error("css.toColor: Unsupported css format");if(f.fillStyle=d,f.fillStyle=c,typeof f.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(f.fillRect(0,0,1,1),[p,s,n,o]=f.getImageData(0,0,1,1).data,o!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:u.toRgba(p,s,n,o),css:c}}}(_||(i.css=_={})),function(a){function f(d,c,b){let S=d/255,y=c/255,m=b/255;return .2126*(S<=.03928?S/12.92:Math.pow((S+.055)/1.055,2.4))+.7152*(y<=.03928?y/12.92:Math.pow((y+.055)/1.055,2.4))+.0722*(m<=.03928?m/12.92:Math.pow((m+.055)/1.055,2.4))}a.relativeLuminance=function(d){return f(d>>16&255,d>>8&255,255&d)},a.relativeLuminance2=f}(t||(i.rgb=t={})),function(a){function f(c,b,S){let y=c>>24&255,m=c>>16&255,A=c>>8&255,x=b>>24&255,M=b>>16&255,E=b>>8&255,I=r(t.relativeLuminance2(x,M,E),t.relativeLuminance2(y,m,A));for(;I<S&&(x>0||M>0||E>0);)x-=Math.max(0,Math.ceil(.1*x)),M-=Math.max(0,Math.ceil(.1*M)),E-=Math.max(0,Math.ceil(.1*E)),I=r(t.relativeLuminance2(x,M,E),t.relativeLuminance2(y,m,A));return(x<<24|M<<16|E<<8|255)>>>0}function d(c,b,S){let y=c>>24&255,m=c>>16&255,A=c>>8&255,x=b>>24&255,M=b>>16&255,E=b>>8&255,I=r(t.relativeLuminance2(x,M,E),t.relativeLuminance2(y,m,A));for(;I<S&&(x<255||M<255||E<255);)x=Math.min(255,x+Math.ceil(.1*(255-x))),M=Math.min(255,M+Math.ceil(.1*(255-M))),E=Math.min(255,E+Math.ceil(.1*(255-E))),I=r(t.relativeLuminance2(x,M,E),t.relativeLuminance2(y,m,A));return(x<<24|M<<16|E<<8|255)>>>0}a.blend=function(c,b){if(o=(255&b)/255,o===1)return b;let S=b>>24&255,y=b>>16&255,m=b>>8&255,A=c>>24&255,x=c>>16&255,M=c>>8&255;return p=A+Math.round((S-A)*o),s=x+Math.round((y-x)*o),n=M+Math.round((m-M)*o),u.toRgba(p,s,n)},a.ensureContrastRatio=function(c,b,S){let y=t.relativeLuminance(c>>8),m=t.relativeLuminance(b>>8);if(r(y,m)<S){if(m<y){let M=f(c,b,S),E=r(y,t.relativeLuminance(M>>8));if(E<S){let I=d(c,b,S);return E>r(y,t.relativeLuminance(I>>8))?M:I}return M}let A=d(c,b,S),x=r(y,t.relativeLuminance(A>>8));if(x<S){let M=f(c,b,S);return x>r(y,t.relativeLuminance(M>>8))?A:M}return A}},a.reduceLuminance=f,a.increaseLuminance=d,a.toChannels=function(c){return[c>>24&255,c>>16&255,c>>8&255,255&c]}}(e||(i.rgba=e={})),i.toPaddedHex=v,i.contrastRatio=r},345:(w,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.runAndSubscribe=i.forwardEvent=i.EventEmitter=void 0,i.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=p=>(this._listeners.push(p),{dispose:()=>{if(!this._disposed){for(let s=0;s<this._listeners.length;s++)if(this._listeners[s]===p)return void this._listeners.splice(s,1)}}})),this._event}fire(p,s){let n=[];for(let o=0;o<this._listeners.length;o++)n.push(this._listeners[o]);for(let o=0;o<n.length;o++)n[o].call(void 0,p,s)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},i.forwardEvent=function(p,s){return p(n=>s.fire(n))},i.runAndSubscribe=function(p,s){return s(void 0),p(n=>s(n))}},859:(w,i)=>{function p(s){for(let n of s)n.dispose();s.length=0}Object.defineProperty(i,"__esModule",{value:!0}),i.getDisposeArrayDisposable=i.disposeArray=i.toDisposable=i.MutableDisposable=i.Disposable=void 0,i.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(let s of this._disposables)s.dispose();this._disposables.length=0}register(s){return this._disposables.push(s),s}unregister(s){let n=this._disposables.indexOf(s);n!==-1&&this._disposables.splice(n,1)}},i.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(s){this._isDisposed||s===this._value||(this._value?.dispose(),this._value=s)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}},i.toDisposable=function(s){return{dispose:s}},i.disposeArray=p,i.getDisposeArrayDisposable=function(s){return{dispose:()=>p(s)}}},485:(w,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.FourKeyMap=i.TwoKeyMap=void 0;class p{constructor(){this._data={}}set(n,o,u){this._data[n]||(this._data[n]={}),this._data[n][o]=u}get(n,o){return this._data[n]?this._data[n][o]:void 0}clear(){this._data={}}}i.TwoKeyMap=p,i.FourKeyMap=class{constructor(){this._data=new p}set(s,n,o,u,h){this._data.get(s,n)||this._data.set(s,n,new p),this._data.get(s,n).set(o,u,h)}get(s,n,o,u){return this._data.get(s,n)?.get(o,u)}clear(){this._data.clear()}}},399:(w,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.isChromeOS=i.isLinux=i.isWindows=i.isIphone=i.isIpad=i.isMac=i.getSafariVersion=i.isSafari=i.isLegacyEdge=i.isFirefox=i.isNode=void 0,i.isNode=typeof process<"u"&&"title"in process;let p=i.isNode?"node":navigator.userAgent,s=i.isNode?"node":navigator.platform;i.isFirefox=p.includes("Firefox"),i.isLegacyEdge=p.includes("Edge"),i.isSafari=/^((?!chrome|android).)*safari/i.test(p),i.getSafariVersion=function(){if(!i.isSafari)return 0;let n=p.match(/Version\/(\d+)/);return n===null||n.length<2?0:parseInt(n[1])},i.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(s),i.isIpad=s==="iPad",i.isIphone=s==="iPhone",i.isWindows=["Windows","Win16","Win32","WinCE"].includes(s),i.isLinux=s.indexOf("Linux")>=0,i.isChromeOS=/\bCrOS\b/.test(p)},385:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.DebouncedIdleTask=i.IdleTaskQueue=i.PriorityTaskQueue=void 0;let s=p(399);class n{constructor(){this._tasks=[],this._i=0}enqueue(h){this._tasks.push(h),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(h){this._idleCallback=void 0;let _=0,t=0,e=h.timeRemaining(),v=0;for(;this._i<this._tasks.length;){if(_=Date.now(),this._tasks[this._i]()||this._i++,_=Math.max(1,Date.now()-_),t=Math.max(_,t),v=h.timeRemaining(),1.5*t>v)return e-_<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(e-_))}ms`),void this._start();e=v}this.clear()}}class o extends n{_requestCallback(h){return setTimeout(()=>h(this._createDeadline(16)))}_cancelCallback(h){clearTimeout(h)}_createDeadline(h){let _=Date.now()+h;return{timeRemaining:()=>Math.max(0,_-Date.now())}}}i.PriorityTaskQueue=o,i.IdleTaskQueue=!s.isNode&&"requestIdleCallback"in window?class extends n{_requestCallback(u){return requestIdleCallback(u)}_cancelCallback(u){cancelIdleCallback(u)}}:o,i.DebouncedIdleTask=class{constructor(){this._queue=new i.IdleTaskQueue}set(u){this._queue.clear(),this._queue.enqueue(u)}flush(){this._queue.flush()}}},147:(w,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ExtendedAttrs=i.AttributeData=void 0;class p{constructor(){this.fg=0,this.bg=0,this.extended=new s}static toColorRGB(o){return[o>>>16&255,o>>>8&255,255&o]}static fromColorRGB(o){return(255&o[0])<<16|(255&o[1])<<8|255&o[2]}clone(){let o=new p;return o.fg=this.fg,o.bg=this.bg,o.extended=this.extended.clone(),o}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}i.AttributeData=p;class s{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(o){this._ext=o}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(o){this._ext&=-469762049,this._ext|=o<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(o){this._ext&=-67108864,this._ext|=67108863&o}get urlId(){return this._urlId}set urlId(o){this._urlId=o}get underlineVariantOffset(){let o=(3758096384&this._ext)>>29;return o<0?4294967288^o:o}set underlineVariantOffset(o){this._ext&=536870911,this._ext|=o<<29&3758096384}constructor(o=0,u=0){this._ext=0,this._urlId=0,this._ext=o,this._urlId=u}clone(){return new s(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}i.ExtendedAttrs=s},782:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CellData=void 0;let s=p(133),n=p(855),o=p(147);class u extends o.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new o.ExtendedAttrs,this.combinedData=""}static fromCharData(_){let t=new u;return t.setFromCharData(_),t}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,s.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(_){this.fg=_[n.CHAR_DATA_ATTR_INDEX],this.bg=0;let t=!1;if(_[n.CHAR_DATA_CHAR_INDEX].length>2)t=!0;else if(_[n.CHAR_DATA_CHAR_INDEX].length===2){let e=_[n.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=e&&e<=56319){let v=_[n.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=v&&v<=57343?this.content=1024*(e-55296)+v-56320+65536|_[n.CHAR_DATA_WIDTH_INDEX]<<22:t=!0}else t=!0}else this.content=_[n.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|_[n.CHAR_DATA_WIDTH_INDEX]<<22;t&&(this.combinedData=_[n.CHAR_DATA_CHAR_INDEX],this.content=2097152|_[n.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}i.CellData=u},855:(w,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.WHITESPACE_CELL_CODE=i.WHITESPACE_CELL_WIDTH=i.WHITESPACE_CELL_CHAR=i.NULL_CELL_CODE=i.NULL_CELL_WIDTH=i.NULL_CELL_CHAR=i.CHAR_DATA_CODE_INDEX=i.CHAR_DATA_WIDTH_INDEX=i.CHAR_DATA_CHAR_INDEX=i.CHAR_DATA_ATTR_INDEX=i.DEFAULT_EXT=i.DEFAULT_ATTR=i.DEFAULT_COLOR=void 0,i.DEFAULT_COLOR=0,i.DEFAULT_ATTR=256|i.DEFAULT_COLOR<<9,i.DEFAULT_EXT=0,i.CHAR_DATA_ATTR_INDEX=0,i.CHAR_DATA_CHAR_INDEX=1,i.CHAR_DATA_WIDTH_INDEX=2,i.CHAR_DATA_CODE_INDEX=3,i.NULL_CELL_CHAR="",i.NULL_CELL_WIDTH=1,i.NULL_CELL_CODE=0,i.WHITESPACE_CELL_CHAR=" ",i.WHITESPACE_CELL_WIDTH=1,i.WHITESPACE_CELL_CODE=32},133:(w,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Utf8ToUtf32=i.StringToUtf32=i.utf32ToString=i.stringFromCodePoint=void 0,i.stringFromCodePoint=function(p){return p>65535?(p-=65536,String.fromCharCode(55296+(p>>10))+String.fromCharCode(p%1024+56320)):String.fromCharCode(p)},i.utf32ToString=function(p,s=0,n=p.length){let o="";for(let u=s;u<n;++u){let h=p[u];h>65535?(h-=65536,o+=String.fromCharCode(55296+(h>>10))+String.fromCharCode(h%1024+56320)):o+=String.fromCharCode(h)}return o},i.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(p,s){let n=p.length;if(!n)return 0;let o=0,u=0;if(this._interim){let h=p.charCodeAt(u++);56320<=h&&h<=57343?s[o++]=1024*(this._interim-55296)+h-56320+65536:(s[o++]=this._interim,s[o++]=h),this._interim=0}for(let h=u;h<n;++h){let _=p.charCodeAt(h);if(55296<=_&&_<=56319){if(++h>=n)return this._interim=_,o;let t=p.charCodeAt(h);56320<=t&&t<=57343?s[o++]=1024*(_-55296)+t-56320+65536:(s[o++]=_,s[o++]=t)}else _!==65279&&(s[o++]=_)}return o}},i.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(p,s){let n=p.length;if(!n)return 0;let o,u,h,_,t=0,e=0,v=0;if(this.interim[0]){let f=!1,d=this.interim[0];d&=(224&d)==192?31:(240&d)==224?15:7;let c,b=0;for(;(c=63&this.interim[++b])&&b<4;)d<<=6,d|=c;let S=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,y=S-b;for(;v<y;){if(v>=n)return 0;if(c=p[v++],(192&c)!=128){v--,f=!0;break}this.interim[b++]=c,d<<=6,d|=63&c}f||(S===2?d<128?v--:s[t++]=d:S===3?d<2048||d>=55296&&d<=57343||d===65279||(s[t++]=d):d<65536||d>1114111||(s[t++]=d)),this.interim.fill(0)}let r=n-4,a=v;for(;a<n;){for(;!(!(a<r)||128&(o=p[a])||128&(u=p[a+1])||128&(h=p[a+2])||128&(_=p[a+3]));)s[t++]=o,s[t++]=u,s[t++]=h,s[t++]=_,a+=4;if(o=p[a++],o<128)s[t++]=o;else if((224&o)==192){if(a>=n)return this.interim[0]=o,t;if(u=p[a++],(192&u)!=128){a--;continue}if(e=(31&o)<<6|63&u,e<128){a--;continue}s[t++]=e}else if((240&o)==224){if(a>=n)return this.interim[0]=o,t;if(u=p[a++],(192&u)!=128){a--;continue}if(a>=n)return this.interim[0]=o,this.interim[1]=u,t;if(h=p[a++],(192&h)!=128){a--;continue}if(e=(15&o)<<12|(63&u)<<6|63&h,e<2048||e>=55296&&e<=57343||e===65279)continue;s[t++]=e}else if((248&o)==240){if(a>=n)return this.interim[0]=o,t;if(u=p[a++],(192&u)!=128){a--;continue}if(a>=n)return this.interim[0]=o,this.interim[1]=u,t;if(h=p[a++],(192&h)!=128){a--;continue}if(a>=n)return this.interim[0]=o,this.interim[1]=u,this.interim[2]=h,t;if(_=p[a++],(192&_)!=128){a--;continue}if(e=(7&o)<<18|(63&u)<<12|(63&h)<<6|63&_,e<65536||e>1114111)continue;s[t++]=e}}return t}}},776:function(w,i,p){var s=this&&this.__decorate||function(e,v,r,a){var f,d=arguments.length,c=d<3?v:a===null?a=Object.getOwnPropertyDescriptor(v,r):a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(e,v,r,a);else for(var b=e.length-1;b>=0;b--)(f=e[b])&&(c=(d<3?f(c):d>3?f(v,r,c):f(v,r))||c);return d>3&&c&&Object.defineProperty(v,r,c),c},n=this&&this.__param||function(e,v){return function(r,a){v(r,a,e)}};Object.defineProperty(i,"__esModule",{value:!0}),i.traceCall=i.setTraceLogger=i.LogService=void 0;let o=p(859),u=p(97),h={trace:u.LogLevelEnum.TRACE,debug:u.LogLevelEnum.DEBUG,info:u.LogLevelEnum.INFO,warn:u.LogLevelEnum.WARN,error:u.LogLevelEnum.ERROR,off:u.LogLevelEnum.OFF},_,t=i.LogService=class extends o.Disposable{get logLevel(){return this._logLevel}constructor(e){super(),this._optionsService=e,this._logLevel=u.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),_=this}_updateLogLevel(){this._logLevel=h[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(e){for(let v=0;v<e.length;v++)typeof e[v]=="function"&&(e[v]=e[v]())}_log(e,v,r){this._evalLazyOptionalParams(r),e.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+v,...r)}trace(e,...v){this._logLevel<=u.LogLevelEnum.TRACE&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,e,v)}debug(e,...v){this._logLevel<=u.LogLevelEnum.DEBUG&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,e,v)}info(e,...v){this._logLevel<=u.LogLevelEnum.INFO&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,e,v)}warn(e,...v){this._logLevel<=u.LogLevelEnum.WARN&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,e,v)}error(e,...v){this._logLevel<=u.LogLevelEnum.ERROR&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,e,v)}};i.LogService=t=s([n(0,u.IOptionsService)],t),i.setTraceLogger=function(e){_=e},i.traceCall=function(e,v,r){if(typeof r.value!="function")throw new Error("not supported");let a=r.value;r.value=function(...f){if(_.logLevel!==u.LogLevelEnum.TRACE)return a.apply(this,f);_.trace(`GlyphRenderer#${a.name}(${f.map(c=>JSON.stringify(c)).join(", ")})`);let d=a.apply(this,f);return _.trace(`GlyphRenderer#${a.name} return`,d),d}}},726:(w,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.createDecorator=i.getServiceDependencies=i.serviceRegistry=void 0;let p="di$target",s="di$dependencies";i.serviceRegistry=new Map,i.getServiceDependencies=function(n){return n[s]||[]},i.createDecorator=function(n){if(i.serviceRegistry.has(n))return i.serviceRegistry.get(n);let o=function(u,h,_){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(t,e,v){e[p]===e?e[s].push({id:t,index:v}):(e[s]=[{id:t,index:v}],e[p]=e)})(o,u,_)};return o.toString=()=>n,i.serviceRegistry.set(n,o),o}},97:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.IDecorationService=i.IUnicodeService=i.IOscLinkService=i.IOptionsService=i.ILogService=i.LogLevelEnum=i.IInstantiationService=i.ICharsetService=i.ICoreService=i.ICoreMouseService=i.IBufferService=void 0;let s=p(726);var n;i.IBufferService=(0,s.createDecorator)("BufferService"),i.ICoreMouseService=(0,s.createDecorator)("CoreMouseService"),i.ICoreService=(0,s.createDecorator)("CoreService"),i.ICharsetService=(0,s.createDecorator)("CharsetService"),i.IInstantiationService=(0,s.createDecorator)("InstantiationService"),function(o){o[o.TRACE=0]="TRACE",o[o.DEBUG=1]="DEBUG",o[o.INFO=2]="INFO",o[o.WARN=3]="WARN",o[o.ERROR=4]="ERROR",o[o.OFF=5]="OFF"}(n||(i.LogLevelEnum=n={})),i.ILogService=(0,s.createDecorator)("LogService"),i.IOptionsService=(0,s.createDecorator)("OptionsService"),i.IOscLinkService=(0,s.createDecorator)("OscLinkService"),i.IUnicodeService=(0,s.createDecorator)("UnicodeService"),i.IDecorationService=(0,s.createDecorator)("DecorationService")}},g={};function l(w){var i=g[w];if(i!==void 0)return i.exports;var p=g[w]={exports:{}};return T[w].call(p.exports,p,p.exports,l),p.exports}var C={};return(()=>{var w=C;Object.defineProperty(w,"__esModule",{value:!0}),w.WebglAddon=void 0;let i=l(345),p=l(859),s=l(399),n=l(666),o=l(776);class u extends p.Disposable{constructor(_){if(s.isSafari&&(0,s.getSafariVersion)()<16){let t={antialias:!1,depth:!1,preserveDrawingBuffer:!0};if(!document.createElement("canvas").getContext("webgl2",t))throw new Error("Webgl2 is only supported on Safari 16 and above")}super(),this._preserveDrawingBuffer=_,this._onChangeTextureAtlas=this.register(new i.EventEmitter),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this.register(new i.EventEmitter),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=this.register(new i.EventEmitter),this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._onContextLoss=this.register(new i.EventEmitter),this.onContextLoss=this._onContextLoss.event}activate(_){let t=_._core;if(!_.element)return void this.register(t.onWillOpen(()=>this.activate(_)));this._terminal=_;let e=t.coreService,v=t.optionsService,r=t,a=r._renderService,f=r._characterJoinerService,d=r._charSizeService,c=r._coreBrowserService,b=r._decorationService,S=r._logService,y=r._themeService;(0,o.setTraceLogger)(S),this._renderer=this.register(new n.WebglRenderer(_,f,d,c,e,b,v,y,this._preserveDrawingBuffer)),this.register((0,i.forwardEvent)(this._renderer.onContextLoss,this._onContextLoss)),this.register((0,i.forwardEvent)(this._renderer.onChangeTextureAtlas,this._onChangeTextureAtlas)),this.register((0,i.forwardEvent)(this._renderer.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas)),this.register((0,i.forwardEvent)(this._renderer.onRemoveTextureAtlasCanvas,this._onRemoveTextureAtlasCanvas)),a.setRenderer(this._renderer),this.register((0,p.toDisposable)(()=>{let m=this._terminal._core._renderService;m.setRenderer(this._terminal._core._createRenderer()),m.handleResize(_.cols,_.rows)}))}get textureAtlas(){return this._renderer?.textureAtlas}clearTextureAtlas(){this._renderer?.clearTextureAtlas()}}w.WebglAddon=u})(),C})())});var Gi=ut((It,hi)=>{(function(T,g){typeof It=="object"&&typeof hi=="object"?hi.exports=g():typeof define=="function"&&define.amd?define([],g):typeof It=="object"?It.CanvasAddon=g():T.CanvasAddon=g()})(self,()=>(()=>{"use strict";var T={903:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BaseRenderLayer=void 0;let s=p(274),n=p(627),o=p(237),u=p(860),h=p(374),_=p(296),t=p(345),e=p(859),v=p(399),r=p(855);class a extends e.Disposable{get canvas(){return this._canvas}get cacheCanvas(){return this._charAtlas?.pages[0].canvas}constructor(c,b,S,y,m,A,x,M,E,I){super(),this._terminal=c,this._container=b,this._alpha=m,this._themeService=A,this._bufferService=x,this._optionsService=M,this._decorationService=E,this._coreBrowserService=I,this._deviceCharWidth=0,this._deviceCharHeight=0,this._deviceCellWidth=0,this._deviceCellHeight=0,this._deviceCharLeft=0,this._deviceCharTop=0,this._selectionModel=(0,_.createSelectionRenderModel)(),this._bitmapGenerator=[],this._charAtlasDisposable=this.register(new e.MutableDisposable),this._onAddTextureAtlasCanvas=this.register(new t.EventEmitter),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._cellColorResolver=new s.CellColorResolver(this._terminal,this._optionsService,this._selectionModel,this._decorationService,this._coreBrowserService,this._themeService),this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add(`xterm-${S}-layer`),this._canvas.style.zIndex=y.toString(),this._initCanvas(),this._container.appendChild(this._canvas),this._refreshCharAtlas(this._themeService.colors),this.register(this._themeService.onChangeColors(F=>{this._refreshCharAtlas(F),this.reset(),this.handleSelectionChanged(this._selectionModel.selectionStart,this._selectionModel.selectionEnd,this._selectionModel.columnSelectMode)})),this.register((0,e.toDisposable)(()=>{this._canvas.remove()}))}_initCanvas(){this._ctx=(0,h.throwIfFalsy)(this._canvas.getContext("2d",{alpha:this._alpha})),this._alpha||this._clearAll()}handleBlur(){}handleFocus(){}handleCursorMove(){}handleGridChanged(c,b){}handleSelectionChanged(c,b,S=!1){this._selectionModel.update(this._terminal._core,c,b,S)}_setTransparency(c){if(c===this._alpha)return;let b=this._canvas;this._alpha=c,this._canvas=this._canvas.cloneNode(),this._initCanvas(),this._container.replaceChild(this._canvas,b),this._refreshCharAtlas(this._themeService.colors),this.handleGridChanged(0,this._bufferService.rows-1)}_refreshCharAtlas(c){if(!(this._deviceCharWidth<=0&&this._deviceCharHeight<=0)){this._charAtlas=(0,n.acquireTextureAtlas)(this._terminal,this._optionsService.rawOptions,c,this._deviceCellWidth,this._deviceCellHeight,this._deviceCharWidth,this._deviceCharHeight,this._coreBrowserService.dpr),this._charAtlasDisposable.value=(0,t.forwardEvent)(this._charAtlas.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas),this._charAtlas.warmUp();for(let b=0;b<this._charAtlas.pages.length;b++)this._bitmapGenerator[b]=new f(this._charAtlas.pages[b].canvas)}}resize(c){this._deviceCellWidth=c.device.cell.width,this._deviceCellHeight=c.device.cell.height,this._deviceCharWidth=c.device.char.width,this._deviceCharHeight=c.device.char.height,this._deviceCharLeft=c.device.char.left,this._deviceCharTop=c.device.char.top,this._canvas.width=c.device.canvas.width,this._canvas.height=c.device.canvas.height,this._canvas.style.width=`${c.css.canvas.width}px`,this._canvas.style.height=`${c.css.canvas.height}px`,this._alpha||this._clearAll(),this._refreshCharAtlas(this._themeService.colors)}clearTextureAtlas(){this._charAtlas?.clearTexture()}_fillCells(c,b,S,y){this._ctx.fillRect(c*this._deviceCellWidth,b*this._deviceCellHeight,S*this._deviceCellWidth,y*this._deviceCellHeight)}_fillMiddleLineAtCells(c,b,S=1){let y=Math.ceil(.5*this._deviceCellHeight);this._ctx.fillRect(c*this._deviceCellWidth,(b+1)*this._deviceCellHeight-y-this._coreBrowserService.dpr,S*this._deviceCellWidth,this._coreBrowserService.dpr)}_fillBottomLineAtCells(c,b,S=1,y=0){this._ctx.fillRect(c*this._deviceCellWidth,(b+1)*this._deviceCellHeight+y-this._coreBrowserService.dpr-1,S*this._deviceCellWidth,this._coreBrowserService.dpr)}_curlyUnderlineAtCell(c,b,S=1){this._ctx.save(),this._ctx.beginPath(),this._ctx.strokeStyle=this._ctx.fillStyle;let y=this._coreBrowserService.dpr;this._ctx.lineWidth=y;for(let m=0;m<S;m++){let A=(c+m)*this._deviceCellWidth,x=(c+m+.5)*this._deviceCellWidth,M=(c+m+1)*this._deviceCellWidth,E=(b+1)*this._deviceCellHeight-y-1,I=E-y,F=E+y;this._ctx.moveTo(A,E),this._ctx.bezierCurveTo(A,I,x,I,x,E),this._ctx.bezierCurveTo(x,F,M,F,M,E)}this._ctx.stroke(),this._ctx.restore()}_dottedUnderlineAtCell(c,b,S=1){this._ctx.save(),this._ctx.beginPath(),this._ctx.strokeStyle=this._ctx.fillStyle;let y=this._coreBrowserService.dpr;this._ctx.lineWidth=y,this._ctx.setLineDash([2*y,y]);let m=c*this._deviceCellWidth,A=(b+1)*this._deviceCellHeight-y-1;this._ctx.moveTo(m,A);for(let x=0;x<S;x++){let M=(c+S+x)*this._deviceCellWidth;this._ctx.lineTo(M,A)}this._ctx.stroke(),this._ctx.closePath(),this._ctx.restore()}_dashedUnderlineAtCell(c,b,S=1){this._ctx.save(),this._ctx.beginPath(),this._ctx.strokeStyle=this._ctx.fillStyle;let y=this._coreBrowserService.dpr;this._ctx.lineWidth=y,this._ctx.setLineDash([4*y,3*y]);let m=c*this._deviceCellWidth,A=(c+S)*this._deviceCellWidth,x=(b+1)*this._deviceCellHeight-y-1;this._ctx.moveTo(m,x),this._ctx.lineTo(A,x),this._ctx.stroke(),this._ctx.closePath(),this._ctx.restore()}_fillLeftLineAtCell(c,b,S){this._ctx.fillRect(c*this._deviceCellWidth,b*this._deviceCellHeight,this._coreBrowserService.dpr*S,this._deviceCellHeight)}_strokeRectAtCell(c,b,S,y){let m=this._coreBrowserService.dpr;this._ctx.lineWidth=m,this._ctx.strokeRect(c*this._deviceCellWidth+m/2,b*this._deviceCellHeight+m/2,S*this._deviceCellWidth-m,y*this._deviceCellHeight-m)}_clearAll(){this._alpha?this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height))}_clearCells(c,b,S,y){this._alpha?this._ctx.clearRect(c*this._deviceCellWidth,b*this._deviceCellHeight,S*this._deviceCellWidth,y*this._deviceCellHeight):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(c*this._deviceCellWidth,b*this._deviceCellHeight,S*this._deviceCellWidth,y*this._deviceCellHeight))}_fillCharTrueColor(c,b,S){this._ctx.font=this._getFont(!1,!1),this._ctx.textBaseline=o.TEXT_BASELINE,this._clipRow(S);let y=!1;this._optionsService.rawOptions.customGlyphs!==!1&&(y=(0,u.tryDrawCustomChar)(this._ctx,c.getChars(),b*this._deviceCellWidth,S*this._deviceCellHeight,this._deviceCellWidth,this._deviceCellHeight,this._optionsService.rawOptions.fontSize,this._coreBrowserService.dpr)),y||this._ctx.fillText(c.getChars(),b*this._deviceCellWidth+this._deviceCharLeft,S*this._deviceCellHeight+this._deviceCharTop+this._deviceCharHeight)}_drawChars(c,b,S){let y=c.getChars(),m=c.getCode(),A=c.getWidth();if(this._cellColorResolver.resolve(c,b,this._bufferService.buffer.ydisp+S,this._deviceCellWidth),!this._charAtlas)return;let x;if(x=y&&y.length>1?this._charAtlas.getRasterizedGlyphCombinedChar(y,this._cellColorResolver.result.bg,this._cellColorResolver.result.fg,this._cellColorResolver.result.ext,!0):this._charAtlas.getRasterizedGlyph(c.getCode()||r.WHITESPACE_CELL_CODE,this._cellColorResolver.result.bg,this._cellColorResolver.result.fg,this._cellColorResolver.result.ext,!0),!x.size.x||!x.size.y)return;this._ctx.save(),this._clipRow(S),this._bitmapGenerator[x.texturePage]&&this._charAtlas.pages[x.texturePage].canvas!==this._bitmapGenerator[x.texturePage].canvas&&(this._bitmapGenerator[x.texturePage]?.bitmap?.close(),delete this._bitmapGenerator[x.texturePage]),this._charAtlas.pages[x.texturePage].version!==this._bitmapGenerator[x.texturePage]?.version&&(this._bitmapGenerator[x.texturePage]||(this._bitmapGenerator[x.texturePage]=new f(this._charAtlas.pages[x.texturePage].canvas)),this._bitmapGenerator[x.texturePage].refresh(),this._bitmapGenerator[x.texturePage].version=this._charAtlas.pages[x.texturePage].version);let M=x.size.x;this._optionsService.rawOptions.rescaleOverlappingGlyphs&&(0,h.allowRescaling)(m,A,x.size.x,this._deviceCellWidth)&&(M=this._deviceCellWidth-1),this._ctx.drawImage(this._bitmapGenerator[x.texturePage]?.bitmap||this._charAtlas.pages[x.texturePage].canvas,x.texturePosition.x,x.texturePosition.y,x.size.x,x.size.y,b*this._deviceCellWidth+this._deviceCharLeft-x.offset.x,S*this._deviceCellHeight+this._deviceCharTop-x.offset.y,M,x.size.y),this._ctx.restore()}_clipRow(c){this._ctx.beginPath(),this._ctx.rect(0,c*this._deviceCellHeight,this._bufferService.cols*this._deviceCellWidth,this._deviceCellHeight),this._ctx.clip()}_getFont(c,b){return`${b?"italic":""} ${c?this._optionsService.rawOptions.fontWeightBold:this._optionsService.rawOptions.fontWeight} ${this._optionsService.rawOptions.fontSize*this._coreBrowserService.dpr}px ${this._optionsService.rawOptions.fontFamily}`}}i.BaseRenderLayer=a;class f{get bitmap(){return this._bitmap}constructor(c){this.canvas=c,this._state=0,this._commitTimeout=void 0,this._bitmap=void 0,this.version=-1}refresh(){this._bitmap?.close(),this._bitmap=void 0,v.isSafari||(this._commitTimeout===void 0&&(this._commitTimeout=window.setTimeout(()=>this._generate(),100)),this._state===1&&(this._state=2))}_generate(){this._state===0&&(this._bitmap?.close(),this._bitmap=void 0,this._state=1,window.createImageBitmap(this.canvas).then(c=>{this._state===2?this.refresh():this._bitmap=c,this._state=0}),this._commitTimeout&&(this._commitTimeout=void 0))}}},949:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CanvasRenderer=void 0;let s=p(627),n=p(56),o=p(374),u=p(345),h=p(859),_=p(873),t=p(43),e=p(630),v=p(744);class r extends h.Disposable{constructor(f,d,c,b,S,y,m,A,x,M,E){super(),this._terminal=f,this._screenElement=d,this._bufferService=b,this._charSizeService=S,this._optionsService=y,this._coreBrowserService=x,this._themeService=E,this._observerDisposable=this.register(new h.MutableDisposable),this._onRequestRedraw=this.register(new u.EventEmitter),this.onRequestRedraw=this._onRequestRedraw.event,this._onChangeTextureAtlas=this.register(new u.EventEmitter),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this.register(new u.EventEmitter),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event;let I=this._optionsService.rawOptions.allowTransparency;this._renderLayers=[new v.TextRenderLayer(this._terminal,this._screenElement,0,I,this._bufferService,this._optionsService,m,M,this._coreBrowserService,E),new e.SelectionRenderLayer(this._terminal,this._screenElement,1,this._bufferService,this._coreBrowserService,M,this._optionsService,E),new t.LinkRenderLayer(this._terminal,this._screenElement,2,c,this._bufferService,this._optionsService,M,this._coreBrowserService,E),new _.CursorRenderLayer(this._terminal,this._screenElement,3,this._onRequestRedraw,this._bufferService,this._optionsService,A,this._coreBrowserService,M,E)];for(let F of this._renderLayers)(0,u.forwardEvent)(F.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas);this.dimensions=(0,o.createRenderDimensions)(),this._devicePixelRatio=this._coreBrowserService.dpr,this._updateDimensions(),this._observerDisposable.value=(0,n.observeDevicePixelDimensions)(this._renderLayers[0].canvas,this._coreBrowserService.window,(F,O)=>this._setCanvasDevicePixelDimensions(F,O)),this.register(this._coreBrowserService.onWindowChange(F=>{this._observerDisposable.value=(0,n.observeDevicePixelDimensions)(this._renderLayers[0].canvas,F,(O,P)=>this._setCanvasDevicePixelDimensions(O,P))})),this.register((0,h.toDisposable)(()=>{for(let F of this._renderLayers)F.dispose();(0,s.removeTerminalFromCache)(this._terminal)}))}get textureAtlas(){return this._renderLayers[0].cacheCanvas}handleDevicePixelRatioChange(){this._devicePixelRatio!==this._coreBrowserService.dpr&&(this._devicePixelRatio=this._coreBrowserService.dpr,this.handleResize(this._bufferService.cols,this._bufferService.rows))}handleResize(f,d){this._updateDimensions();for(let c of this._renderLayers)c.resize(this.dimensions);this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}handleCharSizeChanged(){this.handleResize(this._bufferService.cols,this._bufferService.rows)}handleBlur(){this._runOperation(f=>f.handleBlur())}handleFocus(){this._runOperation(f=>f.handleFocus())}handleSelectionChanged(f,d,c=!1){this._runOperation(b=>b.handleSelectionChanged(f,d,c)),this._themeService.colors.selectionForeground&&this._onRequestRedraw.fire({start:0,end:this._bufferService.rows-1})}handleCursorMove(){this._runOperation(f=>f.handleCursorMove())}clear(){this._runOperation(f=>f.reset())}_runOperation(f){for(let d of this._renderLayers)f(d)}renderRows(f,d){for(let c of this._renderLayers)c.handleGridChanged(f,d)}clearTextureAtlas(){for(let f of this._renderLayers)f.clearTextureAtlas()}_updateDimensions(){if(!this._charSizeService.hasValidSize)return;let f=this._coreBrowserService.dpr;this.dimensions.device.char.width=Math.floor(this._charSizeService.width*f),this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*f),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.top=this._optionsService.rawOptions.lineHeight===1?0:Math.round((this.dimensions.device.cell.height-this.dimensions.device.char.height)/2),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.char.left=Math.floor(this._optionsService.rawOptions.letterSpacing/2),this.dimensions.device.canvas.height=this._bufferService.rows*this.dimensions.device.cell.height,this.dimensions.device.canvas.width=this._bufferService.cols*this.dimensions.device.cell.width,this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/f),this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/f),this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows,this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols}_setCanvasDevicePixelDimensions(f,d){this.dimensions.device.canvas.height=d,this.dimensions.device.canvas.width=f;for(let c of this._renderLayers)c.resize(this.dimensions);this._requestRedrawViewport()}_requestRedrawViewport(){this._onRequestRedraw.fire({start:0,end:this._bufferService.rows-1})}}i.CanvasRenderer=r},873:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CursorRenderLayer=void 0;let s=p(457),n=p(859),o=p(399),u=p(782),h=p(903);class _ extends h.BaseRenderLayer{constructor(e,v,r,a,f,d,c,b,S,y){super(e,v,"cursor",r,!0,y,f,d,S,b),this._onRequestRedraw=a,this._coreService=c,this._cursorBlinkStateManager=this.register(new n.MutableDisposable),this._cell=new u.CellData,this._state={x:0,y:0,isFocused:!1,style:"",width:0},this._cursorRenderers={bar:this._renderBarCursor.bind(this),block:this._renderBlockCursor.bind(this),underline:this._renderUnderlineCursor.bind(this),outline:this._renderOutlineCursor.bind(this)},this.register(d.onOptionChange(()=>this._handleOptionsChanged())),this._handleOptionsChanged()}resize(e){super.resize(e),this._state={x:0,y:0,isFocused:!1,style:"",width:0}}reset(){this._clearCursor(),this._cursorBlinkStateManager.value?.restartBlinkAnimation(),this._handleOptionsChanged()}handleBlur(){this._cursorBlinkStateManager.value?.pause(),this._onRequestRedraw.fire({start:this._bufferService.buffer.y,end:this._bufferService.buffer.y})}handleFocus(){this._cursorBlinkStateManager.value?.resume(),this._onRequestRedraw.fire({start:this._bufferService.buffer.y,end:this._bufferService.buffer.y})}_handleOptionsChanged(){this._optionsService.rawOptions.cursorBlink?this._cursorBlinkStateManager.value||(this._cursorBlinkStateManager.value=new s.CursorBlinkStateManager(()=>this._render(!0),this._coreBrowserService)):this._cursorBlinkStateManager.clear(),this._onRequestRedraw.fire({start:this._bufferService.buffer.y,end:this._bufferService.buffer.y})}handleCursorMove(){this._cursorBlinkStateManager.value?.restartBlinkAnimation()}handleGridChanged(e,v){!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isPaused?this._render(!1):this._cursorBlinkStateManager.value.restartBlinkAnimation()}_render(e){if(!this._coreService.isCursorInitialized||this._coreService.isCursorHidden)return void this._clearCursor();let v=this._bufferService.buffer.ybase+this._bufferService.buffer.y,r=v-this._bufferService.buffer.ydisp;if(r<0||r>=this._bufferService.rows)return void this._clearCursor();let a=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1);if(this._bufferService.buffer.lines.get(v).loadCell(a,this._cell),this._cell.content!==void 0){if(!this._coreBrowserService.isFocused){this._clearCursor(),this._ctx.save(),this._ctx.fillStyle=this._themeService.colors.cursor.css;let f=this._optionsService.rawOptions.cursorStyle,d=this._optionsService.rawOptions.cursorInactiveStyle;return d&&d!=="none"&&this._cursorRenderers[d](a,r,this._cell),this._ctx.restore(),this._state.x=a,this._state.y=r,this._state.isFocused=!1,this._state.style=f,void(this._state.width=this._cell.getWidth())}if(!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isCursorVisible){if(this._state){if(this._state.x===a&&this._state.y===r&&this._state.isFocused===this._coreBrowserService.isFocused&&this._state.style===this._optionsService.rawOptions.cursorStyle&&this._state.width===this._cell.getWidth())return;this._clearCursor()}this._ctx.save(),this._cursorRenderers[this._optionsService.rawOptions.cursorStyle||"block"](a,r,this._cell),this._ctx.restore(),this._state.x=a,this._state.y=r,this._state.isFocused=!1,this._state.style=this._optionsService.rawOptions.cursorStyle,this._state.width=this._cell.getWidth()}else this._clearCursor()}}_clearCursor(){this._state&&(o.isFirefox||this._coreBrowserService.dpr<1?this._clearAll():this._clearCells(this._state.x,this._state.y,this._state.width,1),this._state={x:0,y:0,isFocused:!1,style:"",width:0})}_renderBarCursor(e,v,r){this._ctx.save(),this._ctx.fillStyle=this._themeService.colors.cursor.css,this._fillLeftLineAtCell(e,v,this._optionsService.rawOptions.cursorWidth),this._ctx.restore()}_renderBlockCursor(e,v,r){this._ctx.save(),this._ctx.fillStyle=this._themeService.colors.cursor.css,this._fillCells(e,v,r.getWidth(),1),this._ctx.fillStyle=this._themeService.colors.cursorAccent.css,this._fillCharTrueColor(r,e,v),this._ctx.restore()}_renderUnderlineCursor(e,v,r){this._ctx.save(),this._ctx.fillStyle=this._themeService.colors.cursor.css,this._fillBottomLineAtCells(e,v),this._ctx.restore()}_renderOutlineCursor(e,v,r){this._ctx.save(),this._ctx.strokeStyle=this._themeService.colors.cursor.css,this._strokeRectAtCell(e,v,r.getWidth(),1),this._ctx.restore()}}i.CursorRenderLayer=_},574:(w,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.GridCache=void 0,i.GridCache=class{constructor(){this.cache=[]}resize(p,s){for(let n=0;n<p;n++){this.cache.length<=n&&this.cache.push([]);for(let o=this.cache[n].length;o<s;o++)this.cache[n].push(void 0);this.cache[n].length=s}this.cache.length=p}clear(){for(let p=0;p<this.cache.length;p++)for(let s=0;s<this.cache[p].length;s++)this.cache[p][s]=void 0}}},43:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.LinkRenderLayer=void 0;let s=p(197),n=p(237),o=p(903);class u extends o.BaseRenderLayer{constructor(_,t,e,v,r,a,f,d,c){super(_,t,"link",e,!0,c,r,a,f,d),this.register(v.onShowLinkUnderline(b=>this._handleShowLinkUnderline(b))),this.register(v.onHideLinkUnderline(b=>this._handleHideLinkUnderline(b)))}resize(_){super.resize(_),this._state=void 0}reset(){this._clearCurrentLink()}_clearCurrentLink(){if(this._state){this._clearCells(this._state.x1,this._state.y1,this._state.cols-this._state.x1,1);let _=this._state.y2-this._state.y1-1;_>0&&this._clearCells(0,this._state.y1+1,this._state.cols,_),this._clearCells(0,this._state.y2,this._state.x2,1),this._state=void 0}}_handleShowLinkUnderline(_){if(_.fg===n.INVERTED_DEFAULT_COLOR?this._ctx.fillStyle=this._themeService.colors.background.css:_.fg&&(0,s.is256Color)(_.fg)?this._ctx.fillStyle=this._themeService.colors.ansi[_.fg].css:this._ctx.fillStyle=this._themeService.colors.foreground.css,_.y1===_.y2)this._fillBottomLineAtCells(_.x1,_.y1,_.x2-_.x1);else{this._fillBottomLineAtCells(_.x1,_.y1,_.cols-_.x1);for(let t=_.y1+1;t<_.y2;t++)this._fillBottomLineAtCells(0,t,_.cols);this._fillBottomLineAtCells(0,_.y2,_.x2)}this._state=_}_handleHideLinkUnderline(_){this._clearCurrentLink()}}i.LinkRenderLayer=u},630:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.SelectionRenderLayer=void 0;let s=p(903);class n extends s.BaseRenderLayer{constructor(u,h,_,t,e,v,r,a){super(u,h,"selection",_,!0,a,t,r,v,e),this._clearState()}_clearState(){this._state={start:void 0,end:void 0,columnSelectMode:void 0,ydisp:void 0}}resize(u){super.resize(u),this._selectionModel.selectionStart&&this._selectionModel.selectionEnd&&(this._clearState(),this._redrawSelection(this._selectionModel.selectionStart,this._selectionModel.selectionEnd,this._selectionModel.columnSelectMode))}reset(){this._state.start&&this._state.end&&(this._clearState(),this._clearAll())}handleBlur(){this.reset(),this._redrawSelection(this._selectionModel.selectionStart,this._selectionModel.selectionEnd,this._selectionModel.columnSelectMode)}handleFocus(){this.reset(),this._redrawSelection(this._selectionModel.selectionStart,this._selectionModel.selectionEnd,this._selectionModel.columnSelectMode)}handleSelectionChanged(u,h,_){super.handleSelectionChanged(u,h,_),this._redrawSelection(u,h,_)}_redrawSelection(u,h,_){if(!this._didStateChange(u,h,_,this._bufferService.buffer.ydisp))return;if(this._clearAll(),!u||!h)return void this._clearState();let t=u[1]-this._bufferService.buffer.ydisp,e=h[1]-this._bufferService.buffer.ydisp,v=Math.max(t,0),r=Math.min(e,this._bufferService.rows-1);if(v>=this._bufferService.rows||r<0)this._state.ydisp=this._bufferService.buffer.ydisp;else{if(this._ctx.fillStyle=(this._coreBrowserService.isFocused?this._themeService.colors.selectionBackgroundTransparent:this._themeService.colors.selectionInactiveBackgroundTransparent).css,_){let a=u[0],f=h[0]-a,d=r-v+1;this._fillCells(a,v,f,d)}else{let a=t===v?u[0]:0,f=v===e?h[0]:this._bufferService.cols;this._fillCells(a,v,f-a,1);let d=Math.max(r-v-1,0);if(this._fillCells(0,v+1,this._bufferService.cols,d),v!==r){let c=e===r?h[0]:this._bufferService.cols;this._fillCells(0,r,c,1)}}this._state.start=[u[0],u[1]],this._state.end=[h[0],h[1]],this._state.columnSelectMode=_,this._state.ydisp=this._bufferService.buffer.ydisp}}_didStateChange(u,h,_,t){return!this._areCoordinatesEqual(u,this._state.start)||!this._areCoordinatesEqual(h,this._state.end)||_!==this._state.columnSelectMode||t!==this._state.ydisp}_areCoordinatesEqual(u,h){return!(!u||!h)&&u[0]===h[0]&&u[1]===h[1]}}i.SelectionRenderLayer=n},744:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.TextRenderLayer=void 0;let s=p(577),n=p(147),o=p(782),u=p(855),h=p(903),_=p(574);class t extends h.BaseRenderLayer{constructor(v,r,a,f,d,c,b,S,y,m){super(v,r,"text",a,f,m,d,c,S,y),this._characterJoinerService=b,this._characterWidth=0,this._characterFont="",this._characterOverlapCache={},this._workCell=new o.CellData,this._state=new _.GridCache,this.register(c.onSpecificOptionChange("allowTransparency",A=>this._setTransparency(A)))}resize(v){super.resize(v);let r=this._getFont(!1,!1);this._characterWidth===v.device.char.width&&this._characterFont===r||(this._characterWidth=v.device.char.width,this._characterFont=r,this._characterOverlapCache={}),this._state.clear(),this._state.resize(this._bufferService.cols,this._bufferService.rows)}reset(){this._state.clear(),this._clearAll()}_forEachCell(v,r,a){for(let f=v;f<=r;f++){let d=f+this._bufferService.buffer.ydisp,c=this._bufferService.buffer.lines.get(d),b=this._characterJoinerService.getJoinedCharacters(d);for(let S=0;S<this._bufferService.cols;S++){c.loadCell(S,this._workCell);let y=this._workCell,m=!1,A=S;if(y.getWidth()!==0){if(b.length>0&&S===b[0][0]){m=!0;let x=b.shift();y=new s.JoinedCellData(this._workCell,c.translateToString(!0,x[0],x[1]),x[1]-x[0]),A=x[1]-1}!m&&this._isOverlapping(y)&&A<c.length-1&&c.getCodePoint(A+1)===u.NULL_CELL_CODE&&(y.content&=-12582913,y.content|=8388608),a(y,S,f),S=A}}}}_drawBackground(v,r){let a=this._ctx,f=this._bufferService.cols,d=0,c=0,b=null;a.save(),this._forEachCell(v,r,(S,y,m)=>{let A=null;S.isInverse()?A=S.isFgDefault()?this._themeService.colors.foreground.css:S.isFgRGB()?`rgb(${n.AttributeData.toColorRGB(S.getFgColor()).join(",")})`:this._themeService.colors.ansi[S.getFgColor()].css:S.isBgRGB()?A=`rgb(${n.AttributeData.toColorRGB(S.getBgColor()).join(",")})`:S.isBgPalette()&&(A=this._themeService.colors.ansi[S.getBgColor()].css);let x=!1;this._decorationService.forEachDecorationAtCell(y,this._bufferService.buffer.ydisp+m,void 0,M=>{M.options.layer!=="top"&&x||(M.backgroundColorRGB&&(A=M.backgroundColorRGB.css),x=M.options.layer==="top")}),b===null&&(d=y,c=m),m!==c?(a.fillStyle=b||"",this._fillCells(d,c,f-d,1),d=y,c=m):b!==A&&(a.fillStyle=b||"",this._fillCells(d,c,y-d,1),d=y,c=m),b=A}),b!==null&&(a.fillStyle=b,this._fillCells(d,c,f-d,1)),a.restore()}_drawForeground(v,r){this._forEachCell(v,r,(a,f,d)=>this._drawChars(a,f,d))}handleGridChanged(v,r){this._state.cache.length!==0&&(this._charAtlas&&this._charAtlas.beginFrame(),this._clearCells(0,v,this._bufferService.cols,r-v+1),this._drawBackground(v,r),this._drawForeground(v,r))}_isOverlapping(v){if(v.getWidth()!==1||v.getCode()<256)return!1;let r=v.getChars();if(this._characterOverlapCache.hasOwnProperty(r))return this._characterOverlapCache[r];this._ctx.save(),this._ctx.font=this._characterFont;let a=Math.floor(this._ctx.measureText(r).width)>this._characterWidth;return this._ctx.restore(),this._characterOverlapCache[r]=a,a}}i.TextRenderLayer=t},274:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CellColorResolver=void 0;let s=p(855),n=p(160),o=p(374),u,h=0,_=0,t=!1,e=!1,v=!1,r=0;i.CellColorResolver=class{constructor(a,f,d,c,b,S){this._terminal=a,this._optionService=f,this._selectionRenderModel=d,this._decorationService=c,this._coreBrowserService=b,this._themeService=S,this.result={fg:0,bg:0,ext:0}}resolve(a,f,d,c){if(this.result.bg=a.bg,this.result.fg=a.fg,this.result.ext=268435456&a.bg?a.extended.ext:0,_=0,h=0,e=!1,t=!1,v=!1,u=this._themeService.colors,r=0,a.getCode()!==s.NULL_CELL_CODE&&a.extended.underlineStyle===4){let b=Math.max(1,Math.floor(this._optionService.rawOptions.fontSize*this._coreBrowserService.dpr/15));r=f*c%(2*Math.round(b))}if(this._decorationService.forEachDecorationAtCell(f,d,"bottom",b=>{b.backgroundColorRGB&&(_=b.backgroundColorRGB.rgba>>8&16777215,e=!0),b.foregroundColorRGB&&(h=b.foregroundColorRGB.rgba>>8&16777215,t=!0)}),v=this._selectionRenderModel.isCellSelected(this._terminal,f,d),v){if(67108864&this.result.fg||(50331648&this.result.bg)!=0){if(67108864&this.result.fg)switch(50331648&this.result.fg){case 16777216:case 33554432:_=this._themeService.colors.ansi[255&this.result.fg].rgba;break;case 50331648:_=(16777215&this.result.fg)<<8|255;break;default:_=this._themeService.colors.foreground.rgba}else switch(50331648&this.result.bg){case 16777216:case 33554432:_=this._themeService.colors.ansi[255&this.result.bg].rgba;break;case 50331648:_=(16777215&this.result.bg)<<8|255}_=n.rgba.blend(_,4294967040&(this._coreBrowserService.isFocused?u.selectionBackgroundOpaque:u.selectionInactiveBackgroundOpaque).rgba|128)>>8&16777215}else _=(this._coreBrowserService.isFocused?u.selectionBackgroundOpaque:u.selectionInactiveBackgroundOpaque).rgba>>8&16777215;if(e=!0,u.selectionForeground&&(h=u.selectionForeground.rgba>>8&16777215,t=!0),(0,o.treatGlyphAsBackgroundColor)(a.getCode())){if(67108864&this.result.fg&&(50331648&this.result.bg)==0)h=(this._coreBrowserService.isFocused?u.selectionBackgroundOpaque:u.selectionInactiveBackgroundOpaque).rgba>>8&16777215;else{if(67108864&this.result.fg)switch(50331648&this.result.bg){case 16777216:case 33554432:h=this._themeService.colors.ansi[255&this.result.bg].rgba;break;case 50331648:h=(16777215&this.result.bg)<<8|255}else switch(50331648&this.result.fg){case 16777216:case 33554432:h=this._themeService.colors.ansi[255&this.result.fg].rgba;break;case 50331648:h=(16777215&this.result.fg)<<8|255;break;default:h=this._themeService.colors.foreground.rgba}h=n.rgba.blend(h,4294967040&(this._coreBrowserService.isFocused?u.selectionBackgroundOpaque:u.selectionInactiveBackgroundOpaque).rgba|128)>>8&16777215}t=!0}}this._decorationService.forEachDecorationAtCell(f,d,"top",b=>{b.backgroundColorRGB&&(_=b.backgroundColorRGB.rgba>>8&16777215,e=!0),b.foregroundColorRGB&&(h=b.foregroundColorRGB.rgba>>8&16777215,t=!0)}),e&&(_=v?-16777216&a.bg&-134217729|_|50331648:-16777216&a.bg|_|50331648),t&&(h=-16777216&a.fg&-67108865|h|50331648),67108864&this.result.fg&&(e&&!t&&(h=(50331648&this.result.bg)==0?-134217728&this.result.fg|16777215&u.background.rgba>>8|50331648:-134217728&this.result.fg|67108863&this.result.bg,t=!0),!e&&t&&(_=(50331648&this.result.fg)==0?-67108864&this.result.bg|16777215&u.foreground.rgba>>8|50331648:-67108864&this.result.bg|67108863&this.result.fg,e=!0)),u=void 0,this.result.bg=e?_:this.result.bg,this.result.fg=t?h:this.result.fg,this.result.ext&=536870911,this.result.ext|=r<<29&3758096384}}},627:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.removeTerminalFromCache=i.acquireTextureAtlas=void 0;let s=p(509),n=p(197),o=[];i.acquireTextureAtlas=function(u,h,_,t,e,v,r,a){let f=(0,n.generateConfig)(t,e,v,r,h,_,a);for(let b=0;b<o.length;b++){let S=o[b],y=S.ownedBy.indexOf(u);if(y>=0){if((0,n.configEquals)(S.config,f))return S.atlas;S.ownedBy.length===1?(S.atlas.dispose(),o.splice(b,1)):S.ownedBy.splice(y,1);break}}for(let b=0;b<o.length;b++){let S=o[b];if((0,n.configEquals)(S.config,f))return S.ownedBy.push(u),S.atlas}let d=u._core,c={atlas:new s.TextureAtlas(document,f,d.unicodeService),config:f,ownedBy:[u]};return o.push(c),c.atlas},i.removeTerminalFromCache=function(u){for(let h=0;h<o.length;h++){let _=o[h].ownedBy.indexOf(u);if(_!==-1){o[h].ownedBy.length===1?(o[h].atlas.dispose(),o.splice(h,1)):o[h].ownedBy.splice(_,1);break}}}},197:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.is256Color=i.configEquals=i.generateConfig=void 0;let s=p(160);i.generateConfig=function(n,o,u,h,_,t,e){let v={foreground:t.foreground,background:t.background,cursor:s.NULL_COLOR,cursorAccent:s.NULL_COLOR,selectionForeground:s.NULL_COLOR,selectionBackgroundTransparent:s.NULL_COLOR,selectionBackgroundOpaque:s.NULL_COLOR,selectionInactiveBackgroundTransparent:s.NULL_COLOR,selectionInactiveBackgroundOpaque:s.NULL_COLOR,ansi:t.ansi.slice(),contrastCache:t.contrastCache,halfContrastCache:t.halfContrastCache};return{customGlyphs:_.customGlyphs,devicePixelRatio:e,letterSpacing:_.letterSpacing,lineHeight:_.lineHeight,deviceCellWidth:n,deviceCellHeight:o,deviceCharWidth:u,deviceCharHeight:h,fontFamily:_.fontFamily,fontSize:_.fontSize,fontWeight:_.fontWeight,fontWeightBold:_.fontWeightBold,allowTransparency:_.allowTransparency,drawBoldTextInBrightColors:_.drawBoldTextInBrightColors,minimumContrastRatio:_.minimumContrastRatio,colors:v}},i.configEquals=function(n,o){for(let u=0;u<n.colors.ansi.length;u++)if(n.colors.ansi[u].rgba!==o.colors.ansi[u].rgba)return!1;return n.devicePixelRatio===o.devicePixelRatio&&n.customGlyphs===o.customGlyphs&&n.lineHeight===o.lineHeight&&n.letterSpacing===o.letterSpacing&&n.fontFamily===o.fontFamily&&n.fontSize===o.fontSize&&n.fontWeight===o.fontWeight&&n.fontWeightBold===o.fontWeightBold&&n.allowTransparency===o.allowTransparency&&n.deviceCharWidth===o.deviceCharWidth&&n.deviceCharHeight===o.deviceCharHeight&&n.drawBoldTextInBrightColors===o.drawBoldTextInBrightColors&&n.minimumContrastRatio===o.minimumContrastRatio&&n.colors.foreground.rgba===o.colors.foreground.rgba&&n.colors.background.rgba===o.colors.background.rgba},i.is256Color=function(n){return(50331648&n)==16777216||(50331648&n)==33554432}},237:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.TEXT_BASELINE=i.DIM_OPACITY=i.INVERTED_DEFAULT_COLOR=void 0;let s=p(399);i.INVERTED_DEFAULT_COLOR=257,i.DIM_OPACITY=.5,i.TEXT_BASELINE=s.isFirefox||s.isLegacyEdge?"bottom":"ideographic"},457:(w,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CursorBlinkStateManager=void 0,i.CursorBlinkStateManager=class{constructor(p,s){this._renderCallback=p,this._coreBrowserService=s,this.isCursorVisible=!0,this._coreBrowserService.isFocused&&this._restartInterval()}get isPaused(){return!(this._blinkStartTimeout||this._blinkInterval)}dispose(){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}restartBlinkAnimation(){this.isPaused||(this._animationTimeRestarted=Date.now(),this.isCursorVisible=!0,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})))}_restartInterval(p=600){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout=this._coreBrowserService.window.setTimeout(()=>{if(this._animationTimeRestarted){let s=600-(Date.now()-this._animationTimeRestarted);if(this._animationTimeRestarted=void 0,s>0)return void this._restartInterval(s)}this.isCursorVisible=!1,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0}),this._blinkInterval=this._coreBrowserService.window.setInterval(()=>{if(this._animationTimeRestarted){let s=600-(Date.now()-this._animationTimeRestarted);return this._animationTimeRestarted=void 0,void this._restartInterval(s)}this.isCursorVisible=!this.isCursorVisible,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})},600)},p)}pause(){this.isCursorVisible=!0,this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}resume(){this.pause(),this._animationTimeRestarted=void 0,this._restartInterval(),this.restartBlinkAnimation()}}},860:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.tryDrawCustomChar=i.powerlineDefinitions=i.boxDrawingDefinitions=i.blockElementDefinitions=void 0;let s=p(374);i.blockElementDefinitions={"\u2580":[{x:0,y:0,w:8,h:4}],"\u2581":[{x:0,y:7,w:8,h:1}],"\u2582":[{x:0,y:6,w:8,h:2}],"\u2583":[{x:0,y:5,w:8,h:3}],"\u2584":[{x:0,y:4,w:8,h:4}],"\u2585":[{x:0,y:3,w:8,h:5}],"\u2586":[{x:0,y:2,w:8,h:6}],"\u2587":[{x:0,y:1,w:8,h:7}],"\u2588":[{x:0,y:0,w:8,h:8}],"\u2589":[{x:0,y:0,w:7,h:8}],"\u258A":[{x:0,y:0,w:6,h:8}],"\u258B":[{x:0,y:0,w:5,h:8}],"\u258C":[{x:0,y:0,w:4,h:8}],"\u258D":[{x:0,y:0,w:3,h:8}],"\u258E":[{x:0,y:0,w:2,h:8}],"\u258F":[{x:0,y:0,w:1,h:8}],"\u2590":[{x:4,y:0,w:4,h:8}],"\u2594":[{x:0,y:0,w:8,h:1}],"\u2595":[{x:7,y:0,w:1,h:8}],"\u2596":[{x:0,y:4,w:4,h:4}],"\u2597":[{x:4,y:4,w:4,h:4}],"\u2598":[{x:0,y:0,w:4,h:4}],"\u2599":[{x:0,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"\u259A":[{x:0,y:0,w:4,h:4},{x:4,y:4,w:4,h:4}],"\u259B":[{x:0,y:0,w:4,h:8},{x:4,y:0,w:4,h:4}],"\u259C":[{x:0,y:0,w:8,h:4},{x:4,y:0,w:4,h:8}],"\u259D":[{x:4,y:0,w:4,h:4}],"\u259E":[{x:4,y:0,w:4,h:4},{x:0,y:4,w:4,h:4}],"\u259F":[{x:4,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"\u{1FB70}":[{x:1,y:0,w:1,h:8}],"\u{1FB71}":[{x:2,y:0,w:1,h:8}],"\u{1FB72}":[{x:3,y:0,w:1,h:8}],"\u{1FB73}":[{x:4,y:0,w:1,h:8}],"\u{1FB74}":[{x:5,y:0,w:1,h:8}],"\u{1FB75}":[{x:6,y:0,w:1,h:8}],"\u{1FB76}":[{x:0,y:1,w:8,h:1}],"\u{1FB77}":[{x:0,y:2,w:8,h:1}],"\u{1FB78}":[{x:0,y:3,w:8,h:1}],"\u{1FB79}":[{x:0,y:4,w:8,h:1}],"\u{1FB7A}":[{x:0,y:5,w:8,h:1}],"\u{1FB7B}":[{x:0,y:6,w:8,h:1}],"\u{1FB7C}":[{x:0,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"\u{1FB7D}":[{x:0,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"\u{1FB7E}":[{x:7,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"\u{1FB7F}":[{x:7,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"\u{1FB80}":[{x:0,y:0,w:8,h:1},{x:0,y:7,w:8,h:1}],"\u{1FB81}":[{x:0,y:0,w:8,h:1},{x:0,y:2,w:8,h:1},{x:0,y:4,w:8,h:1},{x:0,y:7,w:8,h:1}],"\u{1FB82}":[{x:0,y:0,w:8,h:2}],"\u{1FB83}":[{x:0,y:0,w:8,h:3}],"\u{1FB84}":[{x:0,y:0,w:8,h:5}],"\u{1FB85}":[{x:0,y:0,w:8,h:6}],"\u{1FB86}":[{x:0,y:0,w:8,h:7}],"\u{1FB87}":[{x:6,y:0,w:2,h:8}],"\u{1FB88}":[{x:5,y:0,w:3,h:8}],"\u{1FB89}":[{x:3,y:0,w:5,h:8}],"\u{1FB8A}":[{x:2,y:0,w:6,h:8}],"\u{1FB8B}":[{x:1,y:0,w:7,h:8}],"\u{1FB95}":[{x:0,y:0,w:2,h:2},{x:4,y:0,w:2,h:2},{x:2,y:2,w:2,h:2},{x:6,y:2,w:2,h:2},{x:0,y:4,w:2,h:2},{x:4,y:4,w:2,h:2},{x:2,y:6,w:2,h:2},{x:6,y:6,w:2,h:2}],"\u{1FB96}":[{x:2,y:0,w:2,h:2},{x:6,y:0,w:2,h:2},{x:0,y:2,w:2,h:2},{x:4,y:2,w:2,h:2},{x:2,y:4,w:2,h:2},{x:6,y:4,w:2,h:2},{x:0,y:6,w:2,h:2},{x:4,y:6,w:2,h:2}],"\u{1FB97}":[{x:0,y:2,w:8,h:2},{x:0,y:6,w:8,h:2}]};let n={"\u2591":[[1,0,0,0],[0,0,0,0],[0,0,1,0],[0,0,0,0]],"\u2592":[[1,0],[0,0],[0,1],[0,0]],"\u2593":[[0,1],[1,1],[1,0],[1,1]]};i.boxDrawingDefinitions={"\u2500":{1:"M0,.5 L1,.5"},"\u2501":{3:"M0,.5 L1,.5"},"\u2502":{1:"M.5,0 L.5,1"},"\u2503":{3:"M.5,0 L.5,1"},"\u250C":{1:"M0.5,1 L.5,.5 L1,.5"},"\u250F":{3:"M0.5,1 L.5,.5 L1,.5"},"\u2510":{1:"M0,.5 L.5,.5 L.5,1"},"\u2513":{3:"M0,.5 L.5,.5 L.5,1"},"\u2514":{1:"M.5,0 L.5,.5 L1,.5"},"\u2517":{3:"M.5,0 L.5,.5 L1,.5"},"\u2518":{1:"M.5,0 L.5,.5 L0,.5"},"\u251B":{3:"M.5,0 L.5,.5 L0,.5"},"\u251C":{1:"M.5,0 L.5,1 M.5,.5 L1,.5"},"\u2523":{3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"\u2524":{1:"M.5,0 L.5,1 M.5,.5 L0,.5"},"\u252B":{3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"\u252C":{1:"M0,.5 L1,.5 M.5,.5 L.5,1"},"\u2533":{3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"\u2534":{1:"M0,.5 L1,.5 M.5,.5 L.5,0"},"\u253B":{3:"M0,.5 L1,.5 M.5,.5 L.5,0"},"\u253C":{1:"M0,.5 L1,.5 M.5,0 L.5,1"},"\u254B":{3:"M0,.5 L1,.5 M.5,0 L.5,1"},"\u2574":{1:"M.5,.5 L0,.5"},"\u2578":{3:"M.5,.5 L0,.5"},"\u2575":{1:"M.5,.5 L.5,0"},"\u2579":{3:"M.5,.5 L.5,0"},"\u2576":{1:"M.5,.5 L1,.5"},"\u257A":{3:"M.5,.5 L1,.5"},"\u2577":{1:"M.5,.5 L.5,1"},"\u257B":{3:"M.5,.5 L.5,1"},"\u2550":{1:(t,e)=>`M0,${.5-e} L1,${.5-e} M0,${.5+e} L1,${.5+e}`},"\u2551":{1:(t,e)=>`M${.5-t},0 L${.5-t},1 M${.5+t},0 L${.5+t},1`},"\u2552":{1:(t,e)=>`M.5,1 L.5,${.5-e} L1,${.5-e} M.5,${.5+e} L1,${.5+e}`},"\u2553":{1:(t,e)=>`M${.5-t},1 L${.5-t},.5 L1,.5 M${.5+t},.5 L${.5+t},1`},"\u2554":{1:(t,e)=>`M1,${.5-e} L${.5-t},${.5-e} L${.5-t},1 M1,${.5+e} L${.5+t},${.5+e} L${.5+t},1`},"\u2555":{1:(t,e)=>`M0,${.5-e} L.5,${.5-e} L.5,1 M0,${.5+e} L.5,${.5+e}`},"\u2556":{1:(t,e)=>`M${.5+t},1 L${.5+t},.5 L0,.5 M${.5-t},.5 L${.5-t},1`},"\u2557":{1:(t,e)=>`M0,${.5+e} L${.5-t},${.5+e} L${.5-t},1 M0,${.5-e} L${.5+t},${.5-e} L${.5+t},1`},"\u2558":{1:(t,e)=>`M.5,0 L.5,${.5+e} L1,${.5+e} M.5,${.5-e} L1,${.5-e}`},"\u2559":{1:(t,e)=>`M1,.5 L${.5-t},.5 L${.5-t},0 M${.5+t},.5 L${.5+t},0`},"\u255A":{1:(t,e)=>`M1,${.5-e} L${.5+t},${.5-e} L${.5+t},0 M1,${.5+e} L${.5-t},${.5+e} L${.5-t},0`},"\u255B":{1:(t,e)=>`M0,${.5+e} L.5,${.5+e} L.5,0 M0,${.5-e} L.5,${.5-e}`},"\u255C":{1:(t,e)=>`M0,.5 L${.5+t},.5 L${.5+t},0 M${.5-t},.5 L${.5-t},0`},"\u255D":{1:(t,e)=>`M0,${.5-e} L${.5-t},${.5-e} L${.5-t},0 M0,${.5+e} L${.5+t},${.5+e} L${.5+t},0`},"\u255E":{1:(t,e)=>`M.5,0 L.5,1 M.5,${.5-e} L1,${.5-e} M.5,${.5+e} L1,${.5+e}`},"\u255F":{1:(t,e)=>`M${.5-t},0 L${.5-t},1 M${.5+t},0 L${.5+t},1 M${.5+t},.5 L1,.5`},"\u2560":{1:(t,e)=>`M${.5-t},0 L${.5-t},1 M1,${.5+e} L${.5+t},${.5+e} L${.5+t},1 M1,${.5-e} L${.5+t},${.5-e} L${.5+t},0`},"\u2561":{1:(t,e)=>`M.5,0 L.5,1 M0,${.5-e} L.5,${.5-e} M0,${.5+e} L.5,${.5+e}`},"\u2562":{1:(t,e)=>`M0,.5 L${.5-t},.5 M${.5-t},0 L${.5-t},1 M${.5+t},0 L${.5+t},1`},"\u2563":{1:(t,e)=>`M${.5+t},0 L${.5+t},1 M0,${.5+e} L${.5-t},${.5+e} L${.5-t},1 M0,${.5-e} L${.5-t},${.5-e} L${.5-t},0`},"\u2564":{1:(t,e)=>`M0,${.5-e} L1,${.5-e} M0,${.5+e} L1,${.5+e} M.5,${.5+e} L.5,1`},"\u2565":{1:(t,e)=>`M0,.5 L1,.5 M${.5-t},.5 L${.5-t},1 M${.5+t},.5 L${.5+t},1`},"\u2566":{1:(t,e)=>`M0,${.5-e} L1,${.5-e} M0,${.5+e} L${.5-t},${.5+e} L${.5-t},1 M1,${.5+e} L${.5+t},${.5+e} L${.5+t},1`},"\u2567":{1:(t,e)=>`M.5,0 L.5,${.5-e} M0,${.5-e} L1,${.5-e} M0,${.5+e} L1,${.5+e}`},"\u2568":{1:(t,e)=>`M0,.5 L1,.5 M${.5-t},.5 L${.5-t},0 M${.5+t},.5 L${.5+t},0`},"\u2569":{1:(t,e)=>`M0,${.5+e} L1,${.5+e} M0,${.5-e} L${.5-t},${.5-e} L${.5-t},0 M1,${.5-e} L${.5+t},${.5-e} L${.5+t},0`},"\u256A":{1:(t,e)=>`M.5,0 L.5,1 M0,${.5-e} L1,${.5-e} M0,${.5+e} L1,${.5+e}`},"\u256B":{1:(t,e)=>`M0,.5 L1,.5 M${.5-t},0 L${.5-t},1 M${.5+t},0 L${.5+t},1`},"\u256C":{1:(t,e)=>`M0,${.5+e} L${.5-t},${.5+e} L${.5-t},1 M1,${.5+e} L${.5+t},${.5+e} L${.5+t},1 M0,${.5-e} L${.5-t},${.5-e} L${.5-t},0 M1,${.5-e} L${.5+t},${.5-e} L${.5+t},0`},"\u2571":{1:"M1,0 L0,1"},"\u2572":{1:"M0,0 L1,1"},"\u2573":{1:"M1,0 L0,1 M0,0 L1,1"},"\u257C":{1:"M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"\u257D":{1:"M.5,.5 L.5,0",3:"M.5,.5 L.5,1"},"\u257E":{1:"M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u257F":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"\u250D":{1:"M.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"\u250E":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2511":{1:"M.5,.5 L.5,1",3:"M.5,.5 L0,.5"},"\u2512":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"\u2515":{1:"M.5,.5 L.5,0",3:"M.5,.5 L1,.5"},"\u2516":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"\u2519":{1:"M.5,.5 L.5,0",3:"M.5,.5 L0,.5"},"\u251A":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,0"},"\u251D":{1:"M.5,0 L.5,1",3:"M.5,.5 L1,.5"},"\u251E":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"\u251F":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2520":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1"},"\u2521":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"\u2522":{1:"M.5,.5 L.5,0",3:"M0.5,1 L.5,.5 L1,.5"},"\u2525":{1:"M.5,0 L.5,1",3:"M.5,.5 L0,.5"},"\u2526":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"\u2527":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"\u2528":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1"},"\u2529":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L0,.5"},"\u252A":{1:"M.5,.5 L.5,0",3:"M0,.5 L.5,.5 L.5,1"},"\u252D":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u252E":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"\u252F":{1:"M.5,.5 L.5,1",3:"M0,.5 L1,.5"},"\u2530":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2531":{1:"M.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"\u2532":{1:"M.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"\u2535":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u2536":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"\u2537":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5"},"\u2538":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,0"},"\u2539":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"\u253A":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,.5 L1,.5"},"\u253D":{1:"M.5,0 L.5,1 M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u253E":{1:"M.5,0 L.5,1 M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"\u253F":{1:"M.5,0 L.5,1",3:"M0,.5 L1,.5"},"\u2540":{1:"M0,.5 L1,.5 M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"\u2541":{1:"M.5,.5 L.5,0 M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2542":{1:"M0,.5 L1,.5",3:"M.5,0 L.5,1"},"\u2543":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"\u2544":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"\u2545":{1:"M.5,0 L.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"\u2546":{1:"M.5,0 L.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"\u2547":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0 M0,.5 L1,.5"},"\u2548":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"\u2549":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"\u254A":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"\u254C":{1:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"\u254D":{3:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"\u2504":{1:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"\u2505":{3:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"\u2508":{1:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"\u2509":{3:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"\u254E":{1:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"\u254F":{3:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"\u2506":{1:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"\u2507":{3:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"\u250A":{1:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"\u250B":{3:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"\u256D":{1:(t,e)=>`M.5,1 L.5,${.5+e/.15*.5} C.5,${.5+e/.15*.5},.5,.5,1,.5`},"\u256E":{1:(t,e)=>`M.5,1 L.5,${.5+e/.15*.5} C.5,${.5+e/.15*.5},.5,.5,0,.5`},"\u256F":{1:(t,e)=>`M.5,0 L.5,${.5-e/.15*.5} C.5,${.5-e/.15*.5},.5,.5,0,.5`},"\u2570":{1:(t,e)=>`M.5,0 L.5,${.5-e/.15*.5} C.5,${.5-e/.15*.5},.5,.5,1,.5`}},i.powerlineDefinitions={"\uE0B0":{d:"M0,0 L1,.5 L0,1",type:0,rightPadding:2},"\uE0B1":{d:"M-1,-.5 L1,.5 L-1,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0B2":{d:"M1,0 L0,.5 L1,1",type:0,leftPadding:2},"\uE0B3":{d:"M2,-.5 L0,.5 L2,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0B4":{d:"M0,0 L0,1 C0.552,1,1,0.776,1,.5 C1,0.224,0.552,0,0,0",type:0,rightPadding:1},"\uE0B5":{d:"M.2,1 C.422,1,.8,.826,.78,.5 C.8,.174,0.422,0,.2,0",type:1,rightPadding:1},"\uE0B6":{d:"M1,0 L1,1 C0.448,1,0,0.776,0,.5 C0,0.224,0.448,0,1,0",type:0,leftPadding:1},"\uE0B7":{d:"M.8,1 C0.578,1,0.2,.826,.22,.5 C0.2,0.174,0.578,0,0.8,0",type:1,leftPadding:1},"\uE0B8":{d:"M-.5,-.5 L1.5,1.5 L-.5,1.5",type:0},"\uE0B9":{d:"M-.5,-.5 L1.5,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0BA":{d:"M1.5,-.5 L-.5,1.5 L1.5,1.5",type:0},"\uE0BC":{d:"M1.5,-.5 L-.5,1.5 L-.5,-.5",type:0},"\uE0BD":{d:"M1.5,-.5 L-.5,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0BE":{d:"M-.5,-.5 L1.5,1.5 L1.5,-.5",type:0}},i.powerlineDefinitions["\uE0BB"]=i.powerlineDefinitions["\uE0BD"],i.powerlineDefinitions["\uE0BF"]=i.powerlineDefinitions["\uE0B9"],i.tryDrawCustomChar=function(t,e,v,r,a,f,d,c){let b=i.blockElementDefinitions[e];if(b)return function(A,x,M,E,I,F){for(let O=0;O<x.length;O++){let P=x[O],H=I/8,$=F/8;A.fillRect(M+P.x*H,E+P.y*$,P.w*H,P.h*$)}}(t,b,v,r,a,f),!0;let S=n[e];if(S)return function(A,x,M,E,I,F){let O=o.get(x);O||(O=new Map,o.set(x,O));let P=A.fillStyle;if(typeof P!="string")throw new Error(`Unexpected fillStyle type "${P}"`);let H=O.get(P);if(!H){let $=x[0].length,L=x.length,R=A.canvas.ownerDocument.createElement("canvas");R.width=$,R.height=L;let k=(0,s.throwIfFalsy)(R.getContext("2d")),B=new ImageData($,L),N,W,q,J;if(P.startsWith("#"))N=parseInt(P.slice(1,3),16),W=parseInt(P.slice(3,5),16),q=parseInt(P.slice(5,7),16),J=P.length>7&&parseInt(P.slice(7,9),16)||1;else{if(!P.startsWith("rgba"))throw new Error(`Unexpected fillStyle color format "${P}" when drawing pattern glyph`);[N,W,q,J]=P.substring(5,P.length-1).split(",").map(Q=>parseFloat(Q))}for(let Q=0;Q<L;Q++)for(let D=0;D<$;D++)B.data[4*(Q*$+D)]=N,B.data[4*(Q*$+D)+1]=W,B.data[4*(Q*$+D)+2]=q,B.data[4*(Q*$+D)+3]=x[Q][D]*(255*J);k.putImageData(B,0,0),H=(0,s.throwIfFalsy)(A.createPattern(R,null)),O.set(P,H)}A.fillStyle=H,A.fillRect(M,E,I,F)}(t,S,v,r,a,f),!0;let y=i.boxDrawingDefinitions[e];if(y)return function(A,x,M,E,I,F,O){A.strokeStyle=A.fillStyle;for(let[P,H]of Object.entries(x)){let $;A.beginPath(),A.lineWidth=O*Number.parseInt(P),$=typeof H=="function"?H(.15,.15/F*I):H;for(let L of $.split(" ")){let R=L[0],k=h[R];if(!k){console.error(`Could not find drawing instructions for "${R}"`);continue}let B=L.substring(1).split(",");B[0]&&B[1]&&k(A,_(B,I,F,M,E,!0,O))}A.stroke(),A.closePath()}}(t,y,v,r,a,f,c),!0;let m=i.powerlineDefinitions[e];return!!m&&(function(A,x,M,E,I,F,O,P){let H=new Path2D;H.rect(M,E,I,F),A.clip(H),A.beginPath();let $=O/12;A.lineWidth=P*$;for(let L of x.d.split(" ")){let R=L[0],k=h[R];if(!k){console.error(`Could not find drawing instructions for "${R}"`);continue}let B=L.substring(1).split(",");B[0]&&B[1]&&k(A,_(B,I,F,M,E,!1,P,(x.leftPadding??0)*($/2),(x.rightPadding??0)*($/2)))}x.type===1?(A.strokeStyle=A.fillStyle,A.stroke()):A.fill(),A.closePath()}(t,m,v,r,a,f,d,c),!0)};let o=new Map;function u(t,e,v=0){return Math.max(Math.min(t,e),v)}let h={C:(t,e)=>t.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5]),L:(t,e)=>t.lineTo(e[0],e[1]),M:(t,e)=>t.moveTo(e[0],e[1])};function _(t,e,v,r,a,f,d,c=0,b=0){let S=t.map(y=>parseFloat(y)||parseInt(y));if(S.length<2)throw new Error("Too few arguments for instruction");for(let y=0;y<S.length;y+=2)S[y]*=e-c*d-b*d,f&&S[y]!==0&&(S[y]=u(Math.round(S[y]+.5)-.5,e,0)),S[y]+=r+c*d;for(let y=1;y<S.length;y+=2)S[y]*=v,f&&S[y]!==0&&(S[y]=u(Math.round(S[y]+.5)-.5,v,0)),S[y]+=a;return S}},56:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.observeDevicePixelDimensions=void 0;let s=p(859);i.observeDevicePixelDimensions=function(n,o,u){let h=new o.ResizeObserver(_=>{let t=_.find(r=>r.target===n);if(!t)return;if(!("devicePixelContentBoxSize"in t))return h?.disconnect(),void(h=void 0);let e=t.devicePixelContentBoxSize[0].inlineSize,v=t.devicePixelContentBoxSize[0].blockSize;e>0&&v>0&&u(e,v)});try{h.observe(n,{box:["device-pixel-content-box"]})}catch{h.disconnect(),h=void 0}return(0,s.toDisposable)(()=>h?.disconnect())}},374:(w,i)=>{function p(n){return 57508<=n&&n<=57558}function s(n){return n>=128512&&n<=128591||n>=127744&&n<=128511||n>=128640&&n<=128767||n>=9728&&n<=9983||n>=9984&&n<=10175||n>=65024&&n<=65039||n>=129280&&n<=129535||n>=127462&&n<=127487}Object.defineProperty(i,"__esModule",{value:!0}),i.computeNextVariantOffset=i.createRenderDimensions=i.treatGlyphAsBackgroundColor=i.allowRescaling=i.isEmoji=i.isRestrictedPowerlineGlyph=i.isPowerlineGlyph=i.throwIfFalsy=void 0,i.throwIfFalsy=function(n){if(!n)throw new Error("value must not be falsy");return n},i.isPowerlineGlyph=p,i.isRestrictedPowerlineGlyph=function(n){return 57520<=n&&n<=57527},i.isEmoji=s,i.allowRescaling=function(n,o,u,h){return o===1&&u>Math.ceil(1.5*h)&&n!==void 0&&n>255&&!s(n)&&!p(n)&&!function(_){return 57344<=_&&_<=63743}(n)},i.treatGlyphAsBackgroundColor=function(n){return p(n)||function(o){return 9472<=o&&o<=9631}(n)},i.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}},i.computeNextVariantOffset=function(n,o,u=0){return(n-(2*Math.round(o)-u))%(2*Math.round(o))}},296:(w,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.createSelectionRenderModel=void 0;class p{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(n,o,u,h=!1){if(this.selectionStart=o,this.selectionEnd=u,!o||!u||o[0]===u[0]&&o[1]===u[1])return void this.clear();let _=n.buffers.active.ydisp,t=o[1]-_,e=u[1]-_,v=Math.max(t,0),r=Math.min(e,n.rows-1);v>=n.rows||r<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=h,this.viewportStartRow=t,this.viewportEndRow=e,this.viewportCappedStartRow=v,this.viewportCappedEndRow=r,this.startCol=o[0],this.endCol=u[0])}isCellSelected(n,o,u){return!!this.hasSelection&&(u-=n.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?o>=this.startCol&&u>=this.viewportCappedStartRow&&o<this.endCol&&u<=this.viewportCappedEndRow:o<this.startCol&&u>=this.viewportCappedStartRow&&o>=this.endCol&&u<=this.viewportCappedEndRow:u>this.viewportStartRow&&u<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&u===this.viewportStartRow&&o>=this.startCol&&o<this.endCol||this.viewportStartRow<this.viewportEndRow&&u===this.viewportEndRow&&o<this.endCol||this.viewportStartRow<this.viewportEndRow&&u===this.viewportStartRow&&o>=this.startCol)}}i.createSelectionRenderModel=function(){return new p}},509:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.TextureAtlas=void 0;let s=p(237),n=p(860),o=p(374),u=p(160),h=p(345),_=p(485),t=p(385),e=p(147),v=p(855),r={texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},offset:{x:0,y:0},size:{x:0,y:0},sizeClipSpace:{x:0,y:0}},a;class f{get pages(){return this._pages}constructor(y,m,A){this._document=y,this._config=m,this._unicodeService=A,this._didWarmUp=!1,this._cacheMap=new _.FourKeyMap,this._cacheMapCombined=new _.FourKeyMap,this._pages=[],this._activePages=[],this._workBoundingBox={top:0,left:0,bottom:0,right:0},this._workAttributeData=new e.AttributeData,this._textureSize=512,this._onAddTextureAtlasCanvas=new h.EventEmitter,this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=new h.EventEmitter,this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._requestClearModel=!1,this._createNewPage(),this._tmpCanvas=b(y,4*this._config.deviceCellWidth+4,this._config.deviceCellHeight+4),this._tmpCtx=(0,o.throwIfFalsy)(this._tmpCanvas.getContext("2d",{alpha:this._config.allowTransparency,willReadFrequently:!0}))}dispose(){for(let y of this.pages)y.canvas.remove();this._onAddTextureAtlasCanvas.dispose()}warmUp(){this._didWarmUp||(this._doWarmUp(),this._didWarmUp=!0)}_doWarmUp(){let y=new t.IdleTaskQueue;for(let m=33;m<126;m++)y.enqueue(()=>{if(!this._cacheMap.get(m,v.DEFAULT_COLOR,v.DEFAULT_COLOR,v.DEFAULT_EXT)){let A=this._drawToCache(m,v.DEFAULT_COLOR,v.DEFAULT_COLOR,v.DEFAULT_EXT);this._cacheMap.set(m,v.DEFAULT_COLOR,v.DEFAULT_COLOR,v.DEFAULT_EXT,A)}})}beginFrame(){return this._requestClearModel}clearTexture(){if(this._pages[0].currentRow.x!==0||this._pages[0].currentRow.y!==0){for(let y of this._pages)y.clear();this._cacheMap.clear(),this._cacheMapCombined.clear(),this._didWarmUp=!1}}_createNewPage(){if(f.maxAtlasPages&&this._pages.length>=Math.max(4,f.maxAtlasPages)){let m=this._pages.filter(O=>2*O.canvas.width<=(f.maxTextureSize||4096)).sort((O,P)=>P.canvas.width!==O.canvas.width?P.canvas.width-O.canvas.width:P.percentageUsed-O.percentageUsed),A=-1,x=0;for(let O=0;O<m.length;O++)if(m[O].canvas.width!==x)A=O,x=m[O].canvas.width;else if(O-A==3)break;let M=m.slice(A,A+4),E=M.map(O=>O.glyphs[0].texturePage).sort((O,P)=>O>P?1:-1),I=this.pages.length-M.length,F=this._mergePages(M,I);F.version++;for(let O=E.length-1;O>=0;O--)this._deletePage(E[O]);this.pages.push(F),this._requestClearModel=!0,this._onAddTextureAtlasCanvas.fire(F.canvas)}let y=new d(this._document,this._textureSize);return this._pages.push(y),this._activePages.push(y),this._onAddTextureAtlasCanvas.fire(y.canvas),y}_mergePages(y,m){let A=2*y[0].canvas.width,x=new d(this._document,A,y);for(let[M,E]of y.entries()){let I=M*E.canvas.width%A,F=Math.floor(M/2)*E.canvas.height;x.ctx.drawImage(E.canvas,I,F);for(let P of E.glyphs)P.texturePage=m,P.sizeClipSpace.x=P.size.x/A,P.sizeClipSpace.y=P.size.y/A,P.texturePosition.x+=I,P.texturePosition.y+=F,P.texturePositionClipSpace.x=P.texturePosition.x/A,P.texturePositionClipSpace.y=P.texturePosition.y/A;this._onRemoveTextureAtlasCanvas.fire(E.canvas);let O=this._activePages.indexOf(E);O!==-1&&this._activePages.splice(O,1)}return x}_deletePage(y){this._pages.splice(y,1);for(let m=y;m<this._pages.length;m++){let A=this._pages[m];for(let x of A.glyphs)x.texturePage--;A.version++}}getRasterizedGlyphCombinedChar(y,m,A,x,M){return this._getFromCacheMap(this._cacheMapCombined,y,m,A,x,M)}getRasterizedGlyph(y,m,A,x,M){return this._getFromCacheMap(this._cacheMap,y,m,A,x,M)}_getFromCacheMap(y,m,A,x,M,E=!1){return a=y.get(m,A,x,M),a||(a=this._drawToCache(m,A,x,M,E),y.set(m,A,x,M,a)),a}_getColorFromAnsiIndex(y){if(y>=this._config.colors.ansi.length)throw new Error("No color found for idx "+y);return this._config.colors.ansi[y]}_getBackgroundColor(y,m,A,x){if(this._config.allowTransparency)return u.NULL_COLOR;let M;switch(y){case 16777216:case 33554432:M=this._getColorFromAnsiIndex(m);break;case 50331648:let E=e.AttributeData.toColorRGB(m);M=u.channels.toColor(E[0],E[1],E[2]);break;default:M=A?u.color.opaque(this._config.colors.foreground):this._config.colors.background}return M}_getForegroundColor(y,m,A,x,M,E,I,F,O,P){let H=this._getMinimumContrastColor(y,m,A,x,M,E,I,O,F,P);if(H)return H;let $;switch(M){case 16777216:case 33554432:this._config.drawBoldTextInBrightColors&&O&&E<8&&(E+=8),$=this._getColorFromAnsiIndex(E);break;case 50331648:let L=e.AttributeData.toColorRGB(E);$=u.channels.toColor(L[0],L[1],L[2]);break;default:$=I?this._config.colors.background:this._config.colors.foreground}return this._config.allowTransparency&&($=u.color.opaque($)),F&&($=u.color.multiplyOpacity($,s.DIM_OPACITY)),$}_resolveBackgroundRgba(y,m,A){switch(y){case 16777216:case 33554432:return this._getColorFromAnsiIndex(m).rgba;case 50331648:return m<<8;default:return A?this._config.colors.foreground.rgba:this._config.colors.background.rgba}}_resolveForegroundRgba(y,m,A,x){switch(y){case 16777216:case 33554432:return this._config.drawBoldTextInBrightColors&&x&&m<8&&(m+=8),this._getColorFromAnsiIndex(m).rgba;case 50331648:return m<<8;default:return A?this._config.colors.background.rgba:this._config.colors.foreground.rgba}}_getMinimumContrastColor(y,m,A,x,M,E,I,F,O,P){if(this._config.minimumContrastRatio===1||P)return;let H=this._getContrastCache(O),$=H.getColor(y,x);if($!==void 0)return $||void 0;let L=this._resolveBackgroundRgba(m,A,I),R=this._resolveForegroundRgba(M,E,I,F),k=u.rgba.ensureContrastRatio(L,R,this._config.minimumContrastRatio/(O?2:1));if(!k)return void H.setColor(y,x,null);let B=u.channels.toColor(k>>24&255,k>>16&255,k>>8&255);return H.setColor(y,x,B),B}_getContrastCache(y){return y?this._config.colors.halfContrastCache:this._config.colors.contrastCache}_drawToCache(y,m,A,x,M=!1){let E=typeof y=="number"?String.fromCharCode(y):y,I=Math.min(this._config.deviceCellWidth*Math.max(E.length,2)+4,this._textureSize);this._tmpCanvas.width<I&&(this._tmpCanvas.width=I);let F=Math.min(this._config.deviceCellHeight+8,this._textureSize);if(this._tmpCanvas.height<F&&(this._tmpCanvas.height=F),this._tmpCtx.save(),this._workAttributeData.fg=A,this._workAttributeData.bg=m,this._workAttributeData.extended.ext=x,this._workAttributeData.isInvisible())return r;let O=!!this._workAttributeData.isBold(),P=!!this._workAttributeData.isInverse(),H=!!this._workAttributeData.isDim(),$=!!this._workAttributeData.isItalic(),L=!!this._workAttributeData.isUnderline(),R=!!this._workAttributeData.isStrikethrough(),k=!!this._workAttributeData.isOverline(),B=this._workAttributeData.getFgColor(),N=this._workAttributeData.getFgColorMode(),W=this._workAttributeData.getBgColor(),q=this._workAttributeData.getBgColorMode();if(P){let U=B;B=W,W=U;let Y=N;N=q,q=Y}let J=this._getBackgroundColor(q,W,P,H);this._tmpCtx.globalCompositeOperation="copy",this._tmpCtx.fillStyle=J.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.globalCompositeOperation="source-over";let Q=O?this._config.fontWeightBold:this._config.fontWeight,D=$?"italic":"";this._tmpCtx.font=`${D} ${Q} ${this._config.fontSize*this._config.devicePixelRatio}px ${this._config.fontFamily}`,this._tmpCtx.textBaseline=s.TEXT_BASELINE;let se=E.length===1&&(0,o.isPowerlineGlyph)(E.charCodeAt(0)),K=E.length===1&&(0,o.isRestrictedPowerlineGlyph)(E.charCodeAt(0)),Z=this._getForegroundColor(m,q,W,A,N,B,P,H,O,(0,o.treatGlyphAsBackgroundColor)(E.charCodeAt(0)));this._tmpCtx.fillStyle=Z.css;let V=K?0:4,ue=!1;this._config.customGlyphs!==!1&&(ue=(0,n.tryDrawCustomChar)(this._tmpCtx,E,V,V,this._config.deviceCellWidth,this._config.deviceCellHeight,this._config.fontSize,this._config.devicePixelRatio));let pe,fe=!se;if(pe=typeof y=="number"?this._unicodeService.wcwidth(y):this._unicodeService.getStringCellWidth(y),L){this._tmpCtx.save();let U=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),Y=U%2==1?.5:0;if(this._tmpCtx.lineWidth=U,this._workAttributeData.isUnderlineColorDefault())this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle;else if(this._workAttributeData.isUnderlineColorRGB())fe=!1,this._tmpCtx.strokeStyle=`rgb(${e.AttributeData.toColorRGB(this._workAttributeData.getUnderlineColor()).join(",")})`;else{fe=!1;let ae=this._workAttributeData.getUnderlineColor();this._config.drawBoldTextInBrightColors&&this._workAttributeData.isBold()&&ae<8&&(ae+=8),this._tmpCtx.strokeStyle=this._getColorFromAnsiIndex(ae).css}this._tmpCtx.beginPath();let oe=V,ie=Math.ceil(V+this._config.deviceCharHeight)-Y-(M?2*U:0),Se=ie+U,xe=ie+2*U,me=this._workAttributeData.getUnderlineVariantOffset();for(let ae=0;ae<pe;ae++){this._tmpCtx.save();let te=oe+ae*this._config.deviceCellWidth,re=oe+(ae+1)*this._config.deviceCellWidth,Pe=te+this._config.deviceCellWidth/2;switch(this._workAttributeData.extended.underlineStyle){case 2:this._tmpCtx.moveTo(te,ie),this._tmpCtx.lineTo(re,ie),this._tmpCtx.moveTo(te,xe),this._tmpCtx.lineTo(re,xe);break;case 3:let Ee=U<=1?xe:Math.ceil(V+this._config.deviceCharHeight-U/2)-Y,Me=U<=1?ie:Math.ceil(V+this._config.deviceCharHeight+U/2)-Y,Ve=new Path2D;Ve.rect(te,ie,this._config.deviceCellWidth,xe-ie),this._tmpCtx.clip(Ve),this._tmpCtx.moveTo(te-this._config.deviceCellWidth/2,Se),this._tmpCtx.bezierCurveTo(te-this._config.deviceCellWidth/2,Me,te,Me,te,Se),this._tmpCtx.bezierCurveTo(te,Ee,Pe,Ee,Pe,Se),this._tmpCtx.bezierCurveTo(Pe,Me,re,Me,re,Se),this._tmpCtx.bezierCurveTo(re,Ee,re+this._config.deviceCellWidth/2,Ee,re+this._config.deviceCellWidth/2,Se);break;case 4:let Te=me===0?0:me>=U?2*U-me:U-me;me>=U||Te===0?(this._tmpCtx.setLineDash([Math.round(U),Math.round(U)]),this._tmpCtx.moveTo(te+Te,ie),this._tmpCtx.lineTo(re,ie)):(this._tmpCtx.setLineDash([Math.round(U),Math.round(U)]),this._tmpCtx.moveTo(te,ie),this._tmpCtx.lineTo(te+Te,ie),this._tmpCtx.moveTo(te+Te+U,ie),this._tmpCtx.lineTo(re,ie)),me=(0,o.computeNextVariantOffset)(re-te,U,me);break;case 5:let Ht=.6,Ut=.3,Ie=re-te,Ke=Math.floor(Ht*Ie),Xe=Math.floor(Ut*Ie),Nt=Ie-Ke-Xe;this._tmpCtx.setLineDash([Ke,Xe,Nt]),this._tmpCtx.moveTo(te,ie),this._tmpCtx.lineTo(re,ie);break;default:this._tmpCtx.moveTo(te,ie),this._tmpCtx.lineTo(re,ie)}this._tmpCtx.stroke(),this._tmpCtx.restore()}if(this._tmpCtx.restore(),!ue&&this._config.fontSize>=12&&!this._config.allowTransparency&&E!==" "){this._tmpCtx.save(),this._tmpCtx.textBaseline="alphabetic";let ae=this._tmpCtx.measureText(E);if(this._tmpCtx.restore(),"actualBoundingBoxDescent"in ae&&ae.actualBoundingBoxDescent>0){this._tmpCtx.save();let te=new Path2D;te.rect(oe,ie-Math.ceil(U/2),this._config.deviceCellWidth*pe,xe-ie+Math.ceil(U/2)),this._tmpCtx.clip(te),this._tmpCtx.lineWidth=3*this._config.devicePixelRatio,this._tmpCtx.strokeStyle=J.css,this._tmpCtx.strokeText(E,V,V+this._config.deviceCharHeight),this._tmpCtx.restore()}}}if(k){let U=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),Y=U%2==1?.5:0;this._tmpCtx.lineWidth=U,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(V,V+Y),this._tmpCtx.lineTo(V+this._config.deviceCharWidth*pe,V+Y),this._tmpCtx.stroke()}if(ue||this._tmpCtx.fillText(E,V,V+this._config.deviceCharHeight),E==="_"&&!this._config.allowTransparency){let U=c(this._tmpCtx.getImageData(V,V,this._config.deviceCellWidth,this._config.deviceCellHeight),J,Z,fe);if(U)for(let Y=1;Y<=5&&(this._tmpCtx.save(),this._tmpCtx.fillStyle=J.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.restore(),this._tmpCtx.fillText(E,V,V+this._config.deviceCharHeight-Y),U=c(this._tmpCtx.getImageData(V,V,this._config.deviceCellWidth,this._config.deviceCellHeight),J,Z,fe),U);Y++);}if(R){let U=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/10)),Y=this._tmpCtx.lineWidth%2==1?.5:0;this._tmpCtx.lineWidth=U,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(V,V+Math.floor(this._config.deviceCharHeight/2)-Y),this._tmpCtx.lineTo(V+this._config.deviceCharWidth*pe,V+Math.floor(this._config.deviceCharHeight/2)-Y),this._tmpCtx.stroke()}this._tmpCtx.restore();let ge=this._tmpCtx.getImageData(0,0,this._tmpCanvas.width,this._tmpCanvas.height),we;if(we=this._config.allowTransparency?function(U){for(let Y=0;Y<U.data.length;Y+=4)if(U.data[Y+3]>0)return!1;return!0}(ge):c(ge,J,Z,fe),we)return r;let X=this._findGlyphBoundingBox(ge,this._workBoundingBox,I,K,ue,V),j,G;for(;;){if(this._activePages.length===0){let U=this._createNewPage();j=U,G=U.currentRow,G.height=X.size.y;break}j=this._activePages[this._activePages.length-1],G=j.currentRow;for(let U of this._activePages)X.size.y<=U.currentRow.height&&(j=U,G=U.currentRow);for(let U=this._activePages.length-1;U>=0;U--)for(let Y of this._activePages[U].fixedRows)Y.height<=G.height&&X.size.y<=Y.height&&(j=this._activePages[U],G=Y);if(G.y+X.size.y>=j.canvas.height||G.height>X.size.y+2){let U=!1;if(j.currentRow.y+j.currentRow.height+X.size.y>=j.canvas.height){let Y;for(let oe of this._activePages)if(oe.currentRow.y+oe.currentRow.height+X.size.y<oe.canvas.height){Y=oe;break}if(Y)j=Y;else if(f.maxAtlasPages&&this._pages.length>=f.maxAtlasPages&&G.y+X.size.y<=j.canvas.height&&G.height>=X.size.y&&G.x+X.size.x<=j.canvas.width)U=!0;else{let oe=this._createNewPage();j=oe,G=oe.currentRow,G.height=X.size.y,U=!0}}U||(j.currentRow.height>0&&j.fixedRows.push(j.currentRow),G={x:0,y:j.currentRow.y+j.currentRow.height,height:X.size.y},j.fixedRows.push(G),j.currentRow={x:0,y:G.y+G.height,height:0})}if(G.x+X.size.x<=j.canvas.width)break;G===j.currentRow?(G.x=0,G.y+=G.height,G.height=0):j.fixedRows.splice(j.fixedRows.indexOf(G),1)}return X.texturePage=this._pages.indexOf(j),X.texturePosition.x=G.x,X.texturePosition.y=G.y,X.texturePositionClipSpace.x=G.x/j.canvas.width,X.texturePositionClipSpace.y=G.y/j.canvas.height,X.sizeClipSpace.x/=j.canvas.width,X.sizeClipSpace.y/=j.canvas.height,G.height=Math.max(G.height,X.size.y),G.x+=X.size.x,j.ctx.putImageData(ge,X.texturePosition.x-this._workBoundingBox.left,X.texturePosition.y-this._workBoundingBox.top,this._workBoundingBox.left,this._workBoundingBox.top,X.size.x,X.size.y),j.addGlyph(X),j.version++,X}_findGlyphBoundingBox(y,m,A,x,M,E){m.top=0;let I=x?this._config.deviceCellHeight:this._tmpCanvas.height,F=x?this._config.deviceCellWidth:A,O=!1;for(let P=0;P<I;P++){for(let H=0;H<F;H++){let $=P*this._tmpCanvas.width*4+4*H+3;if(y.data[$]!==0){m.top=P,O=!0;break}}if(O)break}m.left=0,O=!1;for(let P=0;P<E+F;P++){for(let H=0;H<I;H++){let $=H*this._tmpCanvas.width*4+4*P+3;if(y.data[$]!==0){m.left=P,O=!0;break}}if(O)break}m.right=F,O=!1;for(let P=E+F-1;P>=E;P--){for(let H=0;H<I;H++){let $=H*this._tmpCanvas.width*4+4*P+3;if(y.data[$]!==0){m.right=P,O=!0;break}}if(O)break}m.bottom=I,O=!1;for(let P=I-1;P>=0;P--){for(let H=0;H<F;H++){let $=P*this._tmpCanvas.width*4+4*H+3;if(y.data[$]!==0){m.bottom=P,O=!0;break}}if(O)break}return{texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},size:{x:m.right-m.left+1,y:m.bottom-m.top+1},sizeClipSpace:{x:m.right-m.left+1,y:m.bottom-m.top+1},offset:{x:-m.left+E+(x||M?Math.floor((this._config.deviceCellWidth-this._config.deviceCharWidth)/2):0),y:-m.top+E+(x||M?this._config.lineHeight===1?0:Math.round((this._config.deviceCellHeight-this._config.deviceCharHeight)/2):0)}}}}i.TextureAtlas=f;class d{get percentageUsed(){return this._usedPixels/(this.canvas.width*this.canvas.height)}get glyphs(){return this._glyphs}addGlyph(y){this._glyphs.push(y),this._usedPixels+=y.size.x*y.size.y}constructor(y,m,A){if(this._usedPixels=0,this._glyphs=[],this.version=0,this.currentRow={x:0,y:0,height:0},this.fixedRows=[],A)for(let x of A)this._glyphs.push(...x.glyphs),this._usedPixels+=x._usedPixels;this.canvas=b(y,m,m),this.ctx=(0,o.throwIfFalsy)(this.canvas.getContext("2d",{alpha:!0}))}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.currentRow.x=0,this.currentRow.y=0,this.currentRow.height=0,this.fixedRows.length=0,this.version++}}function c(S,y,m,A){let x=y.rgba>>>24,M=y.rgba>>>16&255,E=y.rgba>>>8&255,I=m.rgba>>>24,F=m.rgba>>>16&255,O=m.rgba>>>8&255,P=Math.floor((Math.abs(x-I)+Math.abs(M-F)+Math.abs(E-O))/12),H=!0;for(let $=0;$<S.data.length;$+=4)S.data[$]===x&&S.data[$+1]===M&&S.data[$+2]===E||A&&Math.abs(S.data[$]-x)+Math.abs(S.data[$+1]-M)+Math.abs(S.data[$+2]-E)<P?S.data[$+3]=0:H=!1;return H}function b(S,y,m){let A=S.createElement("canvas");return A.width=y,A.height=m,A}},577:function(w,i,p){var s=this&&this.__decorate||function(v,r,a,f){var d,c=arguments.length,b=c<3?r:f===null?f=Object.getOwnPropertyDescriptor(r,a):f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(v,r,a,f);else for(var S=v.length-1;S>=0;S--)(d=v[S])&&(b=(c<3?d(b):c>3?d(r,a,b):d(r,a))||b);return c>3&&b&&Object.defineProperty(r,a,b),b},n=this&&this.__param||function(v,r){return function(a,f){r(a,f,v)}};Object.defineProperty(i,"__esModule",{value:!0}),i.CharacterJoinerService=i.JoinedCellData=void 0;let o=p(147),u=p(855),h=p(782),_=p(97);class t extends o.AttributeData{constructor(r,a,f){super(),this.content=0,this.combinedData="",this.fg=r.fg,this.bg=r.bg,this.combinedData=a,this._width=f}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(r){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}i.JoinedCellData=t;let e=i.CharacterJoinerService=class ji{constructor(r){this._bufferService=r,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new h.CellData}register(r){let a={id:this._nextCharacterJoinerId++,handler:r};return this._characterJoiners.push(a),a.id}deregister(r){for(let a=0;a<this._characterJoiners.length;a++)if(this._characterJoiners[a].id===r)return this._characterJoiners.splice(a,1),!0;return!1}getJoinedCharacters(r){if(this._characterJoiners.length===0)return[];let a=this._bufferService.buffer.lines.get(r);if(!a||a.length===0)return[];let f=[],d=a.translateToString(!0),c=0,b=0,S=0,y=a.getFg(0),m=a.getBg(0);for(let A=0;A<a.getTrimmedLength();A++)if(a.loadCell(A,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==y||this._workCell.bg!==m){if(A-c>1){let x=this._getJoinedRanges(d,S,b,a,c);for(let M=0;M<x.length;M++)f.push(x[M])}c=A,S=b,y=this._workCell.fg,m=this._workCell.bg}b+=this._workCell.getChars().length||u.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-c>1){let A=this._getJoinedRanges(d,S,b,a,c);for(let x=0;x<A.length;x++)f.push(A[x])}return f}_getJoinedRanges(r,a,f,d,c){let b=r.substring(a,f),S=[];try{S=this._characterJoiners[0].handler(b)}catch(y){console.error(y)}for(let y=1;y<this._characterJoiners.length;y++)try{let m=this._characterJoiners[y].handler(b);for(let A=0;A<m.length;A++)ji._mergeRanges(S,m[A])}catch(m){console.error(m)}return this._stringRangesToCellRanges(S,d,c),S}_stringRangesToCellRanges(r,a,f){let d=0,c=!1,b=0,S=r[d];if(S){for(let y=f;y<this._bufferService.cols;y++){let m=a.getWidth(y),A=a.getString(y).length||u.WHITESPACE_CELL_CHAR.length;if(m!==0){if(!c&&S[0]<=b&&(S[0]=y,c=!0),S[1]<=b){if(S[1]=y,S=r[++d],!S)break;S[0]<=b?(S[0]=y,c=!0):c=!1}b+=A}}S&&(S[1]=this._bufferService.cols)}}static _mergeRanges(r,a){let f=!1;for(let d=0;d<r.length;d++){let c=r[d];if(f){if(a[1]<=c[0])return r[d-1][1]=a[1],r;if(a[1]<=c[1])return r[d-1][1]=Math.max(a[1],c[1]),r.splice(d,1),r;r.splice(d,1),d--}else{if(a[1]<=c[0])return r.splice(d,0,a),r;if(a[1]<=c[1])return c[0]=Math.min(a[0],c[0]),r;a[0]<c[1]&&(c[0]=Math.min(a[0],c[0]),f=!0)}}return f?r[r.length-1][1]=a[1]:r.push(a),r}};i.CharacterJoinerService=e=s([n(0,_.IBufferService)],e)},160:(w,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.contrastRatio=i.toPaddedHex=i.rgba=i.rgb=i.css=i.color=i.channels=i.NULL_COLOR=void 0;let p=0,s=0,n=0,o=0;var u,h,_,t,e;function v(a){let f=a.toString(16);return f.length<2?"0"+f:f}function r(a,f){return a<f?(f+.05)/(a+.05):(a+.05)/(f+.05)}i.NULL_COLOR={css:"#00000000",rgba:0},function(a){a.toCss=function(f,d,c,b){return b!==void 0?`#${v(f)}${v(d)}${v(c)}${v(b)}`:`#${v(f)}${v(d)}${v(c)}`},a.toRgba=function(f,d,c,b=255){return(f<<24|d<<16|c<<8|b)>>>0},a.toColor=function(f,d,c,b){return{css:a.toCss(f,d,c,b),rgba:a.toRgba(f,d,c,b)}}}(u||(i.channels=u={})),function(a){function f(d,c){return o=Math.round(255*c),[p,s,n]=e.toChannels(d.rgba),{css:u.toCss(p,s,n,o),rgba:u.toRgba(p,s,n,o)}}a.blend=function(d,c){if(o=(255&c.rgba)/255,o===1)return{css:c.css,rgba:c.rgba};let b=c.rgba>>24&255,S=c.rgba>>16&255,y=c.rgba>>8&255,m=d.rgba>>24&255,A=d.rgba>>16&255,x=d.rgba>>8&255;return p=m+Math.round((b-m)*o),s=A+Math.round((S-A)*o),n=x+Math.round((y-x)*o),{css:u.toCss(p,s,n),rgba:u.toRgba(p,s,n)}},a.isOpaque=function(d){return(255&d.rgba)==255},a.ensureContrastRatio=function(d,c,b){let S=e.ensureContrastRatio(d.rgba,c.rgba,b);if(S)return u.toColor(S>>24&255,S>>16&255,S>>8&255)},a.opaque=function(d){let c=(255|d.rgba)>>>0;return[p,s,n]=e.toChannels(c),{css:u.toCss(p,s,n),rgba:c}},a.opacity=f,a.multiplyOpacity=function(d,c){return o=255&d.rgba,f(d,o*c/255)},a.toColorRGB=function(d){return[d.rgba>>24&255,d.rgba>>16&255,d.rgba>>8&255]}}(h||(i.color=h={})),function(a){let f,d;try{let c=document.createElement("canvas");c.width=1,c.height=1;let b=c.getContext("2d",{willReadFrequently:!0});b&&(f=b,f.globalCompositeOperation="copy",d=f.createLinearGradient(0,0,1,1))}catch{}a.toColor=function(c){if(c.match(/#[\da-f]{3,8}/i))switch(c.length){case 4:return p=parseInt(c.slice(1,2).repeat(2),16),s=parseInt(c.slice(2,3).repeat(2),16),n=parseInt(c.slice(3,4).repeat(2),16),u.toColor(p,s,n);case 5:return p=parseInt(c.slice(1,2).repeat(2),16),s=parseInt(c.slice(2,3).repeat(2),16),n=parseInt(c.slice(3,4).repeat(2),16),o=parseInt(c.slice(4,5).repeat(2),16),u.toColor(p,s,n,o);case 7:return{css:c,rgba:(parseInt(c.slice(1),16)<<8|255)>>>0};case 9:return{css:c,rgba:parseInt(c.slice(1),16)>>>0}}let b=c.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(b)return p=parseInt(b[1]),s=parseInt(b[2]),n=parseInt(b[3]),o=Math.round(255*(b[5]===void 0?1:parseFloat(b[5]))),u.toColor(p,s,n,o);if(!f||!d)throw new Error("css.toColor: Unsupported css format");if(f.fillStyle=d,f.fillStyle=c,typeof f.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(f.fillRect(0,0,1,1),[p,s,n,o]=f.getImageData(0,0,1,1).data,o!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:u.toRgba(p,s,n,o),css:c}}}(_||(i.css=_={})),function(a){function f(d,c,b){let S=d/255,y=c/255,m=b/255;return .2126*(S<=.03928?S/12.92:Math.pow((S+.055)/1.055,2.4))+.7152*(y<=.03928?y/12.92:Math.pow((y+.055)/1.055,2.4))+.0722*(m<=.03928?m/12.92:Math.pow((m+.055)/1.055,2.4))}a.relativeLuminance=function(d){return f(d>>16&255,d>>8&255,255&d)},a.relativeLuminance2=f}(t||(i.rgb=t={})),function(a){function f(c,b,S){let y=c>>24&255,m=c>>16&255,A=c>>8&255,x=b>>24&255,M=b>>16&255,E=b>>8&255,I=r(t.relativeLuminance2(x,M,E),t.relativeLuminance2(y,m,A));for(;I<S&&(x>0||M>0||E>0);)x-=Math.max(0,Math.ceil(.1*x)),M-=Math.max(0,Math.ceil(.1*M)),E-=Math.max(0,Math.ceil(.1*E)),I=r(t.relativeLuminance2(x,M,E),t.relativeLuminance2(y,m,A));return(x<<24|M<<16|E<<8|255)>>>0}function d(c,b,S){let y=c>>24&255,m=c>>16&255,A=c>>8&255,x=b>>24&255,M=b>>16&255,E=b>>8&255,I=r(t.relativeLuminance2(x,M,E),t.relativeLuminance2(y,m,A));for(;I<S&&(x<255||M<255||E<255);)x=Math.min(255,x+Math.ceil(.1*(255-x))),M=Math.min(255,M+Math.ceil(.1*(255-M))),E=Math.min(255,E+Math.ceil(.1*(255-E))),I=r(t.relativeLuminance2(x,M,E),t.relativeLuminance2(y,m,A));return(x<<24|M<<16|E<<8|255)>>>0}a.blend=function(c,b){if(o=(255&b)/255,o===1)return b;let S=b>>24&255,y=b>>16&255,m=b>>8&255,A=c>>24&255,x=c>>16&255,M=c>>8&255;return p=A+Math.round((S-A)*o),s=x+Math.round((y-x)*o),n=M+Math.round((m-M)*o),u.toRgba(p,s,n)},a.ensureContrastRatio=function(c,b,S){let y=t.relativeLuminance(c>>8),m=t.relativeLuminance(b>>8);if(r(y,m)<S){if(m<y){let M=f(c,b,S),E=r(y,t.relativeLuminance(M>>8));if(E<S){let I=d(c,b,S);return E>r(y,t.relativeLuminance(I>>8))?M:I}return M}let A=d(c,b,S),x=r(y,t.relativeLuminance(A>>8));if(x<S){let M=f(c,b,S);return x>r(y,t.relativeLuminance(M>>8))?A:M}return A}},a.reduceLuminance=f,a.increaseLuminance=d,a.toChannels=function(c){return[c>>24&255,c>>16&255,c>>8&255,255&c]}}(e||(i.rgba=e={})),i.toPaddedHex=v,i.contrastRatio=r},345:(w,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.runAndSubscribe=i.forwardEvent=i.EventEmitter=void 0,i.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=p=>(this._listeners.push(p),{dispose:()=>{if(!this._disposed){for(let s=0;s<this._listeners.length;s++)if(this._listeners[s]===p)return void this._listeners.splice(s,1)}}})),this._event}fire(p,s){let n=[];for(let o=0;o<this._listeners.length;o++)n.push(this._listeners[o]);for(let o=0;o<n.length;o++)n[o].call(void 0,p,s)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},i.forwardEvent=function(p,s){return p(n=>s.fire(n))},i.runAndSubscribe=function(p,s){return s(void 0),p(n=>s(n))}},859:(w,i)=>{function p(s){for(let n of s)n.dispose();s.length=0}Object.defineProperty(i,"__esModule",{value:!0}),i.getDisposeArrayDisposable=i.disposeArray=i.toDisposable=i.MutableDisposable=i.Disposable=void 0,i.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(let s of this._disposables)s.dispose();this._disposables.length=0}register(s){return this._disposables.push(s),s}unregister(s){let n=this._disposables.indexOf(s);n!==-1&&this._disposables.splice(n,1)}},i.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(s){this._isDisposed||s===this._value||(this._value?.dispose(),this._value=s)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}},i.toDisposable=function(s){return{dispose:s}},i.disposeArray=p,i.getDisposeArrayDisposable=function(s){return{dispose:()=>p(s)}}},485:(w,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.FourKeyMap=i.TwoKeyMap=void 0;class p{constructor(){this._data={}}set(n,o,u){this._data[n]||(this._data[n]={}),this._data[n][o]=u}get(n,o){return this._data[n]?this._data[n][o]:void 0}clear(){this._data={}}}i.TwoKeyMap=p,i.FourKeyMap=class{constructor(){this._data=new p}set(s,n,o,u,h){this._data.get(s,n)||this._data.set(s,n,new p),this._data.get(s,n).set(o,u,h)}get(s,n,o,u){return this._data.get(s,n)?.get(o,u)}clear(){this._data.clear()}}},399:(w,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.isChromeOS=i.isLinux=i.isWindows=i.isIphone=i.isIpad=i.isMac=i.getSafariVersion=i.isSafari=i.isLegacyEdge=i.isFirefox=i.isNode=void 0,i.isNode=typeof process<"u"&&"title"in process;let p=i.isNode?"node":navigator.userAgent,s=i.isNode?"node":navigator.platform;i.isFirefox=p.includes("Firefox"),i.isLegacyEdge=p.includes("Edge"),i.isSafari=/^((?!chrome|android).)*safari/i.test(p),i.getSafariVersion=function(){if(!i.isSafari)return 0;let n=p.match(/Version\/(\d+)/);return n===null||n.length<2?0:parseInt(n[1])},i.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(s),i.isIpad=s==="iPad",i.isIphone=s==="iPhone",i.isWindows=["Windows","Win16","Win32","WinCE"].includes(s),i.isLinux=s.indexOf("Linux")>=0,i.isChromeOS=/\bCrOS\b/.test(p)},385:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.DebouncedIdleTask=i.IdleTaskQueue=i.PriorityTaskQueue=void 0;let s=p(399);class n{constructor(){this._tasks=[],this._i=0}enqueue(h){this._tasks.push(h),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(h){this._idleCallback=void 0;let _=0,t=0,e=h.timeRemaining(),v=0;for(;this._i<this._tasks.length;){if(_=Date.now(),this._tasks[this._i]()||this._i++,_=Math.max(1,Date.now()-_),t=Math.max(_,t),v=h.timeRemaining(),1.5*t>v)return e-_<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(e-_))}ms`),void this._start();e=v}this.clear()}}class o extends n{_requestCallback(h){return setTimeout(()=>h(this._createDeadline(16)))}_cancelCallback(h){clearTimeout(h)}_createDeadline(h){let _=Date.now()+h;return{timeRemaining:()=>Math.max(0,_-Date.now())}}}i.PriorityTaskQueue=o,i.IdleTaskQueue=!s.isNode&&"requestIdleCallback"in window?class extends n{_requestCallback(u){return requestIdleCallback(u)}_cancelCallback(u){cancelIdleCallback(u)}}:o,i.DebouncedIdleTask=class{constructor(){this._queue=new i.IdleTaskQueue}set(u){this._queue.clear(),this._queue.enqueue(u)}flush(){this._queue.flush()}}},147:(w,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ExtendedAttrs=i.AttributeData=void 0;class p{constructor(){this.fg=0,this.bg=0,this.extended=new s}static toColorRGB(o){return[o>>>16&255,o>>>8&255,255&o]}static fromColorRGB(o){return(255&o[0])<<16|(255&o[1])<<8|255&o[2]}clone(){let o=new p;return o.fg=this.fg,o.bg=this.bg,o.extended=this.extended.clone(),o}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}i.AttributeData=p;class s{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(o){this._ext=o}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(o){this._ext&=-469762049,this._ext|=o<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(o){this._ext&=-67108864,this._ext|=67108863&o}get urlId(){return this._urlId}set urlId(o){this._urlId=o}get underlineVariantOffset(){let o=(3758096384&this._ext)>>29;return o<0?4294967288^o:o}set underlineVariantOffset(o){this._ext&=536870911,this._ext|=o<<29&3758096384}constructor(o=0,u=0){this._ext=0,this._urlId=0,this._ext=o,this._urlId=u}clone(){return new s(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}i.ExtendedAttrs=s},782:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CellData=void 0;let s=p(133),n=p(855),o=p(147);class u extends o.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new o.ExtendedAttrs,this.combinedData=""}static fromCharData(_){let t=new u;return t.setFromCharData(_),t}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,s.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(_){this.fg=_[n.CHAR_DATA_ATTR_INDEX],this.bg=0;let t=!1;if(_[n.CHAR_DATA_CHAR_INDEX].length>2)t=!0;else if(_[n.CHAR_DATA_CHAR_INDEX].length===2){let e=_[n.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=e&&e<=56319){let v=_[n.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=v&&v<=57343?this.content=1024*(e-55296)+v-56320+65536|_[n.CHAR_DATA_WIDTH_INDEX]<<22:t=!0}else t=!0}else this.content=_[n.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|_[n.CHAR_DATA_WIDTH_INDEX]<<22;t&&(this.combinedData=_[n.CHAR_DATA_CHAR_INDEX],this.content=2097152|_[n.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}i.CellData=u},855:(w,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.WHITESPACE_CELL_CODE=i.WHITESPACE_CELL_WIDTH=i.WHITESPACE_CELL_CHAR=i.NULL_CELL_CODE=i.NULL_CELL_WIDTH=i.NULL_CELL_CHAR=i.CHAR_DATA_CODE_INDEX=i.CHAR_DATA_WIDTH_INDEX=i.CHAR_DATA_CHAR_INDEX=i.CHAR_DATA_ATTR_INDEX=i.DEFAULT_EXT=i.DEFAULT_ATTR=i.DEFAULT_COLOR=void 0,i.DEFAULT_COLOR=0,i.DEFAULT_ATTR=256|i.DEFAULT_COLOR<<9,i.DEFAULT_EXT=0,i.CHAR_DATA_ATTR_INDEX=0,i.CHAR_DATA_CHAR_INDEX=1,i.CHAR_DATA_WIDTH_INDEX=2,i.CHAR_DATA_CODE_INDEX=3,i.NULL_CELL_CHAR="",i.NULL_CELL_WIDTH=1,i.NULL_CELL_CODE=0,i.WHITESPACE_CELL_CHAR=" ",i.WHITESPACE_CELL_WIDTH=1,i.WHITESPACE_CELL_CODE=32},133:(w,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Utf8ToUtf32=i.StringToUtf32=i.utf32ToString=i.stringFromCodePoint=void 0,i.stringFromCodePoint=function(p){return p>65535?(p-=65536,String.fromCharCode(55296+(p>>10))+String.fromCharCode(p%1024+56320)):String.fromCharCode(p)},i.utf32ToString=function(p,s=0,n=p.length){let o="";for(let u=s;u<n;++u){let h=p[u];h>65535?(h-=65536,o+=String.fromCharCode(55296+(h>>10))+String.fromCharCode(h%1024+56320)):o+=String.fromCharCode(h)}return o},i.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(p,s){let n=p.length;if(!n)return 0;let o=0,u=0;if(this._interim){let h=p.charCodeAt(u++);56320<=h&&h<=57343?s[o++]=1024*(this._interim-55296)+h-56320+65536:(s[o++]=this._interim,s[o++]=h),this._interim=0}for(let h=u;h<n;++h){let _=p.charCodeAt(h);if(55296<=_&&_<=56319){if(++h>=n)return this._interim=_,o;let t=p.charCodeAt(h);56320<=t&&t<=57343?s[o++]=1024*(_-55296)+t-56320+65536:(s[o++]=_,s[o++]=t)}else _!==65279&&(s[o++]=_)}return o}},i.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(p,s){let n=p.length;if(!n)return 0;let o,u,h,_,t=0,e=0,v=0;if(this.interim[0]){let f=!1,d=this.interim[0];d&=(224&d)==192?31:(240&d)==224?15:7;let c,b=0;for(;(c=63&this.interim[++b])&&b<4;)d<<=6,d|=c;let S=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,y=S-b;for(;v<y;){if(v>=n)return 0;if(c=p[v++],(192&c)!=128){v--,f=!0;break}this.interim[b++]=c,d<<=6,d|=63&c}f||(S===2?d<128?v--:s[t++]=d:S===3?d<2048||d>=55296&&d<=57343||d===65279||(s[t++]=d):d<65536||d>1114111||(s[t++]=d)),this.interim.fill(0)}let r=n-4,a=v;for(;a<n;){for(;!(!(a<r)||128&(o=p[a])||128&(u=p[a+1])||128&(h=p[a+2])||128&(_=p[a+3]));)s[t++]=o,s[t++]=u,s[t++]=h,s[t++]=_,a+=4;if(o=p[a++],o<128)s[t++]=o;else if((224&o)==192){if(a>=n)return this.interim[0]=o,t;if(u=p[a++],(192&u)!=128){a--;continue}if(e=(31&o)<<6|63&u,e<128){a--;continue}s[t++]=e}else if((240&o)==224){if(a>=n)return this.interim[0]=o,t;if(u=p[a++],(192&u)!=128){a--;continue}if(a>=n)return this.interim[0]=o,this.interim[1]=u,t;if(h=p[a++],(192&h)!=128){a--;continue}if(e=(15&o)<<12|(63&u)<<6|63&h,e<2048||e>=55296&&e<=57343||e===65279)continue;s[t++]=e}else if((248&o)==240){if(a>=n)return this.interim[0]=o,t;if(u=p[a++],(192&u)!=128){a--;continue}if(a>=n)return this.interim[0]=o,this.interim[1]=u,t;if(h=p[a++],(192&h)!=128){a--;continue}if(a>=n)return this.interim[0]=o,this.interim[1]=u,this.interim[2]=h,t;if(_=p[a++],(192&_)!=128){a--;continue}if(e=(7&o)<<18|(63&u)<<12|(63&h)<<6|63&_,e<65536||e>1114111)continue;s[t++]=e}}return t}}},776:function(w,i,p){var s=this&&this.__decorate||function(e,v,r,a){var f,d=arguments.length,c=d<3?v:a===null?a=Object.getOwnPropertyDescriptor(v,r):a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(e,v,r,a);else for(var b=e.length-1;b>=0;b--)(f=e[b])&&(c=(d<3?f(c):d>3?f(v,r,c):f(v,r))||c);return d>3&&c&&Object.defineProperty(v,r,c),c},n=this&&this.__param||function(e,v){return function(r,a){v(r,a,e)}};Object.defineProperty(i,"__esModule",{value:!0}),i.traceCall=i.setTraceLogger=i.LogService=void 0;let o=p(859),u=p(97),h={trace:u.LogLevelEnum.TRACE,debug:u.LogLevelEnum.DEBUG,info:u.LogLevelEnum.INFO,warn:u.LogLevelEnum.WARN,error:u.LogLevelEnum.ERROR,off:u.LogLevelEnum.OFF},_,t=i.LogService=class extends o.Disposable{get logLevel(){return this._logLevel}constructor(e){super(),this._optionsService=e,this._logLevel=u.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),_=this}_updateLogLevel(){this._logLevel=h[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(e){for(let v=0;v<e.length;v++)typeof e[v]=="function"&&(e[v]=e[v]())}_log(e,v,r){this._evalLazyOptionalParams(r),e.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+v,...r)}trace(e,...v){this._logLevel<=u.LogLevelEnum.TRACE&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,e,v)}debug(e,...v){this._logLevel<=u.LogLevelEnum.DEBUG&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,e,v)}info(e,...v){this._logLevel<=u.LogLevelEnum.INFO&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,e,v)}warn(e,...v){this._logLevel<=u.LogLevelEnum.WARN&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,e,v)}error(e,...v){this._logLevel<=u.LogLevelEnum.ERROR&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,e,v)}};i.LogService=t=s([n(0,u.IOptionsService)],t),i.setTraceLogger=function(e){_=e},i.traceCall=function(e,v,r){if(typeof r.value!="function")throw new Error("not supported");let a=r.value;r.value=function(...f){if(_.logLevel!==u.LogLevelEnum.TRACE)return a.apply(this,f);_.trace(`GlyphRenderer#${a.name}(${f.map(c=>JSON.stringify(c)).join(", ")})`);let d=a.apply(this,f);return _.trace(`GlyphRenderer#${a.name} return`,d),d}}},726:(w,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.createDecorator=i.getServiceDependencies=i.serviceRegistry=void 0;let p="di$target",s="di$dependencies";i.serviceRegistry=new Map,i.getServiceDependencies=function(n){return n[s]||[]},i.createDecorator=function(n){if(i.serviceRegistry.has(n))return i.serviceRegistry.get(n);let o=function(u,h,_){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(t,e,v){e[p]===e?e[s].push({id:t,index:v}):(e[s]=[{id:t,index:v}],e[p]=e)})(o,u,_)};return o.toString=()=>n,i.serviceRegistry.set(n,o),o}},97:(w,i,p)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.IDecorationService=i.IUnicodeService=i.IOscLinkService=i.IOptionsService=i.ILogService=i.LogLevelEnum=i.IInstantiationService=i.ICharsetService=i.ICoreService=i.ICoreMouseService=i.IBufferService=void 0;let s=p(726);var n;i.IBufferService=(0,s.createDecorator)("BufferService"),i.ICoreMouseService=(0,s.createDecorator)("CoreMouseService"),i.ICoreService=(0,s.createDecorator)("CoreService"),i.ICharsetService=(0,s.createDecorator)("CharsetService"),i.IInstantiationService=(0,s.createDecorator)("InstantiationService"),function(o){o[o.TRACE=0]="TRACE",o[o.DEBUG=1]="DEBUG",o[o.INFO=2]="INFO",o[o.WARN=3]="WARN",o[o.ERROR=4]="ERROR",o[o.OFF=5]="OFF"}(n||(i.LogLevelEnum=n={})),i.ILogService=(0,s.createDecorator)("LogService"),i.IOptionsService=(0,s.createDecorator)("OptionsService"),i.IOscLinkService=(0,s.createDecorator)("OscLinkService"),i.IUnicodeService=(0,s.createDecorator)("UnicodeService"),i.IDecorationService=(0,s.createDecorator)("DecorationService")}},g={};function l(w){var i=g[w];if(i!==void 0)return i.exports;var p=g[w]={exports:{}};return T[w].call(p.exports,p,p.exports,l),p.exports}var C={};return(()=>{var w=C;Object.defineProperty(w,"__esModule",{value:!0}),w.CanvasAddon=void 0;let i=l(345),p=l(859),s=l(776),n=l(949);class o extends p.Disposable{constructor(){super(...arguments),this._onChangeTextureAtlas=this.register(new i.EventEmitter),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this.register(new i.EventEmitter),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event}get textureAtlas(){return this._renderer?.textureAtlas}activate(h){let _=h._core;if(!h.element)return void this.register(_.onWillOpen(()=>this.activate(h)));this._terminal=h;let t=_.coreService,e=_.optionsService,v=_.screenElement,r=_.linkifier,a=_,f=a._bufferService,d=a._renderService,c=a._characterJoinerService,b=a._charSizeService,S=a._coreBrowserService,y=a._decorationService,m=a._logService,A=a._themeService;(0,s.setTraceLogger)(m),this._renderer=new n.CanvasRenderer(h,v,r,f,b,e,c,t,S,y,A),this.register((0,i.forwardEvent)(this._renderer.onChangeTextureAtlas,this._onChangeTextureAtlas)),this.register((0,i.forwardEvent)(this._renderer.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas)),d.setRenderer(this._renderer),d.handleResize(f.cols,f.rows),this.register((0,p.toDisposable)(()=>{d.setRenderer(this._terminal._core._createRenderer()),d.handleResize(h.cols,h.rows),this._renderer?.dispose(),this._renderer=void 0}))}clearTextureAtlas(){this._renderer?.clearTextureAtlas()}}w.CanvasAddon=o})(),C})())});var Vi=ut((Ot,li)=>{(function(T,g){typeof Ot=="object"&&typeof li=="object"?li.exports=g():typeof define=="function"&&define.amd?define([],g):typeof Ot=="object"?Ot.FitAddon=g():T.FitAddon=g()})(self,()=>(()=>{"use strict";var T={};return(()=>{var g=T;Object.defineProperty(g,"__esModule",{value:!0}),g.FitAddon=void 0,g.FitAddon=class{activate(l){this._terminal=l}dispose(){}fit(){let l=this.proposeDimensions();if(!l||!this._terminal||isNaN(l.cols)||isNaN(l.rows))return;let C=this._terminal._core;this._terminal.rows===l.rows&&this._terminal.cols===l.cols||(C._renderService.clear(),this._terminal.resize(l.cols,l.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;let l=this._terminal._core,C=l._renderService.dimensions;if(C.css.cell.width===0||C.css.cell.height===0)return;let w=this._terminal.options.scrollback===0?0:l.viewport.scrollBarWidth,i=window.getComputedStyle(this._terminal.element.parentElement),p=parseInt(i.getPropertyValue("height")),s=Math.max(0,parseInt(i.getPropertyValue("width"))),n=window.getComputedStyle(this._terminal.element),o=p-(parseInt(n.getPropertyValue("padding-top"))+parseInt(n.getPropertyValue("padding-bottom"))),u=s-(parseInt(n.getPropertyValue("padding-right"))+parseInt(n.getPropertyValue("padding-left")))-w;return{cols:Math.max(2,Math.floor(u/C.css.cell.width)),rows:Math.max(1,Math.floor(o/C.css.cell.height))}}}})(),T})())});var _t=globalThis,pt=_t.ShadowRoot&&(_t.ShadyCSS===void 0||_t.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,ui=Symbol(),di=new WeakMap,gt=class{constructor(g,l,C){if(this._$cssResult$=!0,C!==ui)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=g,this.t=l}get styleSheet(){let g=this.o,l=this.t;if(pt&&g===void 0){let C=l!==void 0&&l.length===1;C&&(g=di.get(l)),g===void 0&&((this.o=g=new CSSStyleSheet).replaceSync(this.cssText),C&&di.set(l,g))}return g}toString(){return this.cssText}},fi=T=>new gt(typeof T=="string"?T:T+"",void 0,ui);var _i=(T,g)=>{if(pt)T.adoptedStyleSheets=g.map(l=>l instanceof CSSStyleSheet?l:l.styleSheet);else for(let l of g){let C=document.createElement("style"),w=_t.litNonce;w!==void 0&&C.setAttribute("nonce",w),C.textContent=l.cssText,T.appendChild(C)}},Wt=pt?T=>T:T=>T instanceof CSSStyleSheet?(g=>{let l="";for(let C of g.cssRules)l+=C.cssText;return fi(l)})(T):T;var{is:rs,defineProperty:ns,getOwnPropertyDescriptor:os,getOwnPropertyNames:as,getOwnPropertySymbols:hs,getPrototypeOf:ls}=Object,De=globalThis,gi=De.trustedTypes,cs=gi?gi.emptyScript:"",ds=De.reactiveElementPolyfillSupport,Ye=(T,g)=>T,Je={toAttribute(T,g){switch(g){case Boolean:T=T?cs:null;break;case Object:case Array:T=T==null?T:JSON.stringify(T)}return T},fromAttribute(T,g){let l=T;switch(g){case Boolean:l=T!==null;break;case Number:l=T===null?null:Number(T);break;case Object:case Array:try{l=JSON.parse(T)}catch{l=null}}return l}},vt=(T,g)=>!rs(T,g),pi={attribute:!0,type:String,converter:Je,reflect:!1,useDefault:!1,hasChanged:vt};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),De.litPropertyMetadata??(De.litPropertyMetadata=new WeakMap);var Re=class extends HTMLElement{static addInitializer(g){this._$Ei(),(this.l??(this.l=[])).push(g)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(g,l=pi){if(l.state&&(l.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(g)&&((l=Object.create(l)).wrapped=!0),this.elementProperties.set(g,l),!l.noAccessor){let C=Symbol(),w=this.getPropertyDescriptor(g,C,l);w!==void 0&&ns(this.prototype,g,w)}}static getPropertyDescriptor(g,l,C){let{get:w,set:i}=os(this.prototype,g)??{get(){return this[l]},set(p){this[l]=p}};return{get:w,set(p){let s=w?.call(this);i?.call(this,p),this.requestUpdate(g,s,C)},configurable:!0,enumerable:!0}}static getPropertyOptions(g){return this.elementProperties.get(g)??pi}static _$Ei(){if(this.hasOwnProperty(Ye("elementProperties")))return;let g=ls(this);g.finalize(),g.l!==void 0&&(this.l=[...g.l]),this.elementProperties=new Map(g.elementProperties)}static finalize(){if(this.hasOwnProperty(Ye("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Ye("properties"))){let l=this.properties,C=[...as(l),...hs(l)];for(let w of C)this.createProperty(w,l[w])}let g=this[Symbol.metadata];if(g!==null){let l=litPropertyMetadata.get(g);if(l!==void 0)for(let[C,w]of l)this.elementProperties.set(C,w)}this._$Eh=new Map;for(let[l,C]of this.elementProperties){let w=this._$Eu(l,C);w!==void 0&&this._$Eh.set(w,l)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(g){let l=[];if(Array.isArray(g)){let C=new Set(g.flat(1/0).reverse());for(let w of C)l.unshift(Wt(w))}else g!==void 0&&l.push(Wt(g));return l}static _$Eu(g,l){let C=l.attribute;return C===!1?void 0:typeof C=="string"?C:typeof g=="string"?g.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(g=>this.enableUpdating=g),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(g=>g(this))}addController(g){(this._$EO??(this._$EO=new Set)).add(g),this.renderRoot!==void 0&&this.isConnected&&g.hostConnected?.()}removeController(g){this._$EO?.delete(g)}_$E_(){let g=new Map,l=this.constructor.elementProperties;for(let C of l.keys())this.hasOwnProperty(C)&&(g.set(C,this[C]),delete this[C]);g.size>0&&(this._$Ep=g)}createRenderRoot(){let g=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return _i(g,this.constructor.elementStyles),g}connectedCallback(){this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),this._$EO?.forEach(g=>g.hostConnected?.())}enableUpdating(g){}disconnectedCallback(){this._$EO?.forEach(g=>g.hostDisconnected?.())}attributeChangedCallback(g,l,C){this._$AK(g,C)}_$ET(g,l){let C=this.constructor.elementProperties.get(g),w=this.constructor._$Eu(g,C);if(w!==void 0&&C.reflect===!0){let i=(C.converter?.toAttribute!==void 0?C.converter:Je).toAttribute(l,C.type);this._$Em=g,i==null?this.removeAttribute(w):this.setAttribute(w,i),this._$Em=null}}_$AK(g,l){let C=this.constructor,w=C._$Eh.get(g);if(w!==void 0&&this._$Em!==w){let i=C.getPropertyOptions(w),p=typeof i.converter=="function"?{fromAttribute:i.converter}:i.converter?.fromAttribute!==void 0?i.converter:Je;this._$Em=w;let s=p.fromAttribute(l,i.type);this[w]=s??this._$Ej?.get(w)??s,this._$Em=null}}requestUpdate(g,l,C){if(g!==void 0){let w=this.constructor,i=this[g];if(C??(C=w.getPropertyOptions(g)),!((C.hasChanged??vt)(i,l)||C.useDefault&&C.reflect&&i===this._$Ej?.get(g)&&!this.hasAttribute(w._$Eu(g,C))))return;this.C(g,l,C)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(g,l,{useDefault:C,reflect:w,wrapped:i},p){C&&!(this._$Ej??(this._$Ej=new Map)).has(g)&&(this._$Ej.set(g,p??l??this[g]),i!==!0||p!==void 0)||(this._$AL.has(g)||(this.hasUpdated||C||(l=void 0),this._$AL.set(g,l)),w===!0&&this._$Em!==g&&(this._$Eq??(this._$Eq=new Set)).add(g))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(l){Promise.reject(l)}let g=this.scheduleUpdate();return g!=null&&await g,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(let[w,i]of this._$Ep)this[w]=i;this._$Ep=void 0}let C=this.constructor.elementProperties;if(C.size>0)for(let[w,i]of C){let{wrapped:p}=i,s=this[w];p!==!0||this._$AL.has(w)||s===void 0||this.C(w,void 0,i,s)}}let g=!1,l=this._$AL;try{g=this.shouldUpdate(l),g?(this.willUpdate(l),this._$EO?.forEach(C=>C.hostUpdate?.()),this.update(l)):this._$EM()}catch(C){throw g=!1,this._$EM(),C}g&&this._$AE(l)}willUpdate(g){}_$AE(g){this._$EO?.forEach(l=>l.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(g)),this.updated(g)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(g){return!0}update(g){this._$Eq&&(this._$Eq=this._$Eq.forEach(l=>this._$ET(l,this[l]))),this._$EM()}updated(g){}firstUpdated(g){}};Re.elementStyles=[],Re.shadowRootOptions={mode:"open"},Re[Ye("elementProperties")]=new Map,Re[Ye("finalized")]=new Map,ds?.({ReactiveElement:Re}),(De.reactiveElementVersions??(De.reactiveElementVersions=[])).push("2.1.1");var Ze=globalThis,mt=Ze.trustedTypes,vi=mt?mt.createPolicy("lit-html",{createHTML:T=>T}):void 0,qt="$lit$",ke=`lit$${Math.random().toFixed(9).slice(2)}$`,jt="?"+ke,us=`<${jt}>`,Fe=document,et=()=>Fe.createComment(""),tt=T=>T===null||typeof T!="object"&&typeof T!="function",Gt=Array.isArray,Si=T=>Gt(T)||typeof T?.[Symbol.iterator]=="function",zt=`[ 	
\f\r]`,Qe=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,mi=/-->/g,bi=/>/g,Oe=RegExp(`>|${zt}(?:([^\\s"'>=/]+)(${zt}*=${zt}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Ci=/'/g,yi=/"/g,xi=/^(?:script|style|textarea|title)$/i,Vt=T=>(g,...l)=>({_$litType$:T,strings:g,values:l}),Ce=Vt(1),Ns=Vt(2),Ws=Vt(3),He=Symbol.for("lit-noChange"),le=Symbol.for("lit-nothing"),wi=new WeakMap,$e=Fe.createTreeWalker(Fe,129);function Li(T,g){if(!Gt(T)||!T.hasOwnProperty("raw"))throw Error("invalid template strings array");return vi!==void 0?vi.createHTML(g):g}var Ai=(T,g)=>{let l=T.length-1,C=[],w,i=g===2?"<svg>":g===3?"<math>":"",p=Qe;for(let s=0;s<l;s++){let n=T[s],o,u,h=-1,_=0;for(;_<n.length&&(p.lastIndex=_,u=p.exec(n),u!==null);)_=p.lastIndex,p===Qe?u[1]==="!--"?p=mi:u[1]!==void 0?p=bi:u[2]!==void 0?(xi.test(u[2])&&(w=RegExp("</"+u[2],"g")),p=Oe):u[3]!==void 0&&(p=Oe):p===Oe?u[0]===">"?(p=w??Qe,h=-1):u[1]===void 0?h=-2:(h=p.lastIndex-u[2].length,o=u[1],p=u[3]===void 0?Oe:u[3]==='"'?yi:Ci):p===yi||p===Ci?p=Oe:p===mi||p===bi?p=Qe:(p=Oe,w=void 0);let t=p===Oe&&T[s+1].startsWith("/>")?" ":"";i+=p===Qe?n+us:h>=0?(C.push(o),n.slice(0,h)+qt+n.slice(h)+ke+t):n+ke+(h===-2?s:t)}return[Li(T,i+(T[l]||"<?>")+(g===2?"</svg>":g===3?"</math>":"")),C]},it=class T{constructor({strings:g,_$litType$:l},C){let w;this.parts=[];let i=0,p=0,s=g.length-1,n=this.parts,[o,u]=Ai(g,l);if(this.el=T.createElement(o,C),$e.currentNode=this.el.content,l===2||l===3){let h=this.el.content.firstChild;h.replaceWith(...h.childNodes)}for(;(w=$e.nextNode())!==null&&n.length<s;){if(w.nodeType===1){if(w.hasAttributes())for(let h of w.getAttributeNames())if(h.endsWith(qt)){let _=u[p++],t=w.getAttribute(h).split(ke),e=/([.?@])?(.*)/.exec(_);n.push({type:1,index:i,name:e[2],strings:t,ctor:e[1]==="."?Ct:e[1]==="?"?yt:e[1]==="@"?wt:Ne}),w.removeAttribute(h)}else h.startsWith(ke)&&(n.push({type:6,index:i}),w.removeAttribute(h));if(xi.test(w.tagName)){let h=w.textContent.split(ke),_=h.length-1;if(_>0){w.textContent=mt?mt.emptyScript:"";for(let t=0;t<_;t++)w.append(h[t],et()),$e.nextNode(),n.push({type:2,index:++i});w.append(h[_],et())}}}else if(w.nodeType===8)if(w.data===jt)n.push({type:2,index:i});else{let h=-1;for(;(h=w.data.indexOf(ke,h+1))!==-1;)n.push({type:7,index:i}),h+=ke.length-1}i++}}static createElement(g,l){let C=Fe.createElement("template");return C.innerHTML=g,C}};function Ue(T,g,l=T,C){if(g===He)return g;let w=C!==void 0?l._$Co?.[C]:l._$Cl,i=tt(g)?void 0:g._$litDirective$;return w?.constructor!==i&&(w?._$AO?.(!1),i===void 0?w=void 0:(w=new i(T),w._$AT(T,l,C)),C!==void 0?(l._$Co??(l._$Co=[]))[C]=w:l._$Cl=w),w!==void 0&&(g=Ue(T,w._$AS(T,g.values),w,C)),g}var bt=class{constructor(g,l){this._$AV=[],this._$AN=void 0,this._$AD=g,this._$AM=l}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(g){let{el:{content:l},parts:C}=this._$AD,w=(g?.creationScope??Fe).importNode(l,!0);$e.currentNode=w;let i=$e.nextNode(),p=0,s=0,n=C[0];for(;n!==void 0;){if(p===n.index){let o;n.type===2?o=new ze(i,i.nextSibling,this,g):n.type===1?o=new n.ctor(i,n.name,n.strings,this,g):n.type===6&&(o=new St(i,this,g)),this._$AV.push(o),n=C[++s]}p!==n?.index&&(i=$e.nextNode(),p++)}return $e.currentNode=Fe,w}p(g){let l=0;for(let C of this._$AV)C!==void 0&&(C.strings!==void 0?(C._$AI(g,C,l),l+=C.strings.length-2):C._$AI(g[l])),l++}},ze=class T{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(g,l,C,w){this.type=2,this._$AH=le,this._$AN=void 0,this._$AA=g,this._$AB=l,this._$AM=C,this.options=w,this._$Cv=w?.isConnected??!0}get parentNode(){let g=this._$AA.parentNode,l=this._$AM;return l!==void 0&&g?.nodeType===11&&(g=l.parentNode),g}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(g,l=this){g=Ue(this,g,l),tt(g)?g===le||g==null||g===""?(this._$AH!==le&&this._$AR(),this._$AH=le):g!==this._$AH&&g!==He&&this._(g):g._$litType$!==void 0?this.$(g):g.nodeType!==void 0?this.T(g):Si(g)?this.k(g):this._(g)}O(g){return this._$AA.parentNode.insertBefore(g,this._$AB)}T(g){this._$AH!==g&&(this._$AR(),this._$AH=this.O(g))}_(g){this._$AH!==le&&tt(this._$AH)?this._$AA.nextSibling.data=g:this.T(Fe.createTextNode(g)),this._$AH=g}$(g){let{values:l,_$litType$:C}=g,w=typeof C=="number"?this._$AC(g):(C.el===void 0&&(C.el=it.createElement(Li(C.h,C.h[0]),this.options)),C);if(this._$AH?._$AD===w)this._$AH.p(l);else{let i=new bt(w,this),p=i.u(this.options);i.p(l),this.T(p),this._$AH=i}}_$AC(g){let l=wi.get(g.strings);return l===void 0&&wi.set(g.strings,l=new it(g)),l}k(g){Gt(this._$AH)||(this._$AH=[],this._$AR());let l=this._$AH,C,w=0;for(let i of g)w===l.length?l.push(C=new T(this.O(et()),this.O(et()),this,this.options)):C=l[w],C._$AI(i),w++;w<l.length&&(this._$AR(C&&C._$AB.nextSibling,w),l.length=w)}_$AR(g=this._$AA.nextSibling,l){for(this._$AP?.(!1,!0,l);g!==this._$AB;){let C=g.nextSibling;g.remove(),g=C}}setConnected(g){this._$AM===void 0&&(this._$Cv=g,this._$AP?.(g))}},Ne=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(g,l,C,w,i){this.type=1,this._$AH=le,this._$AN=void 0,this.element=g,this.name=l,this._$AM=w,this.options=i,C.length>2||C[0]!==""||C[1]!==""?(this._$AH=Array(C.length-1).fill(new String),this.strings=C):this._$AH=le}_$AI(g,l=this,C,w){let i=this.strings,p=!1;if(i===void 0)g=Ue(this,g,l,0),p=!tt(g)||g!==this._$AH&&g!==He,p&&(this._$AH=g);else{let s=g,n,o;for(g=i[0],n=0;n<i.length-1;n++)o=Ue(this,s[C+n],l,n),o===He&&(o=this._$AH[n]),p||(p=!tt(o)||o!==this._$AH[n]),o===le?g=le:g!==le&&(g+=(o??"")+i[n+1]),this._$AH[n]=o}p&&!w&&this.j(g)}j(g){g===le?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,g??"")}},Ct=class extends Ne{constructor(){super(...arguments),this.type=3}j(g){this.element[this.name]=g===le?void 0:g}},yt=class extends Ne{constructor(){super(...arguments),this.type=4}j(g){this.element.toggleAttribute(this.name,!!g&&g!==le)}},wt=class extends Ne{constructor(g,l,C,w,i){super(g,l,C,w,i),this.type=5}_$AI(g,l=this){if((g=Ue(this,g,l,0)??le)===He)return;let C=this._$AH,w=g===le&&C!==le||g.capture!==C.capture||g.once!==C.once||g.passive!==C.passive,i=g!==le&&(C===le||w);w&&this.element.removeEventListener(this.name,this,C),i&&this.element.addEventListener(this.name,this,g),this._$AH=g}handleEvent(g){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,g):this._$AH.handleEvent(g)}},St=class{constructor(g,l,C){this.element=g,this.type=6,this._$AN=void 0,this._$AM=l,this.options=C}get _$AU(){return this._$AM._$AU}_$AI(g){Ue(this,g)}},Ei={M:qt,P:ke,A:jt,C:1,L:Ai,R:bt,D:Si,V:Ue,I:ze,H:Ne,N:yt,U:wt,B:Ct,F:St},fs=Ze.litHtmlPolyfillSupport;fs?.(it,ze),(Ze.litHtmlVersions??(Ze.litHtmlVersions=[])).push("3.3.1");var Mi=(T,g,l)=>{let C=l?.renderBefore??g,w=C._$litPart$;if(w===void 0){let i=l?.renderBefore??null;C._$litPart$=w=new ze(g.insertBefore(et(),i),i,void 0,l??{})}return w._$AI(T),w};var st=globalThis,be=class extends Re{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var l;let g=super.createRenderRoot();return(l=this.renderOptions).renderBefore??(l.renderBefore=g.firstChild),g}update(g){let l=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(g),this._$Do=Mi(l,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return He}};be._$litElement$=!0,be.finalized=!0,st.litElementHydrateSupport?.({LitElement:be});var _s=st.litElementPolyfillSupport;_s?.({LitElement:be});(st.litElementVersions??(st.litElementVersions=[])).push("4.2.1");var Be=T=>(g,l)=>{l!==void 0?l.addInitializer(()=>{customElements.define(T,g)}):customElements.define(T,g)};var gs={attribute:!0,type:String,converter:Je,reflect:!1,hasChanged:vt},ps=(T=gs,g,l)=>{let{kind:C,metadata:w}=l,i=globalThis.litPropertyMetadata.get(w);if(i===void 0&&globalThis.litPropertyMetadata.set(w,i=new Map),C==="setter"&&((T=Object.create(T)).wrapped=!0),i.set(l.name,T),C==="accessor"){let{name:p}=l;return{set(s){let n=g.get.call(this);g.set.call(this,s),this.requestUpdate(p,n,T)},init(s){return s!==void 0&&this.C(p,void 0,T,s),s}}}if(C==="setter"){let{name:p}=l;return function(s){let n=this[p];g.call(this,s),this.requestUpdate(p,n,T)}}throw Error("Unsupported decorator location: "+C)};function ne(T){return(g,l)=>typeof l=="object"?ps(T,g,l):((C,w,i)=>{let p=w.hasOwnProperty(i);return w.constructor.createProperty(i,C),p?Object.getOwnPropertyDescriptor(w,i):void 0})(T,g,l)}function he(T){return ne({...T,state:!0,attribute:!1})}var{I:Tr}=Ei;var Ti=T=>T.strings===void 0;var Ri={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},Kt=T=>(...g)=>({_$litDirective$:T,values:g}),Lt=class{constructor(g){}get _$AU(){return this._$AM._$AU}_$AT(g,l,C){this._$Ct=g,this._$AM=l,this._$Ci=C}_$AS(g,l){return this.update(g,l)}update(g,l){return this.render(...l)}};var rt=(T,g)=>{let l=T._$AN;if(l===void 0)return!1;for(let C of l)C._$AO?.(g,!1),rt(C,g);return!0},At=T=>{let g,l;do{if((g=T._$AM)===void 0)break;l=g._$AN,l.delete(T),T=g}while(l?.size===0)},ki=T=>{for(let g;g=T._$AM;T=g){let l=g._$AN;if(l===void 0)g._$AN=l=new Set;else if(l.has(T))break;l.add(T),bs(g)}};function vs(T){this._$AN!==void 0?(At(this),this._$AM=T,ki(this)):this._$AM=T}function ms(T,g=!1,l=0){let C=this._$AH,w=this._$AN;if(w!==void 0&&w.size!==0)if(g)if(Array.isArray(C))for(let i=l;i<C.length;i++)rt(C[i],!1),At(C[i]);else C!=null&&(rt(C,!1),At(C));else rt(this,T)}var bs=T=>{T.type==Ri.CHILD&&(T._$AP??(T._$AP=ms),T._$AQ??(T._$AQ=vs))},Et=class extends Lt{constructor(){super(...arguments),this._$AN=void 0}_$AT(g,l,C){super._$AT(g,l,C),ki(this),this.isConnected=g._$AU}_$AO(g,l=!0){g!==this.isConnected&&(this.isConnected=g,g?this.reconnected?.():this.disconnected?.()),l&&(rt(this,g),At(this))}setValue(g){if(Ti(this._$Ct))this._$Ct._$AI(g,this);else{let l=[...this._$Ct._$AH];l[this._$Ci]=g,this._$Ct._$AI(l,this,0)}}disconnected(){}reconnected(){}};var Mt=()=>new Yt,Yt=class{},Xt=new WeakMap,Tt=Kt(class extends Et{render(T){return le}update(T,[g]){let l=g!==this.G;return l&&this.G!==void 0&&this.rt(void 0),(l||this.lt!==this.ct)&&(this.G=g,this.ht=T.options?.host,this.rt(this.ct=T.element)),le}rt(T){if(this.isConnected||(T=void 0),typeof this.G=="function"){let g=this.ht??globalThis,l=Xt.get(g);l===void 0&&(l=new WeakMap,Xt.set(g,l)),l.get(this.G)!==void 0&&this.G.call(this.ht,void 0),l.set(this.G,T),T!==void 0&&this.G.call(this.ht,T)}else this.G.value=T}get lt(){return typeof this.G=="function"?Xt.get(this.ht??globalThis)?.get(this.G):this.G?.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}});var Xi=ft(Bi());var Pi="terminal-shortcut",Cs=[{pattern:/\bctrl\+([a-z])\b/gi,keySequence:T=>`ctrl_${T[1].toLowerCase()}`},{pattern:/\bctrl\+([0-9])\b/gi,keySequence:T=>`ctrl_${T[1]}`},{pattern:/\bctrl\+f([1-9]|1[0-2])\b/gi,keySequence:T=>`ctrl_f${T[1]}`},{pattern:/\bctrl\+shift\+([a-z])\b/gi,keySequence:T=>`ctrl_shift_${T[1].toLowerCase()}`},{pattern:/\balt\+([a-z])\b/gi,keySequence:T=>`alt_${T[1].toLowerCase()}`},{pattern:/\bcmd\+([a-z])\b/gi,keySequence:T=>`cmd_${T[1].toLowerCase()}`},{pattern:/\bf([1-9]|1[0-2])\b/gi,keySequence:T=>`f${T[1]}`},{pattern:/\besc\b/gi,keySequence:()=>"escape"},{pattern:/\bescape\b/gi,keySequence:()=>"escape"},{pattern:/\btab\b/gi,keySequence:()=>"tab"},{pattern:/\bshift\+tab\b/gi,keySequence:()=>"shift_tab"},{pattern:/\benter\b/gi,keySequence:()=>"enter"},{pattern:/\breturn\b/gi,keySequence:()=>"enter"},{pattern:/\bbackspace\b/gi,keySequence:()=>"backspace"},{pattern:/\bdelete\b/gi,keySequence:()=>"delete"},{pattern:/\bspace\b/gi,keySequence:()=>" "},{pattern:/\barrow\s+(up|down|left|right)\b/gi,keySequence:T=>`arrow_${T[1].toLowerCase()}`},{pattern:/\b(up|down|left|right)\s+arrow\b/gi,keySequence:T=>`arrow_${T[1].toLowerCase()}`},{pattern:/\bpage\s+(up|down)\b/gi,keySequence:T=>`page_${T[1].toLowerCase()}`},{pattern:/\b(home|end)\b/gi,keySequence:T=>T[1].toLowerCase()},{pattern:/\besc\s+to\s+(interrupt|quit|exit|cancel)\b/gi,keySequence:()=>"escape"},{pattern:/\bpress\s+esc\b/gi,keySequence:()=>"escape"},{pattern:/\bpress\s+enter\b/gi,keySequence:()=>"enter"},{pattern:/\bpress\s+tab\b/gi,keySequence:()=>"tab"},{pattern:/\bpress\s+ctrl\+([a-z])\b/gi,keySequence:T=>`ctrl_${T[1].toLowerCase()}`},{pattern:/\bctrl\+([a-z])\s+to\s+\w+/gi,keySequence:T=>`ctrl_${T[1].toLowerCase()}`},{pattern:/\bq\s+to\s+(quit|exit)\b/gi,keySequence:()=>"q"},{pattern:/\bpress\s+q\b/gi,keySequence:()=>"q"},{pattern:/❯\s*(\d+)\.\s+.*/g,keySequence:T=>T[1]},{pattern:/(\d+)\.\s+.*/g,keySequence:T=>T[1]}];function Ii(T,g){new Jt(T,g).process()}var Jt=class{constructor(g,l){this.processedRanges=new Map;this.container=g,this.lines=g.querySelectorAll(".terminal-line"),this.onShortcutClick=l}process(){if(this.lines.length!==0)for(let g=0;g<this.lines.length;g++)this.processLine(g)}processLine(g){let l=this.getLineText(g);if(!l)return;let C=this.findShortcutsInLine(l);for(let w of C)this.isRangeProcessed(g,w.start,w.end)||(this.createShortcutLink(w,g),this.markRangeAsProcessed(g,w.start,w.end))}findShortcutsInLine(g){let l=[];for(let w of Cs){w.pattern.lastIndex=0;let i=w.pattern.exec(g);for(;i!==null;){let p=i[0],s=w.keySequence(i),n=i.index,o=i.index+p.length;l.push({text:p,keySequence:s,start:n,end:o}),i=w.pattern.exec(g)}}l.sort((w,i)=>w.start-i.start);let C=[];for(let w of l)C.some(p=>w.start<p.end&&w.end>p.start)||C.push(w);return C}createShortcutLink(g,l){let C=this.lines[l];new Qt(C,g,this.onShortcutClick).createLink()}getLineText(g){return g<0||g>=this.lines.length?"":this.lines[g].textContent||""}isRangeProcessed(g,l,C){let w=this.processedRanges.get(g);return w?w.some(i=>l<i.end&&C>i.start):!1}markRangeAsProcessed(g,l,C){this.processedRanges.has(g)||this.processedRanges.set(g,[]);let w=this.processedRanges.get(g);w&&w.push({start:l,end:C})}},Qt=class{constructor(g,l,C){this.lineElement=g,this.shortcut=l,this.onShortcutClick=C}createLink(){this.wrapTextInLink(this.lineElement,this.shortcut.start,this.shortcut.end)}wrapTextInLink(g,l,C){let w=document.createTreeWalker(g,NodeFilter.SHOW_TEXT,null),i=[],p=0,s=w.nextNode();for(;s;){let n=s,o=n.textContent||"",u=p,h=p+o.length;h>l&&u<C&&i.push({node:n,start:u,end:h}),p=h,s=w.nextNode()}for(let n=i.length-1;n>=0;n--){let{node:o,start:u}=i[n],h=o.textContent||"",_=Math.max(0,l-u),t=Math.min(h.length,C-u);_<t&&this.wrapTextNode(o,_,t)}}wrapTextNode(g,l,C){let w=g.parentNode;if(!w||this.isInsideClickable(w))return;let i=g.textContent||"",p=i.substring(0,l),s=i.substring(l,C),n=i.substring(C),o=this.createShortcutElement(s),u=document.createDocumentFragment();p&&u.appendChild(document.createTextNode(p)),u.appendChild(o),n&&u.appendChild(document.createTextNode(n)),w.replaceChild(u,g)}createShortcutElement(g){let l=document.createElement("span");return l.className=Pi,l.style.color="#9ca3af",l.style.textDecoration="underline",l.style.textDecorationStyle="dotted",l.style.cursor="pointer",l.style.fontWeight="500",l.textContent=g,l.addEventListener("click",C=>{C.preventDefault(),C.stopPropagation(),this.onShortcutClick(this.shortcut.keySequence)}),l.addEventListener("mouseenter",()=>{l.style.backgroundColor="rgba(156, 163, 175, 0.2)",l.style.color="#d1d5db"}),l.addEventListener("mouseleave",()=>{l.style.backgroundColor="",l.style.color="#9ca3af"}),l.title=`Click to send: ${this.shortcut.keySequence}`,l}isInsideClickable(g){let l=g;for(;l&&l!==document.body;){if(l.tagName==="A"&&l.classList.contains("terminal-link")||l.tagName==="SPAN"&&l.classList.contains(Pi))return!0;l=l.parentElement}return!1}};qe();qe();function Hi(){return/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)||!!navigator.maxTouchPoints&&navigator.maxTouchPoints>1}var je=Ae("terminal-preferences");var ei={maxCols:0,fontSize:Hi()?12:14,fitHorizontally:!1,theme:"dracula"},Ui="tunnelforge_terminal_preferences",ot=class T{constructor(){this.preferences=this.loadPreferences()}static getInstance(){return T.instance||(T.instance=new T),T.instance}loadPreferences(){try{let g=localStorage.getItem(Ui);if(g){let l=JSON.parse(g),C={...ei,...l};return je.debug("Loaded terminal preferences:",C),C}}catch(g){je.warn("Failed to load terminal preferences",{error:g})}return je.debug("Using default terminal preferences"),{...ei}}savePreferences(){try{let g=JSON.stringify(this.preferences);localStorage.setItem(Ui,g),je.debug("Saved terminal preferences to localStorage")}catch(g){je.warn("Failed to save terminal preferences",{error:g})}}getMaxCols(){return this.preferences.maxCols}setMaxCols(g){this.preferences.maxCols=Math.max(0,g),this.savePreferences()}getFontSize(){return this.preferences.fontSize}setFontSize(g){this.preferences.fontSize=Math.max(8,Math.min(32,g)),this.savePreferences()}getFitHorizontally(){return this.preferences.fitHorizontally}setFitHorizontally(g){this.preferences.fitHorizontally=g,this.savePreferences()}getTheme(){return this.preferences.theme}setTheme(g){je.debug("Setting terminal theme:",g),this.preferences.theme=g,this.savePreferences()}getPreferences(){return{...this.preferences}}resetToDefaults(){this.preferences={...ei},this.savePreferences()}};var ti=[{id:"auto",name:"Auto",description:"Follow system theme",colors:{}},{id:"dark",name:"Dark",description:"TunnelForge default dark",colors:{background:"#1e1e1e",foreground:"#d4d4d4",cursor:"rgb(var(--color-primary))",cursorAccent:"#1e1e1e",black:"#000000",red:"#cd0000",green:"#00cd00",yellow:"#cdcd00",blue:"#0000ee",magenta:"#cd00cd",cyan:"#00cdcd",white:"#e5e5e5",brightBlack:"#7f7f7f",brightRed:"#ff0000",brightGreen:"#00ff00",brightYellow:"#ffff00",brightBlue:"#5c5cff",brightMagenta:"#ff00ff",brightCyan:"#00ffff",brightWhite:"#ffffff"}},{id:"light",name:"Light",description:"Soft light theme",colors:{background:"#f8f9fa",foreground:"#1f2328",cursor:"rgb(var(--color-primary))",cursorAccent:"#f8f9fa",black:"#24292f",red:"#cf222e",green:"#1a7f37",yellow:"#9a6700",blue:"#0969da",magenta:"#8250df",cyan:"#1b7c83",white:"#6e7781",brightBlack:"#57606a",brightRed:"#da3633",brightGreen:"#2da44e",brightYellow:"#bf8700",brightBlue:"#218bff",brightMagenta:"#a475f9",brightCyan:"#3192aa",brightWhite:"#8c959f",selectionBackground:"#0969da",selectionForeground:"#ffffff",selectionInactiveBackground:"#e1e4e8"}},{id:"vscode-dark",name:"VS Code Dark",description:"Popular theme from Visual Studio Code",colors:{background:"#1E1E1E",foreground:"#D4D4D4",cursor:"#AEAFAD",cursorAccent:"#1E1E1E",black:"#000000",red:"#CD3131",green:"#0DBC79",yellow:"#E5E510",blue:"#2472C8",magenta:"#BC3FBC",cyan:"#11A8CD",white:"#E5E5E5",brightBlack:"#666666",brightRed:"#F14C4C",brightGreen:"#23D18B",brightYellow:"#F5F543",brightBlue:"#3B8EEA",brightMagenta:"#D670D6",brightCyan:"#29B8DB",brightWhite:"#FFFFFF"}},{id:"dracula",name:"Dracula",description:"Classic dark theme",colors:{background:"#282A36",foreground:"#F8F8F2",cursor:"#F8F8F2",cursorAccent:"#282A36",black:"#21222C",red:"#FF5555",green:"#50FA7B",yellow:"#F1FA8C",blue:"#BD93F9",magenta:"#FF79C6",cyan:"#8BE9FD",white:"#F8F8F2",brightBlack:"#6272A4",brightRed:"#FF6E6E",brightGreen:"#69FF94",brightYellow:"#FFFFA5",brightBlue:"#D6ACFF",brightMagenta:"#FF92DF",brightCyan:"#A4FFFF",brightWhite:"#FFFFFF"}},{id:"nord",name:"Nord",description:"Arctic north-bluish palette",colors:{background:"#2E3440",foreground:"#D8DEE9",cursor:"#D8DEE9",cursorAccent:"#2E3440",black:"#3B4252",red:"#BF616A",green:"#A3BE8C",yellow:"#EBCB8B",blue:"#81A1C1",magenta:"#B48EAD",cyan:"#88C0D0",white:"#E5E9F0",brightBlack:"#4C566A",brightRed:"#BF616A",brightGreen:"#A3BE8C",brightYellow:"#EBCB8B",brightBlue:"#81A1C1",brightMagenta:"#B48EAD",brightCyan:"#8FBCBB",brightWhite:"#ECEFF4"}}];function ii(){let T=document.documentElement.getAttribute("data-theme");return T==="dark"?"dark":T==="light"?"light":window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function si(){return ii()==="dark"}var Ms=["https://","http://","file://"],Ni="terminal-link",Bt=/https?:\/\/|file:\/\//g,Ts=/(^|\s)(h|ht|htt|http|https|https:|https:\/|https:\/\/|f|fi|fil|file|file:|file:\/|file:\/\/)$/,ri=/^[a-zA-Z0-9[\].-]/,Rs=/^[/a-zA-Z0-9[\].-]/,Wi=/[^\w\-._~:/?#[\]@!$&'()*+,;=%{}|\\^`]/,ks=/^(https?:\/\/(localhost|[\d.]+|\[[\da-fA-F:]+\]|(([a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?\.)*[a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?\.[a-zA-Z]+))(:\d+)?.*|file:\/\/.+)/,Ds=/^[a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?$/;function Bs(T){new ni(T).process()}var ni=class{constructor(g){this.processedRanges=new Map;this.container=g,this.lines=g.querySelectorAll(".terminal-line")}process(){if(this.lines.length!==0)for(let g=0;g<this.lines.length;g++)this.processLine(g)}processLine(g){g>0&&this.checkPreviousLineContinuation(g),this.findUrlsInLine(g)}checkPreviousLineContinuation(g){let l=this.getLineText(g),C=this.getLineText(g-1),w=this.findIncompleteUrlAtLineEnd(C,l);if(w){let{startPos:i}=w,p=this.buildMultiLineUrl(g-1,i);p&&this.isValidUrl(p.url)&&(this.isRangeProcessed(g-1,i,p.endLine)||(this.createUrlLinks(p.url,g-1,p.endLine,i),this.markRangeAsProcessed(g-1,p.endLine,i,p.url)))}}findIncompleteUrlAtLineEnd(g,l){for(let w of Ms){let i=g.lastIndexOf(w);if(i>=0&&g.endsWith(w)&&ri.test(l.trimStart()))return{startPos:i,protocol:w}}let C=g.match(Ts);if(C){let w=C[2],i=(C.index??0)+(C[1]?1:0);if(this.isValidContinuation(w,l))return{startPos:i,protocol:w}}return null}isValidContinuation(g,l){let C=l.trimStart();if(g==="https://"||g==="file://")return ri.test(C);if(g.endsWith("/"))return Rs.test(C);let w=g+C;return/^(https?:\/\/|file:\/\/)/.test(w)}isValidUrlContinuation(g,l){let C=l.trimStart();if(!C)return!1;if(!g.includes("://")){let i=g+C;return/^(https?:|file:|https?:\/|file:\/|https?:\/\/|file:\/\/)/.test(i)}if(g.match(/(https?:|file:)\/\/$/))return ri.test(C);if(/^(and|or|but|the|is|are|was|were|been|have|has|had|will|would|could|should|may|might|check|visit|go|see|click|open|navigate)\b/i.test(C)||/^[!?;]/.test(C)||/^\.(\s|$)/.test(C))return!1;let w=C.split(/\s/)[0];return/[/:._-]/.test(w)?!0:/^[a-zA-Z]+$/.test(w)&&w.length>2?!/^(next|line|with|text|this|that|then|when|where|which|while|after|before|during|since|until|above|below|between|into|through|under|over|about|against|among|around|behind|beside|beyond|inside|outside|toward|within|without|according|although|because|however|therefore|moreover|nevertheless|furthermore|otherwise|meanwhile|indeed|instead|likewise|similarly|specifically|subsequently|ultimately|additionally|consequently|eventually|finally|initially|particularly|previously|recently|suddenly|usually)/i.test(w):/^[a-zA-Z0-9._~:/?#[\]@!$&'()*+,;=%-]/.test(C)}findUrlsInLine(g){let l=this.getLineText(g);Bt.lastIndex=0;let C=Bt.exec(l);for(;C!==null;){let w=C.index;if(this.isPositionProcessed(g,w)){C=Bt.exec(l);continue}let i=this.buildMultiLineUrl(g,w);i&&this.isValidUrl(i.url)&&(this.createUrlLinks(i.url,g,i.endLine,w),this.markRangeAsProcessed(g,i.endLine,w,i.url)),C=Bt.exec(l)}}buildMultiLineUrl(g,l){let C="",w=g;for(let i=g;i<this.lines.length;i++){let p=this.getLineText(i),s;if(i===g)s=p.substring(l);else{let o=C;if(!this.isValidUrlContinuation(o,p)){w=i-1;break}if(s=p.trimStart(),!s){w=i-1;break}}let n=this.findUrlEndInText(s);if(n>=0){C+=s.substring(0,n),w=i;break}else if(C+=s,w=i,i===this.lines.length-1)break}return{url:this.cleanUrl(C),endLine:w}}findUrlEndInText(g){let l=g.search(/\s/);if(l>=0)return l;let C=g.match(Wi);return C&&C.index!==void 0?C.index:-1}createUrlLinks(g,l,C,w){new oi(this.lines,g).createLinks(l,C,w)}getLineText(g){return g<0||g>=this.lines.length?"":this.lines[g].textContent||""}isValidUrl(g){if(g.length<7||g.length>2048||/[\n\r\t]/.test(g)||!ks.test(g))return!1;try{let l=new URL(g);if(!["http:","https:","file:"].includes(l.protocol))return!1;if(l.protocol==="http:"||l.protocol==="https:"){let C=l.hostname;if(C==="localhost"||/^[\d.]+$/.test(C)||C.startsWith("["))return!0;let w=C.split(".");if(w.length<2)return!1;for(let p=0;p<w.length;p++)if(!Ds.test(w[p]))return!1;let i=w[w.length-1];if(!/[a-zA-Z]/.test(i))return!1}return!0}catch{return!1}}cleanUrl(g){let l=g,C=(l.match(/\(/g)||[]).length,w=(l.match(/\)/g)||[]).length;if(w>C){let i=w-C;l=l.replace(/\)+$/,p=>p.substring(0,p.length-i))}return l=l.replace(/[.,;:!?]+$/,""),l}isRangeProcessed(g,l,C){for(let w=g;w<=C;w++)if(this.isPositionProcessed(w,w===g?l:0))return!0;return!1}isPositionProcessed(g,l){let C=this.processedRanges.get(g);return C?C.some(w=>l>=w.start&&l<w.end):!1}markRangeAsProcessed(g,l,C,w){let i=w,p=g;for(;p<=l&&i.length>0;){let s=this.getLineText(p);this.processedRanges.has(p)||this.processedRanges.set(p,[]);let n=this.processedRanges.get(p);if(!n)continue;let o,u;if(p===g){o=C;let h=s.substring(C),_=Math.min(h.length,i.length);u=C+_}else{let h=s.match(/^\s*/);o=h?h[0].length:0;let _=s.substring(o),t=Math.min(_.length,i.length);if(p===l){let e=_.substring(0,t).search(Wi);e>=0&&(t=e)}u=o+t}n.push({start:o,end:u}),i=i.substring(u-o),p++}}},oi=class{constructor(g,l){this.lines=g,this.url=l}createLinks(g,l,C){let w=this.url;for(let i=g;i<=l;i++){let p=this.lines[i],s=p.textContent||"",n,o;if(i===g){n=C;let u=s.substring(C);o=C+Math.min(u.length,w.length)}else{let u=s.match(/^\s*/);n=u?u[0].length:0;let h=s.substring(n),_=Math.min(h.length,w.length),t=h.match(/[\s<>"'`]/),e=t?Math.min(t.index??_,_):_;o=n+e}if(n<o&&(this.wrapTextInLink(p,n,o),w=w.substring(o-n)),w.length===0)break}}wrapTextInLink(g,l,C){let w=document.createTreeWalker(g,NodeFilter.SHOW_TEXT,null),i=[],p=0,s=w.nextNode();for(;s;){let n=s,o=n.textContent||"",u=p,h=p+o.length;h>l&&u<C&&i.push({node:n,start:u,end:h}),p=h,s=w.nextNode()}for(let n=i.length-1;n>=0;n--){let{node:o,start:u}=i[n],h=o.textContent||"",_=Math.max(0,l-u),t=Math.min(h.length,C-u);_<t&&this.wrapTextNode(o,_,t)}}wrapTextNode(g,l,C){let w=g.parentNode;if(!w||this.isInsideLink(w))return;let i=g.textContent||"",p=i.substring(0,l),s=i.substring(l,C),n=i.substring(C),o=this.createLinkElement(s),u=document.createDocumentFragment();p&&u.appendChild(document.createTextNode(p)),u.appendChild(o),n&&u.appendChild(document.createTextNode(n)),w.replaceChild(u,g)}createLinkElement(g){let l=document.createElement("a");return l.className=Ni,l.href=this.url,l.target="_blank",l.rel="noopener noreferrer",l.style.color="#4fc3f7",l.style.textDecoration="underline",l.style.cursor="pointer",l.textContent=g,l.addEventListener("mouseenter",()=>{l.style.backgroundColor="rgba(79, 195, 247, 0.2)"}),l.addEventListener("mouseleave",()=>{l.style.backgroundColor=""}),l}isInsideLink(g){let l=g;for(;l&&l!==document.body;){if(l.tagName==="A"&&l.classList.contains(Ni))return!0;l=l.parentElement}return!1}},zi={processLinks:Bs};var at=null,$t=null,Ki=null,z=Ae("terminal"),de=class extends be{constructor(){super(...arguments);this.sessionId="";this.sessionStatus="running";this.cols=80;this.rows=24;this.fontSize=14;this.fitHorizontally=!1;this.maxCols=0;this.theme="auto";this.disableClick=!1;this.hideScrollButton=!1;this.initialCols=0;this.initialRows=0;this.originalFontSize=14;this.userOverrideWidth=!1;this.terminal=null;this._viewportY=0;this.followCursorEnabled=!0;this.programmaticScroll=!1;this.debugMode=!1;this.renderCount=0;this.totalRenderTime=0;this.lastRenderTime=0;this.actualRows=24;this.cursorVisible=!0;this.container=null;this.explicitSizeSet=!1;this.renderPending=!1;this.momentumVelocityY=0;this.momentumVelocityX=0;this.momentumAnimation=null;this.resizeObserver=null;this.mobileWidthResizeComplete=!1;this.pendingResize=null;this.lastCols=0;this.lastRows=0;this.isMobile=!1;this.mobileInitialResizeTimeout=null;this.operationQueue=[];this.handleScrollToBottom=()=>{this.followCursorEnabled=!0,this.scrollToBottom(),this.requestUpdate()};this.handleFitToggle=()=>{if(!this.terminal||!this.container){this.fitHorizontally=!this.fitHorizontally,this.requestUpdate();return}let l=this.terminal.buffer.active,C=this.fontSize*1.2,w=C>0?this.viewportY/C:0,i=this.isScrolledToBottom();if(this.fitHorizontally||(this.originalFontSize=this.fontSize),this.fitHorizontally=!this.fitHorizontally,this.fitHorizontally||(this.fontSize=this.originalFontSize),this.requestResize("fit-mode-change"),i)this.scrollToBottom();else{let p=this.fontSize*1.2,s=Math.max(0,(l.length-this.actualRows)*p),n=w*p;this.viewportY=Math.max(0,Math.min(s,n))}this.requestUpdate()};this.handlePaste=async l=>{l.preventDefault(),l.stopPropagation();let C=l.clipboardData?.getData("text/plain");if(!C&&navigator.clipboard)try{C=await navigator.clipboard.readText()}catch(w){z.error("Failed to read clipboard via navigator API",w)}C&&this.dispatchEvent(new CustomEvent("terminal-paste",{detail:{text:C},bubbles:!0}))};this.handleClick=()=>{this.disableClick||this.container&&this.container.focus()};this.handleShortcutClick=l=>{this.dispatchEvent(new CustomEvent("terminal-input",{detail:{text:l},bubbles:!0}))}}createRenderRoot(){return this}get viewportY(){return this._viewportY}set viewportY(l){this._viewportY=l}queueRenderOperation(l){this.operationQueue.push(l),this.renderPending||(this.renderPending=!0,requestAnimationFrame(()=>{this.processOperationQueue().then(()=>{this.operationQueue.length===0&&(this.renderPending=!1)})}))}requestRenderBuffer(){z.debug("Requesting render buffer update"),this.queueRenderOperation(()=>{z.debug("Executing render operation"),this.renderBuffer()})}async processOperationQueue(){let l=performance.now(),C=8;for(;this.operationQueue.length>0;){let w=this.operationQueue.shift();if(w&&await w(),performance.now()-l>C&&this.operationQueue.length>0){await new Promise(i=>{requestAnimationFrame(()=>{this.processOperationQueue().then(i)})});return}}this.renderBuffer(),this.operationQueue.length===0&&(this.renderPending=!1)}connectedCallback(){let l=ot.getInstance();if(this.theme=l.getTheme(),super.connectedCallback(),this.debugMode=new URLSearchParams(window.location.search).has("debug"),this.themeObserver=new MutationObserver(()=>{this.terminal&&this.theme==="auto"?(z.debug("Auto theme detected system change, updating terminal"),this.terminal.options.theme=this.getTerminalTheme(),this.updateTerminalColorProperties(this.getTerminalTheme()),this.requestRenderBuffer()):this.theme!=="auto"&&z.debug("Ignoring system theme change - explicit theme selected:",this.theme)}),this.themeObserver.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),this.sessionId)try{let C=localStorage.getItem(`terminal-width-override-${this.sessionId}`);C!==null&&(this.userOverrideWidth=C==="true")}catch(C){z.warn("Failed to load terminal width preference from localStorage:",C)}}updated(l){if(l.has("sessionId")&&this.sessionId)try{let C=localStorage.getItem(`terminal-width-override-${this.sessionId}`);C!==null&&(this.userOverrideWidth=C==="true",this.container&&this.requestResize("property-change"))}catch(C){z.warn("Failed to load terminal width preference from localStorage:",C)}if((l.has("cols")||l.has("rows"))&&(this.terminal&&!this.explicitSizeSet&&this.reinitializeTerminal(),this.explicitSizeSet=!1),l.has("fontSize")&&(this.fitHorizontally||(this.originalFontSize=this.fontSize),this.terminal&&this.container&&this.requestResize("property-change")),l.has("fitHorizontally")&&(this.fitHorizontally||(this.fontSize=this.originalFontSize),this.requestResize("property-change")),l.has("maxCols")&&this.terminal&&this.container&&this.requestResize("property-change"),l.has("theme"))if(z.debug("Terminal theme changed to:",this.theme),this.terminal?.options){let C=this.getTerminalTheme();z.debug("Applying terminal theme:",this.theme),this.terminal.options.theme=C,this.updateTerminalColorProperties(C),this.container&&(this.container.innerHTML=""),this.requestRenderBuffer()}else z.warn("No terminal instance found for theme update")}disconnectedCallback(){this.cleanup(),this.themeObserver&&this.themeObserver.disconnect(),super.disconnectedCallback()}setUserOverrideWidth(l){if(this.userOverrideWidth=l,this.isMobile&&l&&(this.mobileWidthResizeComplete=!1,z.debug("[Terminal] Mobile: Resetting width resize block for user-initiated change")),this.sessionId)try{localStorage.setItem(`terminal-width-override-${this.sessionId}`,String(l))}catch(C){z.warn("Failed to save terminal width preference to localStorage:",C)}this.container&&this.requestResize("property-change")}cleanup(){this.momentumAnimation&&(cancelAnimationFrame(this.momentumAnimation),this.momentumAnimation=null),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.pendingResize&&(cancelAnimationFrame(this.pendingResize),this.pendingResize=null),this.mobileInitialResizeTimeout&&(clearTimeout(this.mobileInitialResizeTimeout),this.mobileInitialResizeTimeout=null),this.terminal&&(this.terminal.dispose(),this.terminal=null)}firstUpdated(){this.originalFontSize=this.fontSize,this.initializeTerminal()}requestResize(l){this.isMobile=window.innerWidth<768,z.debug(`[Terminal] Resize requested from ${l} (mobile: ${this.isMobile}, width: ${window.innerWidth})`),this.pendingResize&&cancelAnimationFrame(this.pendingResize),this.pendingResize=requestAnimationFrame(()=>{this.fitTerminal(l),this.pendingResize=null})}shouldResize(l,C){if(this.isMobile&&this.mobileWidthResizeComplete&&!this.userOverrideWidth){let i=this.lastCols!==l,p=this.lastRows!==C;return i?(z.debug("[Terminal] Preventing WIDTH resize on mobile (width already set)"),!1):p?(z.debug(`[Terminal] Allowing HEIGHT resize on mobile: ${this.lastRows} \u2192 ${C} rows`),this.lastRows=C,!0):!1}let w=this.lastCols!==l||this.lastRows!==C;return w&&(z.debug(`[Terminal] Dimensions changed: ${this.lastCols}x${this.lastRows} \u2192 ${l}x${C}`),this.lastCols=l,this.lastRows=C,this.isMobile&&!this.mobileWidthResizeComplete&&(this.mobileWidthResizeComplete=!0,z.debug("[Terminal] Mobile WIDTH resize complete - blocking future width changes"))),w}getTerminalTheme(){let l=this.theme;return l==="auto"&&(l=ii()),{...(ti.find(w=>w.id===l)||ti[0]).colors}}updateTerminalColorProperties(l){z.debug("Updating terminal CSS color properties"),Object.entries({black:0,red:1,green:2,yellow:3,blue:4,magenta:5,cyan:6,white:7,brightBlack:8,brightRed:9,brightGreen:10,brightYellow:11,brightBlue:12,brightMagenta:13,brightCyan:14,brightWhite:15}).forEach(([w,i])=>{if(l[w]){let p=`--terminal-color-${i}`;document.documentElement.style.setProperty(p,l[w]),z.debug(`Set CSS property ${p}:`,l[w])}}),l.foreground&&(document.documentElement.style.setProperty("--terminal-foreground",l.foreground),z.debug("Set terminal foreground color:",l.foreground)),l.background&&(document.documentElement.style.setProperty("--terminal-background",l.background),z.debug("Set terminal background color:",l.background)),z.debug("CSS terminal color properties updated")}async initializeTerminal(){try{if(z.debug("initializeTerminal starting"),this.requestUpdate(),this.container=this.querySelector("#terminal-container"),!this.container){let l=new Error("Terminal container not found");throw z.error("terminal container not found",l),l}z.debug("Terminal container found, proceeding with setup"),await this.setupTerminal(),this.setupResize(),this.setupScrolling(),this.viewportY=0,this.terminal&&this.terminal.scrollToTop(),this.requestUpdate()}catch(l){z.error("failed to initialize terminal:",l),this.requestUpdate()}}async reinitializeTerminal(){if(this.terminal){this.container&&this.container.offsetHeight;let l=Number.isFinite(this.cols)?Math.floor(this.cols):80,C=Number.isFinite(this.rows)?Math.floor(this.rows):24;this.terminal.resize(l,C),this.requestResize("property-change")}}async setupTerminal(){try{let l=ot.getInstance(),C=this.getOptimizedScrollback(),w=this.getOptimizedFontSize();w!==this.fontSize&&(this.fontSize=w,z.debug(`[Terminal] Applied optimized font size: ${w}px`));let i=this.getMobileCapabilities();this.terminal=new Xi.Terminal({cursorBlink:!0,cursorStyle:"block",cursorWidth:1,lineHeight:1.2,letterSpacing:0,scrollback:C,allowProposedApi:!0,allowTransparency:!1,convertEol:!0,drawBoldTextInBrightColors:!0,minimumContrastRatio:i.isLowEnd?1.5:1,macOptionIsMeta:!0,altClickMovesCursor:!0,rightClickSelectsWord:!1,wordSeparator:" ()[]{}'\"`",theme:this.getTerminalTheme()}),await this.loadPerformanceAddons(),this.terminal.resize(this.cols,this.rows),this.requestRenderBuffer()}catch(l){throw z.error("failed to create terminal:",l),l}}measureCharacterWidth(){if(!this.container)return 8;let l=document.createElement("div");l.className="terminal-line",l.style.position="absolute",l.style.visibility="hidden",l.style.top="0",l.style.left="0",l.style.fontSize=`${this.fontSize}px`,l.style.fontFamily="Hack Nerd Font Mono, Fira Code, monospace";let C="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+-=[]{}|;:,.<>?",w=Math.ceil(this.cols/C.length),i=C.repeat(w).substring(0,this.cols);l.textContent=i,this.container.appendChild(l);let s=l.getBoundingClientRect().width/this.cols;return this.container.removeChild(l),Number.isFinite(s)&&s>0?s:8}fitTerminal(l){if(!this.terminal||!this.container){z.warn("[Terminal] Cannot fit terminal: terminal or container not initialized");return}let C=Date.now(),w=this._lastFitTime?C-this._lastFitTime:0;if(this._lastFitTime=C,z.debug("[Terminal] \u{1F4F1} fitTerminal called",{source:l||"unknown",isMobile:this.isMobile,windowWidth:window.innerWidth,timeSinceLastFit:w,cols:this.cols,rows:this.rows,actualRows:this.actualRows,bufferLength:this.terminal.buffer.active.length}),this.isMobile&&z.debug(`[Terminal] Mobile detected in fitTerminal - source: ${l}, userAgent: ${navigator.userAgent}`),!this.fitHorizontally){let o=this.getOptimizedFontSize();o!==this.fontSize&&(this.fontSize=o,z.debug(`[Terminal] fitTerminal applied optimized font size: ${o}px`))}let i=this.actualRows,p=this.fontSize*1.2,s=this.isScrolledToBottom(),n=p>0?this.viewportY/p:0;if(this.fitHorizontally){let o=this.container.clientWidth,u=this.container.clientHeight,h=o/this.cols,_=this.measureCharacterWidth(),t=h/_,e=this.fontSize*t,v=Math.max(4,Math.min(32,e));this.fontSize=v;let r=this.fontSize*1.2,a=Math.max(1,Math.floor(u/r));if(this.actualRows=a,this.rows=a,this.terminal){let f=Number.isFinite(this.cols)?Math.floor(this.cols):80,d=Number.isFinite(this.rows)?Math.floor(this.rows):24,c=this.lastCols,b=this.lastRows;if(this.shouldResize(f,d)){z.debug(`Resizing terminal (${l||"unknown"}): ${f}x${d}`),this.terminal.resize(f,d);let y=!(f!==c)&&d!==b;this.dispatchEvent(new CustomEvent("terminal-resize",{detail:{cols:f,rows:d,isMobile:this.isMobile,isHeightOnlyChange:y,source:l||"unknown"},bubbles:!0}))}else z.debug(`Skipping resize (${l||"unknown"}): dimensions unchanged`)}}else{let o=this.container.clientWidth||800,u=this.container.clientHeight||600,h=this.fontSize*1.2,_=this.measureCharacterWidth(),t=Number.isFinite(_)&&_>0?_:8,e=Math.max(20,Math.floor(o/t))-1,v=this.sessionId.startsWith("fwd_");if(this.maxCols>0?this.cols=Math.min(e,this.maxCols):this.userOverrideWidth?this.cols=e:this.initialCols>0&&v?this.cols=Math.min(e,this.initialCols):this.cols=e,this.rows=Math.max(6,Math.floor(u/h)),this.actualRows=this.rows,this.terminal){let r=Number.isFinite(this.cols)?Math.floor(this.cols):80,a=Number.isFinite(this.rows)?Math.floor(this.rows):24,f=this.lastCols,d=this.lastRows;if(this.shouldResize(r,a)){z.debug(`Resizing terminal (${l||"unknown"}): ${r}x${a}`),this.terminal.resize(r,a);let b=!(r!==f)&&a!==d;this.dispatchEvent(new CustomEvent("terminal-resize",{detail:{cols:r,rows:a,isMobile:this.isMobile,isHeightOnlyChange:b,source:l||"unknown"},bubbles:!0}))}else z.debug(`Skipping resize (${l||"unknown"}): dimensions unchanged`)}}if(this.terminal){let o=this.terminal.buffer.active,u=this.fontSize*1.2,h=Math.max(0,(o.length-this.actualRows)*u);if(s)this.viewportY=h;else{let _=n*u,t=Math.max(0,Math.min(h,_));this.viewportY=t}}this.requestRenderBuffer(),this.requestUpdate()}setupResize(){if(!this.container)return;let l=768;this.isMobile=window.innerWidth<l,z.debug(`[Terminal] Setting up resize - isMobile: ${this.isMobile}, width: ${window.innerWidth}, userAgent: ${navigator.userAgent}`),this.isMobile?(z.debug("[Terminal] Mobile detected - scheduling initial resize in 200ms"),this.mobileInitialResizeTimeout=setTimeout(()=>{z.debug("[Terminal] Mobile: Executing initial resize"),this.fitTerminal("initial-mobile-only"),z.debug("[Terminal] Mobile: Initial width set, future WIDTH resizes blocked (height allowed for keyboard)"),this.mobileInitialResizeTimeout=null},200)):(z.debug("[Terminal] Desktop detected - setting up resize observers"),this.resizeObserver=new ResizeObserver(()=>{z.debug("[Terminal] ResizeObserver triggered"),this.requestResize("ResizeObserver")}),this.resizeObserver.observe(this.container),window.addEventListener("resize",()=>{z.debug("[Terminal] Window resize event triggered"),this.requestResize("window-resize")}),z.debug("[Terminal] Desktop: Requesting initial resize"),this.requestResize("initial-desktop"))}setupScrolling(){if(!this.container)return;this.container.addEventListener("wheel",u=>{u.preventDefault();let h=this.fontSize*1.2,_=0,t=0;switch(u.deltaMode){case WheelEvent.DOM_DELTA_PIXEL:_=u.deltaY,t=u.deltaX;break;case WheelEvent.DOM_DELTA_LINE:_=u.deltaY*h,t=u.deltaX*h;break;case WheelEvent.DOM_DELTA_PAGE:_=u.deltaY*(this.actualRows*h),t=u.deltaX*(this.actualRows*h);break}let e=.5;_*=e,t*=e,Math.abs(_)>0&&this.scrollViewportPixels(_),Math.abs(t)>0&&!this.fitHorizontally&&this.container&&(this.container.scrollLeft+=t)},{passive:!1});let l=!1,C=0,w=0,i=[],p=u=>{u.pointerType!=="touch"||!u.isPrimary||(this.momentumAnimation&&(cancelAnimationFrame(this.momentumAnimation),this.momentumAnimation=null),l=!1,C=u.clientY,w=u.clientX,i=[{y:u.clientY,x:u.clientX,time:performance.now()}],this.container?.setPointerCapture(u.pointerId))},s=u=>{if(u.pointerType!=="touch"||!this.container?.hasPointerCapture(u.pointerId))return;let h=u.clientY,_=u.clientX,t=C-h,e=w-_,v=performance.now();i.push({y:h,x:_,time:v}),i.length>5&&i.shift(),!l&&(Math.abs(t)>5||Math.abs(e)>5)&&(l=!0),l&&(Math.abs(t)>0&&(this.scrollViewportPixels(t),C=h),Math.abs(e)>0&&!this.fitHorizontally&&(this.container.scrollLeft+=e,w=_))},n=u=>{if(u.pointerType==="touch"){if(l&&i.length>=2){let h=performance.now(),_=i[i.length-1],t=i[i.length-2],e=h-t.time,v=_.y-t.y,r=_.x-t.x,a=e>0?-v/e:0,f=e>0?-r/e:0,d=.3;(Math.abs(a)>d||Math.abs(f)>d)&&this.startMomentum(a,f)}this.container?.releasePointerCapture(u.pointerId)}},o=u=>{u.pointerType==="touch"&&this.container?.releasePointerCapture(u.pointerId)};this.container.addEventListener("pointerdown",p),this.container.addEventListener("pointermove",s),this.container.addEventListener("pointerup",n),this.container.addEventListener("pointercancel",o)}scrollViewportPixels(l){if(!this.terminal)return;let C=this.terminal.buffer.active,w=this.fontSize*1.2,i=Math.max(0,(C.length-this.actualRows)*w),p=Math.max(0,Math.min(i,this.viewportY+l));p!==this.viewportY&&(this.viewportY=p,this.updateFollowCursorState(),this.requestRenderBuffer())}startMomentum(l,C){this.momentumVelocityY=l*16,this.momentumVelocityX=C*16,this.momentumAnimation&&cancelAnimationFrame(this.momentumAnimation),this.animateMomentum()}animateMomentum(){let w=this.momentumVelocityY,i=this.momentumVelocityX,p=!1;if(Math.abs(w)>.1){let s=this.terminal?.buffer.active;if(s){let n=this.fontSize*1.2,o=Math.max(0,(s.length-this.actualRows)*n),u=Math.max(0,Math.min(o,this.viewportY+w));u!==this.viewportY?(this.viewportY=u,p=!0,this.updateFollowCursorState()):this.momentumVelocityY=0}}if(Math.abs(i)>.1&&!this.fitHorizontally&&this.container){let s=this.container.scrollLeft+i;this.container.scrollLeft=s,p=!0}this.momentumVelocityY*=.92,this.momentumVelocityX*=.92,Math.abs(this.momentumVelocityY)>.1||Math.abs(this.momentumVelocityX)>.1?(this.momentumAnimation=requestAnimationFrame(()=>{this.animateMomentum()}),p&&this.renderBuffer()):(this.momentumAnimation=null,this.momentumVelocityY=0,this.momentumVelocityX=0)}renderBuffer(){if(!this.terminal||!this.container){z.warn("renderBuffer called but missing terminal or container",{hasTerminal:!!this.terminal,hasContainer:!!this.container});return}z.debug("renderBuffer executing");let l=this.debugMode?performance.now():0;this.debugMode&&this.renderCount++;let C=this.terminal.buffer.active,w=C.length,i=this.fontSize*1.2,p=this.viewportY/i,s=Math.floor(p),n=(p-s)*i,o="",u=C.getNullCell(),h=this.terminal.buffer.active.cursorX,_=this.terminal.buffer.active.cursorY+this.terminal.buffer.active.viewportY;for(let t=0;t<this.actualRows;t++){let e=s+t,v=n>0?` style="transform: translateY(-${n}px);"`:"";if(e>=w){o+=`<div class="terminal-line"${v}></div>`;continue}let r=C.getLine(e);if(!r){o+=`<div class="terminal-line"${v}></div>`;continue}let a=e===_,f=this.renderLine(r,u,a&&this.cursorVisible?h:-1);o+=`<div class="terminal-line"${v}>${f||""}</div>`}if(this.container.innerHTML=o,zi.processLinks(this.container),Ii(this.container,this.handleShortcutClick),this.debugMode){let t=performance.now();this.lastRenderTime=t-l,this.totalRenderTime+=this.lastRenderTime,this.requestUpdate()}}renderLine(l,C,w=-1){let i="",p="",s="",n="",o=h=>h.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),u=()=>{if(p){let h=o(p);i+=`<span class="${s}"${n?` style="${n}"`:""}>${h}</span>`,p=""}};for(let h=0;h<l.length;h++){if(l.getCell(h,C),!C)continue;let _=C.getChars()||" ";if(C.getWidth()===0)continue;let e="terminal-char",v="",r=h===w;r&&(e+=" cursor");let a=C.getFgColor();if(a!==void 0){if(typeof a=="number"&&a>=0&&a<=255)v+=`color: var(--terminal-color-${a});`;else if(typeof a=="number"&&a>255){let M=a>>16&255,E=a>>8&255,I=a&255;v+=`color: rgb(${M}, ${E}, ${I});`}}let f=C.getBgColor();if(f!==void 0){if(typeof f=="number"&&f>=0&&f<=255)v+=`background-color: var(--terminal-color-${f});`;else if(typeof f=="number"&&f>255){let M=f>>16&255,E=f>>8&255,I=f&255;v+=`background-color: rgb(${M}, ${E}, ${I});`}}let d=C.isBold(),c=C.isItalic(),b=C.isUnderline(),S=C.isDim(),y=C.isInverse(),m=C.isInvisible(),A=C.isStrikethrough(),x=C.isOverline();if(d&&(e+=" bold"),c&&(e+=" italic"),b&&(e+=" underline"),S&&(e+=" dim"),A&&(e+=" strikethrough"),x&&(e+=" overline"),y){let M=v.match(/color: ([^;]+);/)?.[1],E=v.match(/background-color: ([^;]+);/)?.[1],I="var(--terminal-foreground, #e4e4e4)",F="var(--terminal-background, #0a0a0a)",O=M||I,P=E||F;v="",v+=`color: ${P};`,v+=`background-color: ${O};`}r&&(v+="background-color: rgb(var(--color-primary));"),m&&(v+="opacity: 0;"),(e!==s||v!==n)&&(u(),s=e,n=v),p+=_}return u(),i}write(l,C=!0){if(!this.terminal){z.warn("Terminal.write called but no terminal instance exists");return}this.isMobile&&l.length>100&&z.debug("[Terminal] \u{1F4F1} Large write to terminal",{sessionId:this.sessionId,dataLength:l.length,followCursor:C,bufferLength:this.terminal.buffer.active.length,scrollPosition:this._viewportY}),l.includes("\x1B[?25l")&&(this.cursorVisible=!1),l.includes("\x1B[?25h")&&(this.cursorVisible=!0),this.queueRenderOperation(async()=>{this.terminal&&(await new Promise(w=>{this.terminal?this.terminal.write(l,w):w()}),C&&this.followCursorEnabled&&this.followCursor())})}clear(){this.terminal&&this.queueRenderOperation(()=>{this.terminal&&(this.terminal.clear(),this.viewportY=0)})}setTerminalSize(l,C){this.cols=l,this.rows=C,this.terminal&&(this.explicitSizeSet=!0,this.queueRenderOperation(()=>{this.terminal&&(this.terminal.resize(l,C),this.requestUpdate())}))}scrollToBottom(){this.terminal&&this.queueRenderOperation(()=>{if(!this.terminal)return;this.requestResize("property-change");let l=this.terminal.buffer.active,C=this.fontSize*1.2,w=Math.max(0,(l.length-this.actualRows)*C);this.programmaticScroll=!0,this.viewportY=w,this.programmaticScroll=!1})}scrollToPosition(l){this.terminal&&this.queueRenderOperation(()=>{if(!this.terminal)return;let C=this.terminal.buffer.active,w=this.fontSize*1.2,i=Math.max(0,C.length-this.actualRows);this.programmaticScroll=!0,this.viewportY=Math.max(0,Math.min(i,l))*w,this.programmaticScroll=!1})}queueCallback(l){this.queueRenderOperation(l)}getTerminalSize(){return{cols:this.cols,rows:this.rows}}getVisibleRows(){return this.actualRows}getBufferSize(){return this.terminal?this.terminal.buffer.active.length:0}getScrollPosition(){let l=this.fontSize*1.2;return Math.round(this.viewportY/l)}getMaxScrollPosition(){if(!this.terminal)return 0;let l=this.terminal.buffer.active;return Math.max(0,l.length-this.actualRows)}isScrolledToBottom(){if(!this.terminal)return!0;let l=this.terminal.buffer.active,C=this.fontSize*1.2,w=Math.max(0,(l.length-this.actualRows)*C);return this.viewportY>=w-C}updateFollowCursorState(){if(this.programmaticScroll)return;let l=this.isScrolledToBottom();l&&!this.followCursorEnabled?this.followCursorEnabled=!0:!l&&this.followCursorEnabled&&(this.followCursorEnabled=!1)}followCursor(){if(!this.terminal)return;let l=this.terminal.buffer.active,C=l.cursorY+l.viewportY,w=this.fontSize*1.2,i=C,p=Math.floor(this.viewportY/w),s=p+this.actualRows-1;this.programmaticScroll=!0,i<p?this.viewportY=i*w:i>s&&(this.viewportY=Math.max(0,(i-this.actualRows+1)*w));let n=Math.max(0,(l.length-this.actualRows)*w);this.viewportY=Math.min(this.viewportY,n),this.programmaticScroll=!1}getOptimizedScrollback(){let l=1e3;try{let C=localStorage.getItem("terminal-scrollback-preference");if(C!==null){let w=Number.parseInt(C,10);Number.isFinite(w)&&w>0&&w<=5e4&&(l=w)}}catch(C){z.warn("Failed to load scrollback preference from localStorage:",C)}return this.isMobile?(l=Math.min(l,500),z.debug(`[Terminal] Mobile device detected - using reduced scrollback: ${l}`)):l=Math.min(l,2e3),z.debug(`[Terminal] Using optimized scrollback size: ${l} lines`),l}getOptimizedFontSize(){let l=this.fontSize;if(this.isMobile){l=Math.max(l*1.2,16);let w=window.devicePixelRatio||1;w>=2?l=l*.9:w<1.5&&(l=l*1.1),l=Math.max(14,Math.min(22,l)),z.debug(`[Terminal] Mobile font size adjusted: ${this.fontSize} \u2192 ${l} (DPR: ${w})`)}return Math.round(l)}getMobileCapabilities(){if(!this.isMobile)return{isLowEnd:!1,isTouchPrimary:!1,hasHighDPI:!1,maxTouchPoints:0};let l={isLowEnd:!1,isTouchPrimary:!0,hasHighDPI:window.devicePixelRatio>=2,maxTouchPoints:navigator.maxTouchPoints||0};if("hardwareConcurrency"in navigator&&navigator.hardwareConcurrency<=2&&(l.isLowEnd=!0),"deviceMemory"in navigator&&navigator.deviceMemory<=2&&(l.isLowEnd=!0),"connection"in navigator&&navigator.connection){let C=navigator.connection;(C.effectiveType==="slow-2g"||C.effectiveType==="2g")&&(l.isLowEnd=!0)}return z.debug("[Terminal] Mobile capabilities:",l),l}async loadPerformanceAddons(){if(!this.terminal){z.warn("Cannot load addons: terminal instance not available");return}let l=performance.now(),C=[],w=[];try{if(!at)try{at=(await Promise.resolve().then(()=>ft(qi()))).WebglAddon,z.debug("[Terminal] WebGL addon module loaded")}catch(p){z.warn("[Terminal] Failed to load WebGL addon module:",p),w.push({addon:"WebGL",error:p})}if(at)try{let p=new at;z.debug("[Terminal] WebGL addon would be loaded (headless mode - addon ready)"),C.push("WebGL (ready)")}catch(p){z.warn("[Terminal] Failed to initialize WebGL addon:",p),w.push({addon:"WebGL init",error:p})}if(!$t)try{$t=(await Promise.resolve().then(()=>ft(Gi()))).CanvasAddon,z.debug("[Terminal] Canvas addon module loaded")}catch(p){z.warn("[Terminal] Failed to load Canvas addon module:",p),w.push({addon:"Canvas",error:p})}if($t&&(!at||w.some(p=>p.addon.includes("WebGL"))))try{let p=new $t;z.debug("[Terminal] Canvas addon would be loaded (headless mode - addon ready)"),C.push("Canvas (ready)")}catch(p){z.warn("[Terminal] Failed to initialize Canvas addon:",p),w.push({addon:"Canvas init",error:p})}if(!Ki)try{Ki=(await Promise.resolve().then(()=>ft(Vi()))).FitAddon,z.debug("[Terminal] Fit addon module loaded")}catch(p){z.warn("[Terminal] Failed to load Fit addon module:",p),w.push({addon:"Fit",error:p})}let i=performance.now()-l;C.length>0?z.debug(`[Terminal] Performance addons loaded in ${i.toFixed(2)}ms:`,C.join(", ")):z.warn("[Terminal] No performance addons could be loaded"),w.length>0&&z.warn("[Terminal] Some addons failed to load:",w.map(p=>`${p.addon}: ${p.error.message}`).join(", ")),this.debugMode&&z.debug("[Terminal] Addon loading performance:",{totalTime:i,loaded:C,errors:w.length})}catch(i){z.error("[Terminal] Unexpected error during addon loading:",i)}}render(){let l=this.getTerminalTheme(),C=`
      view-transition-name: session-${this.sessionId};
      background-color: ${l.background||"var(--terminal-background, #0a0a0a)"};
      color: ${l.foreground||"var(--terminal-foreground, #e4e4e4)"};
    `;return Ce`
      <style>
        /* Dynamic terminal sizing */
        .terminal-container {
          font-size: ${this.fontSize}px;
          line-height: ${this.fontSize*1.2}px;
          touch-action: none !important;
        }

        .terminal-line {
          height: ${this.fontSize*1.2}px;
          line-height: ${this.fontSize*1.2}px;
        }
      </style>
      <div class="relative w-full h-full p-0 m-0">
        <div
          id="terminal-container"
          class="terminal-container w-full h-full overflow-hidden p-0 m-0"
          tabindex="0"
          contenteditable="false"
          style="${C}"
          @paste=${this.handlePaste}
          @click=${this.handleClick}
          data-testid="terminal-container"
        ></div>
        ${!this.followCursorEnabled&&!this.hideScrollButton?Ce`
              <div
                class="scroll-to-bottom"
                @click=${this.handleScrollToBottom}
                title="Scroll to bottom"
              >
                ↓
              </div>
            `:""}
        ${this.debugMode?Ce`
              <div class="debug-overlay">
                <div class="metric">
                  <span class="metric-label">Renders:</span>
                  <span class="metric-value">${this.renderCount}</span>
                </div>
                <div class="metric">
                  <span class="metric-label">Avg:</span>
                  <span class="metric-value"
                    >${this.renderCount>0?(this.totalRenderTime/this.renderCount).toFixed(2):"0.00"}ms</span
                  >
                </div>
                <div class="metric">
                  <span class="metric-label">Last:</span>
                  <span class="metric-value">${this.lastRenderTime.toFixed(2)}ms</span>
                </div>
              </div>
            `:""}
      </div>
    `}};ee([ne({type:String})],de.prototype,"sessionId",2),ee([ne({type:String})],de.prototype,"sessionStatus",2),ee([ne({type:Number})],de.prototype,"cols",2),ee([ne({type:Number})],de.prototype,"rows",2),ee([ne({type:Number})],de.prototype,"fontSize",2),ee([ne({type:Boolean})],de.prototype,"fitHorizontally",2),ee([ne({type:Number})],de.prototype,"maxCols",2),ee([ne({type:String})],de.prototype,"theme",2),ee([ne({type:Boolean})],de.prototype,"disableClick",2),ee([ne({type:Boolean})],de.prototype,"hideScrollButton",2),ee([ne({type:Number})],de.prototype,"initialCols",2),ee([ne({type:Number})],de.prototype,"initialRows",2),ee([he()],de.prototype,"terminal",2),ee([he()],de.prototype,"followCursorEnabled",2),ee([he()],de.prototype,"actualRows",2),ee([he()],de.prototype,"cursorVisible",2),de=ee([Be("vibe-terminal")],de);var ht={SESSION_LIST_BOTTOM_BAR:10,TERMINAL_OVERLAY:15,LOG_BUTTON:20,MOBILE_OVERLAY:25,SIDEBAR_MOBILE:30,MOBILE_INPUT_OVERLAY:40,CTRL_ALPHA_OVERLAY:45,TERMINAL_QUICK_KEYS:48,WIDTH_SELECTOR_DROPDOWN:60,BRANCH_SELECTOR_DROPDOWN:65,IME_INPUT:70,MODAL_BACKDROP:100,MODAL:105,FILE_PICKER:110,SESSION_EXITED_OVERLAY:120,NOTIFICATION:150,FILE_BROWSER:1100};var We=class extends be{constructor(){super(...arguments);this.cols=80;this.rows=24;this.inputText="";this.terminalRef=Mt();this.testData={ansi:"\x1B[31mRed\x1B[0m \x1B[32mGreen\x1B[0m \x1B[34mBlue\x1B[0m \x1B[1;33mBold Yellow\x1B[0m",unicode:"\u{1F680} Unicode: \u4F60\u597D\u4E16\u754C \u2022 \xF1 \u2022 \xFC \u2022 \xF6 \u2022 \u{1F3A8}",longLine:"This is a very long line that should wrap around when it reaches the edge of the terminal. ".repeat(5),progress:"[##########          ] 50% Complete"}}createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),this.setupTerminal()}async setupTerminal(){await this.updateComplete;let l=this.terminalRef.value;l&&l.addEventListener("terminal-ready",()=>{this.writeWelcomeMessage()})}writeWelcomeMessage(){let l=this.terminalRef.value;l&&(l.write(`\x1B[1;36mTunnelForge Terminal Test\x1B[0m\r
`),l.write(`=====================================\r
\r
`),l.write(`This is a test environment for the terminal component.\r
`),l.write(`Use the buttons above to test various features.\r
\r
`),l.write("\x1B[32m$ \x1B[0m"))}handleTerminalInput(l){let C=this.terminalRef.value;if(!C)return;let w=l.detail;C.write(w),w==="\r"&&C.write(`
\x1B[32m$ \x1B[0m`)}handleTerminalResize(l){console.log("Terminal resized:",l.detail)}clearTerminal(){let l=this.terminalRef.value;l&&(l.clear(),l.write("\x1B[32m$ \x1B[0m"))}writeTestData(l){let C=this.terminalRef.value;C&&C.write(`${this.testData[l]}\r
\x1B[32m$ \x1B[0m`)}resizeTerminal(l,C){this.cols=l,this.rows=C;let w=this.terminalRef.value;w&&w.setTerminalSize(l,C)}sendCustomInput(){if(!this.inputText)return;let l=this.terminalRef.value;l&&(l.write(`${this.inputText}\r
\x1B[32m$ \x1B[0m`),this.inputText="")}render(){return Ce`
      <div class="h-screen flex flex-col bg-background text-foreground font-mono">
        <div class="bg-surface border-b border-gray-800 p-4 font-sans">
          <h1 class="text-2xl font-bold text-emerald-400 mb-4">Terminal Test</h1>
          <div class="flex gap-2 flex-wrap">
            <button
              @click=${this.clearTerminal}
              class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-emerald-400 rounded text-sm transition-colors"
            >
              Clear
            </button>
            <button
              @click=${()=>this.writeTestData("ansi")}
              class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-emerald-400 rounded text-sm transition-colors"
            >
              ANSI Colors
            </button>
            <button
              @click=${()=>this.writeTestData("unicode")}
              class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-emerald-400 rounded text-sm transition-colors"
            >
              Unicode
            </button>
            <button
              @click=${()=>this.writeTestData("longLine")}
              class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-emerald-400 rounded text-sm transition-colors"
            >
              Long Line
            </button>
            <button
              @click=${()=>this.writeTestData("progress")}
              class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-emerald-400 rounded text-sm transition-colors"
            >
              Progress Bar
            </button>
            <button
              @click=${()=>this.resizeTerminal(80,24)}
              class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-emerald-400 rounded text-sm transition-colors"
            >
              80x24
            </button>
            <button
              @click=${()=>this.resizeTerminal(120,30)}
              class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-emerald-400 rounded text-sm transition-colors"
            >
              120x30
            </button>
            <button
              @click=${()=>this.resizeTerminal(40,15)}
              class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-emerald-400 rounded text-sm transition-colors"
            >
              40x15
            </button>
          </div>
        </div>

        <div class="flex-1 relative overflow-hidden bg-black m-4 rounded-lg border border-gray-800">
          <div
            class="absolute top-4 right-4 bg-black/80 border border-gray-800 rounded px-3 py-1.5 text-xs"
            style="z-index: ${ht.TERMINAL_OVERLAY};"
          >
            <div>Size: <code class="text-emerald-400">${this.cols}x${this.rows}</code></div>
          </div>

          <vibe-terminal
            ${Tt(this.terminalRef)}
            .cols=${this.cols}
            .rows=${this.rows}
            @terminal-input=${this.handleTerminalInput}
            @terminal-resize=${this.handleTerminalResize}
            style="width: 100%; height: 100%;"
          ></vibe-terminal>

          <div class="absolute bottom-4 left-4 right-4 flex gap-2" style="z-index: ${ht.TERMINAL_OVERLAY};">
            <input
              type="text"
              placeholder="Type custom text to send..."
              class="flex-1 px-3 py-2 bg-black/80 text-foreground border border-gray-800 rounded font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-emerald-400"
              .value=${this.inputText}
              @input=${l=>{this.inputText=l.target.value}}
              @keydown=${l=>{l.key==="Enter"&&this.sendCustomInput()}}
            />
            <button
              @click=${this.sendCustomInput}
              class="px-4 py-2 bg-emerald-500 hover:bg-emerald-600 text-background rounded font-medium text-sm transition-colors"
            >
              Send
            </button>
          </div>
        </div>
      </div>
    `}};ee([he()],We.prototype,"cols",2),ee([he()],We.prototype,"rows",2),ee([he()],We.prototype,"inputText",2),We=ee([Be("terminal-test")],We);qe();qe();var lt=Ae("monaco-loader"),Yi=!1,Ft=null;async function Ps(){return Ft||(Ft=new Promise((T,g)=>{let l=()=>{let C=document.createElement("script");C.src="/monaco-editor/vs/loader.js",C.async=!0,C.defer=!0,C.onload=()=>{window.require.config({paths:{vs:"/monaco-editor/vs"}}),window.MonacoEnvironment={getWorker:(w,i)=>new Worker("data:,")},window.require(["vs/editor/editor.main"],()=>{lt.debug("Monaco Editor loaded via AMD with lazy loading"),T()})},C.onerror=()=>{g(new Error("Failed to load Monaco loader script"))},document.head.appendChild(C)};"requestIdleCallback"in window?requestIdleCallback(l,{timeout:2e3}):setTimeout(l,100)}),Ft)}async function Ji(){if(!Yi)try{lt.debug("Loading Monaco Editor..."),window.monaco||await Ps(),lt.debug("Initializing Monaco Editor...");let T=window.monaco;T.languages.register({id:"shell"}),T.languages.setMonarchTokensProvider("shell",{tokenizer:{root:[[/^#.*$/,"comment"],[/\$\w+/,"variable"],[/\b(echo|cd|ls|grep|find|chmod|mkdir|rm|cp|mv|touch|cat|sed|awk|curl|wget|git|pnpm|npm|yarn|docker|kubectl)\b/,"keyword"],[/"([^"\\]|\\.)*"/,"string"],[/'([^'\\]|\\.)*'/,"string"]]}}),T.editor.setTheme(si()?"vs-dark":"vs"),new MutationObserver(()=>{T.editor.setTheme(si()?"vs-dark":"vs")}).observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),Yi=!0,lt.debug("Monaco Editor initialized successfully")}catch(T){throw lt.error("Failed to initialize Monaco Editor:",T),T}}var Lo=typeof window<"u"?window.monaco:void 0;var Ge=Ae("monaco-editor"),ve=class extends be{constructor(){super(...arguments);this.content="";this.originalContent="";this.modifiedContent="";this.language="";this.filename="";this.readOnly=!1;this.mode="normal";this.showModeToggle=!1;this.options={};this.isLoading=!0;this.diffMode="sideBySide";this.containerWidth=0;this.containerRef=Mt();this.editor=null;this.resizeObserver=null;this.monacoLoaded=!1}createRenderRoot(){return this}async connectedCallback(){super.connectedCallback(),await this.loadMonaco(),this.setupResizeObserver(),await this.updateComplete,this.containerRef.value&&!this.editor&&!this.isLoading&&await this.createEditor()}disconnectedCallback(){super.disconnectedCallback(),this.disposeEditor(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null)}async loadMonaco(){if(this.monacoLoaded||window.monaco){this.monacoLoaded=!0,this.isLoading=!1;return}try{Ge.debug("Loading Monaco Editor..."),await Ji(),this.monacoLoaded=!0,this.isLoading=!1,Ge.debug("Monaco Editor loaded successfully")}catch(l){Ge.error("Failed to load Monaco Editor:",l),this.isLoading=!1}}setupResizeObserver(){this.resizeObserver=new ResizeObserver(l=>{for(let C of l){if(this.containerWidth=C.contentRect.width,this.mode==="diff"&&this.editor){let i=this.containerWidth<768?"inline":"sideBySide";i!==this.diffMode&&(this.diffMode=i,this.recreateEditor())}this.editor&&this.editor.layout()}}),this.containerRef.value&&this.resizeObserver.observe(this.containerRef.value)}async updated(l){super.updated(l),(l.has("mode")||l.has("content")&&!this.editor||l.has("originalContent")&&this.mode==="diff"||l.has("modifiedContent")&&this.mode==="diff")&&!this.isLoading&&this.containerRef.value?await this.recreateEditor():this.editor&&!this.isLoading&&(l.has("content")&&this.mode==="normal"&&this.updateContent(),(l.has("language")||l.has("filename"))&&this.updateLanguage(),l.has("readOnly")&&this.updateReadOnly())}async recreateEditor(){this.disposeEditor(),await this.createEditor()}async createEditor(){if(!(!this.containerRef.value||!window.monaco))try{this.setupTheme();let l={theme:"vs-dark",automaticLayout:!0,fontSize:14,fontFamily:"'Fira Code', Menlo, Monaco, 'Courier New', monospace",fontLigatures:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,renderWhitespace:"selection",readOnly:this.readOnly,folding:!0,foldingStrategy:"indentation",foldingHighlight:!0,showFoldingControls:"always",renderLineHighlight:"all",renderLineHighlightOnlyWhenFocus:!1,...this.options};if(this.mode==="diff"){let C={readOnly:!0,automaticLayout:!0,scrollBeyondLastLine:!1,minimap:{enabled:!1},renderWhitespace:"selection",renderSideBySide:this.diffMode==="sideBySide",ignoreTrimWhitespace:!1};this.editor=window.monaco.editor.createDiffEditor(this.containerRef.value,C);let w=this.detectLanguage(),i=Date.now(),p=`${this.filename||"untitled"}-${i}`,s=window.monaco.editor.createModel(this.originalContent||"",w,window.monaco.Uri.parse(`file:///${p}#original`)),n=window.monaco.editor.createModel(this.modifiedContent||"",w,window.monaco.Uri.parse(`file:///${p}#modified`));Ge.debug("Creating diff editor");let o=this.editor;o.setModel({original:s,modified:n});let u=()=>{this.editor&&this.editor.layout()},h=o.onDidUpdateDiff(()=>{u(),h.dispose()});setTimeout(u,200)}else this.editor=window.monaco.editor.create(this.containerRef.value,{...l,value:this.content,language:this.detectLanguage()}),this.readOnly||(this.editor.addCommand(window.monaco.KeyMod.CtrlCmd|window.monaco.KeyCode.KeyS,()=>{this.handleSave()}),this.editor.onDidChangeModelContent(()=>{let C=this.editor?.getValue()||"";this.dispatchEvent(new CustomEvent("content-changed",{detail:{content:C},bubbles:!0,composed:!0}))}));Ge.debug(`Created ${this.mode} editor`)}catch(l){Ge.error("Failed to create editor:",l)}}setupTheme(){window.monaco}detectLanguage(){if(this.language)return this.language;if(this.filename){let l=this.filename.split(".").pop()?.toLowerCase();return{js:"javascript",jsx:"javascript",ts:"typescript",tsx:"typescript",json:"json",html:"html",htm:"html",css:"css",scss:"scss",sass:"sass",less:"less",py:"python",rb:"ruby",go:"go",rs:"rust",java:"java",c:"c",cpp:"cpp",cs:"csharp",php:"php",swift:"swift",kt:"kotlin",scala:"scala",r:"r",sql:"sql",sh:"shell",bash:"shell",zsh:"shell",fish:"shell",ps1:"powershell",yml:"yaml",yaml:"yaml",xml:"xml",md:"markdown",markdown:"markdown",dockerfile:"dockerfile",makefile:"makefile",gitignore:"gitignore"}[l||""]||"plaintext"}return"plaintext"}updateContent(){if(!this.editor||this.mode==="diff")return;this.editor.getValue()!==this.content&&this.editor.setValue(this.content)}updateLanguage(){if(!this.editor||!window.monaco)return;let l=this.detectLanguage();if(this.mode==="normal"){let C=this.editor.getModel();C&&window.monaco.editor.setModelLanguage(C,l)}else{let C=this.editor,w=C.getOriginalEditor().getModel(),i=C.getModifiedEditor().getModel();w&&window.monaco.editor.setModelLanguage(w,l),i&&window.monaco.editor.setModelLanguage(i,l)}}updateReadOnly(){this.editor&&(this.mode==="normal"?this.editor.updateOptions({readOnly:this.readOnly}):this.editor.getModifiedEditor().updateOptions({readOnly:this.readOnly}))}handleSave(){if(this.readOnly||!this.editor||this.mode==="diff")return;let l=this.editor.getValue();this.dispatchEvent(new CustomEvent("save",{detail:{content:l},bubbles:!0,composed:!0}))}toggleDiffMode(){if(this.mode!=="diff")return;this.diffMode=this.diffMode==="inline"?"sideBySide":"inline";let l="",C="";if(this.editor){let i=this.editor.getModel();i&&(l=i.original?.getValue()||this.originalContent||"",C=i.modified?.getValue()||this.modifiedContent||"")}this.originalContent=l,this.modifiedContent=C,this.recreateEditor()}disposeEditor(){if(this.editor){if(this.mode==="diff"){let l=this.editor,C=l.getModel();l.setModel(null),C&&setTimeout(()=>{C.original?.dispose(),C.modified?.dispose()},0)}this.editor.dispose(),this.editor=null}}render(){return Ce`
      <div
        class="monaco-editor-root"
        style="display: block; width: 100%; height: 100%; position: relative;"
      >
        <div
          class="editor-container"
          ${Tt(this.containerRef)}
          style="width: 100%; height: 100%; position: relative; background: rgb(var(--color-bg-secondary));"
        >
          ${this.isLoading?Ce`
                <div
                  class="loading"
                  style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: rgb(var(--color-text-muted)); font-family: ui-monospace, monospace;"
                >
                  Loading editor...
                </div>
              `:""}
          ${this.showModeToggle&&this.mode==="diff"&&!this.isLoading?Ce`
                <button
                  class="mode-toggle"
                  style="position: absolute; top: 10px; right: 10px; z-index: 10; background: rgb(var(--color-surface)); border: 1px solid rgb(var(--color-border)); color: rgb(var(--color-text)); padding: 4px 8px; border-radius: 4px; font-size: 12px; cursor: pointer;"
                  @click=${this.toggleDiffMode}
                  title="Toggle between inline and side-by-side diff"
                  @mouseenter=${l=>{let C=l.target;C.style.background="rgb(var(--color-surface-hover))",C.style.borderColor="rgb(var(--color-border-focus))"}}
                  @mouseleave=${l=>{let C=l.target;C.style.background="rgb(var(--color-surface))",C.style.borderColor="rgb(var(--color-border))"}}
                >
                  ${this.diffMode==="inline"?"Side by Side":"Inline"}
                </button>
              `:""}
        </div>
      </div>
    `}};ee([ne({type:String})],ve.prototype,"content",2),ee([ne({type:String})],ve.prototype,"originalContent",2),ee([ne({type:String})],ve.prototype,"modifiedContent",2),ee([ne({type:String})],ve.prototype,"language",2),ee([ne({type:String})],ve.prototype,"filename",2),ee([ne({type:Boolean})],ve.prototype,"readOnly",2),ee([ne({type:String})],ve.prototype,"mode",2),ee([ne({type:Boolean})],ve.prototype,"showModeToggle",2),ee([ne({type:Object})],ve.prototype,"options",2),ee([he()],ve.prototype,"isLoading",2),ee([he()],ve.prototype,"diffMode",2),ee([he()],ve.prototype,"containerWidth",2),ve=ee([Be("monaco-editor")],ve);var ye=class extends be{constructor(){super(...arguments);this.mode="diff";this.readOnly=!1;this.showModeToggle=!0;this.language="typescript";this.content="";this.originalContent="";this.modifiedContent="";this.savedContent="";this.sampleCode={typescript:`// TypeScript Example
interface User {
  id: number;
  name: string;
  email: string;
  isActive: boolean;
}

class UserService {
  private users: User[] = [];

  async getUser(id: number): Promise<User | undefined> {
    return this.users.find(user => user.id === id);
  }

  async createUser(user: Omit<User, 'id'>): Promise<User> {
    const newUser: User = {
      ...user,
      id: this.users.length + 1
    };
    this.users.push(newUser);
    return newUser;
  }
}

export default UserService;`,javascript:`// JavaScript Example
class Calculator {
  constructor() {
    this.result = 0;
  }

  add(a, b) {
    this.result = a + b;
    return this.result;
  }

  subtract(a, b) {
    this.result = a - b;
    return this.result;
  }

  multiply(a, b) {
    this.result = a * b;
    return this.result;
  }

  divide(a, b) {
    if (b === 0) {
      throw new Error('Division by zero');
    }
    this.result = a / b;
    return this.result;
  }
}

module.exports = Calculator;`,python:`# Python Example
import asyncio
from typing import List, Optional

class TaskManager:
    def __init__(self):
        self.tasks: List[asyncio.Task] = []
        self.results: List[any] = []
    
    async def add_task(self, coro):
        """Add a coroutine as a task"""
        task = asyncio.create_task(coro)
        self.tasks.append(task)
        return task
    
    async def wait_all(self) -> List[any]:
        """Wait for all tasks to complete"""
        if not self.tasks:
            return []
        
        self.results = await asyncio.gather(*self.tasks)
        return self.results
    
    def cancel_all(self):
        """Cancel all pending tasks"""
        for task in self.tasks:
            if not task.done():
                task.cancel()

# Example usage
async def main():
    manager = TaskManager()
    await manager.add_task(asyncio.sleep(1))
    await manager.wait_all()`,json:`{
  "name": "monaco-editor-test",
  "version": "1.0.0",
  "description": "Monaco Editor test component",
  "dependencies": {
    "monaco-editor": "^0.52.2",
    "lit": "^3.3.0"
  },
  "scripts": {
    "test": "echo 'Error: no test specified' && exit 1",
    "build": "tsc && vite build",
    "dev": "vite"
  },
  "keywords": ["monaco", "editor", "test"],
  "author": "TunnelForge Team",
  "license": "MIT"
}`}}createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),this.loadSampleContent()}loadSampleContent(){let l=this.sampleCode[this.language]||this.sampleCode.typescript;this.content=l,this.originalContent=l,this.modifiedContent=`${l}

// Modified by user
console.log("Changes made!");`}handleModeChange(l){this.mode=l,this.loadSampleContent()}handleLanguageChange(l){let C=l.target;this.language=C.value,this.loadSampleContent()}handleSave(l){this.savedContent=l.detail.content,console.log("Content saved:",this.savedContent),alert("Content saved! Check console for details.")}handleContentChanged(l){console.log("Content changed:",l.detail.content)}render(){return Ce`
      <div class="h-screen flex flex-col bg-background text-foreground">
        <div class="bg-surface border-b border-gray-800 p-4">
          <h1 class="text-2xl font-bold text-emerald-400 mb-4">Monaco Editor Test</h1>
          <div class="flex gap-3 flex-wrap items-center">
            <span class="text-sm text-gray-400">Mode:</span>
            <button
              class="${this.mode==="normal"?"bg-emerald-500 text-background":"bg-gray-800 hover:bg-gray-700 text-foreground"} px-3 py-1.5 border ${this.mode==="normal"?"border-emerald-500":"border-gray-700 hover:border-emerald-400"} rounded text-sm transition-colors"
              @click=${()=>this.handleModeChange("normal")}
            >
              Normal
            </button>
            <button
              class="${this.mode==="diff"?"bg-emerald-500 text-background":"bg-gray-800 hover:bg-gray-700 text-foreground"} px-3 py-1.5 border ${this.mode==="diff"?"border-emerald-500":"border-gray-700 hover:border-emerald-400"} rounded text-sm transition-colors"
              @click=${()=>this.handleModeChange("diff")}
            >
              Diff
            </button>

            <span class="text-sm text-gray-400 ml-4">Language:</span>
            <select
              @change=${this.handleLanguageChange}
              .value=${this.language}
              class="px-3 py-1.5 bg-gray-800 text-foreground border border-gray-700 hover:border-emerald-400 rounded text-sm cursor-pointer focus:outline-none focus:border-emerald-400"
            >
              <option value="typescript">TypeScript</option>
              <option value="javascript">JavaScript</option>
              <option value="python">Python</option>
              <option value="json">JSON</option>
            </select>

            <label class="flex items-center gap-2 ml-4 text-sm cursor-pointer">
              <input
                type="checkbox"
                .checked=${this.readOnly}
                @change=${l=>{this.readOnly=l.target.checked}}
                class="w-4 h-4 rounded border-gray-700 bg-gray-800 text-emerald-500 focus:ring-emerald-400 focus:ring-offset-0"
              />
              <span>Read Only</span>
            </label>

            ${this.mode==="diff"?Ce`
                  <label class="flex items-center gap-2 ml-4 text-sm cursor-pointer">
                    <input
                      type="checkbox"
                      .checked=${this.showModeToggle}
                      @change=${l=>{this.showModeToggle=l.target.checked}}
                      class="w-4 h-4 rounded border-gray-700 bg-gray-800 text-emerald-500 focus:ring-emerald-400 focus:ring-offset-0"
                    />
                    <span>Show Mode Toggle</span>
                  </label>
                `:""}
          </div>
        </div>

        <div class="flex-1 relative overflow-hidden border border-gray-800 m-4 rounded-lg">
          <div
            class="absolute top-4 right-4 bg-black/80 border border-gray-800 rounded px-3 py-1.5 text-xs"
            style="z-index: ${ht.TERMINAL_OVERLAY};"
          >
            <div>Mode: <code class="text-emerald-400">${this.mode}</code></div>
            <div>Language: <code class="text-emerald-400">${this.language}</code></div>
            <div>Read Only: <code class="text-emerald-400">${this.readOnly}</code></div>
          </div>

          <monaco-editor
            .mode=${this.mode}
            .content=${this.content}
            .originalContent=${this.originalContent}
            .modifiedContent=${this.modifiedContent}
            .language=${this.language}
            .readOnly=${this.readOnly}
            .showModeToggle=${this.showModeToggle}
            @save=${this.handleSave}
            @content-changed=${this.handleContentChanged}
            style="width: 100%; height: 100%;"
          ></monaco-editor>
        </div>
      </div>
    `}};ee([he()],ye.prototype,"mode",2),ee([he()],ye.prototype,"readOnly",2),ee([he()],ye.prototype,"showModeToggle",2),ee([he()],ye.prototype,"language",2),ee([he()],ye.prototype,"content",2),ee([he()],ye.prototype,"originalContent",2),ee([he()],ye.prototype,"modifiedContent",2),ee([he()],ye.prototype,"savedContent",2),ye=ee([Be("monaco-editor-test")],ye);
/*! Bundled license information:

@lit/reactive-element/css-tag.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

@lit/reactive-element/reactive-element.js:
lit-html/lit-html.js:
lit-element/lit-element.js:
@lit/reactive-element/decorators/custom-element.js:
@lit/reactive-element/decorators/property.js:
@lit/reactive-element/decorators/state.js:
@lit/reactive-element/decorators/event-options.js:
@lit/reactive-element/decorators/base.js:
@lit/reactive-element/decorators/query.js:
@lit/reactive-element/decorators/query-all.js:
@lit/reactive-element/decorators/query-async.js:
@lit/reactive-element/decorators/query-assigned-nodes.js:
lit-html/directive.js:
lit-html/async-directive.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

lit-html/is-server.js:
  (**
   * @license
   * Copyright 2022 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

@lit/reactive-element/decorators/query-assigned-elements.js:
  (**
   * @license
   * Copyright 2021 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

lit-html/directive-helpers.js:
lit-html/directives/ref.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)
*/
