{"version":3,"file":"session-list.js","sourceRoot":"","sources":["../../src/client/components/session-list.ts"],"names":[],"mappings":"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","sourcesContent":["import { LitElement, html } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\n\nexport interface Session {\n  id: string;\n  command: string;\n  workingDir: string;\n  status: 'running' | 'exited';\n  exitCode?: number;\n  startedAt: string;\n  lastModified: string;\n  pid?: number;\n}\n\n@customElement('session-list')\nexport class SessionList extends LitElement {\n  // Disable shadow DOM to use Tailwind\n  createRenderRoot() {\n    return this;\n  }\n\n  @property({ type: Array }) sessions: Session[] = [];\n  @property({ type: Boolean }) loading = false;\n\n  @state() private killingSessionIds = new Set<string>();\n  @state() private loadedSnapshots = new Map<string, string>();\n  @state() private loadingSnapshots = new Set<string>();\n\n  private handleRefresh() {\n    this.dispatchEvent(new CustomEvent('refresh'));\n  }\n\n  private async loadSnapshot(sessionId: string) {\n    if (this.loadedSnapshots.has(sessionId) || this.loadingSnapshots.has(sessionId)) {\n      return;\n    }\n\n    this.loadingSnapshots.add(sessionId);\n    this.requestUpdate();\n\n    try {\n      // Just mark as loaded and create the player with the endpoint URL\n      this.loadedSnapshots.set(sessionId, sessionId);\n      this.requestUpdate();\n      \n      // Create asciinema player after the element is rendered\n      setTimeout(() => this.createPlayer(sessionId), 10);\n    } catch (error) {\n      console.error('Error loading snapshot:', error);\n    } finally {\n      this.loadingSnapshots.delete(sessionId);\n      this.requestUpdate();\n    }\n  }\n\n  private loadAllSnapshots() {\n    this.sessions.forEach(session => {\n      this.loadSnapshot(session.id);\n    });\n  }\n\n  updated(changedProperties: any) {\n    super.updated(changedProperties);\n    if (changedProperties.has('sessions')) {\n      // Auto-load all snapshots when sessions change\n      setTimeout(() => this.loadAllSnapshots(), 100);\n    }\n  }\n\n  private createPlayer(sessionId: string) {\n    const playerElement = this.querySelector(`#player-${sessionId}`) as HTMLElement;\n    if (playerElement && (window as any).AsciinemaPlayer) {\n      try {\n        const snapshotUrl = `/api/sessions/${sessionId}/snapshot`;\n        \n        (window as any).AsciinemaPlayer.create(snapshotUrl, playerElement, {\n          autoPlay: true,\n          loop: false,\n          controls: false,\n          fit: 'both',\n          terminalFontSize: '8px',\n          idleTimeLimit: 0.5,\n          preload: true,\n          poster: 'npt:999999'\n        });\n      } catch (error) {\n        console.error('Error creating asciinema player:', error);\n      }\n    }\n  }\n\n  private handleSessionClick(session: Session) {\n    this.dispatchEvent(new CustomEvent('session-select', {\n      detail: session\n    }));\n  }\n\n  private async handleKillSession(e: Event, sessionId: string) {\n    e.stopPropagation(); // Prevent session selection\n\n    if (!confirm('Are you sure you want to kill this session?')) {\n      return;\n    }\n\n    this.killingSessionIds.add(sessionId);\n    this.requestUpdate();\n\n    try {\n      const response = await fetch(`/api/sessions/${sessionId}`, {\n        method: 'DELETE'\n      });\n\n      if (response.ok) {\n        this.dispatchEvent(new CustomEvent('session-killed', {\n          detail: { sessionId }\n        }));\n        // Refresh the list after a short delay\n        setTimeout(() => {\n          this.handleRefresh();\n        }, 1000);\n      } else {\n        const error = await response.json();\n        this.dispatchEvent(new CustomEvent('error', {\n          detail: `Failed to kill session: ${error.error}`\n        }));\n      }\n    } catch (error) {\n      console.error('Error killing session:', error);\n      this.dispatchEvent(new CustomEvent('error', {\n        detail: 'Failed to kill session'\n      }));\n    } finally {\n      this.killingSessionIds.delete(sessionId);\n      this.requestUpdate();\n    }\n  }\n\n  private formatTime(timestamp: string): string {\n    try {\n      const date = new Date(timestamp);\n      return date.toLocaleTimeString();\n    } catch {\n      return 'Unknown';\n    }\n  }\n\n  private truncateId(id: string): string {\n    return id.length > 8 ? `${id.substring(0, 8)}...` : id;\n  }\n\n  render() {\n    return html`\n      <div class=\"font-mono text-sm p-4\">\n        ${this.sessions.length === 0 ? html`\n          <div class=\"text-vs-muted text-center py-8\">\n            ${this.loading ? 'Loading sessions...' : 'No sessions found'}\n          </div>\n        ` : html`\n          <div class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4\">\n            ${this.sessions.map(session => html`\n              <div \n                class=\"bg-vs-bg border border-vs-border rounded shadow cursor-pointer overflow-hidden\"\n                @click=${() => this.handleSessionClick(session)}\n              >\n                <!-- Compact Header -->\n                <div class=\"flex justify-between items-center px-3 py-2 border-b border-vs-border\">\n                  <div class=\"text-vs-text text-xs font-mono truncate pr-2 flex-1\">${session.command}</div>\n                  <button \n                    class=\"bg-vs-warning text-vs-bg hover:bg-vs-highlight font-mono px-2 py-0.5 border-none text-xs disabled:opacity-50 flex-shrink-0 rounded\"\n                    @click=${(e: Event) => this.handleKillSession(e, session.id)}\n                    ?disabled=${this.killingSessionIds.has(session.id)}\n                  >\n                    ${this.killingSessionIds.has(session.id) ? 'killing...' : 'kill'}\n                  </button>\n                </div>\n\n                <!-- Asciinema player (main content) -->\n                <div class=\"session-preview bg-black flex items-center justify-center\" style=\"aspect-ratio: 640/480;\">\n                  ${this.loadedSnapshots.has(session.id) ? html`\n                    <div id=\"player-${session.id}\" class=\"w-full h-full\" style=\"overflow: hidden;\"></div>\n                  ` : html`\n                    <div class=\"text-vs-muted text-xs\">\n                      ${this.loadingSnapshots.has(session.id) ? 'Loading...' : 'Loading...'}\n                    </div>\n                  `}\n                </div>\n\n                <!-- Compact Footer -->\n                <div class=\"px-3 py-2 text-vs-muted text-xs border-t border-vs-border\">\n                  <div class=\"flex justify-between items-center\">\n                    <span class=\"${session.status === 'running' ? 'text-vs-user' : 'text-vs-warning'} text-xs\">\n                      ${session.status}\n                    </span>\n                    <span class=\"truncate\">${this.truncateId(session.id)}</span>\n                  </div>\n                  <div class=\"truncate text-xs opacity-75\" title=\"${session.workingDir}\">${session.workingDir}</div>\n                </div>\n              </div>\n            `)}\n          </div>\n        `}\n      </div>\n    `;\n  }\n}"]}